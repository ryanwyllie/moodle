{"version":3,"sources":["../src/async_backup.js"],"names":["define","$","ajax","Str","notification","Templates","STATUS_FINISHED_ERR","STATUS_FINISHED_OK","Asyncbackup","checkdelay","backupid","contextid","restoreurl","typeid","backupintervalid","allbackupintervalid","updateElement","percentage","percentagewidth","Math","round","elementbar","percentagetext","toFixed","attr","css","text","updateBackupTableRow","statuscell","parent","tablerow","cellsiblings","siblings","timecell","timevalue","filenamecell","filename","call","methodname","args","done","response","context","time","size","filesize","fileurl","render","then","html","js","replaceNodeContents","fail","exception","Error","updateRestoreTableRow","coursecell","resourcename","updateProgress","progress","elementstatus","elementdetail","elementbutton","stringRequests","status","addClass","strProcessing","get_string","title","catch","removeClass","strStatus","strStatusDetail","key","component","get_strings","strings","children","last","clearInterval","strComplete","strDetail","strButton","param","updateProgressAll","forEach","element","type","operation","getBackupProgress","getAllBackupProgress","backupids","progressbars","find","not","each","push","id","substring","length","asyncBackupAllStatus","setInterval","asyncBackupStatus","backup","restore","removeAttr"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module updates the UI during an asynchronous\n * backup or restore process.\n *\n * @module     backup/util/async_backup\n * @package    core\n * @copyright  2018 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.7\n */\ndefine(['jquery', 'core/ajax', 'core/str', 'core/notification', 'core/templates'],\n        function($, ajax, Str, notification, Templates) {\n\n    /**\n     * Module level constants.\n     *\n     * Using var instead of const as ES6 isn't fully supported yet.\n     */\n    var STATUS_EXECUTING = 800;\n    var STATUS_FINISHED_ERR = 900;\n    var STATUS_FINISHED_OK = 1000;\n\n    /**\n     * Module level variables.\n     */\n    var Asyncbackup = {};\n    var checkdelay = 5000; //  How often we check for progress updates.\n    var backupid; //  The backup id to get the progress for.\n    var contextid; //  The course this backup progress is for.\n    var restoreurl; //  The URL to view course restores.\n    var typeid; //  The type of operation backup or restore.\n    var backupintervalid; //  The id of the setInterval function.\n    var allbackupintervalid; //  The id of the setInterval function.\n\n    /**\n     * Helper function to update UI components.\n     *\n     * @param {string} backupid The id to match elements on.\n     * @param {number} percentage The completion percentage to apply.\n     */\n    function updateElement(backupid, percentage) {\n        var percentagewidth = Math.round(percentage) + '%';\n        var elementbar = $('#' + backupid + '_bar');\n        var percentagetext = percentage.toFixed(2) + '%';\n\n        // Set progress bar percentage indicators\n        elementbar.attr('aria-valuenow', percentagewidth);\n        elementbar.css('width', percentagewidth);\n        elementbar.text(percentagetext);\n    }\n\n    /**\n     * Update backup table row when an async backup completes.\n     *\n     * @param {string} backupid The id to match elements on.\n     */\n    function updateBackupTableRow(backupid) {\n        var statuscell = $('#' + backupid + '_bar').parent().parent();\n        var tablerow = statuscell.parent();\n        var cellsiblings = statuscell.siblings();\n        var timecell = cellsiblings[1];\n        var timevalue = $(timecell).text();\n        var filenamecell = cellsiblings[0];\n        var filename = $(filenamecell).text();\n\n        ajax.call([{\n            // Get the table data via webservice.\n            methodname: 'core_backup_get_async_backup_links_backup',\n            args: {\n                'filename': filename,\n                'contextid': contextid\n            },\n        }])[0].done(function(response) {\n            // We have the data now update the UI.\n            var context = {\n                    filename: filename,\n                    time: timevalue,\n                    size: response.filesize,\n                    fileurl: response.fileurl,\n                    restoreurl: response.restoreurl\n                    };\n\n            Templates.render('core/async_backup_progress_row', context).then(function(html, js) {\n                Templates.replaceNodeContents(tablerow, html, js);\n                return;\n            }).fail(function() {\n                notification.exception(new Error('Failed to load table row'));\n                return;\n            });\n        });\n    }\n\n    /**\n     * Update restore table row when an async restore completes.\n     *\n     * @param {string} backupid The id to match elements on.\n     */\n    function updateRestoreTableRow(backupid) {\n        var statuscell = $('#' + backupid + '_bar').parent().parent();\n        var tablerow = statuscell.parent();\n        var cellsiblings = statuscell.siblings();\n        var coursecell = cellsiblings[0];\n        var timecell = cellsiblings[1];\n        var timevalue = $(timecell).text();\n\n        ajax.call([{\n            // Get the table data via webservice.\n            methodname: 'core_backup_get_async_backup_links_restore',\n            args: {\n                'backupid': backupid,\n                'contextid': contextid\n            },\n        }])[0].done(function(response) {\n         // We have the data now update the UI.\n            var resourcename = $(coursecell).text();\n            var context = {\n                    resourcename: resourcename,\n                    restoreurl: response.restoreurl,\n                    time: timevalue\n                    };\n\n            Templates.render('core/async_restore_progress_row', context).then(function(html, js) {\n                Templates.replaceNodeContents(tablerow, html, js);\n                return;\n            }).fail(function() {\n                notification.exception(new Error('Failed to load table row'));\n                return;\n            });\n        });\n    }\n\n    /**\n     * Update the Moodle user interface with the progress of\n     * the backup process.\n     *\n     * @param {object} progress The progress and status of the process.\n     */\n    function updateProgress(progress) {\n        var percentage = progress.progress * 100;\n        var elementbar = $('#' + backupid + '_bar');\n        var elementstatus = $('#' + backupid + '_status');\n        var elementdetail = $('#' + backupid + '_detail');\n        var elementbutton = $('#' + backupid + '_button');\n        var stringRequests;\n\n        if (progress.status == STATUS_EXECUTING) {\n            // Process is in progress.\n            // Add in progress class color to bar\n            elementbar.addClass('bg-success');\n\n            updateElement(backupid, percentage);\n\n            // Change heading\n            var strProcessing = 'async' + typeid + 'processing';\n            Str.get_string(strProcessing, 'backup').then(function(title) {\n                elementstatus.text(title);\n                return title;\n            }).catch(function() {\n                notification.exception(new Error('Failed to load string: backup ' + strProcessing));\n            });\n\n        } else if (progress.status == STATUS_FINISHED_ERR) {\n            // Process completed with error.\n\n            // Add in fail class color to bar\n            elementbar.addClass('bg-danger');\n\n            // Remove in progress class color to bar\n            elementbar.removeClass('bg-success');\n\n            updateElement(backupid, 100);\n\n            // Change heading and text\n            var strStatus = 'async' + typeid + 'error';\n            var strStatusDetail = 'async' + typeid + 'errordetail';\n            stringRequests = [\n                {key: strStatus, component: 'backup'},\n                {key: strStatusDetail, component: 'backup'}\n            ];\n            Str.get_strings(stringRequests).then(function(strings) {\n                elementstatus.text(strings[0]);\n                elementdetail.text(strings[1]);\n\n                return strings;\n            })\n            .catch(function() {\n                notification.exception(new Error('Failed to load string'));\n                return;\n            });\n\n            $('.backup_progress').children('span').removeClass('backup_stage_current');\n            $('.backup_progress').children('span').last().addClass('backup_stage_current');\n\n            // Stop checking when we either have an error or a completion.\n            clearInterval(backupintervalid);\n\n        } else if (progress.status == STATUS_FINISHED_OK) {\n            // Process completed successfully.\n\n            // Add in progress class color to bar\n            elementbar.addClass('bg-success');\n\n            updateElement(backupid, 100);\n\n            // Change heading and text\n            var strComplete = 'async' + typeid + 'complete';\n            Str.get_string(strComplete, 'backup').then(function(title) {\n                elementstatus.text(title);\n                return title;\n            }).catch(function() {\n                notification.exception(new Error('Failed to load string: backup ' + strComplete));\n            });\n\n            if (typeid == 'restore') {\n                ajax.call([{\n                    // Get the table data via webservice.\n                    methodname: 'core_backup_get_async_backup_links_restore',\n                    args: {\n                        'backupid': backupid,\n                        'contextid': contextid\n                    },\n                }])[0].done(function(response) {\n                    var strDetail = 'async' + typeid + 'completedetail';\n                    var strButton = 'async' + typeid + 'completebutton';\n                    var stringRequests = [\n                        {key: strDetail, component: 'backup', param: response.restoreurl},\n                        {key: strButton, component: 'backup'}\n                    ];\n                    Str.get_strings(stringRequests).then(function(strings) {\n                        elementdetail.html(strings[0]);\n                        elementbutton.text(strings[1]);\n                        elementbutton.attr('href', response.restoreurl);\n\n                        return strings;\n                    })\n                    .catch(function() {\n                        notification.exception(new Error('Failed to load string'));\n                        return;\n                    });\n\n                });\n            } else {\n                var strDetail = 'async' + typeid + 'completedetail';\n                var strButton = 'async' + typeid + 'completebutton';\n                stringRequests = [\n                    {key: strDetail, component: 'backup', param: restoreurl},\n                    {key: strButton, component: 'backup'}\n                ];\n                Str.get_strings(stringRequests).then(function(strings) {\n                    elementdetail.html(strings[0]);\n                    elementbutton.text(strings[1]);\n                    elementbutton.attr('href', restoreurl);\n\n                    return strings;\n                })\n                .catch(function() {\n                    notification.exception(new Error('Failed to load string'));\n                    return;\n                });\n\n            }\n\n            $('.backup_progress').children('span').removeClass('backup_stage_current');\n            $('.backup_progress').children('span').last().addClass('backup_stage_current');\n\n            // Stop checking when we either have an error or a completion.\n            clearInterval(backupintervalid);\n        }\n    }\n\n    /**\n     * Update the Moodle user interface with the progress of\n     * all the pending processes.\n     *\n     * @param {object} progress The progress and status of the process.\n     */\n    function updateProgressAll(progress) {\n        progress.forEach(function(element) {\n            var percentage = element.progress * 100;\n            var backupid = element.backupid;\n            var elementbar = $('#' + backupid + '_bar');\n            var type = element.operation;\n\n            if (element.status == STATUS_EXECUTING) {\n                // Process is in element.\n\n                // Add in element class color to bar\n                elementbar.addClass('bg-success');\n\n                updateElement(backupid, percentage);\n\n            } else if (element.status == STATUS_FINISHED_ERR) {\n                // Process completed with error.\n\n                // Add in fail class color to bar\n                elementbar.addClass('bg-danger');\n                elementbar.addClass('complete');\n\n                // Remove in element class color to bar\n                $('#' + backupid + '_bar').removeClass('bg-success');\n\n                updateElement(backupid, 100);\n\n            } else if (element.status == STATUS_FINISHED_OK) {\n                // Process completed successfully.\n\n                // Add in element class color to bar\n                elementbar.addClass('bg-success');\n                elementbar.addClass('complete');\n\n                updateElement(backupid, 100);\n\n                // We have a successful backup. Update the UI with download and file details.\n                if (type == 'backup') {\n                    updateBackupTableRow(backupid);\n                } else {\n                    updateRestoreTableRow(backupid);\n                }\n\n            }\n\n        });\n    }\n\n    /**\n     * Get the progress of the backup process via ajax.\n     */\n    function getBackupProgress() {\n        ajax.call([{\n            // Get the backup progress via webservice.\n            methodname: 'core_backup_get_async_backup_progress',\n            args: {\n                'backupids': [backupid],\n                'contextid': contextid\n            },\n        }])[0].done(function(response) {\n            // We have the progress now update the UI.\n            updateProgress(response[0]);\n        });\n    }\n\n    /**\n     * Get the progress of all backup processes via ajax.\n     */\n    function getAllBackupProgress() {\n        var backupids = [];\n        var progressbars = $('.progress').find('.progress-bar').not('.complete');\n\n        progressbars.each(function() {\n            backupids.push((this.id).substring(0, 32));\n        });\n\n        if (backupids.length > 0) {\n            ajax.call([{\n                // Get the backup progress via webservice.\n                methodname: 'core_backup_get_async_backup_progress',\n                args: {\n                    'backupids': backupids,\n                    'contextid': contextid\n                },\n            }])[0].done(function(response) {\n                updateProgressAll(response);\n            });\n        } else {\n            clearInterval(allbackupintervalid); // No more progress bars to update, stop checking.\n        }\n    }\n\n    /**\n     * Get status updates for all backups.\n     *\n     * @public\n     * @param {number} context The context id.\n     */\n    Asyncbackup.asyncBackupAllStatus = function(context) {\n        contextid = context;\n        allbackupintervalid = setInterval(getAllBackupProgress, checkdelay);\n    };\n\n    /**\n     * Get status updates for backup.\n     *\n     * @public\n     * @param {string} backup The backup record id.\n     * @param {number} context The context id.\n     * @param {string} restore The restore link.\n     * @param {string} type The operation type (backup or restore).\n     */\n    Asyncbackup.asyncBackupStatus = function(backup, context, restore, type) {\n        backupid = backup;\n        contextid = context;\n        restoreurl = restore;\n\n        if (type == 'backup') {\n            typeid = 'backup';\n        } else {\n            typeid = 'restore';\n        }\n\n        // Remove the links from the progress bar, no going back now.\n        $('.backup_progress').children('a').removeAttr('href');\n\n        //  Periodically check for progress updates and update the UI as required.\n        backupintervalid = setInterval(getBackupProgress, checkdelay);\n\n      };\n\n      return Asyncbackup;\n});\n"],"file":"async_backup.min.js"}