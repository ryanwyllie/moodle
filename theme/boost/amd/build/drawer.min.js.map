{"version":3,"sources":["../src/drawer.js"],"names":["define","$","CustomEvents","Log","SELECTORS","TOGGLE_REGION","TOGGLE_ACTION","TOGGLE_TARGET","TOGGLE_SIDE","BODY","SECTION","small","document","width","Drawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","getElementById","hidden","side","body","preference","M","util","set_user_preference","on","preventPageScroll","addClass","bind","registerEventListeners","closeAll","prototype","removeClass","toggleDrawer","e","target","closest","open","focus","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"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","file":"drawer.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for a drawer.\n *\n * @package    theme_boost\n * @copyright  2016 Damyon Wiese\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/custom_interaction_events', 'core/log'],\n     function($, CustomEvents, Log) {\n\n    var SELECTORS = {\n        TOGGLE_REGION: '[data-region=\"drawer-toggle\"]',\n        TOGGLE_ACTION: '[data-action=\"toggle-drawer\"]',\n        TOGGLE_TARGET: 'aria-controls',\n        TOGGLE_SIDE: 'left',\n        BODY: 'body',\n        SECTION: '.list-group-item[href*=\"#section-\"]'\n    };\n\n    var small = $(document).width() < 768;\n\n    /**\n     * Constructor for the Drawer.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var Drawer = function() {\n\n        if (!$(SELECTORS.TOGGLE_REGION).length) {\n            Log.debug('Page is missing a drawer region');\n        }\n        if (!$(SELECTORS.TOGGLE_ACTION).length) {\n            Log.debug('Page is missing a drawer toggle link');\n        }\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var hidden = trigger.attr('aria-expanded') == 'false';\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n            var preference = trigger.attr('data-preference');\n            if (small) {\n                M.util.set_user_preference(preference, 'false');\n            }\n\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\n\n            if (!hidden) {\n                body.addClass('drawer-open-' + side);\n                trigger.attr('aria-expanded', 'true');\n            } else {\n                trigger.attr('aria-expanded', 'false');\n            }\n        }.bind(this));\n\n        this.registerEventListeners();\n        if (small) {\n            this.closeAll();\n        }\n    };\n\n    Drawer.prototype.closeAll = function() {\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var preference = trigger.attr('data-preference');\n\n            trigger.attr('aria-expanded', 'false');\n            body.removeClass('drawer-open-' + side);\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            if (!small) {\n                M.util.set_user_preference(preference, 'false');\n            }\n        });\n    };\n\n    /**\n     * Open / close the blocks drawer.\n     *\n     * @method toggleDrawer\n     * @param {Event} e\n     */\n    Drawer.prototype.toggleDrawer = function(e) {\n        var trigger = $(e.target).closest('[data-action=toggle-drawer]');\n        var drawerid = trigger.attr('aria-controls');\n        var drawer = $(document.getElementById(drawerid));\n        var body = $(SELECTORS.BODY);\n        var side = trigger.attr('data-side');\n        var preference = trigger.attr('data-preference');\n        if (small) {\n            M.util.set_user_preference(preference, 'false');\n        }\n\n        body.addClass('drawer-ease');\n        var open = trigger.attr('aria-expanded') == 'true';\n        if (!open) {\n            // Open.\n            trigger.attr('aria-expanded', 'true');\n            drawer.attr('aria-hidden', 'false');\n            drawer.focus();\n            body.addClass('drawer-open-' + side);\n            drawer.removeClass('closed');\n            if (!small) {\n                M.util.set_user_preference(preference, 'true');\n            }\n        } else {\n            // Close.\n            body.removeClass('drawer-open-' + side);\n            trigger.attr('aria-expanded', 'false');\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            if (!small) {\n                M.util.set_user_preference(preference, 'false');\n            }\n        }\n    };\n\n    /**\n     * Prevent the page from scrolling when the drawer is at max scroll.\n     *\n     * @method preventPageScroll\n     * @param  {Event} e\n     */\n    Drawer.prototype.preventPageScroll = function(e) {\n        var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\n            bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\n            topOverflow = this.scrollTop <= 0;\n\n        if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\n            e.preventDefault();\n        }\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    Drawer.prototype.registerEventListeners = function() {\n\n        $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n            CustomEvents.define($(element), [CustomEvents.events.activate]);\n            $(element).on(CustomEvents.events.activate, function(e, data) {\n                this.toggleDrawer(data.originalEvent);\n                data.originalEvent.preventDefault();\n            }.bind(this));\n        }.bind(this));\n\n        $(SELECTORS.SECTION).click(function() {\n            if (small) {\n                this.closeAll();\n            }\n        }.bind(this));\n    };\n\n    return {\n        'init': function() {\n            return new Drawer();\n        }\n    };\n});\n"]}