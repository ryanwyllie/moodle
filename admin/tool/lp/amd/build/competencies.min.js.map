{"version":3,"sources":["../src/competencies.js"],"names":["define","$","notification","ajax","templates","str","Picker","dragdrop","competencies","itemid","itemtype","pagectxid","pageContextId","pickerInstance","prop","registerEvents","registerDragDrop","prototype","localthis","get_string","done","movestring","identifier","component","drag","drop","handleDrop","fail","exception","fromid","data","toid","requests","call","methodname","args","courseid","competencyidfrom","competencyidto","templateid","planid","pickCompetency","self","pagerender","pageregion","pageContextIncludes","on","e","compIds","competencyIds","each","index","compId","push","competencyid","moduleid","pagecontext","contextid","length","then","context","render","html","js","replaceWith","runTemplateJS","catch","display","doDelete","deleteid","deleteHandler","message","id","competency","get_strings","key","param","shortname","strings","confirm","coursecompetencyid","target","ruleoutcome","val","click","preventDefault","closest"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle add/remove competency links.\n *\n * @module     tool_lp/competencies\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'core/ajax',\n        'core/templates',\n        'core/str',\n        'tool_lp/competencypicker',\n        'tool_lp/dragdrop-reorder'],\n       function($, notification, ajax, templates, str, Picker, dragdrop) {\n\n    /**\n     * Constructor\n     *\n     * @param {Number} itemid\n     * @param {String} itemtype\n     * @param {Number} pagectxid\n     */\n    var competencies = function(itemid, itemtype, pagectxid) {\n        this.itemid = itemid;\n        this.itemtype = itemtype;\n        this.pageContextId = pagectxid;\n        this.pickerInstance = null;\n\n        $('[data-region=\"actions\"] button').prop('disabled', false);\n        this.registerEvents();\n        this.registerDragDrop();\n    };\n\n    /**\n     * Initialise the drag/drop code.\n     * @method registerDragDrop\n     */\n    competencies.prototype.registerDragDrop = function() {\n        var localthis = this;\n        // Init this module.\n        str.get_string('movecompetency', 'tool_lp').done(\n            function(movestring) {\n                dragdrop.dragdrop('movecompetency',\n                                  movestring,\n                                  {identifier: 'movecompetency', component: 'tool_lp'},\n                                  {identifier: 'movecompetencyafter', component: 'tool_lp'},\n                                  'drag-samenode',\n                                  'drag-parentnode',\n                                  'drag-handlecontainer',\n                                  function(drag, drop) {\n                                      localthis.handleDrop(drag, drop);\n                                  });\n            }\n        ).fail(notification.exception);\n\n    };\n\n    /**\n     * Handle a drop from a drag/drop operation.\n     *\n     * @method handleDrop\n     * @param {DOMNode} drag The dragged node.\n     * @param {DOMNode} drop The dropped on node.\n     */\n    competencies.prototype.handleDrop = function(drag, drop) {\n        var fromid = $(drag).data('id');\n        var toid = $(drop).data('id');\n        var localthis = this;\n        var requests = [];\n\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_course_competency',\n                    args: {courseid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_template_competency',\n                    args: {templateid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_plan_competency',\n                    args: {planid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else {\n            return;\n        }\n\n        requests[0].fail(notification.exception);\n    };\n\n    /**\n     * Pick a competency\n     *\n     * @method pickCompetency\n     */\n    competencies.prototype.pickCompetency = function() {\n        var self = this;\n        var requests;\n        var pagerender;\n        var pageregion;\n        var pageContextIncludes;\n\n        if (!self.pickerInstance) {\n            if (self.itemtype === 'template' || self.itemtype === 'course') {\n                pageContextIncludes = 'parents';\n            }\n            self.pickerInstance = new Picker(self.pageContextId, false, pageContextIncludes);\n            self.pickerInstance.on('save', function(e, data) {\n                var compIds = data.competencyIds;\n\n                if (self.itemtype === \"course\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_course',\n                            args: {courseid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_course_competencies_page',\n                        args: {courseid: self.itemid, moduleid: 0}\n                    });\n\n                    pagerender = 'tool_lp/course_competencies_page';\n                    pageregion = 'coursecompetenciespage';\n\n                } else if (self.itemtype === \"template\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_template',\n                            args: {templateid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_template_competencies_page',\n                        args: {templateid: self.itemid, pagecontext: {contextid: self.pageContextId}}\n                    });\n                    pagerender = 'tool_lp/template_competencies_page';\n                    pageregion = 'templatecompetenciespage';\n                } else if (self.itemtype === \"plan\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_plan',\n                            args: {planid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                         methodname: 'tool_lp_data_for_plan_page',\n                         args: {planid: self.itemid}\n                    });\n                    pagerender = 'tool_lp/plan_page';\n                    pageregion = 'plan-page';\n                }\n                ajax.call(requests)[requests.length - 1].then(function(context) {\n                    return templates.render(pagerender, context);\n                }).then(function(html, js) {\n                    $('[data-region=\"' + pageregion + '\"]').replaceWith(html);\n                    templates.runTemplateJS(js);\n                    return;\n                }).catch(notification.exception);\n            });\n        }\n\n        self.pickerInstance.display();\n    };\n\n    /**\n     * Delete the link between competency and course, template or plan. Reload the page.\n     *\n     * @method doDelete\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.doDelete = function(deleteid) {\n        var localthis = this;\n        var requests = [],\n            pagerender = '',\n            pageregion = '';\n\n        // Delete the link and reload the page template.\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_course',\n                    args: {courseid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_course_competencies_page',\n                    args: {courseid: localthis.itemid, moduleid: 0}}\n            ]);\n            pagerender = 'tool_lp/course_competencies_page';\n            pageregion = 'coursecompetenciespage';\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_template',\n                    args: {templateid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_template_competencies_page',\n                    args: {templateid: localthis.itemid, pagecontext: {contextid: localthis.pageContextId}}}\n            ]);\n            pagerender = 'tool_lp/template_competencies_page';\n            pageregion = 'templatecompetenciespage';\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_plan',\n                    args: {planid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_plan_page',\n                    args: {planid: localthis.itemid}}\n            ]);\n            pagerender = 'tool_lp/plan_page';\n            pageregion = 'plan-page';\n        }\n\n        requests[1].done(function(context) {\n            templates.render(pagerender, context).done(function(html, js) {\n                $('[data-region=\"' + pageregion + '\"]').replaceWith(html);\n                templates.runTemplateJS(js);\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n\n    };\n\n    /**\n     * Show a confirm dialogue before deleting a competency.\n     *\n     * @method deleteHandler\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.deleteHandler = function(deleteid) {\n        var localthis = this;\n        var requests = [];\n        var message;\n\n        if (localthis.itemtype == 'course') {\n            message = 'unlinkcompetencycourse';\n        } else if (localthis.itemtype == 'template') {\n            message = 'unlinkcompetencytemplate';\n        } else if (localthis.itemtype == 'plan') {\n            message = 'unlinkcompetencyplan';\n        } else {\n            return;\n        }\n\n        requests = ajax.call([{\n            methodname: 'core_competency_read_competency',\n            args: {id: deleteid}\n        }]);\n\n        requests[0].done(function(competency) {\n            str.get_strings([\n                {key: 'confirm', component: 'moodle'},\n                {key: message, component: 'tool_lp', param: competency.shortname},\n                {key: 'confirm', component: 'moodle'},\n                {key: 'cancel', component: 'moodle'}\n            ]).done(function(strings) {\n                notification.confirm(\n                    strings[0], // Confirm.\n                    strings[1], // Unlink the competency X from the course?\n                    strings[2], // Confirm.\n                    strings[3], // Cancel.\n                    function() {\n                        localthis.doDelete(deleteid);\n                    }\n                );\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n    };\n\n    /**\n     * Register the javascript event handlers for this page.\n     *\n     * @method registerEvents\n     */\n    competencies.prototype.registerEvents = function() {\n        var localthis = this;\n\n        if (localthis.itemtype == 'course') {\n            // Course completion rule handling.\n            $('[data-region=\"coursecompetenciespage\"]').on('change', 'select[data-field=\"ruleoutcome\"]', function(e) {\n                var requests = [];\n                var pagerender = 'tool_lp/course_competencies_page';\n                var pageregion = 'coursecompetenciespage';\n                var coursecompetencyid = $(e.target).data('id');\n                var ruleoutcome = $(e.target).val();\n                requests = ajax.call([\n                    {methodname: 'core_competency_set_course_competency_ruleoutcome',\n                      args: {coursecompetencyid: coursecompetencyid, ruleoutcome: ruleoutcome}},\n                    {methodname: 'tool_lp_data_for_course_competencies_page',\n                      args: {courseid: localthis.itemid, moduleid: 0}}\n                ]);\n\n                requests[1].done(function(context) {\n                    templates.render(pagerender, context).done(function(html, js) {\n                        $('[data-region=\"' + pageregion + '\"]').replaceWith(html);\n                        templates.runTemplateJS(js);\n                    }).fail(notification.exception);\n                }).fail(notification.exception);\n            });\n        }\n\n        $('[data-region=\"actions\"] button').click(function(e) {\n            e.preventDefault();\n            localthis.pickCompetency();\n        });\n        $('[data-action=\"delete-competency-link\"]').click(function(e) {\n            e.preventDefault();\n\n            var deleteid = $(e.target).closest('[data-id]').data('id');\n            localthis.deleteHandler(deleteid);\n        });\n    };\n\n    return /** @alias module:tool_lp/competencies */ competencies;\n});\n"],"file":"competencies.min.js"}