define("tool_lp/competencytree",["core/ajax","core/notification","core/templates","tool_lp/tree","tool_lp/competency_outcomes","jquery"],function(a,b,c,d,e,f){var g={},h=0,j="",i="",k="",l=!1,m=function(a,b){var c=0,d=!1;a.haschildren=!1;a.children=[];for(c=0;c<b.length;c++){d=b[c];if(d.parentid==a.id){a.haschildren=!0;a.children.push(d);m(d,b)}}},n=function(b){var e=f.Deferred();c.render("tool_lp/loading",{}).done(function(n,o){c.replaceNodeContents(f(i),n,o);var p=a.call([{methodname:"core_competency_search_competencies",args:{searchtext:b,competencyframeworkid:h}}]);p[0].done(function(a){g={};var b=0;for(b=0;b<a.length;b++){g[a[b].id]=a[b]}var h=[],n=!1;for(b=0;b<a.length;b++){n=a[b];if(0===parseInt(n.parentid,10)){h.push(n);m(n,a)}}var o={shortname:j,canmanage:l,competencies:h};c.render("tool_lp/competencies_tree_root",o).done(function(a,b){c.replaceNodeContents(f(i),f(a).html(),b);var h=new d(i,!1);if(k){var j=f(i).find("[data-id="+k+"]");if(j.length){h.selectItem(j);h.updateFocus(j)}}e.resolve(g)}).fail(e.reject)}).fail(e.reject)});return e.promise()},o=function(a,b){var c=b.selected;k=c.attr("data-id")};return{init:function init(a,c,d,e,f,g){h=a;j=c;l=f;i=e;n(d).fail(b.exception);if(0<g){k=g}this.on("selectionchanged",o)},on:function on(a,b){f(i).on(a,b)},getChildren:function getChildren(a){var b=[];f.each(g,function(c,d){if(d.parentid==a){b.push(d)}});return b},getCompetencyFrameworkId:function getCompetencyFrameworkId(){return h},getCompetency:function getCompetency(a){return g[a]},getCompetencyLevel:function getCompetencyLevel(a){var b=this.getCompetency(a),c=b.path.replace(/^\/|\/$/g,"").split("/").length;return c},hasChildren:function hasChildren(a){return 0<this.getChildren(a).length},hasRule:function hasRule(a){var b=this.getCompetency(a);if(b){return b.ruleoutcome!=e.OUTCOME_NONE&&b.ruletype}return!1},reloadCompetencies:function reloadCompetencies(){return n("").fail(b.exception)},listCompetencies:function listCompetencies(){return g}}});
//# sourceMappingURL=competencytree.min.js.map
