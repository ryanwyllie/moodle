{"version":3,"sources":["../src/course_competency_settings.js"],"names":["define","$","notification","Dialogue","str","ajax","templates","settingsMod","selector","on","configureSettings","bind","prototype","_dialogue","e","courseid","target","closest","data","currentValue","preventDefault","render","settings","pushratingstouserplans","done","html","get_string","title","addListeners","fail","exception","save","_find","saveSettings","cancel","cancelChanges","close","find","newValue","val","courseId","call","methodname","args","refreshCourseCompetenciesPage","context","js","replaceWith","runTemplateJS"],"mappings":"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","file":"course_competency_settings.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Change the course competency settings in a popup.\n *\n * @module     tool_lp/configurecoursecompetencysettings\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'tool_lp/dialogue',\n        'core/str',\n        'core/ajax',\n        'core/templates'],\n       function($, notification, Dialogue, str, ajax, templates) {\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector - selector for the links to open the dialogue.\n     */\n    var settingsMod = function(selector) {\n        $(selector).on('click', this.configureSettings.bind(this));\n    };\n\n    /** @type {Dialogue} Reference to the dialogue that we opened. */\n    settingsMod.prototype._dialogue = null;\n\n    /**\n     * Open the configure settings dialogue.\n     *\n     * @param {Event} e\n     * @method configureSettings\n     */\n    settingsMod.prototype.configureSettings = function(e) {\n        var courseid = $(e.target).closest('a').data('courseid');\n        var currentValue = $(e.target).closest('a').data('pushratingstouserplans');\n        var context = {\n            courseid: courseid,\n            settings: {pushratingstouserplans: currentValue}\n        };\n        e.preventDefault();\n\n        templates.render('tool_lp/course_competency_settings', context).done(function(html) {\n            str.get_string('configurecoursecompetencysettings', 'tool_lp').done(function(title) {\n                this._dialogue = new Dialogue(\n                    title,\n                    html,\n                    this.addListeners.bind(this)\n                );\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Add the save listener to the form.\n     *\n     * @method addSaveListener\n     */\n    settingsMod.prototype.addListeners = function() {\n        var save = this._find('[data-action=\"save\"]');\n        save.on('click', this.saveSettings.bind(this));\n        var cancel = this._find('[data-action=\"cancel\"]');\n        cancel.on('click', this.cancelChanges.bind(this));\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {Event} e\n     * @method cancelChanges\n     */\n    settingsMod.prototype.cancelChanges = function(e) {\n        e.preventDefault();\n        this._dialogue.close();\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {String} selector\n     * @return {JQuery}\n     */\n    settingsMod.prototype._find = function(selector) {\n        return $('[data-region=\"coursecompetencysettings\"]').find(selector);\n    };\n\n    /**\n     * Save the settings.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.saveSettings = function(e) {\n        e.preventDefault();\n\n        var newValue = this._find('input[name=\"pushratingstouserplans\"]:checked').val();\n        var courseId = this._find('input[name=\"courseid\"]').val();\n        var settings = {pushratingstouserplans: newValue};\n\n        ajax.call([\n            {methodname: 'core_competency_update_course_competency_settings',\n              args: {courseid: courseId, settings: settings}}\n        ])[0].done(function() {\n            this.refreshCourseCompetenciesPage();\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Refresh the course competencies page.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.refreshCourseCompetenciesPage = function() {\n        var courseId = this._find('input[name=\"courseid\"]').val();\n\n        ajax.call([\n            {methodname: 'tool_lp_data_for_course_competencies_page',\n              args: {courseid: courseId}}\n        ])[0].done(function(context) {\n            templates.render('tool_lp/course_competencies_page', context).done(function(html, js) {\n                $('[data-region=\"coursecompetenciespage\"]').replaceWith(html);\n                templates.runTemplateJS(js);\n                this._dialogue.close();\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    return /** @alias module:tool_lp/configurecoursecompetencysettings */ settingsMod;\n});\n"]}