{"version":3,"sources":["../src/course_competency_settings.js"],"names":["define","$","notification","Dialogue","str","ajax","templates","settingsMod","selector","on","configureSettings","bind","prototype","_dialogue","e","courseid","target","closest","data","currentValue","preventDefault","render","settings","pushratingstouserplans","done","html","get_string","title","addListeners","fail","exception","save","_find","saveSettings","cancel","cancelChanges","close","find","newValue","val","courseId","call","methodname","args","refreshCourseCompetenciesPage","moduleid","context","js","replaceWith","runTemplateJS"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Change the course competency settings in a popup.\n *\n * @module     tool_lp/configurecoursecompetencysettings\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'tool_lp/dialogue',\n        'core/str',\n        'core/ajax',\n        'core/templates'],\n       function($, notification, Dialogue, str, ajax, templates) {\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector - selector for the links to open the dialogue.\n     */\n    var settingsMod = function(selector) {\n        $(selector).on('click', this.configureSettings.bind(this));\n    };\n\n    /** @type {Dialogue} Reference to the dialogue that we opened. */\n    settingsMod.prototype._dialogue = null;\n\n    /**\n     * Open the configure settings dialogue.\n     *\n     * @param {Event} e\n     * @method configureSettings\n     */\n    settingsMod.prototype.configureSettings = function(e) {\n        var courseid = $(e.target).closest('a').data('courseid');\n        var currentValue = $(e.target).closest('a').data('pushratingstouserplans');\n        var context = {\n            courseid: courseid,\n            settings: {pushratingstouserplans: currentValue}\n        };\n        e.preventDefault();\n\n        templates.render('tool_lp/course_competency_settings', context).done(function(html) {\n            str.get_string('configurecoursecompetencysettings', 'tool_lp').done(function(title) {\n                this._dialogue = new Dialogue(\n                    title,\n                    html,\n                    this.addListeners.bind(this)\n                );\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Add the save listener to the form.\n     *\n     * @method addSaveListener\n     */\n    settingsMod.prototype.addListeners = function() {\n        var save = this._find('[data-action=\"save\"]');\n        save.on('click', this.saveSettings.bind(this));\n        var cancel = this._find('[data-action=\"cancel\"]');\n        cancel.on('click', this.cancelChanges.bind(this));\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {Event} e\n     * @method cancelChanges\n     */\n    settingsMod.prototype.cancelChanges = function(e) {\n        e.preventDefault();\n        this._dialogue.close();\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {String} selector\n     * @return {JQuery}\n     */\n    settingsMod.prototype._find = function(selector) {\n        return $('[data-region=\"coursecompetencysettings\"]').find(selector);\n    };\n\n    /**\n     * Save the settings.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.saveSettings = function(e) {\n        e.preventDefault();\n\n        var newValue = this._find('input[name=\"pushratingstouserplans\"]:checked').val();\n        var courseId = this._find('input[name=\"courseid\"]').val();\n        var settings = {pushratingstouserplans: newValue};\n\n        ajax.call([\n            {methodname: 'core_competency_update_course_competency_settings',\n              args: {courseid: courseId, settings: settings}}\n        ])[0].done(function() {\n            this.refreshCourseCompetenciesPage();\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Refresh the course competencies page.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.refreshCourseCompetenciesPage = function() {\n        var courseId = this._find('input[name=\"courseid\"]').val();\n\n        ajax.call([\n            {methodname: 'tool_lp_data_for_course_competencies_page',\n              args: {courseid: courseId, moduleid: 0}}\n        ])[0].done(function(context) {\n            templates.render('tool_lp/course_competencies_page', context).done(function(html, js) {\n                $('[data-region=\"coursecompetenciespage\"]').replaceWith(html);\n                templates.runTemplateJS(js);\n                this._dialogue.close();\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    return /** @alias module:tool_lp/configurecoursecompetencysettings */ settingsMod;\n});\n"],"file":"course_competency_settings.min.js"}