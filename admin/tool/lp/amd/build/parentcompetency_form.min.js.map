{"version":3,"sources":["../src/parentcompetency_form.js"],"names":["define","$","ajax","Str","Picker","Templates","Notification","ParentCompetencyForm","buttonSelector","inputHiddenSelector","staticElementSelector","frameworkId","pageContextId","registerEvents","prototype","setParent","data","self","competencyId","get_string","then","rootframework","html","val","fail","exception","call","methodname","args","id","done","competency","shortname","on","e","preventDefault","picker","_render","_preRender","context","competencies","_competencies","framework","_getFramework","_frameworkId","frameworks","_frameworks","search","_searchText","singleFramework","_singleFramework","render","display","init","inputSelector"],"mappings":"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","file":"parentcompetency_form.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle selecting parent competency in competency form.\n *\n * @module     tool_lp/parentcompetency_form\n * @package    tool_lp\n * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/str', 'tool_lp/competencypicker', 'core/templates', 'core/notification'],\n    function($, ajax, Str, Picker, Templates, Notification) {\n\n    /**\n     * Parent Competency Form object.\n     * @param {String} buttonSelector The parent competency button selector.\n     * @param {String} inputHiddenSelector The hidden input field selector.\n     * @param {String} staticElementSelector The static element displaying the parent competency.\n     * @param {Number} frameworkId The competency framework ID.\n     * @param {Number} pageContextId The page context ID.\n     */\n    var ParentCompetencyForm = function(buttonSelector,\n                                        inputHiddenSelector,\n                                        staticElementSelector,\n                                        frameworkId,\n                                        pageContextId) {\n        this.buttonSelector = buttonSelector;\n        this.inputHiddenSelector = inputHiddenSelector;\n        this.staticElementSelector = staticElementSelector;\n        this.frameworkId = frameworkId;\n        this.pageContextId = pageContextId;\n\n        // Register the events.\n        this.registerEvents();\n    };\n\n    /** @var {String} The parent competency button selector. */\n    ParentCompetencyForm.prototype.buttonSelector = null;\n    /** @var {String} The hidden input field selector. */\n    ParentCompetencyForm.prototype.inputHiddenSelector = null;\n    /** @var {String} The static element displaying the parent competency. */\n    ParentCompetencyForm.prototype.staticElementSelector = null;\n    /** @var {Number} The competency framework ID. */\n    ParentCompetencyForm.prototype.frameworkId = null;\n    /** @var {Number} The page context ID. */\n    ParentCompetencyForm.prototype.pageContextId = null;\n\n    /**\n     * Set the parent competency in the competency form.\n     *\n     * @param {Object} data Data containing selected competency.\n     * @method setParent\n     */\n    ParentCompetencyForm.prototype.setParent = function(data) {\n        var self = this;\n\n        if (data.competencyId !== 0) {\n            ajax.call([\n                {methodname: 'core_competency_read_competency', args: {\n                    id: data.competencyId\n                }}\n            ])[0].done(function(competency) {\n                $(self.staticElementSelector).html(competency.shortname);\n                $(self.inputHiddenSelector).val(competency.id);\n            }).fail(Notification.exception);\n        } else {\n            // Root of competency framework selected.\n            Str.get_string('competencyframeworkroot', 'tool_lp').then(function(rootframework) {\n                $(self.staticElementSelector).html(rootframework);\n                $(self.inputHiddenSelector).val(data.competencyId);\n                return;\n            }).fail(Notification.exception);\n        }\n    };\n\n    /**\n     * Register the events of parent competency button click.\n     *\n     * @method registerEvents\n     */\n    ParentCompetencyForm.prototype.registerEvents = function() {\n        var self = this;\n\n        // Event on edit parent button.\n        $(self.buttonSelector).on('click', function(e) {\n            e.preventDefault();\n\n            var picker = new Picker(self.pageContextId, self.frameworkId, 'self', false);\n\n            // Override the render method to make framework selectable.\n            picker._render = function() {\n                var self = this;\n                return self._preRender().then(function() {\n                    var context = {\n                        competencies: self._competencies,\n                        framework: self._getFramework(self._frameworkId),\n                        frameworks: self._frameworks,\n                        search: self._searchText,\n                        singleFramework: self._singleFramework,\n                    };\n\n                    return Templates.render('tool_lp/competency_picker_competencyform', context);\n                });\n            };\n\n            // On selected competency.\n            picker.on('save', function(e, data) {\n                self.setParent(data);\n            });\n\n            picker.display();\n        });\n    };\n\n    return {\n\n        /**\n         * Main initialisation.\n         * @param {String} buttonSelector The parent competency button selector.\n         * @param {String} inputSelector The hidden input field selector.\n         * @param {String} staticElementSelector The static element displaying the parent competency.\n         * @param {Number} frameworkId The competency framework ID.\n         * @param {Number} pageContextId The page context ID.\n         * @method init\n         */\n        init: function(buttonSelector,\n                        inputSelector,\n                        staticElementSelector,\n                        frameworkId,\n                        pageContextId) {\n            // Create instance.\n            new ParentCompetencyForm(buttonSelector,\n                                    inputSelector,\n                                    staticElementSelector,\n                                    frameworkId,\n                                    pageContextId);\n        }\n    };\n});\n"]}