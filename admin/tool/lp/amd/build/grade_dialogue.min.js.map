{"version":3,"sources":["../src/grade_dialogue.js"],"names":["define","$","Notification","Templates","Dialogue","EventBase","Str","Grade","ratingOptions","prototype","constructor","apply","_ratingOptions","Object","create","_popup","_afterRender","btnRate","_find","lstRating","txtComment","click","e","preventDefault","_trigger","close","bind","change","node","val","prop","display","_render","then","html","get_string","title","fail","exception","selector","getContent","find","context","cangrade","_canGrade","ratings","render"],"mappings":"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","file":"grade_dialogue.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Grade dialogue.\n *\n * @package    tool_lp\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/notification',\n        'core/templates',\n        'tool_lp/dialogue',\n        'tool_lp/event_base',\n        'core/str'],\n        function($, Notification, Templates, Dialogue, EventBase, Str) {\n\n    /**\n     * Grade dialogue class.\n     * @param {Array} ratingOptions\n     */\n    var Grade = function(ratingOptions) {\n        EventBase.prototype.constructor.apply(this, []);\n        this._ratingOptions = ratingOptions;\n    };\n    Grade.prototype = Object.create(EventBase.prototype);\n\n    /** @type {Dialogue} The dialogue. */\n    Grade.prototype._popup = null;\n    /** @type {Array} Array of objects containing, 'value', 'name' and optionally 'selected'. */\n    Grade.prototype._ratingOptions = null;\n\n    /**\n     * After render hook.\n     *\n     * @method _afterRender\n     * @protected\n     */\n    Grade.prototype._afterRender = function() {\n        var btnRate = this._find('[data-action=\"rate\"]'),\n            lstRating = this._find('[name=\"rating\"]'),\n            txtComment = this._find('[name=\"comment\"]');\n\n        this._find('[data-action=\"cancel\"]').click(function(e) {\n            e.preventDefault();\n            this._trigger('cancelled');\n            this.close();\n        }.bind(this));\n\n        lstRating.change(function() {\n            var node = $(this);\n            if (!node.val()) {\n                btnRate.prop('disabled', true);\n            } else {\n                btnRate.prop('disabled', false);\n            }\n        }).change();\n\n        btnRate.click(function(e) {\n            e.preventDefault();\n            var val = lstRating.val();\n            if (!val) {\n                return;\n            }\n            this._trigger('rated', {\n                'rating': val,\n                'note': txtComment.val()\n            });\n            this.close();\n        }.bind(this));\n    };\n\n    /**\n     * Close the dialogue.\n     *\n     * @method close\n     */\n    Grade.prototype.close = function() {\n        this._popup.close();\n        this._popup = null;\n    };\n\n    /**\n     * Opens the picker.\n     *\n     * @param {Number} competencyId The competency ID of the competency to work on.\n     * @method display\n     * @return {Promise}\n     */\n    Grade.prototype.display = function() {\n        return this._render().then(function(html) {\n            return Str.get_string('rate', 'tool_lp').then(function(title) {\n                this._popup = new Dialogue(\n                    title,\n                    html,\n                    this._afterRender.bind(this)\n                );\n            }.bind(this));\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Find a node in the dialogue.\n     *\n     * @param {String} selector\n     * @method _find\n     * @returns {node} The node\n     * @protected\n     */\n    Grade.prototype._find = function(selector) {\n        return $(this._popup.getContent()).find(selector);\n    };\n\n    /**\n     * Render the dialogue.\n     *\n     * @method _render\n     * @protected\n     * @return {Promise}\n     */\n    Grade.prototype._render = function() {\n        var context = {\n            cangrade: this._canGrade,\n            ratings: this._ratingOptions\n        };\n        return Templates.render('tool_lp/competency_grader', context);\n    };\n\n    return /** @alias module:tool_lp/grade_dialogue */ Grade;\n\n});\n"]}