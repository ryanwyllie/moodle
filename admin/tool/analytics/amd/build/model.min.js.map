{"version":3,"sources":["../src/model.js"],"names":["define","$","Str","log","Notification","ModalFactory","ModalEvents","actionsList","clear","title","key","component","body","getModelName","actionItem","closest","find","text","confirmAction","actionId","actionType","on","ev","preventDefault","a","currentTarget","error","reqStrings","param","stringsPromise","get_strings","modalPromise","create","type","types","SAVE_CANCEL","when","then","strings","modal","setTitle","setBody","setSaveButtonText","getRoot","save","window","location","href","attr","show","fail","exception"],"mappings":"aAsBAA,8BAAO,CAAC,QAAD,CAAW,UAAX,CAAuB,UAAvB,CAAmC,mBAAnC,CAAwD,oBAAxD,CAA8E,mBAA9E,CAAP,CACI,SAASC,CAAT,CAAYC,GAAZ,CAAiBC,GAAjB,CAAsBC,YAAtB,CAAoCC,YAApC,CAAkDC,WAAlD,CAA+D,IAK3DC,aAAc,CACdC,MAAO,CACHC,MAAO,CACHC,IAAK,kBADF,CAEHC,UAAW,gBAFR,CADJ,CAIAC,KAAM,CACLF,IAAK,uBADA,CAELC,UAAW,gBAFN,CAJN,CADO,CAL6C,CAwB3DE,aAAe,SAASC,UAAT,CAAqB,CACpC,MAAOb,GAAEa,WAAWC,OAAX,CAAmB,IAAnB,EAAyB,CAAzB,CAAF,EAA+BC,IAA/B,CAAoC,kBAApC,EAAwDC,IAAxD,EACV,CA1B8D,CA6B/D,MAAO,CAQHC,cAAe,uBAASC,QAAT,CAAmBC,UAAnB,CAA+B,CAC1CnB,EAAE,oBAAsBkB,QAAtB,CAAiC,IAAnC,EAAyCE,EAAzC,CAA4C,OAA5C,CAAqD,SAASC,EAAT,CAAa,CAC9DA,GAAGC,cAAH,EAD8D,CAG9D,GAAIC,GAAIvB,EAAEqB,GAAGG,aAAL,CAAR,CAEA,GAAuC,WAAnC,QAAOlB,aAAYa,UAAZ,CAAX,CAEI,WADAjB,KAAIuB,KAAJ,CAAU,WAAaN,UAAb,CAA0B,mBAApC,CACA,CAGJ,GAAIO,YAAa,CACbpB,YAAYa,UAAZ,EAAwBX,KADX,CAEbF,YAAYa,UAAZ,EAAwBR,IAFX,CAAjB,CAIAe,WAAW,CAAX,EAAcC,KAAd,CAAsBf,aAAaW,CAAb,CAdwC,IAgB1DK,gBAAiB3B,IAAI4B,WAAJ,CAAgBH,UAAhB,CAhByC,CAiB1DI,aAAe1B,aAAa2B,MAAb,CAAoB,CAACC,KAAM5B,aAAa6B,KAAb,CAAmBC,WAA1B,CAApB,CAjB2C,CAmB9DlC,EAAEmC,IAAF,CAAOP,cAAP,CAAuBE,YAAvB,EAAqCM,IAArC,CAA0C,SAASC,OAAT,CAAkBC,KAAlB,CAAyB,CAQ/D,MAPAA,OAAMC,QAAN,CAAeF,QAAQ,CAAR,CAAf,CAOA,CANAC,MAAME,OAAN,CAAcH,QAAQ,CAAR,CAAd,CAMA,CALAC,MAAMG,iBAAN,CAAwBJ,QAAQ,CAAR,CAAxB,CAKA,CAJAC,MAAMI,OAAN,GAAgBtB,EAAhB,CAAmBf,YAAYsC,IAA/B,CAAqC,UAAW,CAC5CC,OAAOC,QAAP,CAAgBC,IAAhB,CAAuBvB,EAAEwB,IAAF,CAAO,MAAP,CAC1B,CAFD,CAIA,CADAT,MAAMU,IAAN,EACA,CAAOV,KACV,CATD,EASGW,IATH,CASQ9C,aAAa+C,SATrB,CAUH,CA7BD,CA8BH,CAvCE,CAyCV,CAvED,C","file":"model.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for model actions confirmation.\n *\n * @module     tool_analytics/model\n * @copyright  2017 David Monllao\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str', 'core/log', 'core/notification', 'core/modal_factory', 'core/modal_events'],\n    function($, Str, log, Notification, ModalFactory, ModalEvents) {\n\n    /**\n     * List of actions that require confirmation and confirmation message.\n     */\n    var actionsList = {\n        clear: {\n            title: {\n                key: 'clearpredictions',\n                component: 'tool_analytics'\n            }, body: {\n                key: 'clearmodelpredictions',\n                component: 'tool_analytics'\n            }\n\n        }\n    };\n\n    /**\n     * Returns the model name.\n     *\n     * @param {Object} actionItem The action item DOM node.\n     * @return {String}\n     */\n    var getModelName = function(actionItem) {\n        return $(actionItem.closest('tr')[0]).find('span.target-name').text();\n    };\n\n    /** @alias module:tool_analytics/model */\n    return {\n\n        /**\n         * Displays a confirm modal window before executing the action.\n         *\n         * @param {String} actionId\n         * @param {String} actionType\n         */\n        confirmAction: function(actionId, actionType) {\n            $('[data-action-id=\"' + actionId + '\"]').on('click', function(ev) {\n                ev.preventDefault();\n\n                var a = $(ev.currentTarget);\n\n                if (typeof actionsList[actionType] === \"undefined\") {\n                    log.error('Action \"' + actionType + '\" is not allowed.');\n                    return;\n                }\n\n                var reqStrings = [\n                    actionsList[actionType].title,\n                    actionsList[actionType].body\n                ];\n                reqStrings[1].param = getModelName(a);\n\n                var stringsPromise = Str.get_strings(reqStrings);\n                var modalPromise = ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL});\n\n                $.when(stringsPromise, modalPromise).then(function(strings, modal) {\n                    modal.setTitle(strings[0]);\n                    modal.setBody(strings[1]);\n                    modal.setSaveButtonText(strings[0]);\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        window.location.href = a.attr('href');\n                    });\n                    modal.show();\n                    return modal;\n                }).fail(Notification.exception);\n            });\n        }\n    };\n});\n"]}