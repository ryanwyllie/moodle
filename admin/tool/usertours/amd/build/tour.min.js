function _typeof2(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof2=function(a){return typeof a}}else{_typeof2=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof2(a)}(function(a,b){if("function"==typeof define&&define.amd){define ("tool_usertours/tour",["jquery","core/popper"],function(c,d){return a.Tour=b(c,d)})}else if("object"===("undefined"==typeof module?"undefined":_typeof2(module))&&module.exports){module.exports=b(require("jquery"),require("popper.js"))}else{a.Tour=b(a.$,a.Popper)}})(this,function(a,b){"use strict";var d="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(a){return _typeof2(a)}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":_typeof2(a)};function c(a){this.init(a)}c.prototype.tourName;c.prototype.storageKey;c.prototype.storage;c.prototype.originalConfiguration;c.prototype.listeners;c.prototype.eventHandlers;c.prototype.steps;c.prototype.currentStepNode;c.prototype.currentStepNumber;c.prototype.currentStepPopper;c.prototype.currentStepConfig;c.prototype.templateContent;c.prototype.init=function(a){this.eventHandlers={};this.reset();this.originalConfiguration=a||{};this.configure.apply(this,arguments);try{this.storage=window.sessionStorage;this.storageKey="tourstate_"+this.tourName}catch(a){this.storage=!1;this.storageKey=""}return this};c.prototype.reset=function(){this.hide();this.eventHandlers=[];this.resetStepListeners();this.originalConfiguration={};this.steps=[];this.currentStepNumber=0;return this};c.prototype.configure=function(a){var b=this;if("object"===("undefined"==typeof a?"undefined":d(a))){if("undefined"!=typeof a.tourName){this.tourName=a.tourName}if(a.eventHandlers){(function(){for(var c in a.eventHandlers){a.eventHandlers[c].forEach(function(a){this.addEventHandler(c,a)},b)}})()}this.resetStepDefaults(!0);if("object"===d(a.steps)){this.steps=a.steps}if("undefined"!=typeof a.template){this.templateContent=a.template}}this.checkMinimumRequirements();return this};c.prototype.checkMinimumRequirements=function(){if(!this.tourName){throw new Error("Tour Name required")}if(!this.steps||!this.steps.length){throw new Error("Steps must be specified")}};c.prototype.resetStepDefaults=function(a){if("undefined"==typeof a){a=!0}this.stepDefaults={};if(!a||"undefined"==typeof this.originalConfiguration.stepDefaults){this.setStepDefaults({})}else{this.setStepDefaults(this.originalConfiguration.stepDefaults)}return this};c.prototype.setStepDefaults=function(b){if(!this.stepDefaults){this.stepDefaults={}}a.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},b);return this};c.prototype.getCurrentStepNumber=function(){return parseInt(this.currentStepNumber,10)};c.prototype.setCurrentStepNumber=function(a){this.currentStepNumber=a;if(this.storage){try{this.storage.setItem(this.storageKey,a)}catch(a){if(a.code===DOMException.QUOTA_EXCEEDED_ERR){this.storage.removeItem(this.storageKey)}}}};c.prototype.getNextStepNumber=function(a){if("undefined"==typeof a){a=this.getCurrentStepNumber()}var b=a+1;while(b<=this.steps.length){if(this.isStepPotentiallyVisible(this.getStepConfig(b))){return b}b++}return null};c.prototype.getPreviousStepNumber=function(a){if("undefined"==typeof a){a=this.getCurrentStepNumber()}var b=a-1;while(0<=b){if(this.isStepPotentiallyVisible(this.getStepConfig(b))){return b}b--}return null};c.prototype.isLastStep=function(a){var b=this.getNextStepNumber(a);return null===b};c.prototype.isFirstStep=function(a){var b=this.getPreviousStepNumber(a);return null===b};c.prototype.isStepPotentiallyVisible=function(a){if(!a){return!1}if(this.isStepActuallyVisible(a)){return!0}if("undefined"!=typeof a.orphan&&a.orphan){return!0}if("undefined"!=typeof a.delay&&a.delay){return!0}return!1};c.prototype.isStepActuallyVisible=function(a){if(!a){return!1}var b=this.getStepTarget(a);if(b&&b.length&&b.is(":visible")){return!!b.length}return!1};c.prototype.next=function(){return this.gotoStep(this.getNextStepNumber())};c.prototype.previous=function(){return this.gotoStep(this.getPreviousStepNumber(),-1)};c.prototype.gotoStep=function(a,b){if(0>a){return this.endTour()}var c=this.getStepConfig(a);if(null===c){return this.endTour()}return this._gotoStep(c,b)};c.prototype._gotoStep=function(a,b){if(!a){return this.endTour()}if("undefined"!=typeof a.delay&&a.delay&&!a.delayed){a.delayed=!0;window.setTimeout(this._gotoStep.bind(this),a.delay,a,b);return this}else if(!a.orphan&&!this.isStepActuallyVisible(a)){var c=-1==b?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[c](a.stepNumber),b)}this.hide();this.fireEventHandlers("beforeRender",a);this.renderStep(a);this.fireEventHandlers("afterRender",a);return this};c.prototype.getStepConfig=function(b){if(null===b||0>b||b>=this.steps.length){return null}var c=this.normalizeStepConfig(this.steps[b]);c=a.extend(c,{stepNumber:b});return c};c.prototype.normalizeStepConfig=function(b){if("undefined"!=typeof b.reflex&&"undefined"==typeof b.moveAfterClick){b.moveAfterClick=b.reflex}if("undefined"!=typeof b.element&&"undefined"==typeof b.target){b.target=b.element}if("undefined"!=typeof b.content&&"undefined"==typeof b.body){b.body=b.content}b=a.extend({},this.stepDefaults,b);b=a.extend({},{attachTo:b.target,attachPoint:"after"},b);if(b.attachTo){b.attachTo=a(b.attachTo).first()}return b};c.prototype.getStepTarget=function(b){if(b.target){return a(b.target)}return null};c.prototype.fireEventHandlers=function(a,b){if("undefined"==typeof this.eventHandlers[a]){return this}this.eventHandlers[a].forEach(function(a){a.call(this,b)},this);return this};c.prototype.addEventHandler=function(a,b){if("undefined"==typeof this.eventHandlers[a]){this.eventHandlers[a]=[]}this.eventHandlers[a].push(b);return this};c.prototype.processStepListeners=function(b){this.listeners.push({node:this.currentStepNode,args:["click","[data-role=\"next\"]",a.proxy(this.next,this)]},{node:this.currentStepNode,args:["click","[data-role=\"previous\"]",a.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click","[data-role=\"end\"]",a.proxy(this.endTour,this)]},{node:a("[data-flexitour=\"backdrop\"]"),args:["click",a.proxy(this.hide,this)]},{node:a("body"),args:["keydown",a.proxy(this.handleKeyDown,this)]});if(b.moveOnClick){var c=this.getStepTarget(b);this.listeners.push({node:c,args:["click",a.proxy(function(b){if(0===a(b.target).parents("[data-flexitour=\"container\"]").length){window.setTimeout(a.proxy(this.next,this),500)}},this)]})}this.listeners.forEach(function(a){a.node.on.apply(a.node,a.args)});return this};c.prototype.resetStepListeners=function(){if(this.listeners){this.listeners.forEach(function(a){a.node.off.apply(a.node,a.args)})}this.listeners=[];return this};c.prototype.renderStep=function(b){this.currentStepConfig=b;this.setCurrentStepNumber(b.stepNumber);var c=a(this.getTemplateContent());c.find("[data-placeholder=\"title\"]").html(b.title);c.find("[data-placeholder=\"body\"]").html(b.body);if(this.isFirstStep(b.stepNumber)){c.find("[data-role=\"previous\"]").prop("disabled",!0)}else{c.find("[data-role=\"previous\"]").prop("disabled",!1)}if(this.isLastStep(b.stepNumber)){c.find("[data-role=\"next\"]").prop("disabled",!0)}else{c.find("[data-role=\"next\"]").prop("disabled",!1)}c.find("[data-role=\"previous\"]").attr("role","button");c.find("[data-role=\"next\"]").attr("role","button");c.find("[data-role=\"end\"]").attr("role","button");b.template=c;this.addStepToPage(b);this.processStepListeners(b);return this};c.prototype.getTemplateContent=function(){return a(this.templateContent).clone()};c.prototype.addStepToPage=function(c){var d=c.template,e=a("<span data-flexitour=\"container\"></span>").html(c.template).hide(),f=a("body, html").stop(!0,!0);if(this.isStepActuallyVisible(c)){var g=this.getStepTarget(c);g.data("flexitour","target");var h=this.calculateZIndex(g);if(h){c.zIndex=h+1}if(c.zIndex){e.css("zIndex",c.zIndex+1)}this.positionBackdrop(c);a(document.body).append(e);this.currentStepNode=e;this.currentStepNode.css({top:0,left:0});f.animate({scrollTop:this.calculateScrollTop(c)}).promise().then(function(){this.positionStep(c);this.revealStep(c)}.bind(this))}else if(c.orphan){c.isOrphan=!0;c.attachTo=a("body").first();c.attachPoint="append";this.positionBackdrop(c);e.addClass("orphan");a(document.body).append(e);this.currentStepNode=e;this.currentStepNode.offset(this.calculateStepPositionInPage());this.currentStepNode.css("position","fixed");this.currentStepPopper=new b(a("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:c.placement+"-start",arrowElement:"[data-role=\"arrow\"]",modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}});this.revealStep(c)}return this};c.prototype.revealStep=function(b){this.currentStepNode.fadeIn("",a.proxy(function(){this.announceStep(b);this.currentStepNode.focus();window.setTimeout(a.proxy(function(){if(this.currentStepNode){this.currentStepNode.focus()}},this),100)},this));return this};c.prototype.announceStep=function(a){var b="tour-step-"+this.tourName+"-"+a.stepNumber;this.currentStepNode.attr("id",b);var c=this.currentStepNode.find("[data-placeholder=\"body\"]").first();c.attr("id",b+"-body");c.attr("role","document");var d=this.currentStepNode.find("[data-placeholder=\"title\"]").first();d.attr("id",b+"-title");d.attr("aria-labelledby",b+"-body");this.currentStepNode.attr("role","dialog");this.currentStepNode.attr("tabindex",0);this.currentStepNode.attr("aria-labelledby",b+"-title");this.currentStepNode.attr("aria-describedby",b+"-body");var e=this.getStepTarget(a);if(e){if(!e.attr("tabindex")){e.attr("tabindex",0)}e.data("original-describedby",e.attr("aria-describedby")).attr("aria-describedby",b+"-body")}this.accessibilityShow(a);return this};c.prototype.handleKeyDown=function(b){switch(b.keyCode){case 27:this.endTour();break;case 9:(function(){if(!this.currentStepConfig.hasBackdrop){return}var c=a(document.activeElement),d=this.getStepTarget(this.currentStepConfig),e=a("a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button:enabled"),f=a("span[data-flexitour=\"container\"]"),g=void 0;if(d){e=e.filter(function(a,b){return null!=d&&(d.has(b).length||f.has(b).length||d.is(b)||f.is(b))})}e.each(function(a,b){if(c.is(b)){g=a;return!1}});var h=void 0,i=void 0,j=void 0;if(void 0!=g){var k=1;if(b.shiftKey){k=-1}h=g;do{h+=k;i=a(e[h])}while(i.length&&i.is(":disabled")||i.is(":hidden"));if(i.length){j=i.closest(d).length;j=j||i.closest(this.currentStepNode).length}else{j=!1}}if(j){i.focus()}else{if(b.shiftKey){this.currentStepNode.find("a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button:enabled").last().focus()}else{if(this.currentStepConfig.isOrphan){this.currentStepNode.focus()}else{d.focus()}}}b.preventDefault()}).call(this);break;}};c.prototype.startTour=function(a){if(this.storage&&"undefined"==typeof a){var b=this.storage.getItem(this.storageKey);if(b){var c=parseInt(b,10);if(c<=this.steps.length){a=c}}}if("undefined"==typeof a){a=this.getCurrentStepNumber()}this.fireEventHandlers("beforeStart",a);this.gotoStep(a);this.fireEventHandlers("afterStart",a);return this};c.prototype.restartTour=function(){return this.startTour(0)};c.prototype.endTour=function(){this.fireEventHandlers("beforeEnd");if(this.currentStepConfig){var a=this.getStepTarget(this.currentStepConfig);if(a){if(!a.attr("tabindex")){a.attr("tabindex","-1")}a.focus()}}this.hide(!0);this.fireEventHandlers("afterEnd");return this};c.prototype.hide=function(b){this.fireEventHandlers("beforeHide");if(this.currentStepNode&&this.currentStepNode.length){this.currentStepNode.hide();if(this.currentStepPopper){this.currentStepPopper.destroy()}}if(this.currentStepConfig){var c=this.getStepTarget(this.currentStepConfig);if(c){if(c.data("original-labelledby")){c.attr("aria-labelledby",c.data("original-labelledby"))}if(c.data("original-describedby")){c.attr("aria-describedby",c.data("original-describedby"))}if(c.data("original-tabindex")){c.attr("tabindex",c.data("tabindex"))}}this.currentStepConfig=null}var d=0;if(b){d=400}a("[data-flexitour=\"step-background\"]").remove();a("[data-flexitour=\"step-backdrop\"]").removeAttr("data-flexitour");a("[data-flexitour=\"backdrop\"]").fadeOut(d,function(){a(this).remove()});if(this.currentStepNode&&this.currentStepNode.length){var e=this.currentStepNode.attr("id");if(e){var f="[aria-describedby=\""+e+"-body\"]";a(f).removeAttr("tabindex");a(f).removeAttr("aria-describedby")}}this.resetStepListeners();this.accessibilityHide();this.fireEventHandlers("afterHide");this.currentStepNode=null;this.currentStepPopper=null;return this};c.prototype.show=function(){var a=this.getCurrentStepNumber();return this.gotoStep(a)};c.prototype.getStepContainer=function(){return a(this.currentStepNode)};c.prototype.calculateScrollTop=function(b){var c=a(window).scrollTop(),d=a(window).height(),e=this.getStepTarget(b);if("top"===b.placement){c=e.offset().top-d/2}else if("bottom"===b.placement){c=e.offset().top+e.height()-d/2}else if(e.height()<=.8*d){c=e.offset().top-(d-e.height())/2}else{c=e.offset().top-.2*d}c=Math.max(0,c);c=Math.min(a(document).height()-d,c);return Math.ceil(c)};c.prototype.calculateStepPositionInPage=function(){var b=a(window).height(),c=this.currentStepNode.height(),d=a(window).width(),e=this.currentStepNode.width();return{top:Math.ceil((b-c)/2),left:Math.ceil((d-e)/2)}};c.prototype.positionStep=function(c){var d=this.currentStepNode;if(!d||!d.length){return this}var e;switch(c.placement){case"left":e=["left","right","top","bottom"];break;case"right":e=["right","left","top","bottom"];break;case"top":e=["top","bottom","right","left"];break;case"bottom":e=["bottom","top","right","left"];break;default:e="flip";break;}var f=this.getStepTarget(c),g={placement:c.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:e},arrow:{element:"[data-role=\"arrow\"]"}},onCreate:function(a){h(a)},onUpdate:function(a){h(a)}},h=function(b){var c=b.placement.split("-")[0],d=-1!==["left","right"].indexOf(c),e=b.instance.popper.querySelector("[data-role=\"arrow\"]"),f=a(b.instance.popper.querySelector("[data-role=\"flexitour-step\"]"));if(d){var g=parseFloat(window.getComputedStyle(e).height),h=parseFloat(window.getComputedStyle(e).top),i=parseFloat(window.getComputedStyle(b.instance.popper).height),j=parseFloat(window.getComputedStyle(b.instance.popper).top),k=parseFloat(f.css("borderTopWidth")),l=2*parseFloat(f.css("borderTopLeftRadius")),m=h+g/2,n=i+j-k-l,o=j+k+l;if(m>=n||m<=o){var p=0;if(m>i/2){p=n-g}else{p=o+g}a(e).css("top",p)}}else{var q=parseFloat(window.getComputedStyle(e).width),r=parseFloat(window.getComputedStyle(e).left),s=parseFloat(window.getComputedStyle(b.instance.popper).width),t=parseFloat(window.getComputedStyle(b.instance.popper).left),u=parseFloat(f.css("borderTopWidth")),v=2*parseFloat(f.css("borderTopLeftRadius")),w=r+q/2,x=s+t-u-v,y=t+u+v;if(w>=x||w<=y){var z=0;if(w>s/2){z=x-q}else{z=y+q}a(e).css("left",z)}}},i=a("[data-flexitour=\"step-background\"]");if(i.length){f=i}this.currentStepPopper=new b(f,d[0],g);return this};c.prototype.positionBackdrop=function(b){if(b.backdrop){this.currentStepConfig.hasBackdrop=!0;var c=a("<div data-flexitour=\"backdrop\"></div>");if(b.zIndex){if("append"===b.attachPoint){b.attachTo.append(c)}else{c.insertAfter(b.attachTo)}}else{a("body").append(c)}if(this.isStepActuallyVisible(b)){var d=a("<div data-flexitour=\"step-background\"></div>"),e=this.getStepTarget(b),f=10,g=e;if(f){g=a("body")}d.css({width:e.outerWidth()+f+f,height:e.outerHeight()+f+f,left:e.offset().left-f,top:e.offset().top-f,backgroundColor:this.calculateInherittedBackgroundColor(g)});if(e.offset().left<f){d.css({width:e.outerWidth()+e.offset().left+f,left:e.offset().left})}if(e.offset().top<f){d.css({height:e.outerHeight()+e.offset().top+f,top:e.offset().top})}var h=e.css("borderRadius");if(h&&h!==a("body").css("borderRadius")){d.css("borderRadius",h)}var i=this.calculatePosition(e);if("fixed"===i){d.css("top",0)}else if("absolute"===i){d.css("position","fixed")}var j=d.clone();j.css({backgroundColor:c.css("backgroundColor"),opacity:c.css("opacity")});j.attr("data-flexitour","step-background-fader");if(b.zIndex){if("append"===b.attachPoint){b.attachTo.append(d)}else{j.insertAfter(b.attachTo);d.insertAfter(b.attachTo)}}else{a("body").append(j);a("body").append(d)}e.attr("data-flexitour","step-backdrop");if(b.zIndex){c.css("zIndex",b.zIndex);d.css("zIndex",b.zIndex+1);e.css("zIndex",b.zIndex+2)}j.fadeOut("2000",function(){a(this).remove()})}}return this};c.prototype.calculateZIndex=function(b){b=a(b);while(b.length&&b[0]!==document){var c=b.css("position");if("absolute"===c||"relative"===c||"fixed"===c){var d=parseInt(b.css("zIndex"),10);if(!isNaN(d)&&0!==d){return d}}b=b.parent()}return 0};c.prototype.calculateInherittedBackgroundColor=function(b){var c=a("<div>").hide();a("body").append(c);var d=c.css("backgroundColor");c.remove();b=a(b);while(b.length&&b[0]!==document){var e=b.css("backgroundColor");if(e!==d){return e}b=b.parent()}return null};c.prototype.calculatePosition=function(b){b=a(b);while(b.length&&b[0]!==document){var c=b.css("position");if("static"!==c){return c}b=b.parent()}return null};c.prototype.accessibilityShow=function(){var b="aria-hidden",c=function(a){var c=a.data("flexitour");if(c){switch(c){case"container":case"target":return;}}var d=a.attr(b);if(!d){a.attr("data-has-hidden",!0);a.attr(b,!0)}};this.currentStepNode.siblings().each(function(b,d){c(a(d))});this.currentStepNode.parentsUntil("body").siblings().each(function(b,d){c(a(d))})};c.prototype.accessibilityHide=function(){var b=function(a){var b=a.attr("data-has-hidden");if("undefined"!=typeof b){a.removeAttr("data-has-hidden");a.removeAttr("aria-hidden")}};a("[data-has-hidden]").each(function(c,d){b(a(d))})};if("object"===("undefined"==typeof exports?"undefined":d(exports))){module.exports=c}return c});
//# sourceMappingURL=tour.min.js.map
