{"version":3,"sources":["../src/tour.js"],"names":["root","factory","define","amd","a0","b1","module","exports","require","$","Popper","Tour","config","init","Math","ceil","_typeof","Symbol","iterator","obj","constructor","prototype","tourName","storageKey","storage","originalConfiguration","listeners","eventHandlers","steps","currentStepNode","currentStepNumber","currentStepPopper","currentStepConfig","templateContent","reset","configure","apply","arguments","window","sessionStorage","e","hide","resetStepListeners","_this","eventName","forEach","handler","addEventHandler","resetStepDefaults","template","checkMinimumRequirements","Error","length","loadOriginalConfiguration","stepDefaults","setStepDefaults","extend","element","placement","delay","moveOnClick","moveAfterTime","orphan","direction","getCurrentStepNumber","parseInt","setCurrentStepNumber","stepNumber","setItem","code","DOMException","QUOTA_EXCEEDED_ERR","removeItem","getNextStepNumber","nextStepNumber","isStepPotentiallyVisible","getStepConfig","getPreviousStepNumber","previousStepNumber","isLastStep","isFirstStep","stepConfig","isStepActuallyVisible","target","getStepTarget","is","next","gotoStep","previous","endTour","_gotoStep","delayed","setTimeout","bind","fn","fireEventHandlers","renderStep","normalizeStepConfig","reflex","moveAfterClick","content","body","attachTo","attachPoint","first","data","thisEvent","call","push","processStepListeners","node","args","proxy","closest","handleKeyDown","targetNode","parents","listener","on","off","getTemplateContent","find","html","title","prop","attr","addStepToPage","clone","stepContent","animationTarget","stop","zIndex","calculateZIndex","css","positionBackdrop","document","append","top","left","animate","scrollTop","calculateScrollTop","promise","then","positionStep","revealStep","isOrphan","addClass","offset","calculateStepPositionInPage","removeOnDestroy","arrowElement","modifiers","enabled","applyStyle","onLoad","fadeIn","announceStep","focus","stepId","bodyRegion","headerRegion","accessibilityShow","keyCode","hasBackdrop","activeElement","stepTarget","tabbableNodes","dialogContainer","currentIndex","filter","index","has","each","nextIndex","nextNode","focusRelevant","shiftKey","last","preventDefault","startTour","startAt","storageStartValue","getItem","storageStartAt","restartTour","previousTarget","transition","destroy","fadeTime","remove","removeAttr","fadeOut","currentStepElement","accessibilityHide","show","getStepContainer","viewportHeight","height","max","min","stepHeight","viewportWidth","width","stepWidth","flipBehavior","flip","behaviour","arrow","onCreate","recalculateArrowPosition","onUpdate","split","isVertical","indexOf","instance","popper","querySelector","stepElement","arrowHeight","parseFloat","getComputedStyle","arrowOffset","popperHeight","popperOffset","popperBorderWidth","popperBorderRadiusWidth","arrowPos","maxPos","minPos","newArrowPos","arrowWidth","_arrowOffset","popperWidth","_popperOffset","_popperBorderWidth","_popperBorderRadiusWidth","_arrowPos","_maxPos","_minPos","_newArrowPos","background","backdrop","insertAfter","colorNode","outerWidth","outerHeight","backgroundColor","calculateInherittedBackgroundColor","targetRadius","targetPosition","calculatePosition","fader","opacity","elem","position","value","isNaN","parent","fakeNode","fakeElemColor","color","hideFunction","child","flexitourRole","hidden","siblings","parentsUntil","showFunction"],"mappings":"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","file":"tour.min.js","sourcesContent":["// jshint ignore: start\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"jquery\",\"core/popper\"], function (a0,b1) {\n      return (root['Tour'] = factory(a0,b1));\n    });\n  } else if (typeof module === 'object' && module.exports) {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"jquery\"),require(\"popper.js\"));\n  } else {\n    root['Tour'] = factory(root[\"$\"],root[\"Popper\"]);\n  }\n}(this, function ($, Popper) {\n\n\"use strict\";\n\n/**\n * A Tour.\n *\n * @class   Tour\n * @param   {object}    config  The configuration object.\n */\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction Tour(config) {\n    this.init(config);\n}\n\n/**\n * The name of the tour.\n *\n * @property    {String}    tourName\n */\nTour.prototype.tourName;\n\n/**\n * The name of the tour storage key.\n *\n * @property    {String}    storageKey\n */\nTour.prototype.storageKey;\n\n/**\n * The session storage object\n *\n * @property    {Storage}   storage\n */\nTour.prototype.storage;\n\n/**\n * The original configuration as passed into the constructor.\n *\n * @property    {Object}    originalConfiguration\n */\nTour.prototype.originalConfiguration;\n\n/**\n * The list of step listeners.\n *\n * @property    {Array}     listeners\n */\nTour.prototype.listeners;\n\n/**\n * The list of event handlers.\n *\n * @property    {Object}    eventHandlers\n */\nTour.prototype.eventHandlers;\n\n/**\n * The list of steps.\n *\n * @property    {Object[]}      steps\n */\nTour.prototype.steps;\n\n/**\n * The current step node.\n *\n * @property    {jQuery}        currentStepNode\n */\nTour.prototype.currentStepNode;\n\n/**\n * The current step number.\n *\n * @property    {Number}        currentStepNumber\n */\nTour.prototype.currentStepNumber;\n\n/**\n * The popper for the current step.\n *\n * @property    {Popper}        currentStepPopper\n */\nTour.prototype.currentStepPopper;\n\n/**\n * The config for the current step.\n *\n * @property    {Object}        currentStepConfig\n */\nTour.prototype.currentStepConfig;\n\n/**\n * The template content.\n *\n * @property    {String}        templateContent\n */\nTour.prototype.templateContent;\n\n/**\n * Initialise the tour.\n *\n * @method  init\n * @param   {Object}    config  The configuration object.\n * @chainable\n */\nTour.prototype.init = function (config) {\n    // Unset all handlers.\n    this.eventHandlers = {};\n\n    // Reset the current tour states.\n    this.reset();\n\n    // Store the initial configuration.\n    this.originalConfiguration = config || {};\n\n    // Apply configuration.\n    this.configure.apply(this, arguments);\n\n    try {\n        this.storage = window.sessionStorage;\n        this.storageKey = 'tourstate_' + this.tourName;\n    } catch (e) {\n        this.storage = false;\n        this.storageKey = '';\n    }\n\n    return this;\n};\n\n/**\n * Reset the current tour state.\n *\n * @method  reset\n * @chainable\n */\nTour.prototype.reset = function () {\n    // Hide the current step.\n    this.hide();\n\n    // Unset all handlers.\n    this.eventHandlers = [];\n\n    // Unset all listeners.\n    this.resetStepListeners();\n\n    // Unset the original configuration.\n    this.originalConfiguration = {};\n\n    // Reset the current step number and list of steps.\n    this.steps = [];\n\n    // Reset the current step number.\n    this.currentStepNumber = 0;\n\n    return this;\n};\n\n/**\n * Prepare tour configuration.\n *\n * @method  configure\n * @chainable\n */\nTour.prototype.configure = function (config) {\n    var _this = this;\n\n    if ((typeof config === 'undefined' ? 'undefined' : _typeof(config)) === 'object') {\n        // Tour name.\n        if (typeof config.tourName !== 'undefined') {\n            this.tourName = config.tourName;\n        }\n\n        // Set up eventHandlers.\n        if (config.eventHandlers) {\n            (function () {\n                var eventName = void 0;\n                for (eventName in config.eventHandlers) {\n                    config.eventHandlers[eventName].forEach(function (handler) {\n                        this.addEventHandler(eventName, handler);\n                    }, _this);\n                }\n            })();\n        }\n\n        // Reset the step configuration.\n        this.resetStepDefaults(true);\n\n        // Configure the steps.\n        if (_typeof(config.steps) === 'object') {\n            this.steps = config.steps;\n        }\n\n        if (typeof config.template !== 'undefined') {\n            this.templateContent = config.template;\n        }\n    }\n\n    // Check that we have enough to start the tour.\n    this.checkMinimumRequirements();\n\n    return this;\n};\n\n/**\n * Check that the configuration meets the minimum requirements.\n *\n * @method  checkMinimumRequirements\n * @chainable\n */\nTour.prototype.checkMinimumRequirements = function () {\n    // Need a tourName.\n    if (!this.tourName) {\n        throw new Error(\"Tour Name required\");\n    }\n\n    // Need a minimum of one step.\n    if (!this.steps || !this.steps.length) {\n        throw new Error(\"Steps must be specified\");\n    }\n};\n\n/**\n * Reset step default configuration.\n *\n * @method  resetStepDefaults\n * @param   {Boolean}   loadOriginalConfiguration   Whether to load the original configuration supplied with the Tour.\n * @chainable\n */\nTour.prototype.resetStepDefaults = function (loadOriginalConfiguration) {\n    if (typeof loadOriginalConfiguration === 'undefined') {\n        loadOriginalConfiguration = true;\n    }\n\n    this.stepDefaults = {};\n    if (!loadOriginalConfiguration || typeof this.originalConfiguration.stepDefaults === 'undefined') {\n        this.setStepDefaults({});\n    } else {\n        this.setStepDefaults(this.originalConfiguration.stepDefaults);\n    }\n\n    return this;\n};\n\n/**\n * Set the step defaults.\n *\n * @method  setStepDefaults\n * @param   {Object}    stepDefaults                The step defaults to apply to all steps\n * @chainable\n */\nTour.prototype.setStepDefaults = function (stepDefaults) {\n    if (!this.stepDefaults) {\n        this.stepDefaults = {};\n    }\n    $.extend(this.stepDefaults, {\n        element: '',\n        placement: 'top',\n        delay: 0,\n        moveOnClick: false,\n        moveAfterTime: 0,\n        orphan: false,\n        direction: 1\n    }, stepDefaults);\n\n    return this;\n};\n\n/**\n * Retrieve the current step number.\n *\n * @method  getCurrentStepNumber\n * @return  {Integer}                   The current step number\n */\nTour.prototype.getCurrentStepNumber = function () {\n    return parseInt(this.currentStepNumber, 10);\n};\n\n/**\n * Store the current step number.\n *\n * @method  setCurrentStepNumber\n * @param   {Integer}   stepNumber      The current step number\n * @chainable\n */\nTour.prototype.setCurrentStepNumber = function (stepNumber) {\n    this.currentStepNumber = stepNumber;\n    if (this.storage) {\n        try {\n            this.storage.setItem(this.storageKey, stepNumber);\n        } catch (e) {\n            if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {\n                this.storage.removeItem(this.storageKey);\n            }\n        }\n    }\n};\n\n/**\n * Get the next step number after the currently displayed step.\n *\n * @method  getNextStepNumber\n * @return  {Integer}    The next step number to display\n */\nTour.prototype.getNextStepNumber = function (stepNumber) {\n    if (typeof stepNumber === 'undefined') {\n        stepNumber = this.getCurrentStepNumber();\n    }\n    var nextStepNumber = stepNumber + 1;\n\n    // Keep checking the remaining steps.\n    while (nextStepNumber <= this.steps.length) {\n        if (this.isStepPotentiallyVisible(this.getStepConfig(nextStepNumber))) {\n            return nextStepNumber;\n        }\n        nextStepNumber++;\n    }\n\n    return null;\n};\n\n/**\n * Get the previous step number before the currently displayed step.\n *\n * @method  getPreviousStepNumber\n * @return  {Integer}    The previous step number to display\n */\nTour.prototype.getPreviousStepNumber = function (stepNumber) {\n    if (typeof stepNumber === 'undefined') {\n        stepNumber = this.getCurrentStepNumber();\n    }\n    var previousStepNumber = stepNumber - 1;\n\n    // Keep checking the remaining steps.\n    while (previousStepNumber >= 0) {\n        if (this.isStepPotentiallyVisible(this.getStepConfig(previousStepNumber))) {\n            return previousStepNumber;\n        }\n        previousStepNumber--;\n    }\n\n    return null;\n};\n\n/**\n * Is the step the final step number?\n *\n * @method  isLastStep\n * @param   {Integer}   stepNumber  Step number to test\n * @return  {Boolean}               Whether the step is the final step\n */\nTour.prototype.isLastStep = function (stepNumber) {\n    var nextStepNumber = this.getNextStepNumber(stepNumber);\n\n    return nextStepNumber === null;\n};\n\n/**\n * Is the step the first step number?\n *\n * @method  isFirstStep\n * @param   {Integer}   stepNumber  Step number to test\n * @return  {Boolean}               Whether the step is the first step\n */\nTour.prototype.isFirstStep = function (stepNumber) {\n    var previousStepNumber = this.getPreviousStepNumber(stepNumber);\n\n    return previousStepNumber === null;\n};\n\n/**\n * Is this step potentially visible?\n *\n * @method  isStepPotentiallyVisible\n * @param   {Integer}   stepNumber  Step number to test\n * @return  {Boolean}               Whether the step is the potentially visible\n */\nTour.prototype.isStepPotentiallyVisible = function (stepConfig) {\n    if (!stepConfig) {\n        // Without step config, there can be no step.\n        return false;\n    }\n\n    if (this.isStepActuallyVisible(stepConfig)) {\n        // If it is actually visible, it is already potentially visible.\n        return true;\n    }\n\n    if (typeof stepConfig.orphan !== 'undefined' && stepConfig.orphan) {\n        // Orphan steps have no target. They are always visible.\n        return true;\n    }\n\n    if (typeof stepConfig.delay !== 'undefined' && stepConfig.delay) {\n        // Only return true if the activated has not been used yet.\n        return true;\n    }\n\n    // Not theoretically, or actually visible.\n    return false;\n};\n\n/**\n * Is this step actually visible?\n *\n * @method  isStepActuallyVisible\n * @param   {Integer}   stepNumber  Step number to test\n * @return  {Boolean}               Whether the step is actually visible\n */\nTour.prototype.isStepActuallyVisible = function (stepConfig) {\n    if (!stepConfig) {\n        // Without step config, there can be no step.\n        return false;\n    }\n\n    var target = this.getStepTarget(stepConfig);\n    if (target && target.length && target.is(':visible')) {\n        // Without a target, there can be no step.\n        return !!target.length;\n    }\n\n    return false;\n};\n\n/**\n * Go to the next step in the tour.\n *\n * @method  next\n * @chainable\n */\nTour.prototype.next = function () {\n    return this.gotoStep(this.getNextStepNumber());\n};\n\n/**\n * Go to the previous step in the tour.\n *\n * @method  previous\n * @chainable\n */\nTour.prototype.previous = function () {\n    return this.gotoStep(this.getPreviousStepNumber(), -1);\n};\n\n/**\n * Go to the specified step in the tour.\n *\n * @method  gotoStep\n * @param   {Integer}   stepNumber      The step number to display\n * @chainable\n */\nTour.prototype.gotoStep = function (stepNumber, direction) {\n    if (stepNumber < 0) {\n        return this.endTour();\n    }\n\n    var stepConfig = this.getStepConfig(stepNumber);\n    if (stepConfig === null) {\n        return this.endTour();\n    }\n\n    return this._gotoStep(stepConfig, direction);\n};\n\nTour.prototype._gotoStep = function (stepConfig, direction) {\n    if (!stepConfig) {\n        return this.endTour();\n    }\n\n    if (typeof stepConfig.delay !== 'undefined' && stepConfig.delay && !stepConfig.delayed) {\n        stepConfig.delayed = true;\n        window.setTimeout(this._gotoStep.bind(this), stepConfig.delay, stepConfig, direction);\n\n        return this;\n    } else if (!stepConfig.orphan && !this.isStepActuallyVisible(stepConfig)) {\n        var fn = direction == -1 ? 'getPreviousStepNumber' : 'getNextStepNumber';\n        return this.gotoStep(this[fn](stepConfig.stepNumber), direction);\n    }\n\n    this.hide();\n\n    this.fireEventHandlers('beforeRender', stepConfig);\n    this.renderStep(stepConfig);\n    this.fireEventHandlers('afterRender', stepConfig);\n\n    return this;\n};\n\n/**\n * Fetch the normalised step configuration for the specified step number.\n *\n * @method  getStepConfig\n * @param   {Integer}   stepNumber      The step number to fetch configuration for\n * @return  {Object}                    The step configuration\n */\nTour.prototype.getStepConfig = function (stepNumber) {\n    if (stepNumber === null || stepNumber < 0 || stepNumber >= this.steps.length) {\n        return null;\n    }\n\n    // Normalise the step configuration.\n    var stepConfig = this.normalizeStepConfig(this.steps[stepNumber]);\n\n    // Add the stepNumber to the stepConfig.\n    stepConfig = $.extend(stepConfig, { stepNumber: stepNumber });\n\n    return stepConfig;\n};\n\n/**\n * Normalise the supplied step configuration.\n *\n * @method  normalizeStepConfig\n * @param   {Object}    stepConfig      The step configuration to normalise\n * @return  {Object}                    The normalised step configuration\n */\nTour.prototype.normalizeStepConfig = function (stepConfig) {\n\n    if (typeof stepConfig.reflex !== 'undefined' && typeof stepConfig.moveAfterClick === 'undefined') {\n        stepConfig.moveAfterClick = stepConfig.reflex;\n    }\n\n    if (typeof stepConfig.element !== 'undefined' && typeof stepConfig.target === 'undefined') {\n        stepConfig.target = stepConfig.element;\n    }\n\n    if (typeof stepConfig.content !== 'undefined' && typeof stepConfig.body === 'undefined') {\n        stepConfig.body = stepConfig.content;\n    }\n\n    stepConfig = $.extend({}, this.stepDefaults, stepConfig);\n\n    stepConfig = $.extend({}, {\n        attachTo: stepConfig.target,\n        attachPoint: 'after'\n    }, stepConfig);\n\n    if (stepConfig.attachTo) {\n        stepConfig.attachTo = $(stepConfig.attachTo).first();\n    }\n\n    return stepConfig;\n};\n\n/**\n * Fetch the actual step target from the selector.\n *\n * This should not be called until after any delay has completed.\n *\n * @method  getStepTarget\n * @param   {Object}    stepConfig      The step configuration\n * @return  {$}\n */\nTour.prototype.getStepTarget = function (stepConfig) {\n    if (stepConfig.target) {\n        return $(stepConfig.target);\n    }\n\n    return null;\n};\n\n/**\n * Fire any event handlers for the specified event.\n *\n * @param   {String}    eventName       The name of the event to handle\n * @param   {Object}    data            Any data to pass to the event\n * @chainable\n */\nTour.prototype.fireEventHandlers = function (eventName, data) {\n    if (typeof this.eventHandlers[eventName] === 'undefined') {\n        return this;\n    }\n\n    this.eventHandlers[eventName].forEach(function (thisEvent) {\n        thisEvent.call(this, data);\n    }, this);\n\n    return this;\n};\n\n/**\n * @method  addEventHandler\n * @param   string      eventName       The name of the event to listen for\n * @param   function    handler         The event handler to call\n */\nTour.prototype.addEventHandler = function (eventName, handler) {\n    if (typeof this.eventHandlers[eventName] === 'undefined') {\n        this.eventHandlers[eventName] = [];\n    }\n\n    this.eventHandlers[eventName].push(handler);\n\n    return this;\n};\n\n/**\n * Process listeners for the step being shown.\n *\n * @method  processStepListeners\n * @param   {object}    stepConfig      The configuration for the step\n * @chainable\n */\nTour.prototype.processStepListeners = function (stepConfig) {\n    this.listeners.push(\n    // Next/Previous buttons.\n    {\n        node: this.currentStepNode,\n        args: ['click', '[data-role=\"next\"]', $.proxy(this.next, this)]\n    }, {\n        node: this.currentStepNode,\n        args: ['click', '[data-role=\"previous\"]', $.proxy(this.previous, this)]\n    },\n\n    // Close and end tour buttons.\n    {\n        node: this.currentStepNode,\n        args: ['click', '[data-role=\"end\"]', $.proxy(this.endTour, this)]\n    },\n\n    // Click backdrop and hide tour.\n    {\n        node: $('[data-flexitour=\"backdrop\"]'),\n        args: ['click', $.proxy(this.hide, this)]\n    },\n\n    // Click out and hide tour without backdrop.\n    {\n        node: $('body'),\n        args: ['click', $.proxy(function (e) {\n            // Handle click in or click out tour content,\n            // if click out, hide tour.\n            if (!this.currentStepNode.is(e.target) && $(e.target).closest('[data-role=\"flexitour-step\"]').length === 0) {\n                this.hide();\n            }\n        }, this)]\n    },\n\n    // Keypresses.\n    {\n        node: $('body'),\n        args: ['keydown', $.proxy(this.handleKeyDown, this)]\n    });\n\n    if (stepConfig.moveOnClick) {\n        var targetNode = this.getStepTarget(stepConfig);\n        this.listeners.push({\n            node: targetNode,\n            args: ['click', $.proxy(function (e) {\n                if ($(e.target).parents('[data-flexitour=\"container\"]').length === 0) {\n                    // Ignore clicks when they are in the flexitour.\n                    window.setTimeout($.proxy(this.next, this), 500);\n                }\n            }, this)]\n        });\n    }\n\n    this.listeners.forEach(function (listener) {\n        listener.node.on.apply(listener.node, listener.args);\n    });\n\n    return this;\n};\n\n/**\n * Reset step listeners.\n *\n * @method  resetStepListeners\n * @chainable\n */\nTour.prototype.resetStepListeners = function () {\n    // Stop listening to all external handlers.\n    if (this.listeners) {\n        this.listeners.forEach(function (listener) {\n            listener.node.off.apply(listener.node, listener.args);\n        });\n    }\n    this.listeners = [];\n\n    return this;\n};\n\n/**\n * The standard step renderer.\n *\n * @method  renderStep\n * @param   {Object}    stepConfig      The step configuration of the step\n * @chainable\n */\nTour.prototype.renderStep = function (stepConfig) {\n    // Store the current step configuration for later.\n    this.currentStepConfig = stepConfig;\n    this.setCurrentStepNumber(stepConfig.stepNumber);\n\n    // Fetch the template and convert it to a $ object.\n    var template = $(this.getTemplateContent());\n\n    // Title.\n    template.find('[data-placeholder=\"title\"]').html(stepConfig.title);\n\n    // Body.\n    template.find('[data-placeholder=\"body\"]').html(stepConfig.body);\n\n    // Is this the first step?\n    if (this.isFirstStep(stepConfig.stepNumber)) {\n        template.find('[data-role=\"previous\"]').prop('disabled', true);\n    } else {\n        template.find('[data-role=\"previous\"]').prop('disabled', false);\n    }\n\n    // Is this the final step?\n    if (this.isLastStep(stepConfig.stepNumber)) {\n        template.find('[data-role=\"next\"]').prop('disabled', true);\n    } else {\n        template.find('[data-role=\"next\"]').prop('disabled', false);\n    }\n\n    template.find('[data-role=\"previous\"]').attr('role', 'button');\n    template.find('[data-role=\"next\"]').attr('role', 'button');\n    template.find('[data-role=\"end\"]').attr('role', 'button');\n\n    // Replace the template with the updated version.\n    stepConfig.template = template;\n\n    // Add to the page.\n    this.addStepToPage(stepConfig);\n\n    // Process step listeners after adding to the page.\n    // This uses the currentNode.\n    this.processStepListeners(stepConfig);\n\n    return this;\n};\n\n/**\n * Getter for the template content.\n *\n * @method  getTemplateContent\n * @return  {$}\n */\nTour.prototype.getTemplateContent = function () {\n    return $(this.templateContent).clone();\n};\n\n/**\n * Helper to add a step to the page.\n *\n * @method  addStepToPage\n * @param   {Object}    stepConfig      The step configuration of the step\n * @chainable\n */\nTour.prototype.addStepToPage = function (stepConfig) {\n    var stepContent = stepConfig.template;\n\n    // Create the stepNode from the template data.\n    var currentStepNode = $('<span data-flexitour=\"container\"></span>').html(stepConfig.template).hide();\n\n    // The scroll animation occurs on the body or html.\n    var animationTarget = $('body, html').stop(true, true);\n\n    if (this.isStepActuallyVisible(stepConfig)) {\n        var targetNode = this.getStepTarget(stepConfig);\n\n        targetNode.data('flexitour', 'target');\n\n        var zIndex = this.calculateZIndex(targetNode);\n        if (zIndex) {\n            stepConfig.zIndex = zIndex + 1;\n        }\n\n        if (stepConfig.zIndex) {\n            currentStepNode.css('zIndex', stepConfig.zIndex + 1);\n        }\n\n        // Add the backdrop.\n        this.positionBackdrop(stepConfig);\n\n        $(document.body).append(currentStepNode);\n        this.currentStepNode = currentStepNode;\n\n        // Ensure that the step node is positioned.\n        // Some situations mean that the value is not properly calculated without this step.\n        this.currentStepNode.css({\n            top: 0,\n            left: 0\n        });\n\n        animationTarget.animate({\n            scrollTop: this.calculateScrollTop(stepConfig)\n        }).promise().then(function () {\n            this.positionStep(stepConfig);\n            this.revealStep(stepConfig);\n        }.bind(this));\n    } else if (stepConfig.orphan) {\n        stepConfig.isOrphan = true;\n\n        // This will be appended to the body instead.\n        stepConfig.attachTo = $('body').first();\n        stepConfig.attachPoint = 'append';\n\n        // Add the backdrop.\n        this.positionBackdrop(stepConfig);\n\n        // This is an orphaned step.\n        currentStepNode.addClass('orphan');\n\n        // It lives in the body.\n        $(document.body).append(currentStepNode);\n        this.currentStepNode = currentStepNode;\n\n        this.currentStepNode.offset(this.calculateStepPositionInPage());\n        this.currentStepNode.css('position', 'fixed');\n\n        this.currentStepPopper = new Popper($('body'), this.currentStepNode[0], {\n            removeOnDestroy: true,\n            placement: stepConfig.placement + '-start',\n            arrowElement: '[data-role=\"arrow\"]',\n            // Empty the modifiers. We've already placed the step and don't want it moved.\n            modifiers: {\n                hide: {\n                    enabled: false\n                },\n                applyStyle: {\n                    onLoad: null,\n                    enabled: false\n                }\n            }\n        });\n\n        this.revealStep(stepConfig);\n    }\n\n    return this;\n};\n\nTour.prototype.revealStep = function (stepConfig) {\n    // Fade the step in.\n    this.currentStepNode.fadeIn('', $.proxy(function () {\n        // Announce via ARIA.\n        this.announceStep(stepConfig);\n\n        // Focus on the current step Node.\n        this.currentStepNode.focus();\n        window.setTimeout($.proxy(function () {\n            // After a brief delay, focus again.\n            // There seems to be an issue with Jaws where it only reads the dialogue title initially.\n            // This second focus helps it to read the full dialogue.\n            if (this.currentStepNode) {\n                this.currentStepNode.focus();\n            }\n        }, this), 100);\n    }, this));\n\n    return this;\n};\n\n/**\n * Helper to announce the step on the page.\n *\n * @method  announceStep\n * @param   {Object}    stepConfig      The step configuration of the step\n * @chainable\n */\nTour.prototype.announceStep = function (stepConfig) {\n    // Setup the step Dialogue as per:\n    // * https://www.w3.org/TR/wai-aria-practices/#dialog_nonmodal\n    // * https://www.w3.org/TR/wai-aria-practices/#dialog_modal\n\n    // Generate an ID for the current step node.\n    var stepId = 'tour-step-' + this.tourName + '-' + stepConfig.stepNumber;\n    this.currentStepNode.attr('id', stepId);\n\n    var bodyRegion = this.currentStepNode.find('[data-placeholder=\"body\"]').first();\n    bodyRegion.attr('id', stepId + '-body');\n    bodyRegion.attr('role', 'document');\n\n    var headerRegion = this.currentStepNode.find('[data-placeholder=\"title\"]').first();\n    headerRegion.attr('id', stepId + '-title');\n    headerRegion.attr('aria-labelledby', stepId + '-body');\n\n    // Generally, a modal dialog has a role of dialog.\n    this.currentStepNode.attr('role', 'dialog');\n    this.currentStepNode.attr('tabindex', 0);\n    this.currentStepNode.attr('aria-labelledby', stepId + '-title');\n    this.currentStepNode.attr('aria-describedby', stepId + '-body');\n\n    // Configure ARIA attributes on the target.\n    var target = this.getStepTarget(stepConfig);\n    if (target) {\n        if (!target.attr('tabindex')) {\n            target.attr('tabindex', 0);\n        }\n\n        target.data('original-describedby', target.attr('aria-describedby')).attr('aria-describedby', stepId + '-body');\n    }\n\n    this.accessibilityShow(stepConfig);\n\n    return this;\n};\n\n/**\n * Handle key down events.\n *\n * @method  handleKeyDown\n * @param   {EventFacade} e\n */\nTour.prototype.handleKeyDown = function (e) {\n    var tabbableSelector = 'a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button:enabled';\n    switch (e.keyCode) {\n        case 27:\n            this.endTour();\n            break;\n\n        // 9 == Tab - trap focus for items with a backdrop.\n        case 9:\n            // Tab must be handled on key up only in this instance.\n            (function () {\n                if (!this.currentStepConfig.hasBackdrop) {\n                    // Trapping tab focus is only handled for those steps with a backdrop.\n                    return;\n                }\n\n                // Find all tabbable locations.\n                var activeElement = $(document.activeElement);\n                var stepTarget = this.getStepTarget(this.currentStepConfig);\n                var tabbableNodes = $(tabbableSelector);\n                var dialogContainer = $('span[data-flexitour=\"container\"]');\n                var currentIndex = void 0;\n                // Filter out element which is not belong to target section or dialogue.\n                if (stepTarget) {\n                    tabbableNodes = tabbableNodes.filter(function (index, element) {\n                        return stepTarget != null && (stepTarget.has(element).length || dialogContainer.has(element).length || stepTarget.is(element) || dialogContainer.is(element));\n                    });\n                }\n\n                // Find index of focusing element.\n                tabbableNodes.each(function (index, element) {\n                    if (activeElement.is(element)) {\n                        currentIndex = index;\n                        return false;\n                    }\n                });\n\n                var nextIndex = void 0;\n                var nextNode = void 0;\n                var focusRelevant = void 0;\n                if (currentIndex != void 0) {\n                    var direction = 1;\n                    if (e.shiftKey) {\n                        direction = -1;\n                    }\n                    nextIndex = currentIndex;\n                    do {\n                        nextIndex += direction;\n                        nextNode = $(tabbableNodes[nextIndex]);\n                    } while (nextNode.length && nextNode.is(':disabled') || nextNode.is(':hidden'));\n                    if (nextNode.length) {\n                        // A new f\n                        focusRelevant = nextNode.closest(stepTarget).length;\n                        focusRelevant = focusRelevant || nextNode.closest(this.currentStepNode).length;\n                    } else {\n                        // Unable to find the target somehow.\n                        focusRelevant = false;\n                    }\n                }\n\n                if (focusRelevant) {\n                    nextNode.focus();\n                } else {\n                    if (e.shiftKey) {\n                        // Focus on the last tabbable node in the step.\n                        this.currentStepNode.find(tabbableSelector).last().focus();\n                    } else {\n                        if (this.currentStepConfig.isOrphan) {\n                            // Focus on the step - there is no target.\n                            this.currentStepNode.focus();\n                        } else {\n                            // Focus on the step target.\n                            stepTarget.focus();\n                        }\n                    }\n                }\n                e.preventDefault();\n            }).call(this);\n            break;\n    }\n};\n\n/**\n * Start the current tour.\n *\n * @method  startTour\n * @param   {Integer}   startAt     Which step number to start at. If not specified, starts at the last point.\n * @chainable\n */\nTour.prototype.startTour = function (startAt) {\n    if (this.storage && typeof startAt === 'undefined') {\n        var storageStartValue = this.storage.getItem(this.storageKey);\n        if (storageStartValue) {\n            var storageStartAt = parseInt(storageStartValue, 10);\n            if (storageStartAt <= this.steps.length) {\n                startAt = storageStartAt;\n            }\n        }\n    }\n\n    if (typeof startAt === 'undefined') {\n        startAt = this.getCurrentStepNumber();\n    }\n\n    this.fireEventHandlers('beforeStart', startAt);\n    this.gotoStep(startAt);\n    this.fireEventHandlers('afterStart', startAt);\n\n    return this;\n};\n\n/**\n * Restart the tour from the beginning, resetting the completionlag.\n *\n * @method  restartTour\n * @chainable\n */\nTour.prototype.restartTour = function () {\n    return this.startTour(0);\n};\n\n/**\n * End the current tour.\n *\n * @method  endTour\n * @chainable\n */\nTour.prototype.endTour = function () {\n    this.fireEventHandlers('beforeEnd');\n\n    if (this.currentStepConfig) {\n        var previousTarget = this.getStepTarget(this.currentStepConfig);\n        if (previousTarget) {\n            if (!previousTarget.attr('tabindex')) {\n                previousTarget.attr('tabindex', '-1');\n            }\n            previousTarget.focus();\n        }\n    }\n\n    this.hide(true);\n\n    this.fireEventHandlers('afterEnd');\n\n    return this;\n};\n\n/**\n * Hide any currently visible steps.\n *\n * @method hide\n * @chainable\n */\nTour.prototype.hide = function (transition) {\n    this.fireEventHandlers('beforeHide');\n\n    if (this.currentStepNode && this.currentStepNode.length) {\n        this.currentStepNode.hide();\n        if (this.currentStepPopper) {\n            this.currentStepPopper.destroy();\n        }\n    }\n\n    // Restore original target configuration.\n    if (this.currentStepConfig) {\n        var target = this.getStepTarget(this.currentStepConfig);\n        if (target) {\n            if (target.data('original-labelledby')) {\n                target.attr('aria-labelledby', target.data('original-labelledby'));\n            }\n\n            if (target.data('original-describedby')) {\n                target.attr('aria-describedby', target.data('original-describedby'));\n            }\n\n            if (target.data('original-tabindex')) {\n                target.attr('tabindex', target.data('tabindex'));\n            }\n        }\n\n        // Clear the step configuration.\n        this.currentStepConfig = null;\n    }\n\n    var fadeTime = 0;\n    if (transition) {\n        fadeTime = 400;\n    }\n\n    // Remove the backdrop features.\n    $('[data-flexitour=\"step-background\"]').remove();\n    $('[data-flexitour=\"step-backdrop\"]').removeAttr('data-flexitour');\n    $('[data-flexitour=\"backdrop\"]').fadeOut(fadeTime, function () {\n        $(this).remove();\n    });\n\n    // Remove aria-describedby and tabindex attributes.\n    if (this.currentStepNode && this.currentStepNode.length) {\n        var stepId = this.currentStepNode.attr('id');\n        if (stepId) {\n            var currentStepElement = '[aria-describedby=\"' + stepId + '-body\"]';\n            $(currentStepElement).removeAttr('tabindex');\n            $(currentStepElement).removeAttr('aria-describedby');\n        }\n    }\n\n    // Reset the listeners.\n    this.resetStepListeners();\n\n    this.accessibilityHide();\n\n    this.fireEventHandlers('afterHide');\n\n    this.currentStepNode = null;\n    this.currentStepPopper = null;\n    return this;\n};\n\n/**\n * Show the current steps.\n *\n * @method show\n * @chainable\n */\nTour.prototype.show = function () {\n    // Show the current step.\n    var startAt = this.getCurrentStepNumber();\n\n    return this.gotoStep(startAt);\n};\n\n/**\n * Return the current step node.\n *\n * @method  getStepContainer\n * @return  {jQuery}\n */\nTour.prototype.getStepContainer = function () {\n    return $(this.currentStepNode);\n};\n\n/**\n * Calculate scrollTop.\n *\n * @method  calculateScrollTop\n * @param   {Object}    stepConfig      The step configuration of the step\n * @return  {Number}\n */\nTour.prototype.calculateScrollTop = function (stepConfig) {\n    var scrollTop = $(window).scrollTop();\n    var viewportHeight = $(window).height();\n    var targetNode = this.getStepTarget(stepConfig);\n\n    if (stepConfig.placement === 'top') {\n        // If the placement is top, center scroll at the top of the target.\n        scrollTop = targetNode.offset().top - viewportHeight / 2;\n    } else if (stepConfig.placement === 'bottom') {\n        // If the placement is bottom, center scroll at the bottom of the target.\n        scrollTop = targetNode.offset().top + targetNode.height() - viewportHeight / 2;\n    } else if (targetNode.height() <= viewportHeight * 0.8) {\n        // If the placement is left/right, and the target fits in the viewport, centre screen on the target\n        scrollTop = targetNode.offset().top - (viewportHeight - targetNode.height()) / 2;\n    } else {\n        // If the placement is left/right, and the target is bigger than the viewport, set scrollTop to target.top + buffer\n        // and change step attachmentTarget to top+.\n        scrollTop = targetNode.offset().top - viewportHeight * 0.2;\n    }\n\n    // Never scroll over the top.\n    scrollTop = Math.max(0, scrollTop);\n\n    // Never scroll beyond the bottom.\n    scrollTop = Math.min($(document).height() - viewportHeight, scrollTop);\n\n    return Math.ceil(scrollTop);\n};\n\n/**\n * Calculate dialogue position for page middle.\n *\n * @method  calculateScrollTop\n * @return  {Number}\n */\nTour.prototype.calculateStepPositionInPage = function () {\n    var viewportHeight = $(window).height();\n    var stepHeight = this.currentStepNode.height();\n\n    var viewportWidth = $(window).width();\n    var stepWidth = this.currentStepNode.width();\n\n    return {\n        top: Math.ceil((viewportHeight - stepHeight) / 2),\n        left: Math.ceil((viewportWidth - stepWidth) / 2)\n    };\n};\n\n/**\n * Position the step on the page.\n *\n * @method  positionStep\n * @param   {Object}    stepConfig      The step configuration of the step\n * @chainable\n */\nTour.prototype.positionStep = function (stepConfig) {\n    var content = this.currentStepNode;\n    if (!content || !content.length) {\n        // Unable to find the step node.\n        return this;\n    }\n\n    var flipBehavior = void 0;\n    switch (stepConfig.placement) {\n        case 'left':\n            flipBehavior = ['left', 'right', 'top', 'bottom'];\n            break;\n        case 'right':\n            flipBehavior = ['right', 'left', 'top', 'bottom'];\n            break;\n        case 'top':\n            flipBehavior = ['top', 'bottom', 'right', 'left'];\n            break;\n        case 'bottom':\n            flipBehavior = ['bottom', 'top', 'right', 'left'];\n            break;\n        default:\n            flipBehavior = 'flip';\n            break;\n    }\n\n    var target = this.getStepTarget(stepConfig);\n    var config = {\n        placement: stepConfig.placement + '-start',\n        removeOnDestroy: true,\n        modifiers: {\n            flip: {\n                behaviour: flipBehavior\n            },\n            arrow: {\n                element: '[data-role=\"arrow\"]'\n            }\n        },\n        onCreate: function onCreate(data) {\n            recalculateArrowPosition(data);\n        },\n        onUpdate: function onUpdate(data) {\n            recalculateArrowPosition(data);\n        }\n    };\n\n    var recalculateArrowPosition = function recalculateArrowPosition(data) {\n        var placement = data.placement.split('-')[0];\n        var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n        var arrowElement = data.instance.popper.querySelector('[data-role=\"arrow\"]');\n        var stepElement = $(data.instance.popper.querySelector('[data-role=\"flexitour-step\"]'));\n        if (isVertical) {\n            var arrowHeight = parseFloat(window.getComputedStyle(arrowElement).height);\n            var arrowOffset = parseFloat(window.getComputedStyle(arrowElement).top);\n            var popperHeight = parseFloat(window.getComputedStyle(data.instance.popper).height);\n            var popperOffset = parseFloat(window.getComputedStyle(data.instance.popper).top);\n            var popperBorderWidth = parseFloat(stepElement.css('borderTopWidth'));\n            var popperBorderRadiusWidth = parseFloat(stepElement.css('borderTopLeftRadius')) * 2;\n            var arrowPos = arrowOffset + arrowHeight / 2;\n            var maxPos = popperHeight + popperOffset - popperBorderWidth - popperBorderRadiusWidth;\n            var minPos = popperOffset + popperBorderWidth + popperBorderRadiusWidth;\n            if (arrowPos >= maxPos || arrowPos <= minPos) {\n                var newArrowPos = 0;\n                if (arrowPos > popperHeight / 2) {\n                    newArrowPos = maxPos - arrowHeight;\n                } else {\n                    newArrowPos = minPos + arrowHeight;\n                }\n                $(arrowElement).css('top', newArrowPos);\n            }\n        } else {\n            var arrowWidth = parseFloat(window.getComputedStyle(arrowElement).width);\n            var _arrowOffset = parseFloat(window.getComputedStyle(arrowElement).left);\n            var popperWidth = parseFloat(window.getComputedStyle(data.instance.popper).width);\n            var _popperOffset = parseFloat(window.getComputedStyle(data.instance.popper).left);\n            var _popperBorderWidth = parseFloat(stepElement.css('borderTopWidth'));\n            var _popperBorderRadiusWidth = parseFloat(stepElement.css('borderTopLeftRadius')) * 2;\n            var _arrowPos = _arrowOffset + arrowWidth / 2;\n            var _maxPos = popperWidth + _popperOffset - _popperBorderWidth - _popperBorderRadiusWidth;\n            var _minPos = _popperOffset + _popperBorderWidth + _popperBorderRadiusWidth;\n            if (_arrowPos >= _maxPos || _arrowPos <= _minPos) {\n                var _newArrowPos = 0;\n                if (_arrowPos > popperWidth / 2) {\n                    _newArrowPos = _maxPos - arrowWidth;\n                } else {\n                    _newArrowPos = _minPos + arrowWidth;\n                }\n                $(arrowElement).css('left', _newArrowPos);\n            }\n        }\n    };\n\n    var background = $('[data-flexitour=\"step-background\"]');\n    if (background.length) {\n        target = background;\n    }\n    this.currentStepPopper = new Popper(target, content[0], config);\n\n    return this;\n};\n\n/**\n * Add the backdrop.\n *\n * @method  positionBackdrop\n * @param   {Object}    stepConfig      The step configuration of the step\n * @chainable\n */\nTour.prototype.positionBackdrop = function (stepConfig) {\n    if (stepConfig.backdrop) {\n        this.currentStepConfig.hasBackdrop = true;\n        var backdrop = $('<div data-flexitour=\"backdrop\"></div>');\n\n        if (stepConfig.zIndex) {\n            if (stepConfig.attachPoint === 'append') {\n                stepConfig.attachTo.append(backdrop);\n            } else {\n                backdrop.insertAfter(stepConfig.attachTo);\n            }\n        } else {\n            $('body').append(backdrop);\n        }\n\n        if (this.isStepActuallyVisible(stepConfig)) {\n            // The step has a visible target.\n            // Punch a hole through the backdrop.\n            var background = $('<div data-flexitour=\"step-background\"></div>');\n\n            var targetNode = this.getStepTarget(stepConfig);\n\n            var buffer = 10;\n\n            var colorNode = targetNode;\n            if (buffer) {\n                colorNode = $('body');\n            }\n\n            background.css({\n                width: targetNode.outerWidth() + buffer + buffer,\n                height: targetNode.outerHeight() + buffer + buffer,\n                left: targetNode.offset().left - buffer,\n                top: targetNode.offset().top - buffer,\n                backgroundColor: this.calculateInherittedBackgroundColor(colorNode)\n            });\n\n            if (targetNode.offset().left < buffer) {\n                background.css({\n                    width: targetNode.outerWidth() + targetNode.offset().left + buffer,\n                    left: targetNode.offset().left\n                });\n            }\n\n            if (targetNode.offset().top < buffer) {\n                background.css({\n                    height: targetNode.outerHeight() + targetNode.offset().top + buffer,\n                    top: targetNode.offset().top\n                });\n            }\n\n            var targetRadius = targetNode.css('borderRadius');\n            if (targetRadius && targetRadius !== $('body').css('borderRadius')) {\n                background.css('borderRadius', targetRadius);\n            }\n\n            var targetPosition = this.calculatePosition(targetNode);\n            if (targetPosition === 'fixed') {\n                background.css('top', 0);\n            } else if (targetPosition === 'absolute') {\n                background.css('position', 'fixed');\n            }\n\n            var fader = background.clone();\n            fader.css({\n                backgroundColor: backdrop.css('backgroundColor'),\n                opacity: backdrop.css('opacity')\n            });\n            fader.attr('data-flexitour', 'step-background-fader');\n\n            if (stepConfig.zIndex) {\n                if (stepConfig.attachPoint === 'append') {\n                    stepConfig.attachTo.append(background);\n                } else {\n                    fader.insertAfter(stepConfig.attachTo);\n                    background.insertAfter(stepConfig.attachTo);\n                }\n            } else {\n                $('body').append(fader);\n                $('body').append(background);\n            }\n\n            // Add the backdrop data to the actual target.\n            // This is the part which actually does the work.\n            targetNode.attr('data-flexitour', 'step-backdrop');\n\n            if (stepConfig.zIndex) {\n                backdrop.css('zIndex', stepConfig.zIndex);\n                background.css('zIndex', stepConfig.zIndex + 1);\n                targetNode.css('zIndex', stepConfig.zIndex + 2);\n            }\n\n            fader.fadeOut('2000', function () {\n                $(this).remove();\n            });\n        }\n    }\n    return this;\n};\n\n/**\n * Calculate the inheritted z-index.\n *\n * @method  calculateZIndex\n * @param   {jQuery}    elem                        The element to calculate z-index for\n * @return  {Number}                                Calculated z-index\n */\nTour.prototype.calculateZIndex = function (elem) {\n    elem = $(elem);\n    while (elem.length && elem[0] !== document) {\n        // Ignore z-index if position is set to a value where z-index is ignored by the browser\n        // This makes behavior of this function consistent across browsers\n        // WebKit always returns auto if the element is positioned.\n        var position = elem.css(\"position\");\n        if (position === \"absolute\" || position === \"relative\" || position === \"fixed\") {\n            // IE returns 0 when zIndex is not specified\n            // other browsers return a string\n            // we ignore the case of nested elements with an explicit value of 0\n            // <div style=\"z-index: -10;\"><div style=\"z-index: 0;\"></div></div>\n            var value = parseInt(elem.css(\"zIndex\"), 10);\n            if (!isNaN(value) && value !== 0) {\n                return value;\n            }\n        }\n        elem = elem.parent();\n    }\n\n    return 0;\n};\n\n/**\n * Calculate the inheritted background colour.\n *\n * @method  calculateInherittedBackgroundColor\n * @param   {jQuery}    elem                        The element to calculate colour for\n * @return  {String}                                Calculated background colour\n */\nTour.prototype.calculateInherittedBackgroundColor = function (elem) {\n    // Use a fake node to compare each element against.\n    var fakeNode = $('<div>').hide();\n    $('body').append(fakeNode);\n    var fakeElemColor = fakeNode.css('backgroundColor');\n    fakeNode.remove();\n\n    elem = $(elem);\n    while (elem.length && elem[0] !== document) {\n        var color = elem.css('backgroundColor');\n        if (color !== fakeElemColor) {\n            return color;\n        }\n        elem = elem.parent();\n    }\n\n    return null;\n};\n\n/**\n * Calculate the inheritted position.\n *\n * @method  calculatePosition\n * @param   {jQuery}    elem                        The element to calculate position for\n * @return  {String}                                Calculated position\n */\nTour.prototype.calculatePosition = function (elem) {\n    elem = $(elem);\n    while (elem.length && elem[0] !== document) {\n        var position = elem.css('position');\n        if (position !== 'static') {\n            return position;\n        }\n        elem = elem.parent();\n    }\n\n    return null;\n};\n\n/**\n * Perform accessibility changes for step shown.\n *\n * This will add aria-hidden=\"true\" to all siblings and parent siblings.\n *\n * @method  accessibilityShow\n */\nTour.prototype.accessibilityShow = function () {\n    var stateHolder = 'data-has-hidden';\n    var attrName = 'aria-hidden';\n    var hideFunction = function hideFunction(child) {\n        var flexitourRole = child.data('flexitour');\n        if (flexitourRole) {\n            switch (flexitourRole) {\n                case 'container':\n                case 'target':\n                    return;\n            }\n        }\n\n        var hidden = child.attr(attrName);\n        if (!hidden) {\n            child.attr(stateHolder, true);\n            child.attr(attrName, true);\n        }\n    };\n\n    this.currentStepNode.siblings().each(function (index, node) {\n        hideFunction($(node));\n    });\n    this.currentStepNode.parentsUntil('body').siblings().each(function (index, node) {\n        hideFunction($(node));\n    });\n};\n\n/**\n * Perform accessibility changes for step hidden.\n *\n * This will remove any newly added aria-hidden=\"true\".\n *\n * @method  accessibilityHide\n */\nTour.prototype.accessibilityHide = function () {\n    var stateHolder = 'data-has-hidden';\n    var attrName = 'aria-hidden';\n    var showFunction = function showFunction(child) {\n        var hidden = child.attr(stateHolder);\n        if (typeof hidden !== 'undefined') {\n            child.removeAttr(stateHolder);\n            child.removeAttr(attrName);\n        }\n    };\n\n    $('[' + stateHolder + ']').each(function (index, node) {\n        showFunction($(node));\n    });\n};\n\nif ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    module.exports = Tour;\n}\n\nreturn Tour;\n\n}));\n"]}