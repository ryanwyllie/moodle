{"version":3,"sources":["../src/search.js"],"names":["define","$","ajax","log","notification","templates","config","reloadListTemplate","templateList","render","done","result","js","replaceNode","fail","exception","refreshSearch","themename","componentStr","val","searchStr","document","location","hash","call","methodname","args","component","search","throttle","queueRefresh","callback","delay","window","clearTimeout","setTimeout","changeHandler","bind","theme","on","replace"],"mappings":"aAuBAA,qCAAO,CAAC,QAAD,CAAW,WAAX,CAAwB,UAAxB,CAAoC,mBAApC,CAAyD,gBAAzD,CAA2E,aAA3E,CAAP,CACO,SAASC,CAAT,CAAYC,IAAZ,CAAkBC,GAAlB,CAAuBC,YAAvB,CAAqCC,SAArC,CAAgDC,MAAhD,CAAwD,IAQvDC,oBAAqB,SAASC,YAAT,CAAuB,CAC5CH,UAAUI,MAAV,CAAiB,qCAAjB,CAAwD,CAACJ,UAAWG,YAAZ,CAAxD,EACKE,IADL,CACU,SAASC,MAAT,CAAiBC,EAAjB,CAAqB,CACvBP,UAAUQ,WAAV,CAAsBZ,EAAE,+BAAF,CAAtB,CAA0DU,MAA1D,CAAkEC,EAAlE,CACH,CAHL,EAGOE,IAHP,CAGYV,aAAaW,SAHzB,CAIH,CAb0D,CAqBvDC,cAAgB,SAASC,SAAT,CAAoB,IAChCC,cAAejB,EAAE,0BAAF,EAA8BkB,GAA9B,EADiB,CAEhCC,UAAYnB,EAAE,uBAAF,EAA2BkB,GAA3B,EAFoB,CAKpCE,SAASC,QAAT,CAAkBC,IAAlB,CAAyBH,SALW,CAOpClB,KAAKsB,IAAL,CAAU,CACN,CAACC,WAAY,qCAAb,CACEC,KAAM,CAACC,UAAWT,YAAZ,CAA0BU,OAAQR,SAAlC,CAA6CH,UAAWA,SAAxD,CADR,CAEEP,KAAMH,kBAFR,CAGEO,KAAMV,aAAaW,SAHrB,CADM,CAAV,OAMH,CAlC0D,CAoCvDc,SAAW,IApC4C,CA8CvDC,aAAe,SAASC,QAAT,CAAmBC,KAAnB,CAA0B,CACxB,IAAb,WADqC,EAErCC,OAAOC,YAAP,CAAoBL,QAApB,CAFqC,CAKzCA,SAAWI,OAAOE,UAAP,CAAkB,UAAW,CACpCJ,UADoC,CAEpCF,SAAW,IACd,CAHU,CAGRG,KAHQ,CAId,CAvD0D,CAyDvDI,cAAgB,UAAW,CAC3BN,aAAad,cAAcqB,IAAd,CAAmB,IAAnB,CAAyB/B,OAAOgC,KAAhC,CAAb,CAAqD,GAArD,CACH,CA3D0D,CAkE3D,MALArC,GAAE,gCAAF,EAAoCsC,EAApC,CAAuC,QAAvC,CAAiD,0BAAjD,CAA6EH,aAA7E,CAKA,CAJAnC,EAAE,gCAAF,EAAoCsC,EAApC,CAAuC,OAAvC,CAAgD,uBAAhD,CAAyEH,aAAzE,CAIA,CAFAnC,EAAE,uBAAF,EAA2BkB,GAA3B,CAA+BE,SAASC,QAAT,CAAkBC,IAAlB,CAAuBiB,OAAvB,CAA+B,GAA/B,CAAoC,EAApC,CAA/B,CAEA,CADAxB,cAAcV,OAAOgC,KAArB,CACA,CAAO,EACV,CApED,C","file":"search.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module adds ajax search functions to the template library page.\n *\n * @module     tool_templatelibrary/search\n * @package    tool_templatelibrary\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/log', 'core/notification', 'core/templates', 'core/config'],\n       function($, ajax, log, notification, templates, config) {\n\n    /**\n     * The ajax call has returned with a new list of templates.\n     *\n     * @method reloadListTemplate\n     * @param {String[]} templateList List of template ids.\n     */\n    var reloadListTemplate = function(templateList) {\n        templates.render('tool_templatelibrary/search_results', {templates: templateList})\n            .done(function(result, js) {\n                templates.replaceNode($('[data-region=\"searchresults\"]'), result, js);\n            }).fail(notification.exception);\n    };\n\n    /**\n     * Get the current values for the form inputs and refresh the list of matching templates.\n     *\n     * @method refreshSearch\n     * @param {String} themename The naeme of the theme.\n     */\n    var refreshSearch = function(themename) {\n        var componentStr = $('[data-field=\"component\"]').val();\n        var searchStr = $('[data-field=\"search\"]').val();\n\n        // Trigger the search.\n        document.location.hash = searchStr;\n\n        ajax.call([\n            {methodname: 'tool_templatelibrary_list_templates',\n              args: {component: componentStr, search: searchStr, themename: themename},\n              done: reloadListTemplate,\n              fail: notification.exception}\n        ], true, false);\n    };\n\n    var throttle = null;\n\n    /**\n     * Call the specified function after a delay. If this function is called again before the function is executed,\n     * the function will only be executed once.\n     *\n     * @method queueRefresh\n     * @param {function} callback\n     * @param {Number} delay The time in milliseconds to delay.\n     */\n    var queueRefresh = function(callback, delay) {\n        if (throttle !== null) {\n            window.clearTimeout(throttle);\n        }\n\n        throttle = window.setTimeout(function() {\n            callback();\n            throttle = null;\n        }, delay);\n    };\n\n    var changeHandler = function() {\n        queueRefresh(refreshSearch.bind(this, config.theme), 400);\n    };\n    // Add change handlers to refresh the list.\n    $('[data-region=\"list-templates\"]').on('change', '[data-field=\"component\"]', changeHandler);\n    $('[data-region=\"list-templates\"]').on('input', '[data-field=\"search\"]', changeHandler);\n\n    $('[data-field=\"search\"]').val(document.location.hash.replace('#', ''));\n    refreshSearch(config.theme);\n    return {};\n});\n"]}