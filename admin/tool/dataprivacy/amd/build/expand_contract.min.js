define(["jquery","core/url","core/str"],function(a,b,c){var d,e,f=0,g=0,h=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),i=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>'),j=function(){var b=a.extend(!0,{},d);if(Object.keys(d).length!=Object.keys(e).length||f>0){for(var c in e)delete b[c];for(var c in b){var g=a('[data-plugintarget="'+c+'"]');g.addClass("hide"),g.attr("aria-expanded",!1),a('[data-plugin="'+c+'"]').addClass("hide")}for(var c in e){a('[data-plugin="'+c+'"]').removeClass("hide");var g=a('[data-plugintarget="'+c+'"]');g.attr("aria-expanded",!0),0==e[c].plugins.length?(g.attr("aria-expanded",!1),g.addClass("hide"),g.children().each(function(){a(this).removeClass("hide")})):(g.removeClass("hide"),g.children().each(function(){a(this).addClass("hide")})),e[c].plugins.forEach(function(b){a('[data-id="'+b.raw_component+'"]').removeClass("hide")})}}else k()},k=function(){for(var b in d){var c=a('[data-plugintarget="'+b+'"]');c.addClass("hide"),c.attr("aria-expanded",!1),a('[data-plugin="'+b+'"]').removeClass("hide")}},l=function(a,b){a.addClass("hide"),a.attr("aria-expanded",!1),b.find(":header i.fa").removeClass("fa-minus-square"),b.find(":header i.fa").addClass("fa-plus-square"),b.find(":header img.icon").attr("src",i.attr("src"))},m=function(a,b){a.removeClass("hide"),a.attr("aria-expanded",!0),b.find(":header i.fa").removeClass("fa-plus-square"),b.find(":header i.fa").addClass("fa-minus-square"),b.find(":header img.icon").attr("src",h.attr("src"))};return{init:function(b){d=b,e=a.extend(!0,{},d)},expandCollapse:function(b){var c,d=!1;if(b.attr("data-plugin")){var e=b.attr("data-plugin");c=a('[data-plugintarget="'+e+'"]');var f=c.children(),g=f.length,h=g;f.each(function(){h=a(this).hasClass("hide")?h-1:h,a(this).removeClass("hide")}),d=g!==h}if("undefined"!=typeof c&&(d||"true"!=c.attr("aria-expanded")?m(c,b):l(c,b)),b.attr("data-component")){var i=b.attr("data-component"),j=a('[data-section="'+i+'"]');"false"==j.attr("aria-expanded")?m(j,b):l(j,b)}},expandCollapseAll:function(b){var d="visible"==b,e="visible"==b?"hide":"visible";a(".tool_dataprivacy-element").each(function(){a(this).addClass(b),a(this).removeClass(e),a(this).attr("aria-expanded",d)}),a(".tool_dataprivacy-expand-all").attr("data-visibility-state",e),c.get_string(b,"tool_dataprivacy").then(function(b){a(".tool_dataprivacy-expand-all").html(b)})["catch"](Notification.exception);var f="visible"==b?"fa-plus-square":"fa-minus-square",g="visible"==b?"fa-minus-square":"fa-plus-square",j="visible"==b?h.attr("src"):i.attr("src");a(":header i.fa").each(function(){a(this).removeClass(f),a(this).addClass(g)}),a(":header img.icon").each(function(){a(this).attr("src",j)})},filterList:function(){var b={"api-issue":function(a){return!a.compliant},additional:function(a){return!!a.hasOwnProperty("external")}},c=function(a,c){var d=[];return e[a].plugins.forEach(function(a){b[c](a)&&d.push(a)}),d},h=a('.tool_dataprivacy-filter[data-display="hide"]');h.length<g&&0==f&&(e=a.extend(!0,{},d)),g=h.length,h.each(function(){var b=a(this).attr("data-type"),d={};for(var f in e){var g=c(f,b);if(g.length>0){var h=e[f];h.plugins=g,d[f]=h}}e=d}),j()},followLink:function(b){var c=a('[data-id="'+b+'"]');c.removeClass("hide");var d=a('[data-section="'+b+'"]');d.removeClass("hide"),d.attr("aria-expanded",!0);var e=d.parents("[data-plugintarget]");e.removeClass("hide"),e.addClass("done"),e.attr("aria-expanded",!0),e.parent().removeClass("hide")},search:function(){var b=a(".tool_dataprivacy-search-box").val(),c=function(a){var c=[];return a.forEach(function(a){var d=a.component.toLowerCase();d.indexOf(b.toLowerCase())!==-1&&c.push(a)}),c};f>b.length&&(e=a.extend(!0,{},d)),f=b.length;for(var g in e){var h=c(e[g].plugins);e[g].plugins=h;var i=e[g].plugin_type.toLowerCase();i.indexOf(b.toLowerCase())==-1&&0==h.length&&delete e[g]}j()}}});