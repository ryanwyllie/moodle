{"version":3,"sources":["../src/purposesactions.js"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","ACTIONS","DELETE","PurposesActions","registerEvents","prototype","click","e","preventDefault","id","data","purposename","get_strings","key","component","param","then","langStrings","title","confirmMessage","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","save","call","methodname","args","done","result","remove","addNotification","message","warnings","fail","exception","hidden","destroy","show"],"mappings":"aAuBAA,0CAAO,CACH,QADG,CAEH,WAFG,CAGH,mBAHG,CAIH,UAJG,CAKH,oBALG,CAMH,mBANG,CAAP,CAOA,SAASC,CAAT,CAAYC,IAAZ,CAAkBC,YAAlB,CAAgCC,GAAhC,CAAqCC,YAArC,CAAmDC,WAAnD,CAAgE,IAOxDC,SAAU,CACVC,OAAQ,+BADE,CAP8C,CAcxDC,gBAAkB,UAAW,CAC7B,KAAKC,cAAL,EACH,CAhB2D,CAqF5D,MAhEAD,iBAAgBE,SAAhB,CAA0BD,cAA1B,CAA2C,UAAW,CAClDT,EAAEM,QAAQC,MAAV,EAAkBI,KAAlB,CAAwB,SAASC,CAAT,CAAY,CAChCA,EAAEC,cAAF,EADgC,IAG5BC,IAAKd,EAAE,IAAF,EAAQe,IAAR,CAAa,IAAb,CAHuB,CAI5BC,YAAchB,EAAE,IAAF,EAAQe,IAAR,CAAa,MAAb,CAJc,CAkBhCZ,IAAIc,WAAJ,CAbiB,CACb,CACIC,IAAK,eADT,CAEIC,UAAW,kBAFf,CAGIC,MAAOJ,WAHX,CADa,CAMb,CACIE,IAAK,mBADT,CAEIC,UAAW,kBAFf,CAGIC,MAAOJ,WAHX,CANa,CAajB,EAA4BK,IAA5B,CAAiC,SAASC,WAAT,CAAsB,IAC/CC,OAAQD,YAAY,CAAZ,CADuC,CAE/CE,eAAiBF,YAAY,CAAZ,CAF8B,CAGnD,MAAOlB,cAAaqB,MAAb,CAAoB,CACvBF,MAAOA,KADgB,CAEvBG,KAAMF,cAFiB,CAGvBG,KAAMvB,aAAawB,KAAb,CAAmBC,WAHF,CAApB,EAIJR,IAJI,CAIC,SAASS,KAAT,CAAgB,CA6BpB,MA5BAA,OAAMC,iBAAN,CAAwBR,KAAxB,CA4BA,CAzBAO,MAAME,OAAN,GAAgBC,EAAhB,CAAmB5B,YAAY6B,IAA/B,CAAqC,UAAW,CAO5CjC,KAAKkC,IAAL,CAAU,CALI,CACVC,WAAY,iCADF,CAEVC,KAAM,CAAC,GAAMvB,EAAP,CAFI,CAKJ,CAAV,EAAqB,CAArB,EAAwBwB,IAAxB,CAA6B,SAASvB,IAAT,CAAe,CACpCA,KAAKwB,MAD+B,CAEpCvC,EAAE,sBAAwBc,EAAxB,CAA6B,IAA/B,EAAqC0B,MAArC,EAFoC,CAIpCtC,aAAauC,eAAb,CAA6B,CACzBC,QAAS3B,KAAK4B,QAAL,CAAc,CAAd,EAAiBD,OADD,CAEzBf,KAAM,OAFmB,CAA7B,CAKP,CATD,EASGiB,IATH,CASQ1C,aAAa2C,SATrB,CAUH,CAjBD,CAyBA,CALAf,MAAME,OAAN,GAAgBC,EAAhB,CAAmB5B,YAAYyC,MAA/B,CAAuC,UAAW,CAE9ChB,MAAMiB,OAAN,EACH,CAHD,CAKA,CAAOjB,KACV,CAlCM,CAmCV,CAtCD,EAsCGQ,IAtCH,CAsCQ,SAASR,KAAT,CAAgB,CACpBA,MAAMkB,IAAN,EAEH,CAzCD,EAyCGJ,IAzCH,CAyCQ1C,aAAa2C,SAzCrB,CA0CH,CA5DD,CA6DH,CAED,CAA6D,CASzD,KAAQ,eAAW,CACf,MAAO,IAAIrC,gBACd,CAXwD,CAahE,CAzGD,C","file":"purposesactions.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for purposes actions.\n *\n * @module     tool_dataprivacy/purposesactions\n * @package    tool_dataprivacy\n * @copyright  2018 David Monllao\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events'],\nfunction($, Ajax, Notification, Str, ModalFactory, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{DELETE: string}}\n     */\n    var ACTIONS = {\n        DELETE: '[data-action=\"deletepurpose\"]',\n    };\n\n    /**\n     * PurposesActions class.\n     */\n    var PurposesActions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    PurposesActions.prototype.registerEvents = function() {\n        $(ACTIONS.DELETE).click(function(e) {\n            e.preventDefault();\n\n            var id = $(this).data('id');\n            var purposename = $(this).data('name');\n            var stringkeys = [\n                {\n                    key: 'deletepurpose',\n                    component: 'tool_dataprivacy',\n                    param: purposename\n                },\n                {\n                    key: 'deletepurposetext',\n                    component: 'tool_dataprivacy',\n                    param: purposename\n                }\n            ];\n\n            Str.get_strings(stringkeys).then(function(langStrings) {\n                var title = langStrings[0];\n                var confirmMessage = langStrings[1];\n                return ModalFactory.create({\n                    title: title,\n                    body: confirmMessage,\n                    type: ModalFactory.types.SAVE_CANCEL\n                }).then(function(modal) {\n                    modal.setSaveButtonText(title);\n\n                    // Handle save event.\n                    modal.getRoot().on(ModalEvents.save, function() {\n\n                        var request = {\n                            methodname: 'tool_dataprivacy_delete_purpose',\n                            args: {'id': id}\n                        };\n\n                        Ajax.call([request])[0].done(function(data) {\n                            if (data.result) {\n                                $('tr[data-purposeid=\"' + id + '\"]').remove();\n                            } else {\n                                Notification.addNotification({\n                                    message: data.warnings[0].message,\n                                    type: 'error'\n                                });\n                            }\n                        }).fail(Notification.exception);\n                    });\n\n                    // Handle hidden event.\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        // Destroy when hidden.\n                        modal.destroy();\n                    });\n\n                    return modal;\n                });\n            }).done(function(modal) {\n                modal.show();\n\n            }).fail(Notification.exception);\n        });\n    };\n\n    return /** @alias module:tool_dataprivacy/purposesactions */ {\n        // Public variables and functions.\n\n        /**\n         * Initialise the module.\n         *\n         * @method init\n         * @return {PurposesActions}\n         */\n        'init': function() {\n            return new PurposesActions();\n        }\n    };\n});\n"]}