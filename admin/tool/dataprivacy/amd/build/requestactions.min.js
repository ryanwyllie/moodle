'use strict';define('tool_dataprivacy/requestactions',['jquery','core/ajax','core/notification','core/str','core/modal_factory','core/modal_events','core/templates','tool_dataprivacy/data_request_modal','tool_dataprivacy/events'],function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,ModalDataRequest,DataPrivacyEvents){function showConfirmation(action,requestId){var keys=[],wsfunction='';action===DataPrivacyEvents.approve?(keys=[{key:'approverequest',component:'tool_dataprivacy'},{key:'confirmapproval',component:'tool_dataprivacy'}],wsfunction='tool_dataprivacy_approve_data_request'):action===DataPrivacyEvents.deny?(keys=[{key:'denyrequest',component:'tool_dataprivacy'},{key:'confirmdenial',component:'tool_dataprivacy'}],wsfunction='tool_dataprivacy_deny_data_request'):void 0;var modalTitle='';Str.get_strings(keys).then(function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})}).then(function(modal){return modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,function(){var request={methodname:wsfunction,args:{requestid:requestId}};Ajax.call([request])[0].done(function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:'error'})}).fail(Notification.exception)}),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}),modal}).done(function(modal){modal.show()}).fail(Notification.exception)}var ACTIONS={APPROVE_REQUEST:'[data-action="approve"]',DENY_REQUEST:'[data-action="deny"]',VIEW_REQUEST:'[data-action="view"]'},RequestActions=function(){this.registerEvents()};return RequestActions.prototype.registerEvents=function(){$(ACTIONS.VIEW_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid'),promises=Ajax.call([{methodname:'tool_dataprivacy_get_data_request',args:{requestid:requestId}}]),modalTitle='',modalType=ModalFactory.types.DEFAULT;$.when(promises[0]).then(function(data){return data.result?(2==data.result.status&&(modalType=ModalDataRequest.TYPE),modalTitle=data.result.typename,Templates.render('tool_dataprivacy/request_details',data.result)):(Notification.addNotification({message:data.warnings[0].message,type:'error'}),!1)}).then(function(html){return ModalFactory.create({title:modalTitle,body:html,type:modalType,large:!0}).then(function(modal){return modal.getRoot().on(DataPrivacyEvents.approve,function(){showConfirmation(DataPrivacyEvents.approve,requestId)}),modal.getRoot().on(DataPrivacyEvents.deny,function(){showConfirmation(DataPrivacyEvents.deny,requestId)}),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}),modal})}).done(function(modal){modal.show()}).fail(Notification.exception)}),$(ACTIONS.APPROVE_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid');showConfirmation(DataPrivacyEvents.approve,requestId)}),$(ACTIONS.DENY_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid');showConfirmation(DataPrivacyEvents.deny,requestId)})},RequestActions});
//# sourceMappingURL=requestactions.min.js.map
