'use strict';define('tool_dataprivacy/requestactions',['jquery','core/ajax','core/notification','core/str','core/modal_factory','core/modal_events','core/templates','tool_dataprivacy/data_request_modal','tool_dataprivacy/events'],function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,ModalDataRequest,DataPrivacyEvents){function showConfirmation(action,requestId){var keys=[],wsfunction='',params={requestid:requestId};action===DataPrivacyEvents.approve?(keys=[{key:'approverequest',component:'tool_dataprivacy'},{key:'confirmapproval',component:'tool_dataprivacy'}],wsfunction='tool_dataprivacy_approve_data_request'):action===DataPrivacyEvents.deny?(keys=[{key:'denyrequest',component:'tool_dataprivacy'},{key:'confirmdenial',component:'tool_dataprivacy'}],wsfunction='tool_dataprivacy_deny_data_request'):action===DataPrivacyEvents.complete?(keys=[{key:'markcomplete',component:'tool_dataprivacy'},{key:'confirmcompletion',component:'tool_dataprivacy'}],wsfunction='tool_dataprivacy_mark_complete'):void 0;var modalTitle='';Str.get_strings(keys).then(function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})}).then(function(modal){return modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,function(){handleSave(wsfunction,params)}),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}),void modal.show()}).catch(Notification.exception)}function handleSave(wsfunction,params){Ajax.call([{methodname:wsfunction,args:params}])[0].done(function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:'error'})}).fail(Notification.exception)}var ACTIONS={APPROVE_REQUEST:'[data-action="approve"]',DENY_REQUEST:'[data-action="deny"]',VIEW_REQUEST:'[data-action="view"]',MARK_COMPLETE:'[data-action="complete"]'},RequestActions=function(){this.registerEvents()};return RequestActions.prototype.registerEvents=function(){$(ACTIONS.VIEW_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid'),promises=Ajax.call([{methodname:'tool_dataprivacy_get_data_request',args:{requestid:requestId}}]);$.when(promises[0]).then(function(data){return data.result?data.result:(Notification.addNotification({message:data.warnings[0].message,type:'error'}),!1)}).then(function(data){var body=Templates.render('tool_dataprivacy/request_details',data),templateContext={approvedeny:data.approvedeny,canmarkcomplete:data.canmarkcomplete};return ModalFactory.create({title:data.typename,body:body,type:ModalDataRequest.TYPE,large:!0,templateContext:templateContext})}).then(function(modal){return modal.getRoot().on(DataPrivacyEvents.approve,function(){showConfirmation(DataPrivacyEvents.approve,requestId)}),modal.getRoot().on(DataPrivacyEvents.deny,function(){showConfirmation(DataPrivacyEvents.deny,requestId)}),modal.getRoot().on(DataPrivacyEvents.complete,function(){handleSave('tool_dataprivacy_mark_complete',{requestid:requestId})}),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}),void modal.show()}).catch(Notification.exception)}),$(ACTIONS.APPROVE_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid');showConfirmation(DataPrivacyEvents.approve,requestId)}),$(ACTIONS.DENY_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data('requestid');showConfirmation(DataPrivacyEvents.deny,requestId)}),$(ACTIONS.MARK_COMPLETE).click(function(e){e.preventDefault(),showConfirmation(DataPrivacyEvents.complete,$(this).data('requestid'))})},RequestActions});
//# sourceMappingURL=requestactions.min.js.map
