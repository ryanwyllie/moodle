{"version":3,"sources":["../src/view.js"],"names":["define","$","Repository","PagedContentFactory","PubSub","CustomEvents","Notification","Templates","CourseEvents","Selectors","PagedContentEvents","SELECTORS","COURSE_REGION","ACTION_HIDE_COURSE","ACTION_SHOW_COURSE","ACTION_ADD_FAVOURITE","ACTION_REMOVE_FAVOURITE","FAVOURITE_ICON","ICON_IS_FAVOURITE","ICON_NOT_FAVOURITE","PAGED_CONTENT_CONTAINER","TEMPLATES","COURSES_CARDS","COURSES_LIST","COURSES_SUMMARY","NOCOURSES","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","getFilterValues","root","courseRegion","find","courseView","region","display","attr","grouping","sort","displaycategories","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getMyCourses","filters","limit","getEnrolledCoursesByTimeline","offset","classification","getFavouriteIconContainer","courseId","getPagedContentContainer","index","getCourseId","hideFavouriteIcon","iconContainer","isFavouriteIcon","addClass","notFavourteIcon","removeClass","showFavouriteIcon","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","publish","favourited","alert","catch","exception","removeFromFavourites","unfavorited","hideElement","target","id","pagingBar","jumpto","parseInt","courseList","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","popElement","merge","length","pagedContentContainer","resetLastPageNumber","pagedContentPage","renderCourses","html","js","replaceNodeContents","page","remove","status","setFavouriteCourses","result","warnings","course","isfavourite","coursesData","currentTemplate","map","coursecategory","render","nocoursesimg","setLimit","registerPagedEventHandlers","event","SET_ITEMS_PER_PAGE_LIMIT","subscribe","bind","initializePagedContent","Math","random","itemsPerPage","pagingLimit","value","active","config","extend","eventNamespace","pagedContentPromise","createWithLimit","pagesData","actions","promises","pageData","currentPage","pageNumber","allItemsLoaded","pagePromise","nextPageStart","pageCourses","currentPageLength","remainingCourses","nextoffset","registerEventListeners","events","activate","on","e","data","favourite","closest","originalEvent","preventDefault","updateUserPreferences","preferences","type","init","reset"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @package    block_myoverview\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'block_myoverview/repository',\n    'core/paged_content_factory',\n    'core/pubsub',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'core_course/events',\n    'block_myoverview/selectors',\n    'core/paged_content_events',\n],\nfunction(\n    $,\n    Repository,\n    PagedContentFactory,\n    PubSub,\n    CustomEvents,\n    Notification,\n    Templates,\n    CourseEvents,\n    Selectors,\n    PagedContentEvents\n) {\n\n    var SELECTORS = {\n        COURSE_REGION: '[data-region=\"course-view-content\"]',\n        ACTION_HIDE_COURSE: '[data-action=\"hide-course\"]',\n        ACTION_SHOW_COURSE: '[data-action=\"show-course\"]',\n        ACTION_ADD_FAVOURITE: '[data-action=\"add-favourite\"]',\n        ACTION_REMOVE_FAVOURITE: '[data-action=\"remove-favourite\"]',\n        FAVOURITE_ICON: '[data-region=\"favourite-icon\"]',\n        ICON_IS_FAVOURITE: '[data-region=\"is-favourite\"]',\n        ICON_NOT_FAVOURITE: '[data-region=\"not-favourite\"]',\n        PAGED_CONTENT_CONTAINER: '[data-region=\"page-container\"]'\n\n    };\n\n    var TEMPLATES = {\n        COURSES_CARDS: 'block_myoverview/view-cards',\n        COURSES_LIST: 'block_myoverview/view-list',\n        COURSES_SUMMARY: 'block_myoverview/view-summary',\n        NOCOURSES: 'core_course/no-courses'\n    };\n\n    var NUMCOURSES_PERPAGE = [12, 24, 48];\n\n    var loadedPages = [];\n\n    var courseOffset = 0;\n\n    var lastPage = 0;\n\n    var lastLimit = 0;\n\n    var namespace = null;\n\n    /**\n     * Get filter values from DOM.\n     *\n     * @param {object} root The root element for the courses view.\n     * @return {filters} Set filters.\n     */\n    var getFilterValues = function(root) {\n        var courseRegion = root.find(Selectors.courseView.region);\n        return {\n            display: courseRegion.attr('data-display'),\n            grouping: courseRegion.attr('data-grouping'),\n            sort: courseRegion.attr('data-sort'),\n            displaycategories: courseRegion.attr('data-displaycategories'),\n        };\n    };\n\n    // We want the paged content controls below the paged content area.\n    // and the controls should be ignored while data is loading.\n    var DEFAULT_PAGED_CONTENT_CONFIG = {\n        ignoreControlWhileLoading: true,\n        controlPlacementBottom: true,\n        persistentLimitKey: 'block_myoverview_user_paging_preference'\n    };\n\n    /**\n     * Get enrolled courses from backend.\n     *\n     * @param {object} filters The filters for this view.\n     * @param {int} limit The number of courses to show.\n     * @return {promise} Resolved with an array of courses.\n     */\n    var getMyCourses = function(filters, limit) {\n\n        return Repository.getEnrolledCoursesByTimeline({\n            offset: courseOffset,\n            limit: limit,\n            classification: filters.grouping,\n            sort: filters.sort\n        });\n    };\n\n    /**\n     * Get the container element for the favourite icon.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The favourite icon container\n     */\n    var getFavouriteIconContainer = function(root, courseId) {\n        return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the paged content container element.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} index Rendered page index.\n     * @return {Object} The rendered paged container.\n     */\n    var getPagedContentContainer = function(root, index) {\n        return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n    };\n\n    /**\n     * Get the course id from a favourite element.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @return {Number} Course id.\n     */\n    var getCourseId = function(root) {\n        return root.attr('data-course-id');\n    };\n\n    /**\n     * Hide the favourite icon.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @param  {Number} courseId Course id number.\n     */\n    var hideFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.addClass('hidden');\n        isFavouriteIcon.attr('aria-hidden', true);\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.removeClass('hidden');\n        notFavourteIcon.attr('aria-hidden', false);\n    };\n\n    /**\n     * Show the favourite icon.\n     *\n     * @param  {Object} root The course overview container.\n     * @param  {Number} courseId Course id number.\n     */\n    var showFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.removeClass('hidden');\n        isFavouriteIcon.attr('aria-hidden', false);\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.addClass('hidden');\n        notFavourteIcon.attr('aria-hidden', true);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The add to favourite menu item.\n     */\n    var getAddFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The remove from favourites menu item.\n     */\n    var getRemoveFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Add course to favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var addToFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, true).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.favourited, courseId);\n                removeAction.removeClass('hidden');\n                addAction.addClass('hidden');\n                showFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Remove course from favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var removeFromFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, false).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.unfavorited, courseId);\n                removeAction.addClass('hidden');\n                addAction.removeClass('hidden');\n                hideFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Reset the loadedPages dataset to take into account the hidden element\n     *\n     * @param {Object} root The course overview container\n     * @param {Object} target The course that you want to hide\n     */\n    var hideElement = function(root, target) {\n        var id = getCourseId(target);\n\n        var pagingBar = root.find('[data-region=\"paging-bar\"]');\n        var jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n        // Get a reduced dataset for the current page.\n        var courseList = loadedPages[jumpto];\n        var reducedCourse = courseList.courses.reduce(function(accumulator, current) {\n            if (id != current.id) {\n                accumulator.push(current);\n            }\n            return accumulator;\n        }, []);\n\n        // Get the next page's data if loaded and pop the first element from it\n        if (loadedPages[jumpto + 1] != undefined) {\n            var newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n            // Adjust the dataset for the reset of the pages that are loaded\n            loadedPages.forEach(function(courseList, index) {\n                if (index > jumpto) {\n                    var popElement = [];\n                    if (loadedPages[index + 1] != undefined) {\n                        popElement = loadedPages[index + 1].courses.slice(0, 1);\n                    }\n\n                    loadedPages[index].courses = $.merge(loadedPages[index].courses.slice(1), popElement);\n                }\n            });\n\n\n            reducedCourse = $.merge(reducedCourse, newElement);\n        }\n\n        // Check if the next page is the last page and if it still has data associated to it\n        if (lastPage == jumpto + 1 && loadedPages[jumpto + 1].courses.length == 0) {\n            var pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n            PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n        }\n\n        loadedPages[jumpto].courses = reducedCourse;\n\n        // Reduce the course offset\n        courseOffset--;\n\n        // Render the paged content for the current\n        var pagedContentPage = getPagedContentContainer(root, jumpto);\n        renderCourses(root, loadedPages[jumpto]).then(function(html, js) {\n            return Templates.replaceNodeContents(pagedContentPage, html, js);\n        }).catch(Notification.exception);\n\n        // Delete subsequent pages in order to trigger the callback\n        loadedPages.forEach(function(courseList, index) {\n            if (index > jumpto) {\n                var page = getPagedContentContainer(root, index);\n                page.remove();\n            }\n        });\n    };\n\n    /**\n     * Set the courses favourite status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new favourite status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseFavouriteState = function(courseId, status) {\n\n        return Repository.setFavouriteCourses({\n            courses: [\n                    {\n                        'id': courseId,\n                        'favourite': status\n                    }\n                ]\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                loadedPages.forEach(function(courseList) {\n                    courseList.courses.forEach(function(course, index) {\n                        if (course.id == courseId) {\n                            courseList.courses[index].isfavourite = status;\n                        }\n                    });\n                });\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Render the dashboard courses.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {array} coursesData containing array of returned courses.\n     * @return {promise} jQuery promise resolved after rendering is complete.\n     */\n    var renderCourses = function(root, coursesData) {\n\n        var filters = getFilterValues(root);\n\n        var currentTemplate = '';\n        if (filters.display == 'card') {\n            currentTemplate = TEMPLATES.COURSES_CARDS;\n        } else if (filters.display == 'list') {\n            currentTemplate = TEMPLATES.COURSES_LIST;\n        } else {\n            currentTemplate = TEMPLATES.COURSES_SUMMARY;\n        }\n\n        // Delete the course category if it is not to be displayed\n        if (filters.displaycategories != 'on') {\n            coursesData.courses = coursesData.courses.map(function(course) {\n                delete course.coursecategory;\n                return course;\n            });\n        }\n\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            var nocoursesimg = root.find(Selectors.courseView.region).attr('data-nocoursesimg');\n            return Templates.render(TEMPLATES.NOCOURSES, {\n                nocoursesimg: nocoursesimg\n            });\n        }\n    };\n\n    /**\n     * Return the callback to be passed to the subscribe event\n     *\n     * @param {Number} limit The paged limit that is passed through the event\n     */\n    var setLimit = function(limit) {\n        this.find(Selectors.courseView.region).attr('data-paging', limit);\n    };\n\n    /**\n     * Intialise the paged list and cards views on page load.\n     * Returns an array of paged contents that we would like to handle here\n     *\n     * @param {object} root The root element for the courses view\n     * @param {string} namespace The namespace for all the events attached\n     */\n    var registerPagedEventHandlers = function(root, namespace) {\n        var event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n        PubSub.subscribe(event, setLimit.bind(root));\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {object} content The content element for the courses view.\n     */\n    var initializePagedContent = function(root) {\n        namespace = \"block_myoverview_\" + root.attr('id') + \"_\" + Math.random();\n\n        var itemsPerPage = NUMCOURSES_PERPAGE;\n        var pagingLimit = parseInt(root.find(Selectors.courseView.region).attr('data-paging'), 10);\n        if (pagingLimit) {\n            itemsPerPage = NUMCOURSES_PERPAGE.map(function(value) {\n                var active = false;\n                if (value == pagingLimit) {\n                    active = true;\n                }\n\n                return {\n                    value: value,\n                    active: active\n                };\n            });\n        }\n\n        var filters = getFilterValues(root);\n        var config = $.extend({}, DEFAULT_PAGED_CONTENT_CONFIG);\n        config.eventNamespace = namespace;\n\n        var pagedContentPromise = PagedContentFactory.createWithLimit(\n            itemsPerPage,\n            function(pagesData, actions) {\n                var promises = [];\n\n                pagesData.forEach(function(pageData) {\n                    var currentPage = pageData.pageNumber;\n                    var limit = pageData.limit;\n\n                    // Reset local variables if limits have changed\n                    if (lastLimit != limit) {\n                        loadedPages = [];\n                        courseOffset = 0;\n                        lastPage = 0;\n                    }\n\n                    if (lastPage == currentPage) {\n                        // If we are on the last page and have it's data then load it from cache\n                        actions.allItemsLoaded(lastPage);\n                        promises.push(renderCourses(root, loadedPages[currentPage]));\n                        return;\n                    }\n\n                    lastLimit = limit;\n\n                    // Get 2 pages worth of data as we will need it for the hidden functionality.\n                    if (loadedPages[currentPage + 1] == undefined) {\n                        if (loadedPages[currentPage] == undefined) {\n                            limit *= 2;\n                        }\n                    }\n\n                    var pagePromise = getMyCourses(\n                        filters,\n                        limit\n                    ).then(function(coursesData) {\n                        var courses = coursesData.courses;\n                        var nextPageStart = 0;\n                        var pageCourses = [];\n\n                        // If current page's data is loaded make sure we max it to page limit\n                        if (loadedPages[currentPage] != undefined) {\n                            pageCourses = loadedPages[currentPage].courses;\n                            var currentPageLength = pageCourses.length;\n                            if (currentPageLength < pageData.limit) {\n                                nextPageStart = pageData.limit - currentPageLength;\n                                pageCourses = $.merge(loadedPages[currentPage].courses, courses.slice(0, nextPageStart));\n                            }\n                        } else {\n                            nextPageStart = pageData.limit;\n                            pageCourses = courses.slice(0, pageData.limit);\n                        }\n\n                        // Finished setting up the current page\n                        loadedPages[currentPage] = {\n                            courses: pageCourses\n                        };\n\n                        // Set up the next page\n                        var remainingCourses = courses.slice(nextPageStart, courses.length);\n                        if (remainingCourses.length) {\n                            loadedPages[currentPage + 1] = {\n                                courses: remainingCourses\n                            };\n                        }\n\n                        // Set the last page to either the current or next page\n                        if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n                            lastPage = currentPage;\n                            actions.allItemsLoaded(currentPage);\n                        } else if (loadedPages[currentPage + 1] != undefined\n                            && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n                            lastPage = currentPage + 1;\n                        }\n\n                        courseOffset = coursesData.nextoffset;\n                        return renderCourses(root, loadedPages[currentPage]);\n                    })\n                    .catch(Notification.exception);\n\n                    promises.push(pagePromise);\n                });\n\n                return promises;\n            },\n            config\n        );\n\n        pagedContentPromise.then(function(html, js) {\n            registerPagedEventHandlers(root, namespace);\n            return Templates.replaceNodeContents(root.find(Selectors.courseView.region), html, js);\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Listen to, and handle events for  the myoverview block.\n     *\n     * @param {Object} root The myoverview block container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            addToFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            removeFromFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, function(e, data) {\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n            var id = getCourseId(target);\n\n            var request = {\n                preferences: [\n                    {\n                        type: 'block_myoverview_hidden_course_' + id,\n                        value: true\n                    }\n                ]\n            };\n            Repository.updateUserPreferences(request);\n\n            hideElement(root, target);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n            var id = getCourseId(target);\n\n            var request = {\n                preferences: [\n                    {\n                        type: 'block_myoverview_hidden_course_' + id,\n                        value: null\n                    }\n                ]\n            };\n\n            Repository.updateUserPreferences(request);\n\n            hideElement(root, target);\n            data.originalEvent.preventDefault();\n        });\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var init = function(root) {\n        root = $(root);\n        loadedPages = [];\n        lastPage = 0;\n        courseOffset = 0;\n\n        initializePagedContent(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    /**\n\n     * Reset the courses views to their original\n     * state on first page load.courseOffset\n     *\n     * This is called when configuration has changed for the event lists\n     * to cause them to reload their data.\n     *\n     * @param {Object} root The root element for the timeline view.\n     */\n    var reset = function(root) {\n        if (loadedPages.length > 0) {\n            loadedPages.forEach(function(courseList, index) {\n                var pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then(function(html, js) {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        } else {\n            init(root);\n        }\n    };\n\n    return {\n        init: init,\n        reset: reset\n    };\n});\n"],"file":"view.min.js"}