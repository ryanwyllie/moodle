'use strict';define('block_myoverview/event_list_by_course',['jquery','block_myoverview/event_list','block_myoverview/calendar_events_repository'],function($,EventList,EventsRepository){var SELECTORS={EVENTS_BY_COURSE_CONTAINER:'[data-region="course-events-container"]',EVENT_LIST_CONTAINER:'[data-region="event-list-container"]'},load=function(root){var courseBlocks=root.find(SELECTORS.EVENTS_BY_COURSE_CONTAINER);if(courseBlocks.length){var eventList=courseBlocks.find(SELECTORS.EVENT_LIST_CONTAINER).first(),midnight=eventList.attr('data-midnight'),limit=eventList.attr('data-limit'),courseIds=courseBlocks.map(function(){return $(this).attr('data-course-id')}).get(),coursesPromise=EventsRepository.queryByCourses({courseids:courseIds,starttime:midnight-1209600,limit:limit});courseBlocks.each(function(index,container){container=$(container);var courseId=container.attr('data-course-id'),eventListContainer=container.find(EventList.rootSelector),promise=$.Deferred();coursesPromise.done(function(result){var events=[],courseGroup=result.groupedbycourse.filter(function(group){return group.courseid==courseId});courseGroup.length&&(events=courseGroup[0].events),promise.resolve({events:events})}).fail(function(e){promise.reject(e)}),EventList.load(eventListContainer,promise)})}};return{init:function init(root){root=$(root),load(root)}}});
//# sourceMappingURL=event_list_by_course.min.js.map
