{"version":3,"sources":["../src/ajax_response_renderer.js"],"names":["define","$","Templates","Notification","Url","buildDOM","rootElement","nodes","ul","attr","each","index","node","li","p","id","key","icon","isBranch","expandable","haschildren","addClass","requiresajaxloading","type","eleToAddIcon","link","title","append","name","hidden","span","NODETYPE","ACTIVITY","RESOURCE","alt","imageUrl","pix","component","classes","className","prepend","renderPix","then","html","catch","exception","children","length","removeClass","parent","render","element","item","first","group","find","hasClass"],"mappings":"iPAwBAA,iDAAO,CAAC,QAAD,CAAW,gBAAX,CAA6B,mBAA7B,CAAkD,UAAlD,CAAP,CAAsE,SAASC,CAAT,CAAYC,SAAZ,CAAuBC,YAAvB,CAAqCC,GAArC,CAA0C,CAkB5G,QAASC,SAAT,CAAkBC,WAAlB,CAA+BC,KAA/B,CAAsC,CAClC,GAAIC,IAAKP,EAAE,WAAF,CAAT,CACAO,GAAGC,IAAH,CAAQ,MAAR,CAAgB,OAAhB,CAFkC,CAGlCD,GAAGC,IAAH,CAAQ,aAAR,IAHkC,CAKlCR,EAAES,IAAF,CAAOH,KAAP,CAAc,SAASI,KAAT,CAAgBC,IAAhB,CAAsB,CAChC,GAAoB,QAAhB,uBAAOA,KAAP,qBAAOA,IAAP,EAAJ,KAIIC,IAAKZ,EAAE,WAAF,CAJT,CAKIa,EAAIb,EAAE,SAAF,CALR,CAMIc,GAAKH,KAAKG,EAAL,EAAWH,KAAKI,GAAL,CAAW,YAN/B,CAOIC,KAAO,IAPX,CAQIC,YAAYN,KAAKO,UAAL,EAAmBP,KAAKQ,WAApC,CARJ,CAUAN,EAAEO,QAAF,CAAW,WAAX,CAVA,CAWAP,EAAEL,IAAF,CAAO,IAAP,CAAaM,EAAb,CAXA,CAYAD,EAAEL,IAAF,CAAO,MAAP,CAAe,UAAf,CAZA,CAcAK,EAAEL,IAAF,CAAO,UAAP,CAAmB,IAAnB,CAdA,CAgBIG,KAAKU,mBAhBT,GAiBIR,EAAEL,IAAF,CAAO,oBAAP,IAjBJ,CAkBIK,EAAEL,IAAF,CAAO,cAAP,CAAuBG,KAAKG,EAA5B,CAlBJ,CAmBID,EAAEL,IAAF,CAAO,eAAP,CAAwBG,KAAKI,GAA7B,CAnBJ,CAoBIF,EAAEL,IAAF,CAAO,gBAAP,CAAyBG,KAAKW,IAA9B,CApBJ,EAuBIL,QAvBJ,GAwBIL,GAAGQ,QAAH,CAAY,2BAAZ,CAxBJ,CAyBIP,EAAEL,IAAF,CAAO,eAAP,IAzBJ,CA0BIK,EAAEO,QAAF,CAAW,QAAX,CA1BJ,EA6BA,GAAIG,cAAe,IAAnB,CACA,GAAIZ,KAAKa,IAAT,CAAe,CACX,GAAIA,MAAOxB,EAAE,aAAeW,KAAKc,KAApB,CAA4B,UAA5B,CAAyCd,KAAKa,IAA9C,CAAqD,QAAvD,CAAX,CAEAD,aAAeC,IAHJ,CAIXA,KAAKE,MAAL,CAAY,mCAAqCf,KAAKgB,IAA1C,CAAiD,SAA7D,CAJW,CAMPhB,KAAKiB,MANE,EAOPJ,KAAKJ,QAAL,CAAc,QAAd,CAPO,CAUXP,EAAEa,MAAF,CAASF,IAAT,CACH,CAXD,IAWO,CACH,GAAIK,MAAO7B,EAAE,eAAF,CAAX,CAEAuB,aAAeM,IAHZ,CAIHA,KAAKH,MAAL,CAAY,mCAAqCf,KAAKgB,IAA1C,CAAiD,SAA7D,CAJG,CAMChB,KAAKiB,MANN,EAOCC,KAAKT,QAAL,CAAc,QAAd,CAPD,CAUHP,EAAEa,MAAF,CAASG,IAAT,CACH,CAEGlB,KAAKK,IAAL,GAAc,CAACC,QAAD,EAAaN,KAAKW,IAAL,GAAcQ,SAASC,QAApC,EAAgDpB,KAAKW,IAAL,GAAcQ,SAASE,QAArF,CAtDJ,GAuDIpB,GAAGQ,QAAH,CAAY,gBAAZ,CAvDJ,CAwDIP,EAAEO,QAAF,CAAW,SAAX,CAxDJ,CA0DQT,KAAKW,IAAL,GAAcQ,SAASC,QAAvB,EAAmCpB,KAAKW,IAAL,GAAcQ,SAASE,QA1DlE,EA2DQhB,KAAOhB,EAAE,QAAF,CA3Df,CA4DQgB,KAAKR,IAAL,CAAU,KAAV,CAAiBG,KAAKK,IAAL,CAAUiB,GAA3B,CA5DR,CA6DQjB,KAAKR,IAAL,CAAU,OAAV,CAAmBG,KAAKK,IAAL,CAAUS,KAA7B,CA7DR,CA8DQT,KAAKR,IAAL,CAAU,KAAV,CAAiBL,IAAI+B,QAAJ,CAAavB,KAAKK,IAAL,CAAUmB,GAAvB,CAA4BxB,KAAKK,IAAL,CAAUoB,SAAtC,CAAjB,CA9DR,CA+DQpC,EAAES,IAAF,CAAOE,KAAKK,IAAL,CAAUqB,OAAjB,CAA0B,SAAS3B,KAAT,CAAgB4B,SAAhB,CAA2B,CACjDtB,KAAKI,QAAL,CAAckB,SAAd,CACH,CAFD,CA/DR,CAkEQf,aAAagB,OAAb,CAAqBvB,IAArB,CAlER,GAoEmC,QAAvB,OAAKA,IAAL,CAAUoB,SApEtB,GAqEYzB,KAAKK,IAAL,CAAUoB,SAAV,CAAsB,MArElC,EAuEQnC,UAAUuC,SAAV,CAAoB7B,KAAKK,IAAL,CAAUmB,GAA9B,CAAmCxB,KAAKK,IAAL,CAAUoB,SAA7C,CAAwDzB,KAAKK,IAAL,CAAUS,KAAlE,EAAyEgB,IAAzE,CAA8E,SAASC,IAAT,CAAe,CAEzFnB,aAAagB,OAAb,CAAqBG,IAArB,CAEH,CAJD,EAIGC,KAJH,CAISzC,aAAa0C,SAJtB,CAvER,GA+EAhC,GAAGc,MAAH,CAAUb,CAAV,CA/EA,CAgFAN,GAAGmB,MAAH,CAAUd,EAAV,CAhFA,CAkFID,KAAKkC,QAAL,EAAiBlC,KAAKkC,QAAL,CAAcC,MAlFnC,CAmFI1C,SAASS,CAAT,CAAYF,KAAKkC,QAAjB,CAnFJ,CAoFW5B,UAAY,CAACN,KAAKU,mBApF7B,GAqFIT,GAAGmC,WAAH,CAAe,iBAAf,CArFJ,CAsFIlC,EAAEO,QAAF,CAAW,aAAX,CAtFJ,EAwFH,CAzFD,CALkC,CAgGlCf,YAAY2C,MAAZ,GAAqBtB,MAArB,CAA4BnB,EAA5B,CAhGkC,CAiGlC,GAAIO,IAAKT,YAAYG,IAAZ,CAAiB,IAAjB,EAAyB,QAAlC,CACAD,GAAGC,IAAH,CAAQ,IAAR,CAAcM,EAAd,CAlGkC,CAmGlCT,YAAYG,IAAZ,CAAiB,WAAjB,CAA8BM,EAA9B,CAnGkC,CAoGlCT,YAAYG,IAAZ,CAAiB,MAAjB,CAAyB,UAAzB,CACH,CAnHD,GAAIsB,UAAW,CAEXC,SAAU,EAFC,CAIXC,SAAU,EAJC,CAAf,CAqHA,MAAO,CACHiB,OAAQ,gBAASC,OAAT,CAAkB5C,KAAlB,CAAyB,CAE7B,GAAIA,MAAMuC,QAAN,EAAkBvC,MAAMuC,QAAN,CAAeC,MAArC,CAA6C,CACzC1C,SAAS8C,OAAT,CAAkB5C,MAAMuC,QAAxB,CADyC,IAGrCM,MAAOD,QAAQL,QAAR,CAAiB,qBAAjB,EAAsCO,KAAtC,EAH8B,CAIrCC,MAAQH,QAAQI,IAAR,CAAa,IAAMH,KAAK3C,IAAL,CAAU,WAAV,CAAnB,CAJ6B,CAMzC2C,KAAK3C,IAAL,CAAU,eAAV,IANyC,CAOzC6C,MAAM7C,IAAN,CAAW,aAAX,IACH,CARD,IASQ0C,SAAQF,MAAR,GAAiBO,QAAjB,CAA0B,iBAA1B,CATR,GAUQL,QAAQF,MAAR,GAAiBD,WAAjB,CAA6B,iBAA7B,CAVR,CAWQG,QAAQ9B,QAAR,CAAiB,aAAjB,CAXR,CAcH,CAjBE,CAmBV,CA5ID,C","file":"ajax_response_renderer.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Parse the response from the navblock ajax page and render the correct DOM\n * structure for the tree from it.\n *\n * @module     block_navigation/ajax_response_renderer\n * @package    core\n * @copyright  2015 John Okely <john@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/templates', 'core/notification', 'core/url'], function($, Templates, Notification, Url) {\n\n    // Mappings for the different types of nodes coming from the navigation.\n    // Copied from lib/navigationlib.php navigation_node constants.\n    var NODETYPE = {\n        // @type int Activity (course module) = 40.\n        ACTIVITY: 40,\n        // @type int Resource (course module = 50.\n        RESOURCE: 50,\n    };\n\n    /**\n     * Build DOM.\n     *\n     * @method buildDOM\n     * @param {Object} rootElement the root element of DOM.\n     * @param {object} nodes jquery object representing the nodes to be build.\n     */\n    function buildDOM(rootElement, nodes) {\n        var ul = $('<ul></ul>');\n        ul.attr('role', 'group');\n        ul.attr('aria-hidden', true);\n\n        $.each(nodes, function(index, node) {\n            if (typeof node !== 'object') {\n                return;\n            }\n\n            var li = $('<li></li>');\n            var p = $('<p></p>');\n            var id = node.id || node.key + '_tree_item';\n            var icon = null;\n            var isBranch = (node.expandable || node.haschildren) ? true : false;\n\n            p.addClass('tree_item');\n            p.attr('id', id);\n            p.attr('role', 'treeitem');\n            // Negative tab index to allow it to receive focus.\n            p.attr('tabindex', '-1');\n\n            if (node.requiresajaxloading) {\n                p.attr('data-requires-ajax', true);\n                p.attr('data-node-id', node.id);\n                p.attr('data-node-key', node.key);\n                p.attr('data-node-type', node.type);\n            }\n\n            if (isBranch) {\n                li.addClass('collapsed contains_branch');\n                p.attr('aria-expanded', false);\n                p.addClass('branch');\n            }\n\n            var eleToAddIcon = null;\n            if (node.link) {\n                var link = $('<a title=\"' + node.title + '\" href=\"' + node.link + '\"></a>');\n\n                eleToAddIcon = link;\n                link.append('<span class=\"item-content-wrap\">' + node.name + '</span>');\n\n                if (node.hidden) {\n                    link.addClass('dimmed');\n                }\n\n                p.append(link);\n            } else {\n                var span = $('<span></span>');\n\n                eleToAddIcon = span;\n                span.append('<span class=\"item-content-wrap\">' + node.name + '</span>');\n\n                if (node.hidden) {\n                    span.addClass('dimmed');\n                }\n\n                p.append(span);\n            }\n\n            if (node.icon && (!isBranch || node.type === NODETYPE.ACTIVITY || node.type === NODETYPE.RESOURCE)) {\n                li.addClass('item_with_icon');\n                p.addClass('hasicon');\n\n                if (node.type === NODETYPE.ACTIVITY || node.type === NODETYPE.RESOURCE) {\n                    icon = $('<img/>');\n                    icon.attr('alt', node.icon.alt);\n                    icon.attr('title', node.icon.title);\n                    icon.attr('src', Url.imageUrl(node.icon.pix, node.icon.component));\n                    $.each(node.icon.classes, function(index, className) {\n                        icon.addClass(className);\n                    });\n                    eleToAddIcon.prepend(icon);\n                } else {\n                    if (node.icon.component == 'moodle') {\n                        node.icon.component = 'core';\n                    }\n                    Templates.renderPix(node.icon.pix, node.icon.component, node.icon.title).then(function(html) {\n                        // Prepend.\n                        eleToAddIcon.prepend(html);\n                        return;\n                    }).catch(Notification.exception);\n                }\n            }\n\n            li.append(p);\n            ul.append(li);\n\n            if (node.children && node.children.length) {\n                buildDOM(p, node.children);\n            } else if (isBranch && !node.requiresajaxloading) {\n                li.removeClass('contains_branch');\n                p.addClass('emptybranch');\n            }\n        });\n\n        rootElement.parent().append(ul);\n        var id = rootElement.attr('id') + '_group';\n        ul.attr('id', id);\n        rootElement.attr('aria-owns', id);\n        rootElement.attr('role', 'treeitem');\n    }\n\n    return {\n        render: function(element, nodes) {\n            // The first element of the response is the existing node so we start with processing the children.\n            if (nodes.children && nodes.children.length) {\n                buildDOM(element, nodes.children);\n\n                var item = element.children(\"[role='treeitem']\").first();\n                var group = element.find('#' + item.attr('aria-owns'));\n\n                item.attr('aria-expanded', true);\n                group.attr('aria-hidden', false);\n            } else {\n                if (element.parent().hasClass('contains_branch')) {\n                    element.parent().removeClass('contains_branch');\n                    element.addClass('emptybranch');\n                }\n            }\n        }\n    };\n});\n"]}