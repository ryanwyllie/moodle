define(["jquery"],function(a){function b(d,e,f){var g=a("<ul></ul>");g.attr("role","group"),g.attr("aria-hidden","true"),f&&(g.attr("id",f),g.attr("style","display: none;")),a.each(e,function(d,e){if("object"==typeof e){var f=a("<li></li>"),h=a("<p></p>"),i=null,j=null,k=e.expandable||e.haschildren?!0:!1,l=e.requiresajaxloading?f:h;if(h.addClass("tree_item"),h.attr("id",e.id),l.attr("role","treeitem"),e.requiresajaxloading&&(f.attr("data-requires-ajax",!0),f.attr("data-node-id",e.id),f.attr("data-node-key",e.key),f.attr("data-node-type",e.type)),k&&(f.addClass("collapsed contains_branch"),l.attr("aria-expanded",!1),h.addClass("branch"),e.requiresajaxloading||(i=e.key+"_group",h.attr("aria-owns",i))),!e.icon||k&&e.type!==c.ACTIVITY&&e.type!==c.RESOURCE||(f.addClass("item_with_icon"),h.addClass("hasicon"),j=a("<img/>"),j.attr("alt",e.icon.alt),j.attr("title",e.icon.title),j.attr("src",M.util.image_url(e.icon.pix,e.icon.component)),a.each(e.icon.classes,function(a,b){j.addClass(b)})),e.link){var m=a('<a title="'+e.title+'" href="'+e.link+'"></a>');j?(m.append(j),m.append('<span class="item-content-wrap">'+e.name+"</span>")):m.text(e.name),e.hidden&&m.addClass("dimmed"),h.append(m)}else{var n=a("<span></span>");j?(n.append(j),n.append('<span class="item-content-wrap">'+e.name+"</span>")):n.text(e.name),e.hidden&&n.addClass("dimmed"),h.append(n)}f.append(h),g.append(f),e.children&&e.children.length?b(f,e.children,i):k&&!e.requiresajaxloading&&(f.removeClass("contains_branch"),f.addClass("emptybranch"))}}),d.append(g)}var c={ACTIVITY:40,RESOURCE:50};return{render:function(a,c){if(c.children&&c.children.length?b(a,c.children):a.hasClass("contains_branch")&&a.removeClass("contains_branch").addClass("emptybranch"),a.is("li")&&"true"===a.attr("data-requires-ajax")){var d=a.find("p").first();a.find("ul").first().attr("id",d.attr("id")),d.attr("role","treeitem"),d.attr("aria-expanded","true"),d.attr("aria-owns",d.attr("id")),d.removeAttr("id"),d.focus()}}}});