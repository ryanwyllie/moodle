{"version":3,"sources":["../src/change_user_visibility.js"],"names":["define","$","Ajax","Str","Notification","SELECTORS","CHANGE_VISIBILITY_LINK","CHANGE_VISIBILITY_ICON","changeVisibility","action","userid","value","call","methodname","args","preferences","then","data","saved","newAction","oppositeAction","changeVisibilityLinkAttr","changeVisibilityIconAttr","catch","exception","getTitle","title","attr","icon","is","M","util","image_url","addClass","getIconClass","removeClass","get_string","init","on","e","preventDefault"],"mappings":"aAwBAA,mDAAO,CAAC,QAAD,CAAW,WAAX,CAAwB,UAAxB,CAAoC,mBAApC,CAAP,CACQ,SAASC,CAAT,CAAYC,IAAZ,CAAkBC,GAAlB,CAAuBC,YAAvB,CAAqC,IAQrCC,WAAY,CACZC,uBAAwB,yBADZ,CAEZC,uBAAwB,+BAFZ,CARyB,CAqBrCC,iBAAmB,SAASC,MAAT,CAAiBC,MAAjB,CAAyB,IAExCC,OAAkB,MAAV,SAAmB,CAAnB,CAAuB,CAFS,CAe5CT,KAAKU,IAAL,CAAU,CANI,CACVC,WAAY,gCADF,CAEVC,KAAM,CACFC,YATU,CAAC,CACf,KAAQ,mCADO,CAEf,MAASJ,KAFM,CAGf,OAAUD,MAHK,CAAD,CAQR,CAFI,CAMJ,CAAV,EAAqB,CAArB,EAAwBM,IAAxB,CAA6B,SAASC,IAAT,CAAe,CACxC,GAAIA,KAAKC,KAAT,CAAgB,CACZ,GAAIC,WAAYC,eAAeX,MAAf,CAAhB,CACAY,yBAAyBF,SAAzB,CAFY,CAGZG,yBAAyBH,SAAzB,CACH,CAEJ,CAPD,EAOGI,KAPH,CAOSnB,aAAaoB,SAPtB,CAQH,CA5CwC,CAsDrCJ,eAAiB,SAASX,MAAT,CAAiB,CAClC,MAAiB,MAAV,SAAmB,MAAnB,CAA4B,MACtC,CAxDwC,CAiErCY,yBAA2B,SAASZ,MAAT,CAAiB,CAC5CgB,SAAShB,MAAT,EAAiBO,IAAjB,CAAsB,SAASU,KAAT,CAAgB,CAClCzB,EAAEI,UAAUC,sBAAZ,EAAoCqB,IAApC,CAAyC,CACrC,cAAelB,MADsB,CAErC,MAASiB,KAF4B,CAAzC,CAKH,CAND,EAMGH,KANH,CAMSnB,aAAaoB,SANtB,CAOH,CAzEwC,CAkFrCF,yBAA2B,SAASb,MAAT,CAAiB,CAC5C,GAAImB,MAAO3B,EAAEI,UAAUE,sBAAZ,CAAX,CACAkB,SAAShB,MAAT,EAAiBO,IAAjB,CAAsB,SAASU,KAAT,CAAgB,CAiBlC,MAfAzB,GAAE2B,IAAF,EAAQD,IAAR,CAAa,CACT,MAASD,KADA,CAET,aAAcA,KAFL,CAAb,CAeA,MAVIE,KAAKC,EAAL,CAAQ,KAAR,CAUJ,CATI5B,EAAE2B,IAAF,EAAQD,IAAR,CAAa,CACT,IAAOG,EAAEC,IAAF,CAAOC,SAAP,CAAiB,KAAOvB,MAAxB,CADE,CAET,IAAOiB,KAFE,CAAb,CASJ,EAHIzB,EAAE2B,IAAF,EAAQK,QAAR,CAAiBC,aAAazB,MAAb,CAAjB,CAGJ,CAFIR,EAAE2B,IAAF,EAAQO,WAAR,CAAoBD,aAAad,eAAeX,MAAf,CAAb,CAApB,CAEJ,EACH,CAlBD,EAkBGc,KAlBH,CAkBSnB,aAAaoB,SAlBtB,CAmBH,CAvGwC,CAiHrCU,aAAe,SAASzB,MAAT,CAAiB,CAChC,MAAiB,MAAV,SAAmB,cAAnB,CAAoC,QAC9C,CAnHwC,CA6HrCgB,SAAW,SAAShB,MAAT,CAAiB,CAC5B,MAAON,KAAIiC,UAAJ,CAAe,iBAAmB3B,MAAlC,CAA0C,oBAA1C,CACV,CA/HwC,CAiIzC,MAAO,CAOH4B,KAAM,eAAW,CACbpC,EAAEI,UAAUC,sBAAZ,EAAoCgC,EAApC,CAAuC,OAAvC,CAAgD,SAASC,CAAT,CAAY,CACxDA,EAAEC,cAAF,EADwD,IAEpD/B,QAAUR,EAAE,IAAF,EAAQ0B,IAAR,CAAa,aAAb,CAF0C,CAGpDjB,OAAUT,EAAE,IAAF,EAAQ0B,IAAR,CAAa,aAAb,CAH0C,CAIxDnB,iBAAiBC,MAAjB,CAAyBC,MAAzB,CACH,CALD,CAMH,CAdE,CAgBV,CAlJD,C","file":"change_user_visibility.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module that handles the change of the user's visibility in the\n * online users block.\n *\n * @module     block_online_users/change_user_visibility\n * @package    block_online_users\n * @copyright  2018 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/str', 'core/notification'],\n        function($, Ajax, Str, Notification) {\n\n    /**\n     * Selectors.\n     *\n     * @access private\n     * @type {Object}\n     */\n    var SELECTORS = {\n        CHANGE_VISIBILITY_LINK: '#change-user-visibility',\n        CHANGE_VISIBILITY_ICON: '#change-user-visibility .icon'\n    };\n\n    /**\n     * Change user visibility in the online users block.\n     *\n     * @method changeVisibility\n     * @param {String} action\n     * @param {String} userid\n     * @private\n     */\n    var changeVisibility = function(action, userid) {\n\n        var value = action == \"show\" ? 1 : 0;\n        var preferences = [{\n            'name': 'block_online_users_uservisibility',\n            'value': value,\n            'userid': userid\n        }];\n\n        var request = {\n            methodname: 'core_user_set_user_preferences',\n            args: {\n                preferences: preferences\n            }\n        };\n        Ajax.call([request])[0].then(function(data) {\n            if (data.saved) {\n                var newAction = oppositeAction(action);\n                changeVisibilityLinkAttr(newAction);\n                changeVisibilityIconAttr(newAction);\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the opposite action.\n     *\n     * @method oppositeAction\n     * @param {String} action\n     * @return {String}\n     * @private\n     */\n    var oppositeAction = function(action) {\n        return action == 'show' ? 'hide' : 'show';\n    };\n\n    /**\n     * Change the attribute values of the user visibility link in the online users block.\n     *\n     * @method changeVisibilityLinkAttr\n     * @param {String} action\n     * @private\n     */\n    var changeVisibilityLinkAttr = function(action) {\n        getTitle(action).then(function(title) {\n            $(SELECTORS.CHANGE_VISIBILITY_LINK).attr({\n                'data-action': action,\n                'title': title\n            });\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Change the attribute values of the user visibility icon in the online users block.\n     *\n     * @method changeVisibilityIconAttr\n     * @param {String} action\n     * @private\n     */\n    var changeVisibilityIconAttr = function(action) {\n        var icon = $(SELECTORS.CHANGE_VISIBILITY_ICON);\n        getTitle(action).then(function(title) {\n            // Add the proper title to the icon.\n            $(icon).attr({\n                'title': title,\n                'aria-label': title\n            });\n            // If the icon is an image.\n            if (icon.is(\"img\")) {\n                $(icon).attr({\n                    'src': M.util.image_url('t/' + action),\n                    'alt': title\n                });\n            } else {\n                // Add the new icon class and remove the old one.\n                $(icon).addClass(getIconClass(action));\n                $(icon).removeClass(getIconClass(oppositeAction(action)));\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the proper class for the user visibility icon in the online users block.\n     *\n     * @method getIconClass\n     * @param {String} action\n     * @return {String}\n     * @private\n     */\n    var getIconClass = function(action) {\n        return action == 'show' ? 'fa-eye-slash' : 'fa-eye';\n    };\n\n    /**\n     * Get the title description of the user visibility link in the online users block.\n     *\n     * @method getTitle\n     * @param {String} action\n     * @return {object} jQuery promise\n     * @private\n     */\n    var getTitle = function(action) {\n        return Str.get_string('online_status:' + action, 'block_online_users');\n    };\n\n    return {\n        // Public variables and functions.\n        /**\n         * Initialise change user visibility function.\n         *\n         * @method init\n         */\n        init: function() {\n            $(SELECTORS.CHANGE_VISIBILITY_LINK).on('click', function(e) {\n                e.preventDefault();\n                var action = ($(this).attr('data-action'));\n                var userid = ($(this).attr('data-userid'));\n                changeVisibility(action, userid);\n            });\n        }\n    };\n});\n"]}