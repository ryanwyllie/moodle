'use strict';define('enrol_manual/quickenrolment',['core/templates','jquery','core/str','core/config','core/notification','core/modal_factory','core/modal_events','core/fragment'],function(Template,$,Str,Config,Notification,ModalFactory,ModalEvents,Fragment){var SELECTORS={COHORTSELECT:'#id_cohortlist',TRIGGERBUTTONS:'.enrolusersbutton.enrol_manual_plugin [type=\'submit\']',UNWANTEDHIDDENFIELDS:':input[value=\'_qf__force_multiselect_submission\']'},QuickEnrolment=function(options){this.contextid=options.contextid,this.initModal()};return QuickEnrolment.prototype.courseid=0,QuickEnrolment.prototype.modal=null,QuickEnrolment.prototype.initModal=function(){var triggerButtons=$(SELECTORS.TRIGGERBUTTONS);$.when(Str.get_strings([{key:'enroluserscohorts',component:'enrol_manual'},{key:'enrolusers',component:'enrol_manual'}]),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,large:!0},triggerButtons)).then(function(strings,modal){return this.modal=modal,modal.setTitle(strings[1]),modal.setSaveButtonText(strings[1]),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on('submit','form',this.submitFormAjax.bind(this)),modal.getRoot().on(ModalEvents.hidden,function(){modal.setBody('')}),void modal.getRoot().on(ModalEvents.shown,function(){var bodyPromise=this.getBody();bodyPromise.then(function(html){var stringIndex=$(html).find(SELECTORS.COHORTSELECT).length?0:1;modal.setSaveButtonText(strings[stringIndex])}).fail(Notification.exception),modal.setBody(bodyPromise)}.bind(this))}.bind(this)).fail(Notification.exception)},QuickEnrolment.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find('form').submit()},QuickEnrolment.prototype.submitFormAjax=function(e){e.preventDefault();var form=this.modal.getRoot().find('form'),hidden=form.find(SELECTORS.UNWANTEDHIDDENFIELDS);hidden.each(function(){$(this).remove()});var formData=form.serialize();this.modal.hide();var script=Config.wwwroot+'/enrol/manual/ajax.php?'+formData;$.ajax(script,{type:'GET',processData:!1,contentType:'application/json'}).then(function(response){response.error?Notification.addNotification({message:response.error,type:'error'}):('undefined'!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload())}).fail(Notification.exception)},QuickEnrolment.prototype.getBody=function(){return Fragment.loadFragment('enrol_manual','enrol_users_form',this.contextid,{}).fail(Notification.exception)},QuickEnrolment.prototype.getFooter=function(){return Template.render('enrol_manual/enrol_modal_footer',{})},{init:function init(config){new QuickEnrolment(config)}}});
//# sourceMappingURL=quickenrolment.min.js.map
