{"version":3,"sources":["../src/editorjs_plugin_template_base.js"],"names":["convertHTML","HTMLToVdom","initializeConverter","VNode","VirtualDOM","VText","TemplateBase","data","config","template","wrapper","tree","html","Templates","syncRender","create","renderFromTemplate","bind","registerEventListeners","newTree","patches","diff","patch"],"mappings":"wOAsBA,OACA,OAEA,O,uXAEMA,CAAAA,CAAW,CAAGC,UAAWC,mBAAX,CAA+B,CAC/CC,KAAK,CAAEC,UAAWD,KAD6B,CAE/CE,KAAK,CAAED,UAAWC,KAF6B,CAA/B,C,CAKCC,C,YACjB,aAA8B,IAAhBC,CAAAA,CAAgB,GAAhBA,IAAgB,CAAVC,CAAU,GAAVA,MAAU,WAC1B,KAAKD,IAAL,CAAYA,CAAZ,CACA,KAAKE,QAAL,CAAgBD,CAAM,CAACC,QAAvB,CACA,KAAKC,OAAL,CAAe,IAAf,CACA,KAAKC,IAAL,CAAY,IACf,C,0EAEwB,CAExB,C,uCAEQ,CACL,KAAKJ,IAAL,CAAY,iBAAW,KAAKA,IAAhB,CAAZ,CACA,GAAMK,CAAAA,CAAI,CAAGC,UAAUC,UAAV,CAAqB,KAAKL,QAA1B,CAAoC,KAAKF,IAAzC,CAAb,CACA,KAAKI,IAAL,CAAYX,CAAW,gBAASY,CAAT,WAAvB,CACA,KAAKF,OAAL,CAAeN,UAAWW,MAAX,CAAkB,KAAKJ,IAAvB,CAAf,CACA,cAAQ,KAAKK,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAAR,EACA,KAAKC,sBAAL,CAA4B,KAAKR,OAAjC,CAA0C,KAAKH,IAA/C,EAEA,MAAO,MAAKG,OACf,C,+DAEoB,IACXE,CAAAA,CAAI,CAAGC,UAAUC,UAAV,CAAqB,KAAKL,QAA1B,CAAoC,WAAK,KAAKF,IAAV,CAApC,CADI,CAGXY,CAAO,CAAGnB,CAAW,gBAASY,CAAT,WAHV,CAIXQ,CAAO,CAAGhB,UAAWiB,IAAX,CAAgB,KAAKV,IAArB,CAA2BQ,CAA3B,CAJC,CAKjBf,UAAWkB,KAAX,CAAiB,KAAKZ,OAAtB,CAA+BU,CAA/B,EACA,KAAKT,IAAL,CAAYQ,CACf,C,mCAEM,CACH,MAAO,WAAK,KAAKZ,IAAV,CACV,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * EditorJS plugin base for using template to render.\n *\n * @copyright  2019 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport VirtualDOM from 'core/virtual-dom';\nimport Templates from 'core/templates';\nimport { observable, autorun, toJS } from 'core/mobx';\nimport HTMLToVdom from 'core/html-to-vdom';\n\nconst convertHTML = HTMLToVdom.initializeConverter({\n    VNode: VirtualDOM.VNode,\n    VText: VirtualDOM.VText\n});\n\nexport default class TemplateBase {\n    constructor({ data, config }) {\n        this.data = data;\n        this.template = config.template;\n        this.wrapper = null;\n        this.tree = null;\n    }\n\n    registerEventListeners() {\n        // Override me.\n    }\n\n    render() {\n        this.data = observable(this.data);\n        const html = Templates.syncRender(this.template, this.data);\n        this.tree = convertHTML(`<div>${html}</div>`);\n        this.wrapper = VirtualDOM.create(this.tree);\n        autorun(this.renderFromTemplate.bind(this));\n        this.registerEventListeners(this.wrapper, this.data);\n\n        return this.wrapper;\n    }\n\n    renderFromTemplate() {\n        const html = Templates.syncRender(this.template, toJS(this.data));\n        // Add our wrapping div so that we don't replace the root node.\n        const newTree = convertHTML(`<div>${html}</div>`);\n        const patches = VirtualDOM.diff(this.tree, newTree);\n        VirtualDOM.patch(this.wrapper, patches);\n        this.tree = newTree;\n    }\n\n    save() {\n        return toJS(this.data);\n    }\n}"],"file":"editorjs_plugin_template_base.min.js"}