define(["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_view_contact","core_message/message_drawer_view_contacts","core_message/message_drawer_view_overview","core_message/message_drawer_view_conversation","core_message/message_drawer_view_search","core_message/message_drawer_view_settings","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={VIEW_CONTACT:'[data-region="view-contact"]',VIEW_CONTACTS:'[data-region="view-contacts"]',VIEW_CONVERSATION:'[data-region="view-conversation"]',VIEW_OVERVIEW:'[data-region="view-overview"]',VIEW_SEARCH:'[data-region="view-search"]',VIEW_SETTINGS:'[data-region="view-settings"]',ROUTES:"[data-route]",ROUTES_BACK:"[data-route-back]",HEADER_CONTAINER:'[data-region="header-container"]',BODY_CONTAINER:'[data-region="body-container"]',FOOTER_CONTAINER:'[data-region="footer-container"]'},n=function(a,b){var c=a.children(),d=c.filter(m.HEADER_CONTAINER).find(b),e=c.filter(m.BODY_CONTAINER).find(b),f=c.filter(m.FOOTER_CONTAINER).find(b),g=[d,e,f].filter(function(a){return a.length});return g},o=function(a){j.add(k.VIEW_CONTACT,n(a,m.VIEW_CONTACT),d.show),j.add(k.VIEW_CONTACTS,n(a,m.VIEW_CONTACTS),e.show),j.add(k.VIEW_CONVERSATION,n(a,m.VIEW_CONVERSATION),g.show),j.add(k.VIEW_OVERVIEW,n(a,m.VIEW_OVERVIEW),f.show),j.add(k.VIEW_SEARCH,n(a,m.VIEW_SEARCH),h.show),j.add(k.VIEW_SETTINGS,n(a,m.VIEW_SETTINGS),i.show)},p=function(a){a.attr("data-shown")||(j.go(k.VIEW_OVERVIEW),a.attr("data-shown",!0)),a.removeClass("hidden"),a.attr("aria-expanded",!0),a.attr("aria-hidden",!1)},q=function(a){a.addClass("hidden"),a.attr("aria-expanded",!1),a.attr("aria-hidden",!0)},r=function(a){return!a.hasClass("hidden")},s=function(d){b.define(d,[b.events.activate]);var e=/^data-route-param-?(\d*)$/;d.on(b.events.activate,m.ROUTES,function(b,c){for(var d=a(b.target).closest(m.ROUTES),f=d.attr("data-route"),g=[],h=0;h<d[0].attributes.length;h++)g.push(d[0].attributes[h]);var i=g.filter(function(a){var b=a.nodeName,c=e.test(b);return c});i.sort(function(a,b){var c=e.exec(a.nodeName),d=e.exec(b.nodeName),f=c.length>1?c[1]:0,g=d.length>1?d[1]:0;return f<g?-1:g<f?1:0});var k=i.map(function(a){return a.nodeValue}),l=[f].concat(k);j.go.apply(null,l),c.originalEvent.preventDefault()}),d.on(b.events.activate,m.ROUTES_BACK,function(a,b){j.back(),b.originalEvent.preventDefault()}),c.subscribe(l.SHOW,function(){p(d)}),c.subscribe(l.HIDE,function(){q(d)}),c.subscribe(l.TOGGLE_VISIBILITY,function(){r(d)?q(d):p(d)}),c.subscribe(l.SHOW_CONVERSATION,function(a){p(d),j.go(k.VIEW_CONVERSATION,a)}),c.subscribe(l.SHOW_SETTINGS,function(){p(d),j.go(k.VIEW_SETTINGS)})},t=function(b){b=a(b),o(b),s(b)};return{init:t}});