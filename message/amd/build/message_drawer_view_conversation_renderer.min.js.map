{"version":3,"sources":["../src/message_drawer_view_conversation_renderer.js"],"names":["define","$","Notification","Str","Templates","UserDate","Constants","SELECTORS","TEMPLATES","CONVERSATION_TYPES","getMessagesContainer","body","find","CONTENT_MESSAGES_CONTAINER","showMessagesContainer","removeClass","hideMessagesContainer","addClass","getSelfConversationMessageContainer","SELF_CONVERSATION_MESSAGE_CONTAINER","hideSelfConversationMessageContainer","getContactRequestSentContainer","CONTACT_REQUEST_SENT_MESSAGE_CONTAINER","hideContactRequestSentContainer","getFooterContentContainer","footer","CONTENT_MESSAGES_FOOTER_CONTAINER","showFooterContent","hideFooterContent","getFooterEditModeContainer","CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER","showFooterEditMode","hideFooterEditMode","getFooterPlaceholderContainer","PLACEHOLDER_CONTAINER","showFooterPlaceholder","hideFooterPlaceholder","getFooterRequireContactContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER","showFooterRequireContact","hideFooterRequireContact","getFooterRequireUnblockContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER","showFooterRequireUnblock","hideFooterRequireUnblock","getFooterUnableToMessageContainer","CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER","showFooterUnableToMessage","hideFooterUnableToMessage","hideAllHeaderElements","header","hideHeaderContent","hideHeaderEditMode","hideHeaderPlaceholder","hideAllFooterElements","getContentPlaceholderContainer","CONTENT_PLACEHOLDER_CONTAINER","showContentPlaceholder","hideContentPlaceholder","getHeaderContent","HEADER","showHeaderContent","getHeaderEditMode","HEADER_EDIT_MODE","showHeaderEditMode","getHeaderPlaceholderContainer","HEADER_PLACEHOLDER_CONTAINER","showHeaderPlaceholder","getMessageTextArea","MESSAGE_TEXT_AREA","getMessageElement","messageId","messagesContainer","getDayElement","dayTimeCreated","getMoreMessagesLoadingIconContainer","MORE_MESSAGES_LOADING_ICON_CONTAINER","showMoreMessagesLoadingIcon","hideMoreMessagesLoadingIcon","disableSendMessage","SEND_MESSAGE_BUTTON","prop","enableSendMessage","startSendMessageLoading","SEND_MESSAGE_ICON_CONTAINER","LOADING_ICON_CONTAINER","stopSendMessageLoading","hasSentMessage","textArea","val","focus","getConfirmDialogueContainer","root","CONFIRM_DIALOGUE_CONTAINER","showConfirmDialogueContainer","container","siblings","attr","hideConfirmDialogueContainer","removeAttr","setMessagesSelectedCount","value","MESSAGES_SELECTED_COUNT","text","formatMessagesForTemplate","messages","datesCache","map","message","id","isread","isRead","fromloggedinuser","fromLoggedInUser","userfrom","userFrom","formattedtime","timeCreated","renderAddDays","days","daysRenderPromises","data","render","DAY","timestamp","when","apply","then","forEach","index","html","before","element","insertBefore","append","catch","renderAddMessages","messagesData","formattedMessages","MESSAGES","messageList","messageHtml","dayContainer","day","dayMessagesContainer","DAY_MESSAGES_CONTAINER","renderRemoveDays","remove","renderRemoveMessages","renderConversation","renderingPromises","hasAddDays","add","length","hasAddMessages","timestampsToFormat","datesCachePromise","Deferred","resolve","promise","concat","reduce","carry","get_string","format","requests","get","formattedTimes","push","renderHeader","headerContainer","template","HEADER_PUBLIC","context","showrouteback","type","PRIVATE","showControls","HEADER_PRIVATE","HEADER_PRIVATE_NO_CONTROLS","SELF","HEADER_SELF","js","replaceNodeContents","renderFooter","get_strings","key","component","param","user","fullname","strings","title","footerContainer","TITLE","TEXT","renderScrollToMessage","messageElement","position","scrollTop","top","renderLoadingMembers","isLoadingMembers","renderLoadingFirstMessages","isLoadingFirstMessages","renderLoadingMessages","isLoading","renderSendingMessage","isSending","showConfirmDialogue","buttonSelectors","bodyText","headerText","canCancel","skipHeader","dialogue","buttons","selector","cancelButton","CONFIRM_DIALOGUE_CANCEL_BUTTON","CONFIRM_DIALOGUE_TEXT","dialogueHeader","CONFIRM_DIALOGUE_HEADER","button","CAN_RECEIVE_FOCUS","filter","first","hideConfirmDialogue","hideCheckDeleteDialogue","renderConfirmBlockUser","string","ACTION_CONFIRM_BLOCK","renderConfirmUnblockUser","ACTION_CONFIRM_UNBLOCK","renderConfirmAddContact","ACTION_CONFIRM_ADD_CONTACT","renderConfirmRemoveContact","ACTION_CONFIRM_REMOVE_CONTACT","renderConfirmDeleteSelectedMessages","showmessage","canDeleteMessagesForAllUsers","showCheckDeleteDialogue","show","ACTION_CONFIRM_DELETE_SELECTED_MESSAGES","renderConfirmDeleteConversation","ACTION_CONFIRM_DELETE_CONVERSATION","renderConfirmContactRequest","ACTION_ACCEPT_CONTACT_REQUEST","ACTION_DECLINE_CONTACT_REQUEST","checkboxRegion","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER","checkbox","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE","renderIsBlocked","isBlocked","ACTION_REQUEST_BLOCK","ACTION_REQUEST_UNBLOCK","renderIsFavourite","state","favouriteIcon","FAVOURITE_ICON_CONTAINER","addFavourite","ACTION_CONFIRM_FAVOURITE","removeFavourite","ACTION_CONFIRM_UNFAVOURITE","renderIsMuted","muteIcon","MUTED_ICON_CONTAINER","setMuted","ACTION_CONFIRM_MUTE","unsetMuted","ACTION_CONFIRM_UNMUTE","renderIsContact","addContact","ACTION_REQUEST_ADD_CONTACT","removeContact","ACTION_REQUEST_REMOVE_CONTACT","renderLoadingConfirmAction","buttonText","CONFIRM_DIALOGUE_BUTTON_TEXT","loadingIcon","renderInEditMode","inEditMode","MESSAGE_NOT_SELECTED","MESSAGE_NOT_SELECTED_ICON","MESSAGE_SELECTED_ICON","renderSelectedMessages","hasSelectedMessages","count","renderRequireAddContact","hasMessages","renderSelfConversationMessage","displayMessage","renderContactRequestSent","userFullName","renderReset","patch","configs","reset","conversation","confirmBlockUser","confirmUnblockUser","confirmAddContact","confirmRemoveContact","confirmDeleteSelectedMessages","confirmDeleteConversation","confirmContactRequest","requireAddContact","selfConversationMessage","contactRequestSent","loadingMembers","loadingFirstMessages","loadingMessages","sendingMessage","isContact","isFavourite","isMuted","loadingConfirmAction","scrollToMessage","selectedMessages","processConfig","config","results","hasOwnProperty","renderFunc","patchValue","i","exception"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module updates the UI for the conversation page in the message\n * drawer.\n *\n * The module will take a patch from the message_drawer_view_conversation_patcher\n * module and update the UI to reflect the changes.\n *\n * This is the only module that ever modifies the UI of the conversation page.\n *\n * @module     core_message/message_drawer_view_conversation_renderer\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/notification',\n    'core/str',\n    'core/templates',\n    'core/user_date',\n    'core_message/message_drawer_view_conversation_constants'\n],\nfunction(\n    $,\n    Notification,\n    Str,\n    Templates,\n    UserDate,\n    Constants\n) {\n    var SELECTORS = Constants.SELECTORS;\n    var TEMPLATES = Constants.TEMPLATES;\n    var CONVERSATION_TYPES = Constants.CONVERSATION_TYPES;\n\n    /**\n     * Get the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getMessagesContainer = function(body) {\n        return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER);\n    };\n\n    /**\n     * Show the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showMessagesContainer = function(body) {\n        getMessagesContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideMessagesContainer = function(body) {\n        getMessagesContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the self-conversation message container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getSelfConversationMessageContainer = function(body) {\n        return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Hide the self-conversation message container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var hideSelfConversationMessageContainer = function(body) {\n        return getSelfConversationMessageContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the contact request sent container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getContactRequestSentContainer = function(body) {\n        return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Hide the contact request sent container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var hideContactRequestSentContainer = function(body) {\n        return getContactRequestSentContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer container element.\n     */\n    var getFooterContentContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER);\n    };\n\n    /**\n     * Show the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterContent = function(footer) {\n        getFooterContentContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterContent = function(footer) {\n        getFooterContentContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer container element.\n     */\n    var getFooterEditModeContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER);\n    };\n\n    /**\n     * Show the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterEditMode = function(footer) {\n        getFooterEditModeContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterEditMode = function(footer) {\n        getFooterEditModeContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer placeholder.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer placeholder container element.\n     */\n    var getFooterPlaceholderContainer = function(footer) {\n        return footer.find(SELECTORS.PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the footer placeholder\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterPlaceholder = function(footer) {\n        getFooterPlaceholderContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer placeholder\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterPlaceholder = function(footer) {\n        getFooterPlaceholderContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Require add as contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Require add as contact container element.\n     */\n    var getFooterRequireContactContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER);\n    };\n\n    /**\n     * Show the footer add as contact dialogue.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterRequireContact = function(footer) {\n        getFooterRequireContactContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer add as contact dialogue.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterRequireContact = function(footer) {\n        getFooterRequireContactContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Required to unblock contact container element.\n     */\n    var getFooterRequireUnblockContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER);\n    };\n\n    /**\n     * Show the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterRequireUnblock = function(footer) {\n        getFooterRequireUnblockContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterRequireUnblock = function(footer) {\n        getFooterRequireUnblockContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Unable to message contact container element.\n     */\n    var getFooterUnableToMessageContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Show the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterUnableToMessage = function(footer) {\n        getFooterUnableToMessageContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterUnableToMessage = function(footer) {\n        getFooterUnableToMessageContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Hide all header elements.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideAllHeaderElements = function(header) {\n        hideHeaderContent(header);\n        hideHeaderEditMode(header);\n        hideHeaderPlaceholder(header);\n    };\n\n    /**\n     * Hide all footer dialogues and messages.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideAllFooterElements = function(footer) {\n        hideFooterContent(footer);\n        hideFooterEditMode(footer);\n        hideFooterPlaceholder(footer);\n        hideFooterRequireContact(footer);\n        hideFooterRequireUnblock(footer);\n        hideFooterUnableToMessage(footer);\n    };\n\n    /**\n     * Get the content placeholder container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The body placeholder container element.\n     */\n    var getContentPlaceholderContainer = function(body) {\n        return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the content placeholder.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showContentPlaceholder = function(body) {\n        getContentPlaceholderContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the content placeholder.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideContentPlaceholder = function(body) {\n        getContentPlaceholderContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the header content container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header content container element.\n     */\n    var getHeaderContent = function(header) {\n        return header.find(SELECTORS.HEADER);\n    };\n\n    /**\n     * Show the header content.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderContent = function(header) {\n        getHeaderContent(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header content.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderContent = function(header) {\n        getHeaderContent(header).addClass('hidden');\n    };\n\n    /**\n     * Get the header edit mode container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header content container element.\n     */\n    var getHeaderEditMode = function(header) {\n        return header.find(SELECTORS.HEADER_EDIT_MODE);\n    };\n\n    /**\n     * Show the header edit mode container.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderEditMode = function(header) {\n        getHeaderEditMode(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header edit mode container.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderEditMode = function(header) {\n        getHeaderEditMode(header).addClass('hidden');\n    };\n\n    /**\n     * Get the header placeholder container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header placeholder container element.\n     */\n    var getHeaderPlaceholderContainer = function(header) {\n        return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the header placeholder.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderPlaceholder = function(header) {\n        getHeaderPlaceholderContainer(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header placeholder.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderPlaceholder = function(header) {\n        getHeaderPlaceholderContainer(header).addClass('hidden');\n    };\n\n    /**\n     * Get the text input area element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer placeholder container element.\n     */\n    var getMessageTextArea = function(footer) {\n        return footer.find(SELECTORS.MESSAGE_TEXT_AREA);\n    };\n\n    /**\n     * Get a message element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @param  {Number} messageId the Message id.\n     * @return {Object} A message element from the conversation.\n     */\n    var getMessageElement = function(body, messageId) {\n        var messagesContainer = getMessagesContainer(body);\n        return messagesContainer.find('[data-message-id=\"' + messageId + '\"]');\n    };\n\n    /**\n     * Get the day container element. The day container element holds a list of messages for that day.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @param  {Number} dayTimeCreated Midnight timestamp for the day.\n     * @return {Object} jQuery object\n     */\n    var getDayElement = function(body, dayTimeCreated) {\n        var messagesContainer = getMessagesContainer(body);\n        return messagesContainer.find('[data-day-id=\"' + dayTimeCreated + '\"]');\n    };\n\n    /**\n     * Get the more messages loading icon container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The more messages loading container element.\n     */\n    var getMoreMessagesLoadingIconContainer = function(body) {\n        return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER);\n    };\n\n    /**\n     * Show the more messages loading icon.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showMoreMessagesLoadingIcon = function(body) {\n        getMoreMessagesLoadingIconContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the more messages loading icon.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideMoreMessagesLoadingIcon = function(body) {\n        getMoreMessagesLoadingIconContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Disable the message controls for sending a message.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var disableSendMessage = function(footer) {\n        footer.find(SELECTORS.SEND_MESSAGE_BUTTON).prop('disabled', true);\n        getMessageTextArea(footer).prop('disabled', true);\n    };\n\n    /**\n     * Enable the message controls for sending a message.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var enableSendMessage = function(footer) {\n        footer.find(SELECTORS.SEND_MESSAGE_BUTTON).prop('disabled', false);\n        getMessageTextArea(footer).prop('disabled', false);\n    };\n\n    /**\n     * Show the sending message loading icon and disable sending more.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var startSendMessageLoading = function(footer) {\n        disableSendMessage(footer);\n        footer.find(SELECTORS.SEND_MESSAGE_ICON_CONTAINER).addClass('hidden');\n        footer.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the sending message loading icon and allow sending new messages.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var stopSendMessageLoading = function(footer) {\n        enableSendMessage(footer);\n        footer.find(SELECTORS.SEND_MESSAGE_ICON_CONTAINER).removeClass('hidden');\n        footer.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Clear out message text input and focus the input element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hasSentMessage = function(footer) {\n        var textArea = getMessageTextArea(footer);\n        textArea.val('');\n        textArea.focus();\n    };\n\n    /**\n     * Get the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element to search.\n     * @return {Object} The confirm dialogue container element.\n     */\n    var getConfirmDialogueContainer = function(root) {\n        return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER);\n    };\n\n    /**\n     * Show the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element containing a dialogue.\n     */\n    var showConfirmDialogueContainer = function(root) {\n        var container = getConfirmDialogueContainer(root);\n        var siblings = container.siblings(':not(.hidden)');\n        siblings.attr('aria-hidden', true);\n        siblings.attr('tabindex', -1);\n        siblings.attr('data-confirm-dialogue-hidden', true);\n\n        container.removeClass('hidden');\n    };\n\n    /**\n     * Hide the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element containing a dialogue.\n     */\n    var hideConfirmDialogueContainer = function(root) {\n        var container = getConfirmDialogueContainer(root);\n        var siblings = container.siblings('[data-confirm-dialogue-hidden=\"true\"]');\n        siblings.removeAttr('aria-hidden');\n        siblings.removeAttr('tabindex');\n        siblings.removeAttr('data-confirm-dialogue-hidden');\n\n        container.addClass('hidden');\n    };\n\n    /**\n     * Set the number of selected messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Number} value The new number to display.\n     */\n    var setMessagesSelectedCount = function(header, value) {\n        getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value);\n    };\n\n    /**\n     * Format message for the mustache template, transform camelCase properties to lowercase properties.\n     *\n     * @param  {Array} messages Array of message objects.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Array} Messages formated for mustache template.\n     */\n    var formatMessagesForTemplate = function(messages, datesCache) {\n        return messages.map(function(message) {\n            return {\n                id: message.id,\n                isread: message.isRead,\n                fromloggedinuser: message.fromLoggedInUser,\n                userfrom: message.userFrom,\n                text: message.text,\n                formattedtime: datesCache[message.timeCreated]\n            };\n        });\n    };\n\n    /**\n     * Create rendering promises for each day containing messages.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Array} days Array of days containing messages.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Promise} Days rendering promises.\n     */\n    var renderAddDays = function(header, body, footer, days, datesCache) {\n        var messagesContainer = getMessagesContainer(body);\n        var daysRenderPromises = days.map(function(data) {\n            return Templates.render(TEMPLATES.DAY, {\n                timestamp: data.value.timestamp,\n                messages: formatMessagesForTemplate(data.value.messages, datesCache)\n            });\n        });\n\n        return $.when.apply($, daysRenderPromises).then(function() {\n            // Wait until all of the rendering is done for each of the days\n            // to ensure they are added to the page in the correct order.\n            days.forEach(function(data, index) {\n                daysRenderPromises[index]\n                    .then(function(html) {\n                        if (data.before) {\n                            var element = getDayElement(body, data.before.timestamp);\n                            return $(html).insertBefore(element);\n                        } else {\n                            return messagesContainer.append(html);\n                        }\n                    })\n                    .catch(function() {\n                        // Fail silently.\n                    });\n            });\n\n            return;\n        });\n    };\n\n    /**\n     * Add (more) messages to day containers.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Array} messages List of messages.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Promise} Messages rendering promises.\n     */\n    var renderAddMessages = function(header, body, footer, messages, datesCache) {\n        var messagesData = messages.map(function(data) {\n            return data.value;\n        });\n        var formattedMessages = formatMessagesForTemplate(messagesData, datesCache);\n\n        return Templates.render(TEMPLATES.MESSAGES, {messages: formattedMessages})\n            .then(function(html) {\n                var messageList = $(html);\n                messages.forEach(function(data) {\n                    var messageHtml = messageList.find('[data-message-id=\"' + data.value.id + '\"]');\n                    if (data.before) {\n                        var element = getMessageElement(body, data.before.id);\n                        return messageHtml.insertBefore(element);\n                    } else {\n                        var dayContainer = getDayElement(body, data.day.timestamp);\n                        var dayMessagesContainer = dayContainer.find(SELECTORS.DAY_MESSAGES_CONTAINER);\n                        return dayMessagesContainer.append(messageHtml);\n                    }\n                });\n\n                return;\n            });\n    };\n\n    /**\n     * Remove days from conversation.\n     *\n     * @param  {Object} body The body container element.\n     * @param  {Array} days Array of days to be removed.\n     */\n    var renderRemoveDays = function(body, days) {\n        days.forEach(function(data) {\n            getDayElement(body, data.timestamp).remove();\n        });\n    };\n\n    /**\n     * Remove messages from conversation.\n     *\n     * @param  {Object} body The body container element.\n     * @param  {Array} messages Array of messages to be removed.\n     */\n    var renderRemoveMessages = function(body, messages) {\n        messages.forEach(function(data) {\n            getMessageElement(body, data.id).remove();\n        });\n    };\n\n    /**\n     * Render the full conversation base on input from the statemanager.\n     *\n     * This will pre-load all of the formatted timestamps for each message that\n     * needs to render to reduce the number of networks requests.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Object} data The conversation diff.\n     * @return {Object} jQuery promise.\n     */\n    var renderConversation = function(header, body, footer, data) {\n        var renderingPromises = [];\n        var hasAddDays = data.days.add.length > 0;\n        var hasAddMessages = data.messages.add.length > 0;\n        var timestampsToFormat = [];\n        var datesCachePromise = $.Deferred().resolve({}).promise();\n\n        if (hasAddDays) {\n            // Search for all of the timeCreated values in all of the messages in all of\n            // the days that we need to render.\n            timestampsToFormat = timestampsToFormat.concat(data.days.add.reduce(function(carry, day) {\n                return carry.concat(day.value.messages.map(function(message) {\n                    return message.timeCreated;\n                }));\n            }, []));\n        }\n\n        if (hasAddMessages) {\n            // Search for all of the timeCreated values in all of the messages that we\n            // need to render.\n            timestampsToFormat = timestampsToFormat.concat(data.messages.add.map(function(message) {\n                return message.value.timeCreated;\n            }));\n        }\n\n        if (timestampsToFormat.length) {\n            // If we have timestamps then pre-load the formatted version of each of them\n            // in a single request to the server. This saves the templates doing multiple\n            // individual requests.\n            datesCachePromise = Str.get_string('strftimetime24', 'core_langconfig')\n                .then(function(format) {\n                    var requests = timestampsToFormat.map(function(timestamp) {\n                        return {\n                            timestamp: timestamp,\n                            format: format\n                        };\n                    });\n\n                    return UserDate.get(requests);\n                })\n                .then(function(formattedTimes) {\n                    return timestampsToFormat.reduce(function(carry, timestamp, index) {\n                        carry[timestamp] = formattedTimes[index];\n                        return carry;\n                    }, {});\n                });\n        }\n\n        if (hasAddDays) {\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\n                return renderAddDays(header, body, footer, data.days.add, datesCache);\n            }));\n        }\n\n        if (hasAddMessages) {\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\n                return renderAddMessages(header, body, footer, data.messages.add, datesCache);\n            }));\n        }\n\n        if (data.days.remove.length > 0) {\n            renderRemoveDays(body, data.days.remove);\n        }\n\n        if (data.messages.remove.length > 0) {\n            renderRemoveMessages(body, data.messages.remove);\n        }\n\n        return $.when.apply($, renderingPromises);\n    };\n\n    /**\n     * Render the conversation header.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Data for header.\n     * @return {Object} jQuery promise\n     */\n    var renderHeader = function(header, body, footer, data) {\n        var headerContainer = getHeaderContent(header);\n        var template = TEMPLATES.HEADER_PUBLIC;\n        data.context.showrouteback = (header.attr('data-from-panel') === \"false\");\n        if (data.type == CONVERSATION_TYPES.PRIVATE) {\n            template = data.showControls ? TEMPLATES.HEADER_PRIVATE : TEMPLATES.HEADER_PRIVATE_NO_CONTROLS;\n        } else if (data.type == CONVERSATION_TYPES.SELF) {\n            template = TEMPLATES.HEADER_SELF;\n        }\n\n        return Templates.render(template, data.context)\n            .then(function(html, js) {\n                Templates.replaceNodeContents(headerContainer, html, js);\n                return;\n            });\n    };\n\n    /**\n     * Render the conversation footer.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Data for footer.\n     * @return {Object} jQuery promise.\n     */\n    var renderFooter = function(header, body, footer, data) {\n        hideAllFooterElements(footer);\n\n        switch (data.type) {\n            case 'placeholder':\n                return showFooterPlaceholder(footer);\n            case 'add-contact':\n                return Str.get_strings([\n                        {\n                            key: 'requirecontacttomessage',\n                            component: 'core_message',\n                            param: data.user.fullname\n                        },\n                        {\n                            key: 'isnotinyourcontacts',\n                            component: 'core_message',\n                            param: data.user.fullname\n                        }\n                    ])\n                    .then(function(strings) {\n                        var title = strings[1];\n                        var text = strings[0];\n                        var footerContainer = getFooterRequireContactContainer(footer);\n                        footerContainer.find(SELECTORS.TITLE).text(title);\n                        footerContainer.find(SELECTORS.TEXT).text(text);\n                        showFooterRequireContact(footer);\n                        return strings;\n                    });\n            case 'edit-mode':\n                return showFooterEditMode(footer);\n            case 'content':\n                return showFooterContent(footer);\n            case 'unblock':\n                return showFooterRequireUnblock(footer);\n            case 'unable-to-message':\n                return showFooterUnableToMessage(footer);\n        }\n\n        return true;\n    };\n\n    /**\n     * Scroll to a message in the conversation.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Number} messageId Message id.\n     */\n    var renderScrollToMessage = function(header, body, footer, messageId) {\n        var messagesContainer = getMessagesContainer(body);\n        var messageElement = getMessageElement(body, messageId);\n        var position = messageElement.position();\n        // Scroll the message container down to the top of the message element.\n        if (position) {\n            var scrollTop = messagesContainer.scrollTop() + position.top;\n            messagesContainer.scrollTop(scrollTop);\n        }\n    };\n\n    /**\n     * Hide or show the conversation header.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoadingMembers Members loading.\n     */\n    var renderLoadingMembers = function(header, body, footer, isLoadingMembers) {\n        if (isLoadingMembers) {\n            hideHeaderContent(header);\n            showHeaderPlaceholder(header);\n        } else {\n            showHeaderContent(header);\n            hideHeaderPlaceholder(header);\n        }\n    };\n\n    /**\n     * Hide or show loading conversation messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoadingFirstMessages Messages loading.\n     */\n    var renderLoadingFirstMessages = function(header, body, footer, isLoadingFirstMessages) {\n        if (isLoadingFirstMessages) {\n            hideMessagesContainer(body);\n            showContentPlaceholder(body);\n        } else {\n            showMessagesContainer(body);\n            hideContentPlaceholder(body);\n        }\n    };\n\n    /**\n     * Hide or show loading more messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoading Messages loading.\n     */\n    var renderLoadingMessages = function(header, body, footer, isLoading) {\n        if (isLoading) {\n            showMoreMessagesLoadingIcon(body);\n        } else {\n            hideMoreMessagesLoadingIcon(body);\n        }\n    };\n\n    /**\n     * Activate or deactivate send message controls.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isSending Message sending.\n     */\n    var renderSendingMessage = function(header, body, footer, isSending) {\n        if (isSending) {\n            startSendMessageLoading(footer);\n        } else {\n            stopSendMessageLoading(footer);\n            hasSentMessage(footer);\n        }\n    };\n\n    /**\n     * Show a confirmation dialogue\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {String} buttonSelectors Selectors for the buttons to show.\n     * @param {String} bodyText Text to show in dialogue.\n     * @param {String} headerText Text to show in dialogue header.\n     * @param {Bool} canCancel Can this dialogue be cancelled.\n     * @param {Bool} skipHeader Skip blanking out the header\n     */\n    var showConfirmDialogue = function(\n        header,\n        body,\n        footer,\n        buttonSelectors,\n        bodyText,\n        headerText,\n        canCancel,\n        skipHeader\n    ) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var buttons = buttonSelectors.map(function(selector) {\n            return dialogue.find(selector);\n        });\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\n\n        dialogue.find('button').addClass('hidden');\n\n        if (canCancel) {\n            cancelButton.removeClass('hidden');\n        } else {\n            cancelButton.addClass('hidden');\n        }\n\n        if (headerText) {\n            dialogueHeader.removeClass('hidden');\n            dialogueHeader.text(headerText);\n        } else {\n            dialogueHeader.addClass('hidden');\n            dialogueHeader.text('');\n        }\n\n        buttons.forEach(function(button) {\n            button.removeClass('hidden');\n        });\n        text.text(bodyText);\n        showConfirmDialogueContainer(footer);\n        showConfirmDialogueContainer(body);\n\n        if (!skipHeader) {\n            showConfirmDialogueContainer(header);\n        }\n\n        dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(':visible').first().focus();\n    };\n\n    /**\n     * Hide the dialogue\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @return {Bool} always true.\n     */\n    var hideConfirmDialogue = function(header, body, footer) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\n\n        hideCheckDeleteDialogue(body);\n        hideConfirmDialogueContainer(body);\n        hideConfirmDialogueContainer(footer);\n        hideConfirmDialogueContainer(header);\n        dialogue.find('button').addClass('hidden');\n        cancelButton.removeClass('hidden');\n        text.text('');\n        dialogueHeader.addClass('hidden');\n        dialogueHeader.text('');\n\n        header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus();\n        return true;\n    };\n\n    /**\n     * Render the confirm block user dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to block.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmBlockUser = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('blockuserconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_BLOCK], string, '', true, false);\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm unblock user dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to unblock.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmUnblockUser = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('unblockuserconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_UNBLOCK], string, '', true, false);\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the add user as contact dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to add as contact.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmAddContact = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('addcontactconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_ADD_CONTACT],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the remove user from contacts dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to remove from contacts.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmRemoveContact = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('removecontactconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the delete selected messages dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data If the dialogue should show and checkbox shows to delete message for all users.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmDeleteSelectedMessages = function(header, body, footer, data) {\n        var showmessage = null;\n        if (data.type == CONVERSATION_TYPES.SELF) {\n            // Message displayed to self-conversations is slighly different.\n            showmessage = 'deleteselectedmessagesconfirmselfconversation';\n        } else {\n            // This other message should be displayed.\n            if (data.canDeleteMessagesForAllUsers) {\n                showCheckDeleteDialogue(body);\n                showmessage = 'deleteforeveryoneselectedmessagesconfirm';\n            } else {\n                showmessage = 'deleteselectedmessagesconfirm';\n            }\n        }\n\n        if (data.show) {\n            return Str.get_string(showmessage, 'core_message')\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm delete conversation dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {int|Null} type The conversation type to be removed.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmDeleteConversation = function(header, body, footer, type) {\n        var showmessage = null;\n        if (type == CONVERSATION_TYPES.SELF) {\n            // Message displayed to self-conversations is slighly different.\n            showmessage = 'deleteallselfconfirm';\n        } else if (type) {\n            // This other message should be displayed.\n            showmessage = 'deleteallconfirm';\n        }\n\n        if (showmessage) {\n            return Str.get_string(showmessage, 'core_message')\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm delete conversation dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} user The other user object.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmContactRequest = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('userwouldliketocontactyou', 'core_message', user.fullname)\n                .then(function(string) {\n                    var buttonSelectors = [\n                        SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,\n                        SELECTORS.ACTION_DECLINE_CONTACT_REQUEST\n                    ];\n                    return showConfirmDialogue(header, body, footer, buttonSelectors, string, '', false, true);\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Show the checkbox to allow delete message for all.\n     *\n     * @param {Object} body The body container element.\n     */\n    var showCheckDeleteDialogue = function(body) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\n        checkboxRegion.removeClass('hidden');\n    };\n\n    /**\n     * Hide the checkbox to allow delete message for all.\n     *\n     * @param {Object} body The body container element.\n     */\n    var hideCheckDeleteDialogue = function(body) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\n        var checkbox = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);\n        checkbox.prop('checked', false);\n        checkboxRegion.addClass('hidden');\n    };\n\n    /**\n     * Show or hide the block / unblock option in the header dropdown menu.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isBlocked is user blocked.\n     */\n    var renderIsBlocked = function(header, body, footer, isBlocked) {\n        if (isBlocked) {\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass('hidden');\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass('hidden');\n        } else {\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass('hidden');\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass('hidden');\n        }\n    };\n\n    /**\n     * Show or hide the favourite / unfavourite option in the header dropdown menu\n     * and the favourite star in the header title.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isFavourite is this conversation a favourite.\n     */\n    var renderIsFavourite = function(header, body, footer, state) {\n        var favouriteIcon = header.find(SELECTORS.FAVOURITE_ICON_CONTAINER);\n        var addFavourite = header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE);\n        var removeFavourite = header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);\n\n        switch (state) {\n            case 'hide':\n                favouriteIcon.addClass('hidden');\n                addFavourite.addClass('hidden');\n                removeFavourite.addClass('hidden');\n                break;\n            case 'show-add':\n                favouriteIcon.addClass('hidden');\n                addFavourite.removeClass('hidden');\n                removeFavourite.addClass('hidden');\n                break;\n            case 'show-remove':\n                favouriteIcon.removeClass('hidden');\n                addFavourite.addClass('hidden');\n                removeFavourite.removeClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide the mute / unmute option in the header dropdown menu\n     * and the muted icon in the header title.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {string} state The state of the conversation as defined by the patcher.\n     */\n    var renderIsMuted = function(header, body, footer, state) {\n        var muteIcon = header.find(SELECTORS.MUTED_ICON_CONTAINER);\n        var setMuted = header.find(SELECTORS.ACTION_CONFIRM_MUTE);\n        var unsetMuted = header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);\n\n        switch (state) {\n            case 'hide':\n                muteIcon.addClass('hidden');\n                setMuted.addClass('hidden');\n                unsetMuted.addClass('hidden');\n                break;\n            case 'show-mute':\n                muteIcon.addClass('hidden');\n                setMuted.removeClass('hidden');\n                unsetMuted.addClass('hidden');\n                break;\n            case 'show-unmute':\n                muteIcon.removeClass('hidden');\n                setMuted.addClass('hidden');\n                unsetMuted.removeClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide the add / remove user as contact option in the header dropdown menu.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} state the contact state.\n     */\n    var renderIsContact = function(header, body, footer, state) {\n        var addContact = header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT);\n        var removeContact = header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);\n\n        switch (state) {\n            case 'pending-contact':\n                addContact.addClass('hidden');\n                removeContact.addClass('hidden');\n                break;\n            case 'contact':\n                addContact.addClass('hidden');\n                removeContact.removeClass('hidden');\n                break;\n            case 'non-contact':\n                addContact.removeClass('hidden');\n                removeContact.addClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide confirm action from confirm dialogue is loading.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoading confirm action is loading.\n     */\n    var renderLoadingConfirmAction = function(header, body, footer, isLoading) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var buttons = dialogue.find('button');\n        var buttonText = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT);\n        var loadingIcon = dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);\n\n        if (isLoading) {\n            buttons.prop('disabled', true);\n            buttonText.addClass('hidden');\n            loadingIcon.removeClass('hidden');\n        } else {\n            buttons.prop('disabled', false);\n            buttonText.removeClass('hidden');\n            loadingIcon.addClass('hidden');\n        }\n    };\n\n    /**\n     * Show or hide the header and footer content for edit mode.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} inEditMode In edit mode or not.\n     */\n    var renderInEditMode = function(header, body, footer, inEditMode) {\n        var messages = null;\n\n        if (inEditMode) {\n            messages = body.find(SELECTORS.MESSAGE_NOT_SELECTED);\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\n            hideHeaderContent(header);\n            showHeaderEditMode(header);\n        } else {\n            messages = getMessagesContainer(body);\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\n            messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\n            showHeaderContent(header);\n            hideHeaderEditMode(header);\n        }\n    };\n\n    /**\n     * Select or unselect messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data The messages to select or unselect.\n     */\n    var renderSelectedMessages = function(header, body, footer, data) {\n        var hasSelectedMessages = data.count > 0;\n\n        if (data.add.length) {\n            data.add.forEach(function(messageId) {\n                var message = getMessageElement(body, messageId);\n                message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass('hidden');\n                message.attr('aria-checked', true);\n            });\n        }\n\n        if (data.remove.length) {\n            data.remove.forEach(function(messageId) {\n                var message = getMessageElement(body, messageId);\n\n                if (hasSelectedMessages) {\n                    message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\n                }\n\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\n                message.attr('aria-checked', false);\n            });\n        }\n\n        setMessagesSelectedCount(header, data.count);\n    };\n\n    /**\n     * Show or hide the require add contact panel.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Whether the user has to be added a a contact.\n     * @return {Object} jQuery promise\n     */\n    var renderRequireAddContact = function(header, body, footer, data) {\n        if (data.show && !data.hasMessages) {\n            return Str.get_strings([\n                    {\n                        key: 'requirecontacttomessage',\n                        component: 'core_message',\n                        param: data.user.fullname\n                    },\n                    {\n                        key: 'isnotinyourcontacts',\n                        component: 'core_message',\n                        param: data.user.fullname\n                    }\n                ])\n                .then(function(strings) {\n                    var title = strings[1];\n                    var text = strings[0];\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_REQUEST_ADD_CONTACT],\n                        text,\n                        title,\n                        false,\n                        true\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Show or hide the self-conversation message.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} displayMessage should the message be displayed?.\n     * @return {Object|true} jQuery promise\n     */\n    var renderSelfConversationMessage = function(header, body, footer, displayMessage) {\n        var container = getSelfConversationMessageContainer(body);\n        if (displayMessage) {\n            container.removeClass('hidden');\n        } else {\n            container.addClass('hidden');\n        }\n        return true;\n    };\n\n    /**\n     * Show or hide the require add contact panel.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} userFullName Full name of the other user.\n     * @return {Object|true} jQuery promise\n     */\n    var renderContactRequestSent = function(header, body, footer, userFullName) {\n        var container = getContactRequestSentContainer(body);\n        if (userFullName) {\n            return Str.get_string('yourcontactrequestpending', 'core_message', userFullName)\n                .then(function(string) {\n                    container.find(SELECTORS.TEXT).text(string);\n                    container.removeClass('hidden');\n                    return string;\n                });\n        } else {\n            container.addClass('hidden');\n            return true;\n        }\n    };\n\n    /**\n     * Reset the UI to the initial state.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @return {Bool}\n     */\n    var renderReset = function(header, body, footer) {\n        hideConfirmDialogue(header, body, footer);\n        hideContactRequestSentContainer(body);\n        hideSelfConversationMessageContainer(body);\n        hideAllHeaderElements(header);\n        showHeaderPlaceholder(header);\n        hideAllFooterElements(footer);\n        showFooterPlaceholder(footer);\n        return true;\n    };\n\n    var render = function(header, body, footer, patch) {\n        var configs = [\n            {\n                // Resetting the UI needs to come first, if it's required.\n                reset: renderReset\n            },\n            {\n                // Any async rendering (stuff that requires templates, strings etc) should\n                // go in here.\n                conversation: renderConversation,\n                header: renderHeader,\n                footer: renderFooter,\n                confirmBlockUser: renderConfirmBlockUser,\n                confirmUnblockUser: renderConfirmUnblockUser,\n                confirmAddContact: renderConfirmAddContact,\n                confirmRemoveContact: renderConfirmRemoveContact,\n                confirmDeleteSelectedMessages: renderConfirmDeleteSelectedMessages,\n                confirmDeleteConversation: renderConfirmDeleteConversation,\n                confirmContactRequest: renderConfirmContactRequest,\n                requireAddContact: renderRequireAddContact,\n                selfConversationMessage: renderSelfConversationMessage,\n                contactRequestSent: renderContactRequestSent\n            },\n            {\n                loadingMembers: renderLoadingMembers,\n                loadingFirstMessages: renderLoadingFirstMessages,\n                loadingMessages: renderLoadingMessages,\n                sendingMessage: renderSendingMessage,\n                isBlocked: renderIsBlocked,\n                isContact: renderIsContact,\n                isFavourite: renderIsFavourite,\n                isMuted: renderIsMuted,\n                loadingConfirmAction: renderLoadingConfirmAction,\n                inEditMode: renderInEditMode\n            },\n            {\n                // Scrolling should be last to make sure everything\n                // on the page is visible.\n                scrollToMessage: renderScrollToMessage,\n                selectedMessages: renderSelectedMessages\n            }\n        ];\n        // Helper function to process each of the configs above.\n        var processConfig = function(config) {\n            var results = [];\n\n            for (var key in patch) {\n                if (config.hasOwnProperty(key)) {\n                    var renderFunc = config[key];\n                    var patchValue = patch[key];\n                    results.push(renderFunc(header, body, footer, patchValue));\n                }\n            }\n\n            return results;\n        };\n\n        // The first config is special because it resets the UI.\n        var renderingPromises = processConfig(configs[0]);\n        // The second config is special because it contains async rendering.\n        renderingPromises = renderingPromises.concat(processConfig(configs[1]));\n\n        // Wait for the async rendering to complete before processing the\n        // rest of the configs, in order.\n        return $.when.apply($, renderingPromises)\n            .then(function() {\n                for (var i = 2; i < configs.length; i++) {\n                    processConfig(configs[i]);\n                }\n\n                return;\n            })\n            .catch(Notification.exception);\n    };\n\n    return {\n        render: render,\n    };\n});\n"],"file":"message_drawer_view_conversation_renderer.min.js"}