define(["jquery","core/notification","core_message/message_repository","core/custom_interaction_events"],function(a,b,c,d){var e={SETTINGS:'[data-region="settings"]',PREFERENCE_CONTROL:'[data-region="preference-control"]',CHECKBOX:'input[type="checkbox"]',LOADING_PLACEHOLDER:'[data-region="loading-placeholder"]'},f={message_blocknoncontacts:{type:"blocknoncontacts",enabled:"1",disabled:"0"},message_provider_moodle_instantmessage_loggedoff:{type:"emailnotifications",enabled:"email",disabled:"none"},message_provider_moodle_instantmessage_loggedin:{type:"emailnotifications",enabled:"email",disabled:"none"}},g=function(a,b){return a.find('[data-preference="'+b+'"]')},h=function(a){var b=a.find(e.CHECKBOX);return b.prop("checked")},i=function(a,b){a.find(e.CHECKBOX).prop("checked",b)},j=function(a,d){var h=a.find(e.SETTINGS),j=a.find(e.LOADING_PLACEHOLDER);c.getPreferences(d).then(function(b){var c=b.preferences.reduce(function(a,b){if(b.name in f){var c=f[b.name],d=b.value,e=d===c.enabled,g=c.type;g in a?a[g].push(e):a[g]=[e]}return a},{});Object.keys(c).forEach(function(b){var d=c[b].every(function(a){return a}),e=g(a,b);i(e,d)})}).then(function(){h.removeClass("hidden"),j.addClass("hidden")})["catch"](b.exception)},k=function(i,j){var k=i.find(e.SETTINGS);d.define(k,[d.events.activate]),k.on(d.events.activate,e.CHECKBOX,function(d){var k=a(d.target).closest(e.PREFERENCE_CONTROL),l=k.attr("data-preference"),m=g(i,l),n=h(m),o=Object.keys(f).reduce(function(a,b){var c=f[b];return c.type===l&&a.push({type:b,value:n?c.enabled:c.disabled}),a},[]);c.savePreferences(j,o)["catch"](b.exception)})},l=function(a,b,c){b.attr("data-init")||(k(b,c),j(b,c),b.attr("data-init",!0))};return{show:l}});