'use strict';define('core_message/message_preferences',['jquery','core/ajax','core/notification','core_message/message_notification_preference','core/custom_interaction_events'],function($,Ajax,Notification,MessageNotificationPreference,CustomEvents){var SELECTORS={PREFERENCE:'[data-state]',PREFERENCES_CONTAINER:'[data-region="preferences-container"]',BLOCK_NON_CONTACTS:'[data-region="block-non-contacts-container"] [data-block-non-contacts]',BLOCK_NON_CONTACTS_CONTAINER:'[data-region="block-non-contacts-container"]'},MessagePreferences=function(element){this.root=$(element),this.userId=this.root.find(SELECTORS.PREFERENCES_CONTAINER).attr('data-user-id'),this.registerEventListeners()};return MessagePreferences.prototype.preferencesDisabled=function(){return this.root.find(SELECTORS.PREFERENCES_CONTAINER).hasClass('disabled')},MessagePreferences.prototype.saveBlockNonContactsStatus=function(){var checkbox=this.root.find(SELECTORS.BLOCK_NON_CONTACTS),container=this.root.find(SELECTORS.BLOCK_NON_CONTACTS_CONTAINER),ischecked=checkbox.prop('checked');if(container.hasClass('loading'))return $.Deferred().resolve();container.addClass('loading');var request={methodname:'core_user_update_user_preferences',args:{userid:this.userId,preferences:[{type:checkbox.attr('data-preference-key'),value:ischecked?1:0}]}};return Ajax.call([request])[0].fail(Notification.exception).always(function(){container.removeClass('loading')})},MessagePreferences.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on(CustomEvents.events.activate,SELECTORS.BLOCK_NON_CONTACTS,function(){this.saveBlockNonContactsStatus()}.bind(this)),this.root.on('change',function(e){if(!this.preferencesDisabled()){var preferencesContainer=$(e.target).closest(SELECTORS.PREFERENCES_CONTAINER),preferenceElement=$(e.target).closest(SELECTORS.PREFERENCE),messagePreference=new MessageNotificationPreference(preferencesContainer,this.userId);preferenceElement.addClass('loading'),messagePreference.save().always(function(){preferenceElement.removeClass('loading')})}}.bind(this))},MessagePreferences});
//# sourceMappingURL=message_preferences.min.js.map
