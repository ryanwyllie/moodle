define(["jquery"],function(a){var b=function(b){var c=a.extend({},b);return c.messages=b.messages.map(function(b){return a.extend({},b)}),c.members=Object.keys(b.members).reduce(function(c,d){return c[d]=a.extend({},b.members[d]),c[d].contactrequests=b.members[d].contactrequests.map(function(b){return a.extend({},b)}),c},{}),c},c=function(a,b,c){return a.map(function(a){var d=a.useridfrom==b;return{id:""+a.id,fromLoggedInUser:d,userFrom:c[a.useridfrom],text:a.text,timeCreated:a.timecreated?parseInt(a.timecreated,10):null}})},d=function(a){return a.map(function(a){return{id:a.id,fullname:a.fullname,profileimageurl:a.profileimageurl,profileimageurlsmall:a.profileimageurlsmall,isonline:a.isonline,showonlinestatus:a.showonlinestatus,isblocked:a.isblocked,iscontact:a.iscontact,isdeleted:a.isdeleted,canmessage:a.canmessage,requirescontact:a.requirescontact,contactrequests:a.contactrequests||[]}})},e=function(a,b,c){return{midnight:a,loggedInUserId:b,id:c,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingSendMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[]}},f=function(a,d){var e=b(a),f=c(d,a.loggedInUserId,a.members);f=f.map(function(a){return a.state="pending",a.timeAdded=Date.now(),a});var g=a.messages.concat(f);return g.sort(function(a,b){if(null===a.timeCreated&&null===b.timeCreated){if(a.timeAdded<b.timeAdded)return-1;if(a.timeAdded>b.timeAdded)return 1}return null===a.timeCreated&&null!==b.timeCreated?1:null!==a.timeCreated&&null===b.timeCreated?-1:a.timeCreated<b.timeCreated?-1:a.timeCreated>b.timeCreated?1:a.id<b.id?-1:a.id>b.id?1:0}),e.messages=g.filter(function(a,b,c){return!b||a.id!=c[b-1].id}),e},g=function(d,e){var f=b(d),g=e.reduce(function(a,b){var e=b[0],f=b[1],g=c([f],d.loggedInUserId,d.members),h=g[0];return a[e.id]=h,a},{});return f.messages=f.messages.map(function(b){return b.id in g?a.extend(b,g[b.id]):b}),f},h=function(a,c){var d=b(a),e=c.map(function(a){return""+a.id});return d.messages=d.messages.filter(function(a){return e.indexOf(a.id)<0}),d},i=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.messages=d.messages.filter(function(a){return c.indexOf(a.id)<0}),d},j=function(a,c){var e=b(a),f=d(c);return f.forEach(function(a){e.members[a.id]=a}),e},k=function(a,c){var d=b(a);return c.forEach(function(a){delete d.members[a.id]}),d},l=function(a,c){var d=b(a);return d.loadingMessages=c,a.loadingMessages&&!c&&(d.hasTriedToLoadMessages=!0),d},m=function(a,c){var d=b(a);return d.loadingMembers=c,d},n=function(a,c){var d=b(a);return d.id=c,d},o=function(a,c){var d=b(a);return d.name=c,d},p=function(a,c){var d=b(a);return d.subname=c,d},q=function(a,c){var d=b(a);return d.type=c,d},r=function(a,c){var d=b(a);return d.isFavourite=c,d},s=function(a,c){var d=b(a);return d.totalMemberCount=c,d},t=function(a,c){var d=b(a);return d.imageUrl=c,d},u=function(a,c){var d=b(a);return d.loadingConfirmAction=c,d},v=function(a,c){var d=b(a);return d.pendingDeleteConversation=c,d},w=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.messages.forEach(function(a){c.indexOf(a.id)>=0&&(a.state="pending")}),d},x=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.messages.forEach(function(a){c.indexOf(a.id)>=0&&(a.state="sent")}),d},y=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.messages.forEach(function(a){c.indexOf(a.id)>=0&&(a.state="error")}),d},z=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingBlockUserIds.push(a)}),d},A=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingRemoveContactIds.push(a)}),d},B=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingUnblockUserIds.push(a)}),d},C=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingAddContactIds.push(a)}),d},D=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingDeleteMessageIds.push(a)}),d},E=function(a,c){var d=b(a);return d.pendingBlockUserIds=d.pendingBlockUserIds.filter(function(a){return c.indexOf(a)<0}),d},F=function(a,c){var d=b(a);return d.pendingRemoveContactIds=d.pendingRemoveContactIds.filter(function(a){return c.indexOf(a)<0}),d},G=function(a,c){var d=b(a);return d.pendingUnblockUserIds=d.pendingUnblockUserIds.filter(function(a){return c.indexOf(a)<0}),d},H=function(a,c){var d=b(a);return d.pendingAddContactIds=d.pendingAddContactIds.filter(function(a){return c.indexOf(a)<0}),d},I=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.pendingDeleteMessageIds=d.pendingDeleteMessageIds.filter(function(a){return c.indexOf(a)<0}),d},J=function(a,c){var d=b(a);return d.selectedMessageIds=d.selectedMessageIds.concat(c),d},K=function(a,c){var d=b(a);return c=c.map(function(a){return""+a}),d.selectedMessageIds=d.selectedMessageIds.filter(function(a){return c.indexOf(a)<0}),d},L=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests.push(a),d.members[c].contactrequests.push(a)}),d},M=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests=d.members[b].contactrequests.filter(function(a){return a.userid!=b}),d.members[c].contactrequests=d.members[c].contactrequests.filter(function(a){return a.requesteduserid!=c})}),d};return{buildInitialState:e,addMessages:f,updateMessages:g,removeMessages:h,removeMessagesById:i,addMembers:j,removeMembers:k,setLoadingMessages:l,setLoadingMembers:m,setId:n,setName:o,setSubname:p,setType:q,setIsFavourite:r,setTotalMemberCount:s,setImageUrl:t,setLoadingConfirmAction:u,setPendingDeleteConversation:v,setMessagesSendPendingById:w,setMessagesSendSuccessById:x,setMessagesSendFailById:y,addPendingBlockUsersById:z,addPendingRemoveContactsById:A,addPendingUnblockUsersById:B,addPendingAddContactsById:C,addPendingDeleteMessagesById:D,removePendingBlockUsersById:E,removePendingRemoveContactsById:F,removePendingUnblockUsersById:G,removePendingAddContactsById:H,removePendingDeleteMessagesById:I,addSelectedMessagesById:J,removeSelectedMessagesById:K,addContactRequests:L,removeContactRequests:M}});