define(["jquery"],function(a){var b=function(b){var c=a.extend({},b);return c.messages=b.messages.map(function(b){return a.extend({},b)}),c.members=Object.keys(b.members).reduce(function(c,d){return c[d]=a.extend({},b.members[d]),c[d].contactrequests=b.members[d].contactrequests.map(function(b){return a.extend({},b)}),c},{}),c},c=function(a,b,c){return a.map(function(a){var d=a.useridfrom==b;return{id:parseInt(a.id,10),isRead:a.isread,fromLoggedInUser:d,userFrom:c[a.useridfrom],text:a.text,timeCreated:parseInt(a.timecreated,10)}})},d=function(a,b,c){return{midnight:a,loggedInUserId:b,id:c,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,sendingMessage:!1,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[]}},e=function(a,d){var e=b(a),f=c(d,a.loggedInUserId,a.members),g=a.messages.concat(f);return g.sort(function(a,b){return a.timeCreated<b.timeCreated?-1:a.timeCreated>b.timeCreated?1:0}),e.messages=g.filter(function(a,b,c){return!b||a.id!==c[b-1].id}),e},f=function(a,c){var d=b(a),e=c.map(function(a){return a.id});return d.messages=d.messages.filter(function(a){return e.indexOf(a.id)<0}),d},g=function(a,c){var d=b(a);return d.messages=d.messages.filter(function(a){return c.indexOf(a.id)<0}),d},h=function(a,c){var d=b(a);return c.forEach(function(a){d.members[a.id]=a}),d},i=function(a,c){var d=b(a);return c.forEach(function(a){delete d.members[a.id]}),d},j=function(a,c){var d=b(a);return d.loadingMessages=c,a.loadingMessages&&!c&&(d.hasTriedToLoadMessages=!0),d},k=function(a,c){var d=b(a);return d.sendingMessage=c,d},l=function(a,c){var d=b(a);return d.loadingMembers=c,d},m=function(a,c){var d=b(a);return d.id=c,d},n=function(a,c){var d=b(a);return d.name=c,d},o=function(a,c){var d=b(a);return d.subname=c,d},p=function(a,c){var d=b(a);return d.type=c,d},q=function(a,c){var d=b(a);return d.isFavourite=c,d},r=function(a,c){var d=b(a);return d.totalMemberCount=c,d},s=function(a,c){var d=b(a);return d.imageUrl=c,d},t=function(a,c){var d=b(a);return d.loadingConfirmAction=c,d},u=function(a,c){var d=b(a);return d.pendingDeleteConversation=c,d},v=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingBlockUserIds.push(a)}),d},w=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingRemoveContactIds.push(a)}),d},x=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingUnblockUserIds.push(a)}),d},y=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingAddContactIds.push(a)}),d},z=function(a,c){var d=b(a);return c.forEach(function(a){d.pendingDeleteMessageIds.push(a)}),d},A=function(a,c){var d=b(a);return d.pendingBlockUserIds=d.pendingBlockUserIds.filter(function(a){return c.indexOf(a)<0}),d},B=function(a,c){var d=b(a);return d.pendingRemoveContactIds=d.pendingRemoveContactIds.filter(function(a){return c.indexOf(a)<0}),d},C=function(a,c){var d=b(a);return d.pendingUnblockUserIds=d.pendingUnblockUserIds.filter(function(a){return c.indexOf(a)<0}),d},D=function(a,c){var d=b(a);return d.pendingAddContactIds=d.pendingAddContactIds.filter(function(a){return c.indexOf(a)<0}),d},E=function(a,c){var d=b(a);return d.pendingDeleteMessageIds=d.pendingDeleteMessageIds.filter(function(a){return c.indexOf(a)<0}),d},F=function(a,c){var d=b(a);return d.selectedMessageIds=d.selectedMessageIds.concat(c),d},G=function(a,c){var d=b(a);return d.selectedMessageIds=d.selectedMessageIds.filter(function(a){return c.indexOf(a)<0}),d},H=function(a,c){var d=b(a),e=c.map(function(a){return a.id});return d.messages=d.messages.map(function(a){return e.indexOf(a.id)>=0&&(a.isRead=!0),a}),d},I=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests.push(a),d.members[c].contactrequests.push(a)}),d},J=function(a,c){var d=b(a);return c.forEach(function(a){var b=a.userid,c=a.requesteduserid;d.members[b].contactrequests=d.members[b].contactrequests.filter(function(a){return a.userid!=b}),d.members[c].contactrequests=d.members[c].contactrequests.filter(function(a){return a.requesteduserid!=c})}),d};return{buildInitialState:d,addMessages:e,removeMessages:f,removeMessagesById:g,addMembers:h,removeMembers:i,setLoadingMessages:j,setSendingMessage:k,setLoadingMembers:l,setId:m,setName:n,setSubname:o,setType:p,setIsFavourite:q,setTotalMemberCount:r,setImageUrl:s,setLoadingConfirmAction:t,setPendingDeleteConversation:u,addPendingBlockUsersById:v,addPendingRemoveContactsById:w,addPendingUnblockUsersById:x,addPendingAddContactsById:y,addPendingDeleteMessagesById:z,removePendingBlockUsersById:A,removePendingRemoveContactsById:B,removePendingUnblockUsersById:C,removePendingAddContactsById:D,removePendingDeleteMessagesById:E,addSelectedMessagesById:F,removeSelectedMessagesById:G,markMessagesAsRead:H,addContactRequests:I,removeContactRequests:J}});