'use strict';define('core_message/toggle_contact_button',['jquery','core/ajax','core/templates','core/notification','core/custom_interaction_events'],function($,Ajax,Templates,Notification,CustomEvents){var isContact=function(element){return'1'==element.attr('data-is-contact')},setContact=function(element){element.attr('data-is-contact','1')},setNotContact=function(element){element.attr('data-is-contact','0')},getUserId=function(element){return element.attr('data-userid')},isLoading=function(element){return element.hasClass('loading')||element.attr('disabled')},sendRequest=function(element,request){return isLoading(element)?$.Deferred():(element.addClass('loading'),element.attr('disabled','disabled'),Ajax.call([request])[0].fail(Notification.exception).always(function(){element.removeClass('loading'),element.removeAttr('disabled')}))},addContact=function(element){if(!isLoading(element)){var request={methodname:'core_message_create_contacts',args:{userids:[getUserId(element)]}};sendRequest(element,request).done(function(){setContact(element),Templates.render('message/remove_contact_button',{}).done(function(html,js){Templates.replaceNodeContents(element,html,js)})})}},removeContact=function(element){if(!isLoading(element)){var request={methodname:'core_message_delete_contacts',args:{userids:[getUserId(element)]}};sendRequest(element,request).done(function(){setNotContact(element),Templates.render('message/add_contact_button',{}).done(function(html,js){Templates.replaceNodeContents(element,html,js)})})}};return{enhance:function enhance(element){element=$(element),element.children('.loading-icon').length||Templates.render('core/loading',{}).done(function(html,js){element.append(html,js)}),CustomEvents.define(element,[CustomEvents.events.activate]),element.on(CustomEvents.events.activate,function(e,data){isContact(element)?removeContact(element):addContact(element),e.preventDefault(),data.originalEvent.preventDefault()})}}});
//# sourceMappingURL=toggle_contact_button.min.js.map
