'use strict';define('core_message/notification_processor_settings',['jquery','core/ajax','core/notification','core/fragment','core/templates','core/str','tool_lp/dialogue'],function($,Ajax,Notification,Fragment,Templates,Str,Dialogue){var SELECTORS={PROCESSOR:'[data-processor-name]',PREFERENCE_ROW:'[data-region="preference-row"]'},NotificationProcessorSettings=function(element){this.root=$(element),this.name=this.root.attr('data-name'),this.userId=this.root.attr('data-user-id'),this.contextId=this.root.attr('data-context-id')};return NotificationProcessorSettings.prototype.show=function(){Fragment.loadFragment('message','processor_settings',this.contextId,{userid:this.userId,type:this.name}).done(function(html,js){Str.get_string('processorsettings','message').done(function(string){var dialogue=new Dialogue(string,html,function(){Templates.runTemplateJS(js)},function(){dialogue.close()});$(document).on('mpp:formsubmitted',function(){dialogue.close(),this.updateConfiguredStatus()}.bind(this)),$(document).on('mpp:formcancelled',function(){dialogue.close()})}.bind(this))}.bind(this))},NotificationProcessorSettings.prototype.updateConfiguredStatus=function(){var processorHeader=this.root.closest(SELECTORS.PROCESSOR);if(!processorHeader.hasClass('unconfigured'))return!1;var processorName=processorHeader.attr('data-processor-name'),request={methodname:'core_message_get_message_processor',args:{name:processorName,userid:this.userId}};return Ajax.call([request])[0].fail(Notification.exception).done(function(result){if(result.userconfigured){var notifications=$(SELECTORS.PREFERENCE_ROW+' [data-processor-name="'+processorName+'"]');processorHeader.removeClass('unconfigured'),notifications.removeClass('disabled')}})},NotificationProcessorSettings});
//# sourceMappingURL=notification_processor_settings.min.js.map
