define(["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/custom_interaction_events"],function(a,b,c,d,e,f,g){function h(a){this.messageArea=a,this._init()}return h.prototype.messageArea=null,h.prototype._init=function(){g.define(this.messageArea.node,[g.events.activate]),this.messageArea.onCustomEvent(this.messageArea.EVENTS.CONTACTSELECTED,this._viewProfile.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILEVIEW,this._viewFullProfile.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILESENDMESSAGE,this._sendMessage.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILEUNBLOCKCONTACT,this._unblockContact.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILEBLOCKCONTACT,this._blockContact.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILEADDCONTACT,this._addContact.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.PROFILEREMOVECONTACT,this._removeContact.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,this.messageArea.SELECTORS.SHOWCONTACTS,this._hideMessagingArea.bind(this))},h.prototype._viewProfile=function(a,e){c.render("core/loading",{}).done(function(a,b){c.replaceNodeContents(this.messageArea.find(this.messageArea.SELECTORS.MESSAGESAREA),a,b)}.bind(this));var f=b.call([{methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:this.messageArea.getCurrentUserId(),otheruserid:e}}]);return f[0].then(function(a){return c.render("core_message/message_area_profile",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(this.messageArea.SELECTORS.MESSAGESAREA),a,b)}.bind(this)).fail(d.exception)},h.prototype._viewFullProfile=function(){window.location.href=f.wwwroot+"/user/profile.php?id="+this._getUserId()},h.prototype._sendMessage=function(){this.messageArea.trigger(this.messageArea.EVENTS.SENDMESSAGE,this._getUserId())},h.prototype._blockContact=function(){var a=this._performAction("core_message_block_contacts","unblockcontact","profile-block-contact","profile-unblock-contact","");return a.then(function(){this.messageArea.trigger(this.messageArea.EVENTS.CONTACTBLOCKED,this._getUserId())}.bind(this))},h.prototype._unblockContact=function(){var a=this._performAction("core_message_unblock_contacts","blockcontact","profile-unblock-contact","profile-block-contact","danger");return a.then(function(){this.messageArea.trigger(this.messageArea.EVENTS.CONTACTUNBLOCKED,this._getUserId())}.bind(this))},h.prototype._addContact=function(){var a=this._performAction("core_message_create_contacts","removecontact","profile-add-contact","profile-remove-contact","danger");return a.then(function(){this.messageArea.trigger(this.messageArea.EVENTS.CONTACTADDED,this._getUserId())}.bind(this))},h.prototype._removeContact=function(){var a=this._performAction("core_message_delete_contacts","addcontact","profile-remove-contact","profile-add-contact","");return a.then(function(){this.messageArea.trigger(this.messageArea.EVENTS.CONTACTREMOVED,this._getUserId())}.bind(this))},h.prototype._performAction=function(a,c,f,g,h){var i=b.call([{methodname:a,args:{userid:this.messageArea.getCurrentUserId(),userids:[this._getUserId()]}}]);return i[0].then(function(){return e.get_string(c,"message")}).then(function(a){this._changeText(a,f,g,h)}.bind(this)).fail(d.exception)},h.prototype._changeText=function(a,b,c,d){var e=this.messageArea.find("[data-action='"+b+"']");e.text(a),e.removeClass(),d&&e.addClass(d),e.attr("data-action",c)},h.prototype._getUserId=function(){return this.messageArea.find(this.messageArea.SELECTORS.PROFILE).data("userid")},h.prototype._hideMessagingArea=function(){this.messageArea.find(this.messageArea.SELECTORS.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},h});