define(["jquery","core/ajax","core/notification"],function(a,b,c){var d={SETTING:"[data-preference-key]"},e=function(b,c){this.root=a(b),this.userId=c};e.prototype.isChecked=function(){return this.root.find("input").prop("checked")},e.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")},e.prototype.startLoading=function(){this.root.addClass("loading"),this.root.find("input").prop("disabled",!0)},e.prototype.stopLoading=function(){this.root.removeClass("loading"),this.root.find("input").prop("disabled",!1)},e.prototype.isLoading=function(){return this.root.hasClass("loading")},e.prototype.getRequestArguments=function(){return{user:{preferences:[{type:this.getPreferenceKey(),value:this.isChecked()?1:0}]}}},e.prototype.save=function(){if(this.isLoading())return a.Deferred();this.startLoading();var d={methodname:"core_user_update_user",args:this.getRequestArguments()};return b.call([d])[0].fail(c.exception).always(function(){this.stopLoading()}.bind(this))};var f=function(a,b){e.call(this,a,b)};f.prototype=Object.create(e.prototype),f.prototype.getRequestArguments=function(){return{user:{emailstop:this.isChecked()?1:0}}},f.prototype.save=function(){return e.prototype.save.call(this).done(function(){this.isChecked()?a(document).trigger("messageprefs:disableall"):a(document).trigger("messageprefs:enableall")}.bind(this))};var g=function(b){this.root=a(b),this.userId=this.root.attr("data-user-id"),this.root.on("change",function(b){var c=a(b.target).closest(d.SETTING),e=this.createFromElement(c);e.save()}.bind(this))};return g.prototype.createFromElement=function(b){return b=a(b),"disableall"===b.attr("data-preference-key")?new f(b,this.userId):new e(b,this.userId)},g});