{"version":3,"sources":["../src/message_area_search.js"],"names":["define","$","Ajax","Templates","Notification","Str","CustomEvents","Events","Search","messageArea","_init","SELECTORS","CONTACTS","CONTACTSAREA","CONVERSATIONS","DELETESEARCHFILTER","LOADINGICON","SEARCHBOX","SEARCHFILTER","SEARCHFILTERAREA","SEARCHRESULTSAREA","SEARCHTEXTAREA","SEARCHUSERSINCOURSE","prototype","_searchArea","_courseid","_isLoading","_numMessagesDisplayed","_numMessagesToRetrieve","_numUsersDisplayed","_numUsersToRetrieve","_searchAreas","MESSAGES","USERS","USERSINCOURSE","_requestTimeout","find","on","_searchRequest","bind","onDelegateEvent","events","activate","e","_setFilter","currentTarget","html","_setPlaceholderText","_clearSearchArea","data","_searchUsersInCourse","focus","_hideSearchResults","trigger","USERSSEARCHCANCELED","onCustomEvent","CONVERSATIONSSELECTED","CONTACTSSELECTED","MESSAGESENT","scrollBottom","_searchMessages","showContactsFirst","str","val","clearTimeout","trim","MESSAGESEARCHCANCELED","hide","show","setTimeout","_searchUsers","promises","call","methodname","args","userid","getCurrentUserId","search","limitfrom","limitnum","numberreceived","render","then","js","appendNodeContents","contacts","length","remove","replaceNodeContents","fail","exception","hascontacts","courses","hascourses","noncontacts","hasnoncontacts","courseid","text","get_string","s","attr","addClass","languagestring","catch","_clearFilters","removeClass","empty","removeAttr"],"mappings":"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","file":"message_area_search.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * The module handles searching contacts.\n *\n * @module     core_message/message_area_search\n * @package    core_message\n * @copyright  2016 Mark Nelson <markn@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/custom_interaction_events',\n        'core_message/message_area_events'],\n    function($, Ajax, Templates, Notification, Str, CustomEvents, Events) {\n\n    /** @type {Object} The list of selectors for the message area. */\n    var SELECTORS = {\n        CONTACTS: \"[data-region='contacts'][data-region-content='contacts']\",\n        CONTACTSAREA: \"[data-region='contacts-area']\",\n        CONVERSATIONS: \"[data-region='contacts'][data-region-content='conversations']\",\n        DELETESEARCHFILTER: \"[data-region='search-filter-area']\",\n        LOADINGICON: '.loading-icon',\n        SEARCHBOX: \"[data-region='search-box']\",\n        SEARCHFILTER: \"[data-region='search-filter']\",\n        SEARCHFILTERAREA: \"[data-region='search-filter-area']\",\n        SEARCHRESULTSAREA: \"[data-region='search-results-area']\",\n        SEARCHTEXTAREA: \"[data-region='search-text-area']\",\n        SEARCHUSERSINCOURSE: \"[data-action='search-users-in-course']\",\n    };\n\n    /**\n     * Search class.\n     *\n     * @param {Messagearea} messageArea The messaging area object.\n     */\n    function Search(messageArea) {\n        this.messageArea = messageArea;\n        this._init();\n    }\n\n    /** @type {Messagearea} The messaging area object. */\n    Search.prototype.messageArea = null;\n\n    /** @type {String} The area we are searching in. */\n    Search.prototype._searchArea = null;\n\n    /** @type {String} The id of the course we are searching in (if any). */\n    Search.prototype._courseid = null;\n\n    /** @type {Boolean} checks if we are currently loading  */\n    Search.prototype._isLoading = false;\n\n    /** @type {String} The number of messages displayed. */\n    Search.prototype._numMessagesDisplayed = 0;\n\n    /** @type {String} The number of messages to retrieve. */\n    Search.prototype._numMessagesToRetrieve = 20;\n\n    /** @type {String} The number of users displayed. */\n    Search.prototype._numUsersDisplayed = 0;\n\n    /** @type {String} The number of users to retrieve. */\n    Search.prototype._numUsersToRetrieve = 20;\n\n    /** @type {Array} The type of available search areas. **/\n    Search.prototype._searchAreas = {\n        MESSAGES: 'messages',\n        USERS: 'users',\n        USERSINCOURSE: 'usersincourse'\n    };\n\n    /** @type {int} The timeout before performing an ajax search */\n    Search.prototype._requestTimeout = null;\n\n    /**\n     * Initialise the event listeners.\n     *\n     * @private\n     */\n    Search.prototype._init = function() {\n        // Handle searching for text.\n        this.messageArea.find(SELECTORS.SEARCHTEXTAREA).on('input', this._searchRequest.bind(this));\n\n        // Handle clicking on a course in the list of users.\n        this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.SEARCHUSERSINCOURSE, function(e) {\n            this._setFilter($(e.currentTarget).html());\n            this._setPlaceholderText('searchforuser');\n            this._clearSearchArea();\n            this._searchArea = this._searchAreas.USERSINCOURSE;\n            this._courseid = $(e.currentTarget).data('courseid');\n            this._searchUsersInCourse();\n            this.messageArea.find(SELECTORS.SEARCHBOX).focus();\n        }.bind(this));\n\n        // Handle deleting the search filter.\n        this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.DELETESEARCHFILTER, function() {\n            this._hideSearchResults();\n            // Filter has been removed, so we don't want to be searching in a course anymore.\n            this._searchArea = this._searchAreas.USERS;\n            this._setPlaceholderText('searchforuserorcourse');\n            // Go back the contacts.\n            this.messageArea.trigger(Events.USERSSEARCHCANCELED);\n            this.messageArea.find(SELECTORS.SEARCHBOX).focus();\n        }.bind(this));\n\n        // Handle events that occur outside this module.\n        this.messageArea.onCustomEvent(Events.CONVERSATIONSSELECTED, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.MESSAGES;\n            this._setPlaceholderText('searchmessages');\n        }.bind(this));\n        this.messageArea.onCustomEvent(Events.CONTACTSSELECTED, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.USERS;\n            this._setPlaceholderText('searchforuserorcourse');\n        }.bind(this));\n        this.messageArea.onCustomEvent(Events.MESSAGESENT, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.MESSAGES;\n            this._setPlaceholderText('searchmessages');\n        }.bind(this));\n\n        // Event listeners for scrolling through messages and users in courses.\n        CustomEvents.define(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), [\n            CustomEvents.events.scrollBottom\n        ]);\n        this.messageArea.onDelegateEvent(CustomEvents.events.scrollBottom, SELECTORS.SEARCHRESULTSAREA,\n            function() {\n                if (this._searchArea == this._searchAreas.MESSAGES) {\n                    this._searchMessages();\n                } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n                    this._searchUsersInCourse();\n                }\n            }.bind(this)\n        );\n\n        // Set the initial search area.\n        this._searchArea = (this.messageArea.showContactsFirst()) ? this._searchAreas.USERS : this._searchAreas.MESSAGES;\n    };\n\n    /**\n     * Handles when search requests are sent.\n     *\n     * @private\n     */\n    Search.prototype._searchRequest = function() {\n        var str = this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').val();\n\n        if (this._requestTimeout) {\n            clearTimeout(this._requestTimeout);\n        }\n\n        if (str.trim() === '') {\n            // If nothing we being searched then we need to display the usual data.\n            if (this._searchArea == this._searchAreas.MESSAGES) {\n                this._hideSearchResults();\n                this.messageArea.trigger(Events.MESSAGESEARCHCANCELED);\n            } else if (this._searchArea == this._searchAreas.USERS) {\n                this._hideSearchResults();\n                this.messageArea.trigger(Events.USERSSEARCHCANCELED);\n            } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n                // We are still searching in a course, so need to list all the users again.\n                this._clearSearchArea();\n                this._searchUsersInCourse();\n            }\n            return;\n        }\n\n        this.messageArea.find(SELECTORS.CONVERSATIONS).hide();\n        this.messageArea.find(SELECTORS.CONTACTS).hide();\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).show();\n\n        if (this._searchArea == this._searchAreas.MESSAGES) {\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numMessagesDisplayed = 0;\n                this._searchMessages();\n            }.bind(this), 300);\n        } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numUsersDisplayed = 0;\n                this._searchUsersInCourse();\n            }.bind(this), 300);\n        } else { // Must be searching for users and courses\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numUsersDisplayed = 0;\n                this._searchUsers();\n            }.bind(this), 300);\n        }\n    };\n\n    /**\n     * Handles searching for messages.\n     *\n     * @private\n     * @return {Promise|boolean} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchMessages = function() {\n        if (this._isLoading) {\n            return false;\n        }\n\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Tell the user we are loading items.\n        this._isLoading = true;\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_messages',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                search: str,\n                limitfrom: this._numMessagesDisplayed,\n                limitnum: this._numMessagesToRetrieve\n            }\n        }]);\n\n        // Keep track of the number of messages\n        var numberreceived = 0;\n        // Add loading icon to the end of the list.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            numberreceived = data.contacts.length;\n            return Templates.render('core_message/message_area_message_search_results', data);\n        }).then(function(html, js) {\n            // Remove the loading icon.\n            this.messageArea.find(SELECTORS.SEARCHRESULTSAREA + \" \" +\n                SELECTORS.LOADINGICON).remove();\n            // Only append data if we got data back.\n            if (numberreceived > 0) {\n                // Show the new content.\n                Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n                // Increment the number of contacts displayed.\n                this._numMessagesDisplayed += numberreceived;\n            } else if (this._numMessagesDisplayed == 0) { // Must have nothing to begin with.\n                // Replace the new content.\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n            }\n            // Mark that we are no longer busy loading data.\n            this._isLoading = false;\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Handles searching for users.\n     *\n     * @private\n     * @return {Promise} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchUsers = function() {\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_users',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                search: str,\n                limitnum: this._numUsersToRetrieve\n            }\n        }]);\n\n        // Perform the search and replace the content.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            if (data.contacts.length > 0) {\n                data.hascontacts = true;\n            }\n            if (data.courses.length > 0) {\n                data.hascourses = true;\n            }\n            if (data.noncontacts.length > 0) {\n                data.hasnoncontacts = true;\n            }\n            return Templates.render('core_message/message_area_user_search_results', data);\n        }).then(function(html, js) {\n            Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Handles searching for users in a course.\n     *\n     * @private\n     * @return {Promise|boolean} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchUsersInCourse = function() {\n        if (this._isLoading) {\n            return false;\n        }\n\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Tell the user we are loading items.\n        this._isLoading = true;\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_users_in_course',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                courseid: this._courseid,\n                search: str,\n                limitfrom: this._numUsersDisplayed,\n                limitnum: this._numUsersToRetrieve\n            }\n        }]);\n\n        // Keep track of the number of contacts\n        var numberreceived = 0;\n        // Add loading icon to the end of the list.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            numberreceived = data.contacts.length;\n            if (numberreceived > 0) {\n                data.hascontacts = true;\n            }\n            return Templates.render('core_message/message_area_user_search_results', data);\n        }).then(function(html, js) {\n            // Remove the loading icon.\n            this.messageArea.find(SELECTORS.SEARCHRESULTSAREA + \" \" +\n                SELECTORS.LOADINGICON).remove();\n            // Only append data if we got data back.\n            if (numberreceived > 0) {\n                // Show the new content.\n                Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n                // Increment the number of contacts displayed.\n                this._numUsersDisplayed += numberreceived;\n            } else if (this._numUsersDisplayed == 0) { // Must have nothing to begin with.\n                // Replace the new content.\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n            }\n            // Mark that we are no longer busy loading data.\n            this._isLoading = false;\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Sets placeholder text for search input.\n     *\n     * @private\n     * @param {String} text The placeholder text\n     * @return {Promise} The promise resolved when the placeholder text has been set\n     */\n    Search.prototype._setPlaceholderText = function(text) {\n        return Str.get_string(text, 'message').then(function(s) {\n            this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').attr('placeholder', s);\n        }.bind(this));\n    };\n\n    /**\n     * Sets filter for search input.\n     *\n     * @private\n     * @param {String} text The filter text\n     */\n    Search.prototype._setFilter = function(text) {\n        this.messageArea.find(SELECTORS.SEARCHBOX).val('');\n        this.messageArea.find(SELECTORS.CONTACTSAREA).addClass('searchfilter');\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).show();\n        this.messageArea.find(SELECTORS.SEARCHFILTER).html(text);\n        Str.get_string('removecoursefilter', 'message', text).then(function(languagestring) {\n            this.messageArea.find(SELECTORS.SEARCHFILTERAREA).attr('aria-label', languagestring);\n        }.bind(this)).catch(Notification.exception);\n    };\n\n    /**\n     * Hides filter for search input.\n     *\n     * @private\n     */\n    Search.prototype._clearFilters = function() {\n        this.messageArea.find(SELECTORS.CONTACTSAREA).removeClass('searchfilter');\n        this.messageArea.find(SELECTORS.SEARCHFILTER).empty();\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).hide();\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).removeAttr('aria-label');\n    };\n\n    /**\n     * Handles clearing the search area.\n     *\n     * @private\n     */\n    Search.prototype._clearSearchArea = function() {\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).empty();\n    };\n\n    /**\n     * Handles hiding the search area.\n     *\n     * @private\n     */\n    Search.prototype._hideSearchResults = function() {\n        this._clearFilters();\n        this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').val('');\n        this._clearSearchArea();\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).hide();\n    };\n\n    return Search;\n});\n"]}