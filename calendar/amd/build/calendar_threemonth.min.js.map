{"version":3,"sources":["../src/calendar_threemonth.js"],"names":["define","$","Notification","CalendarSelectors","CalendarEvents","Templates","CalendarViewManager","registerCalendarEventListeners","root","body","on","monthChanged","e","year","month","courseId","categoryId","queue","next","processRequest","then","fail","exception","newCurrentMonth","find","newParent","closest","calendarPeriods","allMonths","previousMonth","nextMonth","placeHolder","attr","placeHolderContainer","hide","append","requestYear","requestMonth","oldMonth","is","insertBefore","data","insertAfter","refreshMonthContent","slideUpPromise","Deferred","slideDownPromise","slideUp","remove","resolve","slideDown","when","init"],"mappings":"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","file":"calendar_threemonth.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles display of multiple mini calendars in a view, and\n * movement through them.\n *\n * @module     core_calendar/calendar_threemonth\n * @package    core_calendar\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/notification',\n    'core_calendar/selectors',\n    'core_calendar/events',\n    'core/templates',\n    'core_calendar/view_manager',\n],\nfunction(\n    $,\n    Notification,\n    CalendarSelectors,\n    CalendarEvents,\n    Templates,\n    CalendarViewManager\n) {\n\n    /**\n     * Listen to and handle any calendar events fired by the calendar UI.\n     *\n     * @method registerCalendarEventListeners\n     * @param {object} root The calendar root element\n     */\n    var registerCalendarEventListeners = function(root) {\n        var body = $('body');\n        body.on(CalendarEvents.monthChanged, function(e, year, month, courseId, categoryId) {\n            // We have to use a queue here because the calling code is decoupled from these listeners.\n            // It's possible for the event to be called multiple times before one call is fully resolved.\n            root.queue(function(next) {\n                return processRequest(e, year, month, courseId, categoryId)\n                .then(function() {\n                    return next();\n                })\n                .fail(Notification.exception)\n                ;\n            });\n        });\n\n        var processRequest = function(e, year, month, courseId, categoryId) {\n            var newCurrentMonth = root.find('[data-year=\"' + year + '\"][data-month=\"' + month + '\"]');\n            var newParent = newCurrentMonth.closest(CalendarSelectors.calendarPeriods.month);\n            var allMonths = root.find(CalendarSelectors.calendarPeriods.month);\n\n            var previousMonth = $(allMonths[0]);\n            var nextMonth = $(allMonths[2]);\n\n            var placeHolder = $('<span>');\n            placeHolder.attr('data-template', 'core_calendar/threemonth_month');\n            placeHolder.attr('data-includenavigation', false);\n            placeHolder.attr('data-mini', true);\n            var placeHolderContainer = $('<div>');\n            placeHolderContainer.hide();\n            placeHolderContainer.append(placeHolder);\n\n            var requestYear;\n            var requestMonth;\n            var oldMonth;\n\n            if (newParent.is(previousMonth)) {\n                // Fetch the new previous month.\n                placeHolderContainer.insertBefore(previousMonth);\n\n                requestYear = previousMonth.data('previousYear');\n                requestMonth = previousMonth.data('previousMonth');\n                oldMonth = nextMonth;\n            } else if (newParent.is(nextMonth)) {\n                // Fetch the new next month.\n                placeHolderContainer.insertAfter(nextMonth);\n                requestYear = nextMonth.data('nextYear');\n                requestMonth = nextMonth.data('nextMonth');\n                oldMonth = previousMonth;\n            }\n\n            return CalendarViewManager.refreshMonthContent(\n                placeHolder,\n                requestYear,\n                requestMonth,\n                courseId,\n                categoryId,\n                placeHolder\n            )\n            .then(function() {\n                var slideUpPromise = $.Deferred();\n                var slideDownPromise = $.Deferred();\n                oldMonth.slideUp('fast', function() {\n                    $(this).remove();\n                    slideUpPromise.resolve();\n                });\n                placeHolderContainer.slideDown('fast', function() {\n                    slideDownPromise.resolve();\n                });\n\n                return $.when(slideUpPromise, slideDownPromise);\n            });\n        };\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n\n            registerCalendarEventListeners(root);\n        }\n    };\n});\n"]}