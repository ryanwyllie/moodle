define(["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events"],function(a,b,c,d,e,f,g,h,i,j,k){var l={ROOT:"[data-region='calendar']",EVENT_LINK:"[data-action='view-event']",NEW_EVENT_BUTTON:"[data-action='new-event-button']"},m=null,n=function(a){var b="type"+a;return c.get_string(b,"core_calendar").then(function(a){return a}).fail(e.exception)},o=function(a){var b=j.getEventById(a);return b.then(function(a){return a.event?a.event:void b.fail(e.exception)}).then(function(a){return n(a.eventtype).then(function(b){return a.eventtype=b,a})}).then(function(a){return m.done(function(b){b.setTitle(a.name),b.setBody(d.render("core_calendar/event_summary_body",a)),0==a.caneditevent&&b.setFooter(""),b.show()})})},p=function(a){var b=a.find(l.NEW_EVENT_BUTTON),c=b.attr("data-context-id");return g.create({type:h.TYPE,large:!0,templateContext:{contextid:c}},b)},q=function(b,c){var d=a("body");d.on(k.created,function(){window.location.reload()}),d.on(k.deleted,function(){window.location.reload()}),d.on(k.updated,function(){window.location.reload()}),c.then(function(a){d.on(k.editEvent,function(b,c){a.setEventId(c),a.show()})})},r=function(b){b=a(b);var c=!1;b.on("click",l.EVENT_LINK,function(b){if(!c){c=!0,b.preventDefault();var d=a(b.target).closest(l.EVENT_LINK),e=d.attr("data-event-id");o(e).then(function(){c=!1})}});var d=p(b);q(b,d)};return{init:function(){m=g.create({type:i.TYPE}),r(l.ROOT)}}});