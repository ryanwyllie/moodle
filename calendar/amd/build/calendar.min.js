'use strict';define('core_calendar/calendar',['jquery','core/ajax','core/str','core/templates','core/notification','core/custom_interaction_events','core/modal_events','core/modal_factory','core_calendar/modal_event_form','core_calendar/summary_modal','core_calendar/repository','core_calendar/events','core_calendar/view_manager','core_calendar/crud','core_calendar/selectors'],function($,Ajax,Str,Templates,Notification,CustomEvents,ModalEvents,ModalFactory,ModalEventForm,SummaryModal,CalendarRepository,CalendarEvents,CalendarViewManager,CalendarCrud,CalendarSelectors){var SELECTORS={ROOT:'[data-region=\'calendar\']',DAY:'[data-region=\'day\']',NEW_EVENT_BUTTON:'[data-action=\'new-event-button\']',DAY_CONTENT:'[data-region=\'day-content\']',LOADING_ICON:'.loading-icon',VIEW_DAY_LINK:'[data-action=\'view-day-link\']',CALENDAR_MONTH_WRAPPER:'.calendarwrapper',TODAY:'.today'},handleMoveEvent=function(e,eventId,originElement,destinationElement){var originTimestamp=null,destinationTimestamp=destinationElement.attr('data-day-timestamp');originElement&&(originTimestamp=originElement.attr('data-day-timestamp')),originElement&&originTimestamp==destinationTimestamp||Templates.render('core/loading',{}).then(function(html,js){return destinationElement.find(SELECTORS.DAY_CONTENT).addClass('hidden'),Templates.appendNodeContents(destinationElement,html,js),void(originElement&&(originElement.find(SELECTORS.DAY_CONTENT).addClass('hidden'),Templates.appendNodeContents(originElement,html,js)))}).then(function(){return CalendarRepository.updateEventStartDay(eventId,destinationTimestamp)}).then(function(){$('body').trigger(CalendarEvents.eventMoved,[eventId,originElement,destinationElement])}).always(function(){var destinationLoadingElement=destinationElement.find(SELECTORS.LOADING_ICON);if(destinationElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden'),Templates.replaceNode(destinationLoadingElement,'',''),originElement){var originLoadingElement=originElement.find(SELECTORS.LOADING_ICON);originElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden'),Templates.replaceNode(originLoadingElement,'','')}}).fail(Notification.exception)},registerCalendarEventListeners=function(root,eventFormModalPromise){var body=$('body');body.on(CalendarEvents.created,function(){CalendarViewManager.reloadCurrentMonth(root)}),body.on(CalendarEvents.deleted,function(){CalendarViewManager.reloadCurrentMonth(root)}),body.on(CalendarEvents.updated,function(){CalendarViewManager.reloadCurrentMonth(root)}),body.on(CalendarEvents.editActionEvent,function(e,url){window.location.assign(url)}),body.on(CalendarEvents.moveEvent,handleMoveEvent),body.on(CalendarEvents.eventMoved,function(){CalendarViewManager.reloadCurrentMonth(root)}),CalendarCrud.registerEditListeners(root,eventFormModalPromise)},registerEventListeners=function(root){root.on('change',CalendarSelectors.elements.courseSelector,function(){var selectElement=$(this),courseId=selectElement.val();CalendarViewManager.reloadCurrentMonth(root,courseId,null).then(function(){return root.find(CalendarSelectors.elements.courseSelector).val(courseId)}).fail(Notification.exception)});var eventFormPromise=CalendarCrud.registerEventFormModal(root),contextId=$(SELECTORS.CALENDAR_MONTH_WRAPPER).data('context-id');registerCalendarEventListeners(root,eventFormPromise),contextId&&root.on('click',SELECTORS.DAY,function(e){var target=$(e.target);if(!target.is(SELECTORS.VIEW_DAY_LINK)){var startTime=$(this).attr('data-new-event-timestamp');eventFormPromise.then(function(modal){var wrapper=target.closest(CalendarSelectors.wrapper);modal.setCourseId(wrapper.data('courseid'));var categoryId=wrapper.data('categoryid');return'undefined'!=typeof categoryId&&modal.setCategoryId(categoryId),modal.setContextId(wrapper.data('contextId')),modal.setStartTime(startTime),void modal.show()}).fail(Notification.exception),e.preventDefault()}})};return{init:function init(root){root=$(root),CalendarViewManager.init(root),registerEventListeners(root)}}});
//# sourceMappingURL=calendar.min.js.map
