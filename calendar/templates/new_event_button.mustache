{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template core_calendar/minicalendar_day_link

    Displays link to calendar day in mini calendar, with hover tooltip.

    Example context (json):
    {
        "day": "Today",
        "url": "http://example.com/",
        "title": "Monday 2nd January",
        "content": "<img class='icon smallicon' alt='icon' src='../../../pix/i/siteevent.svg'>Test site event"
    }
}}
<button id="{{uniqid}}"
        type="button"
        class="btn btn-secondary pull-xs-right"
        data-context-id="{{contextid}}"
        data-course-id="{{courseid}}"
        data-current-time="{{time}}"
        data-action="new">
New Event
</button>
{{#js}}
require(['jquery', 'core/fragment', 'core/templates'], function($, Fragment, Templates) {
    var button = $('#{{uniqid}}');
    var promise = Fragment.loadFragment('calendar', 'event_form', button.attr('data-context-id'), {
        courseid: button.attr('data-course-id'),
        action: 'new',
        time: button.attr('data-current-time'),
    })
    .done(function(html, js) {
        var container = $('[role="main"]');
        var calendar = container.find('.maincalendar');
        var node = $(html);
        node.prepend('<button class="btn btn-danger" id="thebackbutton">Back</button>');
        Templates.appendNodeContents(container, node, js);

        node.hide();
        button.click(function(e) {
            calendar.hide();
            node.show();

            e.stopPropagation();
            e.preventDefault();
        });

        node.find('#thebackbutton').click(function(e) {
            calendar.show();
            node.hide();

            e.stopPropagation();
            e.preventDefault();
        });
    });
});
{{/js}}
