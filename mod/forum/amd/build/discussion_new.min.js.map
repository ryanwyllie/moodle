{"version":3,"sources":["../src/discussion_new.js"],"names":["define","$","AutoRows","CustomEvents","Selectors","Discussion","PostsList","LockToggle","FavouriteToggle","Pin","registerEventListeners","root","init","on","events","IN_PAGE_REPLY_VISIBILITY_CHANGE","post","inpageReplyContent","e","isVisible","target","closest","postContainer","replyVisibilityToggleContainer","children","repliesContainer","hasReplies","length","showButton","find","showReplies","hideButton","hideReplies","slideUp","removeClass","addClass","slideDown","buttonContainer","parent","context","template","discussionToolsContainer"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for viewing a discussion.\n *\n * @module     mod_forum/discussion_new\n * @package    mod_forum\n * @copyright  2019 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/auto_rows',\n    'core/custom_interaction_events',\n    'mod_forum/selectors',\n    'mod_forum/discussion',\n    'mod_forum/posts_list',\n    'mod_forum/lock_toggle',\n    'mod_forum/favourite_toggle',\n    'mod_forum/pin_toggle'\n],\nfunction(\n    $,\n    AutoRows,\n    CustomEvents,\n    Selectors,\n    Discussion,\n    PostsList,\n    LockToggle,\n    FavouriteToggle,\n    Pin\n) {\n\n    var registerEventListeners = function(root) {\n        AutoRows.init(root);\n\n        root.on(PostsList.events.IN_PAGE_REPLY_VISIBILITY_CHANGE, Selectors.post.inpageReplyContent, function(e, isVisible) {\n            var inpageReplyContent = $(e.target).closest(Selectors.post.inpageReplyContent);\n            var postContainer = inpageReplyContent.closest(Selectors.post.post);\n            var replyVisibilityToggleContainer = postContainer.children(Selectors.post.replyVisibilityToggleContainer);\n            var repliesContainer = postContainer.children(Selectors.post.repliesContainer);\n            var hasReplies = repliesContainer.children().length > 0;\n\n            if (replyVisibilityToggleContainer.length && hasReplies) {\n                var showButton = replyVisibilityToggleContainer.find(Selectors.post.showReplies);\n                var hideButton = replyVisibilityToggleContainer.find(Selectors.post.hideReplies);\n\n                if (isVisible) {\n                    repliesContainer.slideUp(200, function() {\n                        showButton.removeClass('hidden');\n                        hideButton.addClass('hidden');\n                        replyVisibilityToggleContainer.removeClass('hidden');\n                    });\n                } else {\n                    replyVisibilityToggleContainer.addClass('hidden');\n                    repliesContainer.slideDown(200);\n                }\n            }\n        });\n\n        root.on('click', Selectors.post.showReplies, function(e) {\n            var showButton = $(e.target).closest(Selectors.post.showReplies);\n            var buttonContainer = showButton.closest(Selectors.post.replyVisibilityToggleContainer);\n            var hideButton = buttonContainer.find(Selectors.post.hideReplies);\n            var postContainer = buttonContainer.closest(Selectors.post.post);\n            var repliesContainer = postContainer.children(Selectors.post.repliesContainer);\n\n            repliesContainer.slideDown(200);\n            hideButton.removeClass('hidden');\n            showButton.addClass('hidden');\n        });\n\n        root.on('click', Selectors.post.hideReplies, function(e) {\n            var hideButton = $(e.target).closest(Selectors.post.hideReplies);\n            var buttonContainer = hideButton.parent();\n            var showButton = buttonContainer.find(Selectors.post.showReplies);\n            var postContainer = buttonContainer.closest(Selectors.post.post);\n            var repliesContainer = postContainer.children(Selectors.post.repliesContainer);\n\n            repliesContainer.slideUp(200);\n            showButton.removeClass('hidden');\n            hideButton.addClass('hidden');\n        });\n    };\n\n    return {\n        init: function(root, context) {\n            registerEventListeners(root);\n            Discussion.init(root);\n            PostsList.init(\n                root,\n                {\n                    template: 'mod_forum/inpage_reply_new',\n                    context: context\n                },\n                {\n                    template: 'mod_forum/forum_discussion_post_new_reply',\n                    context: {}\n                }\n            );\n\n            var discussionToolsContainer = $('[data-container=\"discussion-tools\"]');\n            LockToggle.init(discussionToolsContainer);\n            FavouriteToggle.init(discussionToolsContainer);\n            Pin.init(discussionToolsContainer);\n        }\n    };\n});\n"],"file":"discussion_new.min.js"}