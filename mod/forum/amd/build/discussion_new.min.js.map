{"version":3,"sources":["../src/discussion_new.js"],"names":["clearUrlHash","window","location","hash","url","href","split","history","pushState","document","title","getPostContainer","element","closest","Selectors","post","getPostContentContainer","postContainer","children","not","repliesContainer","find","forumCoreContent","getInPageReplyContainer","filter","inpageReplyContainer","getInPageReplyForm","inpageReplyContent","getInPageReplyCreateButton","inpageReplyCreateButton","getRepliesVisibilityToggleContainer","repliesVisibilityToggleContainer","getRepliesContainer","hasReplies","pageContainer","length","getShowRepliesButton","replyVisibilityToggleContainer","showReplies","getHideRepliesButton","hideReplies","repliesVisible","is","showButton","hideButton","addClass","removeClass","slideDown","duration","queue","css","fadeIn","slideUp","fadeOut","showInPageReplyForm","buildShowInPageReplyFormFunction","additionalTemplateContext","inPageReplyContainer","inPageReplyCreateButton","hasInPageReplyForm","renderInPageReplyTemplate","html","Templates","appendNodeContents","Notification","exception","inPageReplyForm","complete","focus","hideInPageReplyForm","button","postContentContainer","currentSubject","forumSubject","text","currentAuthorName","authorName","context","postid","data","attr","sesskey","M","cfg","parentsubject","parentauthorname","canreplyprivately","postformat","InPageReply","CONTENT_FORMATS","MOODLE","render","incrementTotalReplyCount","replyCount","each","index","currentCount","parseInt","innerText","registerEventListeners","root","CustomEvents","define","events","activate","AutoRows","init","on","e","originalEvent","preventDefault","currentTarget","inpageReplyCancelButton","target","EVENTS","POST_CREATED","inpageSubmitBtn","Discussion","discussionToolsContainer","discussion","tools","LockToggle","FavouriteToggle","Pin"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for viewing a discussion.\n *\n * @module     mod_forum/discussion_new\n * @package    mod_forum\n * @copyright  2019 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport AutoRows from 'core/auto_rows';\nimport CustomEvents from 'core/custom_interaction_events';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Discussion from 'mod_forum/discussion';\nimport InPageReply from 'mod_forum/inpage_reply';\nimport LockToggle from 'mod_forum/lock_toggle';\nimport FavouriteToggle from 'mod_forum/favourite_toggle';\nimport Pin from 'mod_forum/pin_toggle';\nimport Selectors from 'mod_forum/selectors';\n\nconst ANIMATION_DURATION = 150;\n\nconst clearUrlHash = () => {\n    // After adding a reply a url hash is being generated that scrolls (points) to the newly added reply.\n    // The hash being present causes this scrolling behavior to the particular reply to persists even when\n    // another, non-related in-page replay link is being clicked which ultimately causes a bad user experience.\n    // A particular solution for this problem would be changing the browser's history state when a url hash is\n    // present.\n    if (window.location.hash) {\n        // Remove the fragment identifier from the url.\n        var url = window.location.href.split('#')[0];\n        history.pushState({}, document.title, url);\n    }\n};\n\nconst getPostContainer = (element) => {\n    return element.closest(Selectors.post.post);\n};\n\nconst getPostContentContainer = (postContainer) => {\n    return postContainer.children().not(Selectors.post.repliesContainer).find(Selectors.post.forumCoreContent);\n};\n\nconst getInPageReplyContainer = (postContainer) => {\n    return postContainer.children().filter(Selectors.post.inpageReplyContainer);\n};\n\nconst getInPageReplyForm = (postContainer) => {\n    return getInPageReplyContainer(postContainer).find(Selectors.post.inpageReplyContent);\n};\n\nconst getInPageReplyCreateButton = (postContainer) => {\n    return getPostContentContainer(postContainer).find(Selectors.post.inpageReplyCreateButton);\n};\n\nconst getRepliesVisibilityToggleContainer = (postContainer) => {\n    return postContainer.children(Selectors.post.repliesVisibilityToggleContainer);\n};\n\nconst getRepliesContainer = (postContainer) => {\n    return postContainer.children(Selectors.post.repliesContainer);\n};\n\nconst hasReplies = (pageContainer) => {\n    return getRepliesContainer(pageContainer).children().length > 0;\n};\n\nconst getShowRepliesButton = (replyVisibilityToggleContainer) => {\n    return replyVisibilityToggleContainer.find(Selectors.post.showReplies);\n};\n\nconst getHideRepliesButton = (replyVisibilityToggleContainer) => {\n    return replyVisibilityToggleContainer.find(Selectors.post.hideReplies);\n};\n\nconst repliesVisible = (pageContainer) => {\n    const repliesContainer = getRepliesContainer(pageContainer);\n    return repliesContainer.is(':visible');\n};\n\nconst showReplies = (pageContainer) => {\n    const repliesContainer = getRepliesContainer(pageContainer);\n    const replyVisibilityToggleContainer = getRepliesVisibilityToggleContainer(pageContainer);\n    const showButton = getShowRepliesButton(replyVisibilityToggleContainer);\n    const hideButton = getHideRepliesButton(replyVisibilityToggleContainer);\n\n    showButton.addClass('hidden');\n    hideButton.removeClass('hidden');\n\n    repliesContainer.slideDown({\n        duration: ANIMATION_DURATION,\n        queue: false\n    }).css('display', 'none').fadeIn(ANIMATION_DURATION);\n};\n\nconst hideReplies = (pageContainer) => {\n    const repliesContainer = getRepliesContainer(pageContainer);\n    const replyVisibilityToggleContainer = getRepliesVisibilityToggleContainer(pageContainer);\n    const showButton = getShowRepliesButton(replyVisibilityToggleContainer);\n    const hideButton = getHideRepliesButton(replyVisibilityToggleContainer);\n\n    showButton.removeClass('hidden');\n    hideButton.addClass('hidden');\n\n    repliesContainer.slideUp({\n        duration: ANIMATION_DURATION,\n        queue: false\n    }).fadeOut(ANIMATION_DURATION);\n};\n\nlet showInPageReplyForm = null;\nconst buildShowInPageReplyFormFunction = (additionalTemplateContext) => {\n    return async (postContainer) => {\n\n        const inPageReplyContainer = getInPageReplyContainer(postContainer);\n        const repliesVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n        const inPageReplyCreateButton = getInPageReplyCreateButton(postContainer);\n\n        if (!hasInPageReplyForm(inPageReplyContainer)) {\n            try {\n                const html = await renderInPageReplyTemplate(additionalTemplateContext, inPageReplyCreateButton, postContainer);\n                Templates.appendNodeContents(inPageReplyContainer, html, '');\n            } catch (e) {\n                Notification.exception(e);\n            }\n        }\n\n        inPageReplyCreateButton.fadeOut(ANIMATION_DURATION, () => {\n            const inPageReplyForm = getInPageReplyForm(postContainer);\n            inPageReplyForm.slideDown({\n                duration: ANIMATION_DURATION,\n                queue: false,\n                complete: () => {\n                    inPageReplyForm.find('textarea').focus();\n                }\n            }).css('display', 'none').fadeIn(ANIMATION_DURATION);\n\n            if (repliesVisibilityToggleContainer.length && hasReplies(postContainer)) {\n                repliesVisibilityToggleContainer.fadeIn(ANIMATION_DURATION);\n                hideReplies(postContainer);\n            }\n        });\n    };\n};\n\nconst hideInPageReplyForm = (postContainer) => {\n    const inPageReplyForm = getInPageReplyForm(postContainer);\n    const inPageReplyCreateButton = getInPageReplyCreateButton(postContainer);\n    const repliesVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n\n    if (repliesVisibilityToggleContainer.length && hasReplies(postContainer)) {\n        repliesVisibilityToggleContainer.fadeOut(ANIMATION_DURATION);\n        if (!repliesVisible(postContainer)) {\n            showReplies(postContainer);\n        }\n    }\n\n    inPageReplyForm.slideUp({\n        duration: ANIMATION_DURATION,\n        queue: false,\n        complete: () => {\n            inPageReplyCreateButton.fadeIn(ANIMATION_DURATION);\n        }\n    }).fadeOut(200);\n};\n\nconst hasInPageReplyForm = (inPageReplyContainer) => {\n    return inPageReplyContainer.find(Selectors.post.inpageReplyContent).length > 0;\n};\n\nconst renderInPageReplyTemplate = (additionalTemplateContext, button, postContainer) => {\n    const postContentContainer = getPostContentContainer(postContainer);\n    const currentSubject = postContentContainer.find(Selectors.post.forumSubject).text();\n    const currentAuthorName = postContentContainer.find(Selectors.post.authorName).text();\n    const context = {\n        postid: postContainer.data('post-id'),\n        \"reply_url\": button.attr('data-href'),\n        sesskey: M.cfg.sesskey,\n        parentsubject: currentSubject,\n        parentauthorname: currentAuthorName,\n        canreplyprivately: button.data('can-reply-privately'),\n        postformat: InPageReply.CONTENT_FORMATS.MOODLE,\n        ...additionalTemplateContext\n    };\n\n    return Templates.render('mod_forum/inpage_reply_new', context);\n};\n\nconst incrementTotalReplyCount = (postContainer) => {\n    getRepliesVisibilityToggleContainer(postContainer).find(Selectors.post.replyCount).each((index, element) => {\n        const currentCount = parseInt(element.innerText, 10);\n        element.innerText = currentCount + 1;\n    });\n};\n\nconst registerEventListeners = (root) => {\n    CustomEvents.define(root, [CustomEvents.events.activate]);\n    AutoRows.init(root);\n\n    root.on(CustomEvents.events.activate, Selectors.post.inpageReplyCreateButton, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.currentTarget));\n        clearUrlHash();\n        showInPageReplyForm(postContainer);\n    });\n\n    root.on(CustomEvents.events.activate, Selectors.post.inpageReplyCancelButton, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.currentTarget));\n        hideInPageReplyForm(postContainer);\n    });\n\n    root.on(CustomEvents.events.activate, Selectors.post.showReplies, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.target));\n        showReplies(postContainer);\n    });\n\n    root.on(CustomEvents.events.activate, Selectors.post.hideReplies, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.target));\n        hideReplies(postContainer);\n    });\n\n    root.on(InPageReply.EVENTS.POST_CREATED, Selectors.post.inpageSubmitBtn, (e) => {\n        const postContainer = getPostContainer($(e.currentTarget));\n        hideInPageReplyForm(postContainer);\n        incrementTotalReplyCount(postContainer);\n    });\n};\n\nexport const init = (root, context) => {\n    showInPageReplyForm = buildShowInPageReplyFormFunction(context);\n    registerEventListeners(root);\n    Discussion.init(root);\n    InPageReply.init(root);\n\n    const discussionToolsContainer = root.find(Selectors.discussion.tools);\n    LockToggle.init(discussionToolsContainer);\n    FavouriteToggle.init(discussionToolsContainer);\n    Pin.init(discussionToolsContainer);\n};\n"],"file":"discussion_new.min.js"}