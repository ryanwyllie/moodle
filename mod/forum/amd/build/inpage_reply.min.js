define("mod_forum/inpage_reply",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors"],function(a,b,c,d,f){var e={THREADED:2,NESTED:3,FLAT_OLDEST_FIRST:1,FLAT_NEWEST_FIRST:-1},g={MOODLE:0},h=function(a){var b=a.find(f.post.inpageSubmitBtnText),c=a.find(f.post.loadingIconContainer),d=a.outerWidth();a.css("width",d);b.addClass("hidden");c.removeClass("hidden")},i=function(a){var b=a.find(f.post.inpageSubmitBtnText),c=a.find(f.post.loadingIconContainer);a.css("width","");b.removeClass("hidden");c.addClass("hidden")},j=function(j){j.on("click",f.post.inpageSubmitBtn,function(k){k.preventDefault();var l=a(k.currentTarget),m=l.parent().find(f.post.inpageReplyButton),n=l.parents(f.post.inpageReplyForm).get(0),o=n.elements.post.value.trim(),p=g.MOODLE,q=n.elements.reply.value,r=n.elements.subject.value,s=l.parents(f.post.forumContent),t=n.elements.privatereply!=void 0?n.elements.privatereply.checked:!1,u=parseInt(j.find(f.post.modeSelect).get(0).value),v;if(o.length){h(l);m.prop("disabled",!0);d.addDiscussionPost(q,r,o,p,t,!0).then(function(a){var b=a.messages.reduce(function(a,b){if("success"==b.type){a+="<p>"+b.message+"</p>"}return a},"");c.addNotification({message:b,type:"success"});return a}).then(function(a){n.reset();var c=a.post;v=c.id;switch(u){case e.THREADED:return b.render("mod_forum/forum_discussion_threaded_post",c);case e.NESTED:return b.render("mod_forum/forum_discussion_nested_post",c);default:return b.render("mod_forum/forum_discussion_post",c);}}).then(function(a,c){var d;if(u==e.FLAT_OLDEST_FIRST||u==e.FLAT_NEWEST_FIRST){d=s.parents(f.post.repliesContainer).children().get(0)}if(d==void 0){d=s.siblings(f.post.repliesContainer).children().get(0)}if(u==e.FLAT_NEWEST_FIRST){return b.prependNodeContents(d,a,c)}else{return b.appendNodeContents(d,a,c)}}).then(function(){i(l);m.prop("disabled",!1);return s.find(f.post.inpageReplyContent).hide()}).then(function(){location.href="#p"+v}).catch(function(a){i(l);m.prop("disabled",!1);return c.exception(a)})}})};return{init:function init(a){j(a)},CONTENT_FORMATS:g}});
//# sourceMappingURL=inpage_reply.min.js.map
