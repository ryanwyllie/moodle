{"version":3,"sources":["../src/discussion_search_form.js"],"names":["SELECTORS","ADVANCED_SEARCH_FORM","ADVANCED_SEARCH_FORM_FIRST_FOCUS","ADVANCED_SEARCH_FORM_SHOW_BUTTON","QUICK_SEARCH_FORM","QUICK_SEARCH_FORM_INPUT","QUICK_SEARCH_FORM_SUBMIT_BUTTON","TIME_FROM_TOGGLE","TIME_FROM_DATE_FIELDS","TIME_FROM_HIDDEN_DATE_FIELDS","TIME_TO_TOGGLE","TIME_TO_DATE_FIELDS","TIME_TO_HIDDEN_DATE_FIELDS","getAdvancedSearchForm","root","querySelector","getQuickSearchForm","getTimeFromToggle","advancedSearchForm","getTimeToToggle","getAdvancedSearchFormShowButton","quickSearchForm","getAdvancedSearchFormFirstFocusElement","getQuickSearchFormInput","getQuickSearchFormSubmitButton","updateDateFieldsDisabled","visibleSelector","hiddenSelector","disabled","querySelectorAll","forEach","element","setAttribute","removeAttribute","value","updateTimeFromDateFieldsDisabled","timeFromToggle","checked","updateTimeToDateFieldsDisabled","timeToToggle","showAdvancedSearchForm","advancedSearchFormShowButton","quickSearchFormSubmitButton","classList","remove","add","focus","hideAdvancedSearchForm","quickSearchFormInput","advancedFormVisible","addEventListener","e","preventDefault","stopPropagation","document","body","keyCode","KeyCodes","escape","contains","target"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Discussion search form contorls.\n *\n * @copyright  2019 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport KeyCodes from 'core/key_codes';\n\nconst SELECTORS = {\n    ADVANCED_SEARCH_FORM: '[data-region=\"advanced-search-form\"]',\n    ADVANCED_SEARCH_FORM_FIRST_FOCUS: 'input[name=\"words\"]',\n    ADVANCED_SEARCH_FORM_SHOW_BUTTON: '[data-action=\"show-advanced-search-form\"]',\n    QUICK_SEARCH_FORM: '[data-region=\"quick-search-form\"]',\n    QUICK_SEARCH_FORM_INPUT: 'input[name=\"search\"]',\n    QUICK_SEARCH_FORM_SUBMIT_BUTTON: 'button[type=\"submit\"]',\n    TIME_FROM_TOGGLE: \"input[name='timefromrestrict']\",\n    TIME_FROM_DATE_FIELDS: \"select[name^=from]\",\n    TIME_FROM_HIDDEN_DATE_FIELDS: \"input[name^=hfrom]\",\n    TIME_TO_TOGGLE: \"input[name='timetorestrict']\",\n    TIME_TO_DATE_FIELDS: \"select[name^=to]\",\n    TIME_TO_HIDDEN_DATE_FIELDS: \"input[name^=hto]\",\n};\n\n/**\n * Get the advanced search form element.\n *\n * @param {Element} root Search forms root element.\n * @return {Element}\n */\nconst getAdvancedSearchForm = (root) => {\n    return root.querySelector(SELECTORS.ADVANCED_SEARCH_FORM);\n};\n\n/**\n * Get the quick search form element.\n *\n * @param {Element} root Search forms root element.\n * @return {Element}\n */\nconst getQuickSearchForm = (root) => {\n    return root.querySelector(SELECTORS.QUICK_SEARCH_FORM);\n};\n\n/**\n * Get the \"time from\" toggle element in the advanced search form.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @return {Element}\n */\nconst getTimeFromToggle = (advancedSearchForm) => {\n    return advancedSearchForm.querySelector(SELECTORS.TIME_FROM_TOGGLE);\n};\n\n/**\n * Get the \"time to\" toggle element in the advanced search form.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @return {Element}\n */\nconst getTimeToToggle = (advancedSearchForm) => {\n    return advancedSearchForm.querySelector(SELECTORS.TIME_TO_TOGGLE);\n};\n\n/**\n * Get the show advanced search form button from the quick search form.\n *\n * @param {Element} quickSearchForm Quick search form element.\n * @return {Element}\n */\nconst getAdvancedSearchFormShowButton = (quickSearchForm) => {\n    return quickSearchForm.querySelector(SELECTORS.ADVANCED_SEARCH_FORM_SHOW_BUTTON);\n};\n\n/**\n * Get the first element in the advanced search form that can be focused.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @return {Element}\n */\nconst getAdvancedSearchFormFirstFocusElement = (advancedSearchForm) => {\n    return advancedSearchForm.querySelector(SELECTORS.ADVANCED_SEARCH_FORM_FIRST_FOCUS);\n};\n\n/**\n * Get the search input from the quick search form.\n *\n * @param {Element} quickSearchForm Quick search form element.\n * @return {Element}\n */\nconst getQuickSearchFormInput = (quickSearchForm) => {\n    return quickSearchForm.querySelector(SELECTORS.QUICK_SEARCH_FORM_INPUT);\n};\n\n/**\n * Get the submit button from the quick search form.\n *\n * @param {Element} quickSearchForm Quick search form element.\n * @return {Element}\n */\nconst getQuickSearchFormSubmitButton = (quickSearchForm) => {\n    return quickSearchForm.querySelector(SELECTORS.QUICK_SEARCH_FORM_SUBMIT_BUTTON);\n};\n\n/**\n * Update the advanced form date fields disabled status.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @param {String} visibleSelector Selector to find the visible date elements.\n * @param {String} hiddenSelector Selector to find the hidden date elements.\n * @param {Bool} disabled The disabled status to set.\n */\nconst updateDateFieldsDisabled = (advancedSearchForm, visibleSelector, hiddenSelector, disabled) => {\n    advancedSearchForm.querySelectorAll(visibleSelector).forEach(element => {\n        if (disabled) {\n            element.setAttribute('disabled', true);\n        } else {\n            element.removeAttribute('disabled');\n        }\n    });\n\n    advancedSearchForm.querySelectorAll(hiddenSelector).forEach(element => {\n        element.value = disabled ? 1 : 0;\n    });\n};\n\n/**\n * Update the advanced form \"time from\" date fields disabled status based on\n * the \"checked\" value of the toggle element.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @param {Element} timeFromToggle The \"time from\" toggle element\n */\nconst updateTimeFromDateFieldsDisabled = (advancedSearchForm, timeFromToggle) => {\n    updateDateFieldsDisabled(\n        advancedSearchForm,\n        SELECTORS.TIME_FROM_DATE_FIELDS,\n        SELECTORS.TIME_FROM_HIDDEN_DATE_FIELDS,\n        !timeFromToggle.checked\n    );\n};\n\n/**\n * Update the advanced form \"time to\" date fields disabled status based on\n * the \"checked\" value of the toggle element.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @param {Element} timeToToggle The \"time to\" toggle element\n */\nconst updateTimeToDateFieldsDisabled = (advancedSearchForm, timeToToggle) => {\n    updateDateFieldsDisabled(\n        advancedSearchForm,\n        SELECTORS.TIME_TO_DATE_FIELDS,\n        SELECTORS.TIME_TO_HIDDEN_DATE_FIELDS,\n        !timeToToggle.checked\n    );\n};\n\n/**\n * Show the advanced search form.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @param {Element} advancedSearchFormShowButton The button to show the advanced form.\n * @param {Element} quickSearchFormSubmitButton The submit button for the quick search form.\n */\nconst showAdvancedSearchForm = (advancedSearchForm, advancedSearchFormShowButton, quickSearchFormSubmitButton) => {\n    advancedSearchForm.classList.remove('hidden');\n    advancedSearchFormShowButton.classList.add('hidden');\n    advancedSearchFormShowButton.setAttribute('aria-expanded', 'true');\n    quickSearchFormSubmitButton.setAttribute('disabled', true);\n    getAdvancedSearchFormFirstFocusElement(advancedSearchForm).focus();\n};\n\n/**\n * Hide the advanced search form.\n *\n * @param {Element} advancedSearchForm Advanced search form element.\n * @param {Element} advancedSearchFormShowButton The button to show the advanced form.\n * @param {Element} quickSearchFormSubmitButton The submit button for the quick search form.\n */\nconst hideAdvancedSearchForm = (advancedSearchForm, advancedSearchFormShowButton, quickSearchFormSubmitButton) => {\n    advancedSearchForm.classList.add('hidden');\n    advancedSearchFormShowButton.classList.remove('hidden');\n    advancedSearchFormShowButton.setAttribute('aria-expanded', 'false');\n    quickSearchFormSubmitButton.removeAttribute('disabled');\n};\n\n/**\n * Initialise the event listeners for the discussion search form.\n *\n * @param {Element} root Search forms root element.\n */\nexport default (root) => {\n    const advancedSearchForm = getAdvancedSearchForm(root);\n    const quickSearchForm = getQuickSearchForm(root);\n    const quickSearchFormInput = getQuickSearchFormInput(quickSearchForm);\n    const quickSearchFormSubmitButton = getQuickSearchFormSubmitButton(quickSearchForm);\n    const timeFromToggle = getTimeFromToggle(advancedSearchForm);\n    const timeToToggle = getTimeToToggle(advancedSearchForm);\n    const advancedSearchFormShowButton = getAdvancedSearchFormShowButton(quickSearchForm);\n    let advancedFormVisible = false;\n\n    updateTimeFromDateFieldsDisabled(advancedSearchForm, timeFromToggle);\n    updateTimeToDateFieldsDisabled(advancedSearchForm, timeToToggle);\n\n    timeFromToggle.addEventListener('click', () => updateTimeFromDateFieldsDisabled(advancedSearchForm, timeFromToggle));\n    timeToToggle.addEventListener('click', () => updateTimeToDateFieldsDisabled(advancedSearchForm, timeToToggle));\n    advancedSearchFormShowButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        showAdvancedSearchForm(advancedSearchForm, advancedSearchFormShowButton, quickSearchFormSubmitButton);\n        advancedFormVisible = true;\n    });\n    document.body.addEventListener('keydown', (e) => {\n        if (advancedFormVisible && e.keyCode == KeyCodes.escape) {\n            hideAdvancedSearchForm(advancedSearchForm, advancedSearchFormShowButton, quickSearchFormSubmitButton);\n            quickSearchFormInput.focus();\n            advancedFormVisible = false;\n        }\n    });\n    document.body.addEventListener('click', (e) => {\n        if (advancedFormVisible && !advancedSearchForm.contains(e.target)) {\n            hideAdvancedSearchForm(advancedSearchForm, advancedSearchFormShowButton, quickSearchFormSubmitButton);\n            advancedFormVisible = false;\n        }\n    });\n};\n"],"file":"discussion_search_form.min.js"}