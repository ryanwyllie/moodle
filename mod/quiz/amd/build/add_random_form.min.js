'use strict';define('mod_quiz/add_random_form',['jquery','mod_quiz/random_question_form_preview'],function($,RandomQuestionFormPreview){var SELECTORS={PREVIEW_CONTAINER:'[data-region="random-question-preview-container"]',CATEGORY_FORM_ELEMENT:'[name="category"]',SUBCATEGORY_FORM_ELEMENT:'[name="includesubcategories"]',TAG_IDS_FORM_ELEMENT:'[name="fromtags[]"]'},getCategorySelectValue=function(form){return form.find(SELECTORS.CATEGORY_FORM_ELEMENT).val()},getCategoryId=function(form){var valueString=getCategorySelectValue(form),values=valueString.split(',');return values[0]},isTopLevelCategorySelected=function(form,topCategories){var selectedValue=getCategorySelectValue(form);return-1<topCategories.indexOf(selectedValue)},shouldIncludeSubcategories=function(form,topCategories){return!!isTopLevelCategorySelected(form,topCategories)||form.find(SELECTORS.SUBCATEGORY_FORM_ELEMENT).is(':checked')},getTagIds=function(form){var values=form.find(SELECTORS.TAG_IDS_FORM_ELEMENT).val();return values.map(function(value){var parts=value.split(',');return parts[0]})},reloadQuestionPreview=function(form,contextId,topCategories){var previewContainer=form.find(SELECTORS.PREVIEW_CONTAINER);RandomQuestionFormPreview.reload(previewContainer,getCategoryId(form),shouldIncludeSubcategories(form,topCategories),getTagIds(form),contextId)},isInterestingElement=function(element){return!!(0<element.closest(SELECTORS.CATEGORY_FORM_ELEMENT).length)||!!(0<element.closest(SELECTORS.SUBCATEGORY_FORM_ELEMENT).length)||!!(0<element.closest(SELECTORS.TAG_IDS_FORM_ELEMENT).length)},addEventListeners=function(form,contextId,topCategories){var reloadTimerId=null;form.on('change',function(e){isInterestingElement($(e.target))&&(RandomQuestionFormPreview.showLoadingIcon(form),reloadTimerId&&clearTimeout(reloadTimerId),reloadTimerId=setTimeout(function(){reloadQuestionPreview(form,contextId,topCategories)},2000))})};return{init:function init(formId,contextId,topCategories){var form=$('#'+formId);reloadQuestionPreview(form,contextId,topCategories),addEventListeners(form,contextId,topCategories)}}});
//# sourceMappingURL=add_random_form.min.js.map
