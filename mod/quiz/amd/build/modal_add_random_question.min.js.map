{"version":3,"sources":["../src/modal_add_random_question.js"],"names":["define","$","Y","Notification","Modal","ModalEvents","ModalRegistry","Fragment","Templates","registered","SELECTORS","EXISTING_CATEGORY_CONTAINER","EXISTING_CATEGORY_FORM_ELEMENT","NEW_CATEGORY_CONTAINER","NEW_CATEGORY_FORM_ELEMENT","TAB_CONTENT","ADD_ON_PAGE_FORM_ELEMENT","SUBMIT_BUTTON_ELEMENT","CANCEL_BUTTON_ELEMENT","FORM_HEADER","BUTTON_CONTAINER","ModalAddRandomQuestion","root","call","contextId","addOnPageId","category","returnUrl","cmid","loadedForm","TYPE","prototype","Object","create","constructor","setContextId","id","getContextId","setAddOnPageId","getBody","find","val","getAddOnPageId","setCategory","getCategory","setReturnUrl","url","getReturnUrl","setCMID","getCMID","moveFormElementIntoTab","formElement","tabElement","submitButtons","footer","addClass","wrap","closest","remove","appendTo","moveTabsIntoTabContent","form","tabContent","empty","wrapAll","moveCancelButtonToTabs","cancelButton","tabFooters","clone","loadForm","loadFragment","addonpage","cat","returnurl","then","html","js","existingCategoryFormElement","existingCategoryTab","newCategoryFormElement","newCategoryTab","replaceNode","bind","use","M","core_formchangechecker","reset_form_dirty_state","fail","exception","show","register"],"mappings":"aAuBAA,4CAAO,CACH,QADG,CAEH,UAFG,CAGH,mBAHG,CAIH,YAJG,CAKH,mBALG,CAMH,qBANG,CAOH,eAPG,CAQH,gBARG,CAAP,CAUA,SACIC,CADJ,CAEIC,CAFJ,CAGIC,YAHJ,CAIIC,KAJJ,CAKIC,WALJ,CAMIC,aANJ,CAOIC,QAPJ,CAQIC,SARJ,CASE,IAEMC,cAFN,CAGMC,UAAY,CACZC,4BAA6B,6CADjB,CAEZC,+BAAgC,4BAFpB,CAGZC,uBAAwB,wCAHZ,CAIZC,0BAA2B,uBAJf,CAKZC,YAAa,6BALD,CAMZC,yBAA0B,oBANd,CAOZC,sBAAuB,sBAPX,CAQZC,sBAAuB,qCARX,CASZC,YAAa,QATD,CAUZC,iBAAkB,QAVN,CAHlB,CAqBMC,uBAAyB,SAASC,IAAT,CAAe,CACxClB,MAAMmB,IAAN,CAAW,IAAX,CAAiBD,IAAjB,CADwC,CAExC,KAAKE,SAAL,CAAiB,IAFuB,CAGxC,KAAKC,WAAL,CAAmB,IAHqB,CAIxC,KAAKC,QAAL,CAAgB,IAJwB,CAKxC,KAAKC,SAAL,CAAiB,IALuB,CAMxC,KAAKC,IAAL,CAAY,IAN4B,CAOxC,KAAKC,UAAL,GACH,CA7BH,CA+QE,MAhPAR,wBAAuBS,IAAvB,CAA8B,mCAgP9B,CA/OAT,uBAAuBU,SAAvB,CAAmCC,OAAOC,MAAP,CAAc7B,MAAM2B,SAApB,CA+OnC,CA9OAV,uBAAuBU,SAAvB,CAAiCG,WAAjC,CAA+Cb,sBA8O/C,CArOAA,uBAAuBU,SAAvB,CAAiCI,YAAjC,CAAgD,SAASC,EAAT,CAAa,CACzD,KAAKZ,SAAL,CAAiBY,EACpB,CAmOD,CA3NAf,uBAAuBU,SAAvB,CAAiCM,YAAjC,CAAgD,UAAW,CACvD,MAAO,MAAKb,SACf,CAyND,CAhNAH,uBAAuBU,SAAvB,CAAiCO,cAAjC,CAAkD,SAASF,EAAT,CAAa,CAC3D,KAAKX,WAAL,CAAmBW,EADwC,CAE3D,KAAKG,OAAL,GAAeC,IAAf,CAAoB9B,UAAUM,wBAA9B,EAAwDyB,GAAxD,CAA4DL,EAA5D,CACH,CA6MD,CArMAf,uBAAuBU,SAAvB,CAAiCW,cAAjC,CAAkD,UAAW,CACzD,MAAO,MAAKjB,WACf,CAmMD,CA1LAJ,uBAAuBU,SAAvB,CAAiCY,WAAjC,CAA+C,SAASjB,QAAT,CAAmB,CAC9D,KAAKA,QAAL,CAAgBA,QACnB,CAwLD,CAhLAL,uBAAuBU,SAAvB,CAAiCa,WAAjC,CAA+C,UAAW,CACtD,MAAO,MAAKlB,QACf,CA8KD,CAtKAL,uBAAuBU,SAAvB,CAAiCc,YAAjC,CAAgD,SAASC,GAAT,CAAc,CAC1D,KAAKnB,SAAL,CAAiBmB,GACpB,CAoKD,CA5JAzB,uBAAuBU,SAAvB,CAAiCgB,YAAjC,CAAgD,UAAW,CACvD,MAAO,MAAKpB,SACf,CA0JD,CAlJAN,uBAAuBU,SAAvB,CAAiCiB,OAAjC,CAA2C,SAASZ,EAAT,CAAa,CACpD,KAAKR,IAAL,CAAYQ,EACf,CAgJD,CAxIAf,uBAAuBU,SAAvB,CAAiCkB,OAAjC,CAA2C,UAAW,CAClD,MAAO,MAAKrB,IACf,CAsID,CAvHAP,uBAAuBU,SAAvB,CAAiCmB,sBAAjC,CAA0D,SAASC,WAAT,CAAsBC,UAAtB,CAAkC,IACpFC,eAAgBF,YAAYX,IAAZ,CAAiB9B,UAAUO,qBAA3B,CADoE,CAEpFqC,OAASrD,EAAE,6DAAF,CAF2E,CAKxFkD,YAAYX,IAAZ,CAAiB9B,UAAUS,WAA3B,EAAwCoC,QAAxC,CAAiD,QAAjD,CALwF,CAOxFJ,YAAYK,IAAZ,CAAiBJ,UAAjB,CAPwF,CASxFC,cAAcI,OAAd,CAAsB/C,UAAUU,gBAAhC,EAAkDsC,MAAlD,EATwF,CAWxFL,cAAcM,QAAd,CAAuBL,MAAvB,CAXwF,CAaxFA,OAAOK,QAAP,CAAgBR,WAAhB,CACH,CAyGD,CAhGA9B,uBAAuBU,SAAvB,CAAiC6B,sBAAjC,CAA0D,SAASC,IAAT,CAAe,CAErE,GAAIC,YAAa,KAAKvB,OAAL,GAAeC,IAAf,CAAoB9B,UAAUK,WAA9B,EAA2CgD,KAA3C,EAAjB,CAEAF,KAAKrB,IAAL,CAAU,mBAAV,EAA+BwB,OAA/B,CAAuCF,UAAvC,CACH,CA2FD,CAlFAzC,uBAAuBU,SAAvB,CAAiCkC,sBAAjC,CAA0D,SAASJ,IAAT,CAAe,IACjEK,cAAeL,KAAKrB,IAAL,CAAU9B,UAAUQ,qBAApB,EAA2CqC,QAA3C,CAAoD,OAApD,CADkD,CAEjEY,WAAaN,KAAKrB,IAAL,CAAU,wBAAV,CAFoD,CAIrE0B,aAAaT,OAAb,CAAqB/C,UAAUU,gBAA/B,EAAiDsC,MAAjD,EAJqE,CAKrEQ,aAAaE,KAAb,GAAqBT,QAArB,CAA8BQ,UAA9B,CACH,CA4ED,CAnEA9C,uBAAuBU,SAAvB,CAAiCsC,QAAjC,CAA4C,UAAW,CACnD,MAAO9D,UAAS+D,YAAT,CACH,UADG,CAEH,0BAFG,CAGH,KAAKjC,YAAL,EAHG,CAIH,CACIkC,UAAW,KAAK7B,cAAL,EADf,CAEI8B,IAAK,KAAK5B,WAAL,EAFT,CAGI6B,UAAW,KAAK1B,YAAL,EAHf,CAIInB,KAAM,KAAKqB,OAAL,EAJV,CAJG,EAWNyB,IAXM,CAWD,SAASC,IAAT,CAAeC,EAAf,CAAmB,IACjBf,MAAO5D,EAAE0E,IAAF,CADU,CAEjBE,4BAA8BhB,KAAKrB,IAAL,CAAU9B,UAAUE,8BAApB,CAFb,CAGjBkE,oBAAsB,KAAKvC,OAAL,GAAeC,IAAf,CAAoB9B,UAAUC,2BAA9B,CAHL,CAIjBoE,uBAAyBlB,KAAKrB,IAAL,CAAU9B,UAAUI,yBAApB,CAJR,CAKjBkE,eAAiB,KAAKzC,OAAL,GAAeC,IAAf,CAAoB9B,UAAUG,sBAA9B,CALA,CAcrB,MANA,MAAKqC,sBAAL,CAA4B2B,2BAA5B,CAAyDC,mBAAzD,CAMA,CALA,KAAK5B,sBAAL,CAA4B6B,sBAA5B,CAAoDC,cAApD,CAKA,CAJA,KAAKpB,sBAAL,CAA4BC,IAA5B,CAIA,CAHA,KAAKI,sBAAL,CAA4BJ,IAA5B,CAGA,KADArD,WAAUyE,WAAV,CAAsB,KAAK1C,OAAL,GAAeC,IAAf,CAAoB9B,UAAUK,WAA9B,CAAtB,CAAkE8C,IAAlE,CAAwEe,EAAxE,CAEH,CAfK,CAeJM,IAfI,CAeC,IAfD,CAXC,EA2BNR,IA3BM,CA2BD,UAAW,CAIbxE,EAAEiF,GAAF,CAAM,+BAAN,CAAuC,UAAW,CAC9CC,EAAEC,sBAAF,CAAyBC,sBAAzB,EACH,CAFD,CAIH,CAnCM,EAoCNC,IApCM,CAoCDpF,aAAaqF,SApCZ,CAqCV,CA6BD,CArBAnE,uBAAuBU,SAAvB,CAAiC0D,IAAjC,CAAwC,UAAW,CAC/CrF,MAAM2B,SAAN,CAAgB0D,IAAhB,CAAqBlE,IAArB,CAA0B,IAA1B,CAD+C,CAG1C,KAAKM,UAHqC,GAI3C,KAAKwC,QAAL,EAJ2C,CAK3C,KAAKxC,UAAL,GAL2C,CAOlD,CAcD,CAVKpB,UAUL,GATIH,cAAcoF,QAAd,CACIrE,uBAAuBS,IAD3B,CAEIT,sBAFJ,CAGI,oCAHJ,CASJ,CAHIZ,aAGJ,EAAOY,sBACV,CAnSD,C","file":"modal_add_random_question.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for the add random question modal.\n *\n * @module     mod_quiz/modal_add_random_question\n * @package    mod_quiz\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/yui',\n    'core/notification',\n    'core/modal',\n    'core/modal_events',\n    'core/modal_registry',\n    'core/fragment',\n    'core/templates',\n],\nfunction(\n    $,\n    Y,\n    Notification,\n    Modal,\n    ModalEvents,\n    ModalRegistry,\n    Fragment,\n    Templates\n) {\n\n    var registered = false;\n    var SELECTORS = {\n        EXISTING_CATEGORY_CONTAINER: '[data-region=\"existing-category-container\"]',\n        EXISTING_CATEGORY_FORM_ELEMENT: '#id_existingcategoryheader',\n        NEW_CATEGORY_CONTAINER: '[data-region=\"new-category-container\"]',\n        NEW_CATEGORY_FORM_ELEMENT: '#id_newcategoryheader',\n        TAB_CONTENT: '[data-region=\"tab-content\"]',\n        ADD_ON_PAGE_FORM_ELEMENT: '[name=\"addonpage\"]',\n        SUBMIT_BUTTON_ELEMENT: 'input[type=\"submit\"]',\n        CANCEL_BUTTON_ELEMENT: 'input[type=\"submit\"][name=\"cancel\"]',\n        FORM_HEADER: 'legend',\n        BUTTON_CONTAINER: '.fitem'\n    };\n\n    /**\n     * Constructor for the Modal.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var ModalAddRandomQuestion = function(root) {\n        Modal.call(this, root);\n        this.contextId = null;\n        this.addOnPageId = null;\n        this.category = null;\n        this.returnUrl = null;\n        this.cmid = null;\n        this.loadedForm = false;\n    };\n\n    ModalAddRandomQuestion.TYPE = 'mod_quiz-quiz-add-random-question';\n    ModalAddRandomQuestion.prototype = Object.create(Modal.prototype);\n    ModalAddRandomQuestion.prototype.constructor = ModalAddRandomQuestion;\n\n    /**\n     * Save the Moodle context id that the question bank is being\n     * rendered in.\n     *\n     * @method setContextId\n     * @param {int} id\n     */\n    ModalAddRandomQuestion.prototype.setContextId = function(id) {\n        this.contextId = id;\n    };\n\n    /**\n     * Retrieve the saved Moodle context id.\n     *\n     * @method getContextId\n     * @return {int}\n     */\n    ModalAddRandomQuestion.prototype.getContextId = function() {\n        return this.contextId;\n    };\n\n    /**\n     * Set the id of the page that the question should be added to\n     * when the user clicks the add to quiz link.\n     *\n     * @method setAddOnPageId\n     * @param {int} id\n     */\n    ModalAddRandomQuestion.prototype.setAddOnPageId = function(id) {\n        this.addOnPageId = id;\n        this.getBody().find(SELECTORS.ADD_ON_PAGE_FORM_ELEMENT).val(id);\n    };\n\n    /**\n     * Returns the saved page id for the question to be added to.\n     *\n     * @method getAddOnPageId\n     * @return {int}\n     */\n    ModalAddRandomQuestion.prototype.getAddOnPageId = function() {\n        return this.addOnPageId;\n    };\n\n    /**\n     * Set the category for this form. The category is a comma separated\n     * category id and category context id.\n     *\n     * @method setCategory\n     * @param {string} category\n     */\n    ModalAddRandomQuestion.prototype.setCategory = function(category) {\n        this.category = category;\n    };\n\n    /**\n     * Returns the saved category.\n     *\n     * @method getCategory\n     * @return {string}\n     */\n    ModalAddRandomQuestion.prototype.getCategory = function() {\n        return this.category;\n    };\n\n    /**\n     * Set the return URL for the form.\n     *\n     * @method setReturnUrl\n     * @param {string} url\n     */\n    ModalAddRandomQuestion.prototype.setReturnUrl = function(url) {\n        this.returnUrl = url;\n    };\n\n    /**\n     * Returns the return URL for the form.\n     *\n     * @method getReturnUrl\n     * @return {string}\n     */\n    ModalAddRandomQuestion.prototype.getReturnUrl = function() {\n        return this.returnUrl;\n    };\n\n    /**\n     * Set the course module id for the form.\n     *\n     * @method setCMID\n     * @param {int} id\n     */\n    ModalAddRandomQuestion.prototype.setCMID = function(id) {\n        this.cmid = id;\n    };\n\n    /**\n     * Returns the course module id for the form.\n     *\n     * @method getCMID\n     * @return {int}\n     */\n    ModalAddRandomQuestion.prototype.getCMID = function() {\n        return this.cmid;\n    };\n\n    /**\n     * Moves a given form element inside (a child of) a given tab element.\n     *\n     * Hides the 'legend' (e.g. header) element of the form element because the\n     * tab has the name.\n     *\n     * Moves the submit button into a footer element at the bottom of the form\n     * element for styling purposes.\n     *\n     * @method moveFormElementIntoTab\n     * @param  {jquery} formElement The form element to move into the tab.\n     * @param  {jquey} tabElement The tab element for the form element to move into.\n     */\n    ModalAddRandomQuestion.prototype.moveFormElementIntoTab = function(formElement, tabElement) {\n        var submitButtons = formElement.find(SELECTORS.SUBMIT_BUTTON_ELEMENT);\n        var footer = $('<div class=\"modal-footer m-t-1\" data-region=\"footer\"></div>');\n        // Hide the header because the tabs show us which part of the form we're\n        // looking at.\n        formElement.find(SELECTORS.FORM_HEADER).addClass('hidden');\n        // Move the element inside a tab.\n        formElement.wrap(tabElement);\n        // Remove the buttons container element.\n        submitButtons.closest(SELECTORS.BUTTON_CONTAINER).remove();\n        // Put the button inside a footer.\n        submitButtons.appendTo(footer);\n        // Add the footer to the end of the category form element.\n        footer.appendTo(formElement);\n    };\n\n    /**\n     * Empty the tab content container and move all tabs from the form into the\n     * tab container element.\n     *\n     * @method moveTabsIntoTabContent\n     * @param  {jquery} form The form element.\n     */\n    ModalAddRandomQuestion.prototype.moveTabsIntoTabContent = function(form) {\n        // Empty it to remove the loading icon.\n        var tabContent = this.getBody().find(SELECTORS.TAB_CONTENT).empty();\n        // Make sure all tabs are inside the tab content element.\n        form.find('[role=\"tabpanel\"]').wrapAll(tabContent);\n    };\n\n    /**\n     * Make sure all of the tabs have a cancel button in their fotter to sit along\n     * side the submit button.\n     *\n     * @method moveCancelButtonToTabs\n     * @param  {jquey} form The form element.\n     */\n    ModalAddRandomQuestion.prototype.moveCancelButtonToTabs = function(form) {\n        var cancelButton = form.find(SELECTORS.CANCEL_BUTTON_ELEMENT).addClass('m-l-1');\n        var tabFooters = form.find('[data-region=\"footer\"]');\n        // Remove the buttons container element.\n        cancelButton.closest(SELECTORS.BUTTON_CONTAINER).remove();\n        cancelButton.clone().appendTo(tabFooters);\n    };\n\n    /**\n     * Load the add random question form in a fragement and perform some transformation\n     * on the HTML to convert it into tabs for rendering in the modal.\n     *\n     * @method loadForm\n     * @return {promise} Resolved with form HTML and JS.\n     */\n    ModalAddRandomQuestion.prototype.loadForm = function() {\n        return Fragment.loadFragment(\n            'mod_quiz',\n            'add_random_question_form',\n            this.getContextId(),\n            {\n                addonpage: this.getAddOnPageId(),\n                cat: this.getCategory(),\n                returnurl: this.getReturnUrl(),\n                cmid: this.getCMID()\n            }\n        )\n        .then(function(html, js) {\n            var form = $(html);\n            var existingCategoryFormElement = form.find(SELECTORS.EXISTING_CATEGORY_FORM_ELEMENT);\n            var existingCategoryTab = this.getBody().find(SELECTORS.EXISTING_CATEGORY_CONTAINER);\n            var newCategoryFormElement = form.find(SELECTORS.NEW_CATEGORY_FORM_ELEMENT);\n            var newCategoryTab = this.getBody().find(SELECTORS.NEW_CATEGORY_CONTAINER);\n\n            // Transform the form into tabs for better rendering in the modal.\n            this.moveFormElementIntoTab(existingCategoryFormElement, existingCategoryTab);\n            this.moveFormElementIntoTab(newCategoryFormElement, newCategoryTab);\n            this.moveTabsIntoTabContent(form);\n            this.moveCancelButtonToTabs(form);\n\n            Templates.replaceNode(this.getBody().find(SELECTORS.TAB_CONTENT), form, js);\n            return;\n        }.bind(this))\n        .then(function() {\n            // Make sure the form change checker is disabled otherwise it'll\n            // stop the user from navigating away from the page once the modal\n            // is hidden.\n            Y.use('moodle-core-formchangechecker', function() {\n                M.core_formchangechecker.reset_form_dirty_state();\n            });\n            return;\n        })\n        .fail(Notification.exception);\n    };\n\n    /**\n     * Override the modal show function to load the form when this modal is first\n     * shown.\n     *\n     * @method show\n     */\n    ModalAddRandomQuestion.prototype.show = function() {\n        Modal.prototype.show.call(this);\n\n        if (!this.loadedForm) {\n            this.loadForm();\n            this.loadedForm = true;\n        }\n    };\n\n    // Automatically register with the modal registry the first time this module is\n    // imported so that you can create modals of this type using the modal factory.\n    if (!registered) {\n        ModalRegistry.register(\n            ModalAddRandomQuestion.TYPE,\n            ModalAddRandomQuestion,\n            'mod_quiz/modal_add_random_question'\n        );\n\n        registered = true;\n    }\n\n    return ModalAddRandomQuestion;\n});\n"]}