'use strict';define('mod_lti/tool_proxy_card_controller',['jquery','core/ajax','core/notification','core/templates','mod_lti/tool_proxy','mod_lti/events','mod_lti/keys','core/str'],function($,ajax,notification,templates,toolProxy,ltiEvents,KEYS,str){var SELECTORS={DELETE_BUTTON:'.delete',CAPABILITIES_CONTAINER:'.capabilities-container',ACTIVATE_BUTTON:'.tool-card-footer a.activate'},getDeleteButton=function(element){return element.find(SELECTORS.DELETE_BUTTON)},getActivateButton=function(element){return element.find(SELECTORS.ACTIVATE_BUTTON)},getTypeId=function(element){return element.attr('data-proxy-id')},clearAllAnnouncements=function(element){element.removeClass('announcement loading success fail capabilities')},startLoading=function(element){clearAllAnnouncements(element),element.addClass('announcement loading')},stopLoading=function(element){element.removeClass('announcement loading')},announceSuccess=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass('announcement success'),setTimeout(function(){element.removeClass('announcement success'),promise.resolve()},2000),promise},announceFailure=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass('announcement fail'),setTimeout(function(){element.removeClass('announcement fail'),promise.resolve()},2000),promise},deleteType=function(element){var promise=$.Deferred(),typeId=getTypeId(element);return(startLoading(element),''===typeId)?$.Deferred().resolve():(str.get_strings([{key:'delete',component:'mod_lti'},{key:'delete_confirmation',component:'mod_lti'},{key:'delete',component:'mod_lti'},{key:'cancel',component:'core'}]).done(function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],function(){toolProxy.delete(typeId).done(function(){stopLoading(element),announceSuccess(element).done(function(){element.remove(),promise.resolve()}).fail(notification.exception)}).fail(function(error){announceFailure(element),promise.reject(error)})},function(){stopLoading(element),promise.resolve()})}).fail(function(error){stopLoading(element),notification.exception(error),promise.reject(error)}),promise)},activateToolType=function(element){var data={proxyid:getTypeId(element)};$(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION,data)},registerEventListeners=function(element){var deleteButton=getDeleteButton(element);deleteButton.click(function(e){e.preventDefault(),deleteType(element)}),deleteButton.keypress(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),deleteButton.click())});var activateButton=getActivateButton(element);activateButton.click(function(e){e.preventDefault(),activateToolType(element)}),activateButton.keypress(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),activateButton.click())})};return{init:function init(element){registerEventListeners(element)}}});
//# sourceMappingURL=tool_proxy_card_controller.min.js.map
