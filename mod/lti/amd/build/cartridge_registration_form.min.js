'use strict';define('mod_lti/cartridge_registration_form',['jquery','core/ajax','core/notification','mod_lti/tool_type','mod_lti/events','mod_lti/keys','core/str'],function($,ajax,notification,toolType,ltiEvents,KEYS,str){var SELECTORS={CARTRIDGE_URL:'#cartridge-url',CONSUMER_KEY:'#registration-key',SHARED_SECRET:'#registration-secret',REGISTRATION_FORM:'#cartridge-registration-form',REGISTRATION_SUBMIT_BUTTON:'#cartridge-registration-submit',REGISTRATION_CANCEL_BUTTON:'#cartridge-registration-cancel'},getCartridgeURL=function(){return $(SELECTORS.REGISTRATION_FORM).attr('data-cartridge-url')},getSubmitButton=function(){return $(SELECTORS.REGISTRATION_SUBMIT_BUTTON)},getCancelButton=function(){return $(SELECTORS.REGISTRATION_CANCEL_BUTTON)},getConsumerKey=function(){return $(SELECTORS.CONSUMER_KEY).val()},getSharedSecret=function(){return $(SELECTORS.SHARED_SECRET).val()},startLoading=function(){getSubmitButton().addClass('loading')},stopLoading=function(){getSubmitButton().removeClass('loading')},isLoading=function(){return getSubmitButton().hasClass('loading')},submitCartridgeURL=function(){if(isLoading())return!1;var url=getCartridgeURL();if(''===url)return!1;startLoading();var consumerKey=getConsumerKey(),sharedSecret=getSharedSecret(),promise=toolType.create({cartridgeurl:url,key:consumerKey,secret:sharedSecret});return promise.done(function(){str.get_string('successfullycreatedtooltype','mod_lti').done(function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s})}).fail(notification.exception)}).fail(function(){str.get_string('failedtocreatetooltype','mod_lti').done(function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s,error:!0})}).fail(notification.exception)}).always(function(){stopLoading()}),promise},registerEventListeners=function(){var form=$(SELECTORS.REGISTRATION_FORM);form.submit(function(e){e.preventDefault(),submitCartridgeURL()});var cancelButton=getCancelButton();cancelButton.click(function(e){e.preventDefault(),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION)}),cancelButton.keypress(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),cancelButton.click())})};return{init:function init(){registerEventListeners()}}});
//# sourceMappingURL=cartridge_registration_form.min.js.map
