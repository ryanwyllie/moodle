{"version":3,"sources":["../src/grading_navigation.js"],"names":["define","$","notification","str","autocomplete","ajax","checker","GradingNavigation","selector","_regionSelector","_region","_filters","_users","_filteredUsers","_loadAllUsers","find","on","_handlePreviousUser","bind","_handleNextUser","_handleChangeUser","_toggleExpandFilters","document","_refreshSelector","toggleLink","configPanel","getElementById","attr","_filterChanged","userid","data","_selectUserById","get_string","done","s","enhance","fail","exception","_isLoading","prototype","select","assignmentid","groupid","call","methodname","args","assignid","filter","onlyids","_usersLoaded","users","length","trigger","_selectNoUser","_triggerNextUserEvent","_checkClickOutsideConfigureFilters","event","is","target","has","hide","unbind","name","key","split","pop","enabled","prop","indexOf","index","splice","filterlist","each","idx","ele","closest","text","join","foundIndex","user","show","filterindex","submitted","requiregrading","grantedextension","id","checkFormForChanges","get_strings","component","strs","confirm","useridnumber","parseInt","isNaN","preventDefault","expanded","css","stopPropagation","e","currentUserId","i","currentIndex","count","newIndex","saved","_refreshCount","param","x","y","nextUserId","nextUser","val"],"mappings":"aAwBAA,uCAAO,CAAC,QAAD,CAAW,mBAAX,CAAgC,UAAhC,CAA4C,wBAA5C,CACC,WADD,CACc,wCADd,CAAP,CAEO,SAASC,CAAT,CAAYC,YAAZ,CAA0BC,GAA1B,CAA+BC,YAA/B,CAA6CC,IAA7C,CAAmDC,OAAnD,CAA4D,CAQ/D,GAAIC,mBAAoB,SAASC,QAAT,CAAmB,CACvC,KAAKC,eAAL,CAAuBD,QADgB,CAEvC,KAAKE,OAAL,CAAeT,EAAEO,QAAF,CAFwB,CAGvC,KAAKG,QAAL,CAAgB,EAHuB,CAIvC,KAAKC,MAAL,CAAc,EAJyB,CAKvC,KAAKC,cAAL,CAAsB,EALiB,CAQvC,KAAKC,aAAL,EARuC,CAYvC,KAAKJ,OAAL,CAAaK,IAAb,CAAkB,+BAAlB,EAAmDC,EAAnD,CAAsD,OAAtD,CAA+D,KAAKC,mBAAL,CAAyBC,IAAzB,CAA8B,IAA9B,CAA/D,CAZuC,CAavC,KAAKR,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,EAA+CC,EAA/C,CAAkD,OAAlD,CAA2D,KAAKG,eAAL,CAAqBD,IAArB,CAA0B,IAA1B,CAA3D,CAbuC,CAcvC,KAAKR,OAAL,CAAaK,IAAb,CAAkB,6BAAlB,EAAiDC,EAAjD,CAAoD,QAApD,CAA8D,KAAKI,iBAAL,CAAuBF,IAAvB,CAA4B,IAA5B,CAA9D,CAduC,CAevC,KAAKR,OAAL,CAAaK,IAAb,CAAkB,8BAAlB,EAAkDC,EAAlD,CAAqD,OAArD,CAA8D,KAAKK,oBAAL,CAA0BH,IAA1B,CAA+B,IAA/B,CAA9D,CAfuC,CAiBvCjB,EAAEqB,QAAF,EAAYN,EAAZ,CAAe,cAAf,CAA+B,KAAKO,gBAAL,CAAsBL,IAAtB,CAA2B,IAA3B,CAA/B,CAjBuC,CAkBvCjB,EAAEqB,QAAF,EAAYN,EAAZ,CAAe,uBAAf,CAAwC,KAAKG,eAAL,CAAqBD,IAArB,CAA0B,IAA1B,CAAxC,CAlBuC,IAqBnCM,YAAa,KAAKd,OAAL,CAAaK,IAAb,CAAkB,8BAAlB,CArBsB,CAsBnCU,YAAcxB,EAAEqB,SAASI,cAAT,CAAwBF,WAAWG,IAAX,CAAgB,eAAhB,CAAxB,CAAF,CAtBqB,CAwBvCF,YAAYT,EAAZ,CAAe,QAAf,CAAyB,mBAAzB,CAA8C,KAAKY,cAAL,CAAoBV,IAApB,CAAyB,IAAzB,CAA9C,CAxBuC,CA0BvC,GAAIW,QAAS5B,EAAE,0CAAF,EAA8C6B,IAA9C,CAAmD,cAAnD,CAAb,CACID,MA3BmC,EA4BnC,KAAKE,eAAL,CAAqBF,MAArB,CA5BmC,CA+BvC1B,IAAI6B,UAAJ,CAAe,YAAf,CAA6B,YAA7B,EAA2CC,IAA3C,CAAgD,SAASC,CAAT,CAAY,CACpD9B,aAAa+B,OAAb,CAAqB,2BAArB,IAAyD,iCAAzD,CAA4FD,CAA5F,CACH,CAFL,EAGEE,IAHF,CAGOlC,aAAamC,SAHpB,CA/BuC,CAsCvCpC,EAAEqB,QAAF,EAAYJ,IAAZ,CAAiB,oBAAjB,CAAuC,UAAW,CAC9C,KAAKoB,UAAL,GACH,CAFsC,CAErCpB,IAFqC,CAEhC,IAFgC,CAAvC,CAtCuC,CAyCvCjB,EAAEqB,QAAF,EAAYJ,IAAZ,CAAiB,qBAAjB,CAAwC,UAAW,CAC/C,KAAKoB,UAAL,GACH,CAFuC,CAEtCpB,IAFsC,CAEjC,IAFiC,CAAxC,CAGH,CA5CD,CAkdA,MAnaAX,mBAAkBgC,SAAlB,CAA4BD,UAA5B,GAmaA,CAhaA/B,kBAAkBgC,SAAlB,CAA4B9B,eAA5B,CAA8C,IAga9C,CA7ZAF,kBAAkBgC,SAAlB,CAA4B5B,QAA5B,CAAuC,IA6ZvC,CA1ZAJ,kBAAkBgC,SAAlB,CAA4B3B,MAA5B,CAAqC,IA0ZrC,CAvZAL,kBAAkBgC,SAAlB,CAA4B7B,OAA5B,CAAsC,IAuZtC,CA/YAH,kBAAkBgC,SAAlB,CAA4BzB,aAA5B,CAA4C,UAAW,IAC/C0B,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CADsC,CAE/C0B,aAAeD,OAAOb,IAAP,CAAY,mBAAZ,CAFgC,CAG/Ce,QAAUF,OAAOb,IAAP,CAAY,cAAZ,CAHqC,CAKnDtB,KAAKsC,IAAL,CAAU,CAAC,CACPC,WAAY,8BADL,CAEPC,KAAM,CAACC,SAAUL,YAAX,CAAyBC,QAASA,OAAlC,CAA2CK,OAAQ,EAAnD,CAAuDC,UAAvD,CAFC,CAGPf,KAAM,KAAKgB,YAAL,CAAkB/B,IAAlB,CAAuB,IAAvB,CAHC,CAIPkB,KAAMlC,aAAamC,SAJZ,CAAD,CAAV,CAMH,CAoYD,CA3XA9B,kBAAkBgC,SAAlB,CAA4BU,YAA5B,CAA2C,SAASC,KAAT,CAAgB,CAEvD,GADA,KAAKrC,cAAL,CAAsB,KAAKD,MAAL,CAAcsC,KACpC,CAAI,KAAKtC,MAAL,CAAYuC,MAAhB,CAAwB,IAEhB3B,YAAa,KAAKd,OAAL,CAAaK,IAAb,CAAkB,8BAAlB,CAFG,CAGhBU,YAAcxB,EAAEqB,SAASI,cAAT,CAAwBF,WAAWG,IAAX,CAAgB,eAAhB,CAAxB,CAAF,CAHE,CAKpBF,YAAYV,IAAZ,CAAiB,mBAAjB,EAAsCqC,OAAtC,CAA8C,QAA9C,CACH,CAND,IAOI,MAAKC,aAAL,EAPJ,CASA,KAAKC,qBAAL,EACH,CA+WD,CAtWA/C,kBAAkBgC,SAAlB,CAA4BgB,kCAA5B,CAAiE,SAASC,KAAT,CAAgB,CAC7E,GAAI/B,aAAc,KAAKf,OAAL,CAAaK,IAAb,CAAkB,mCAAlB,CAAlB,CAEA,GAAI,CAACU,YAAYgC,EAAZ,CAAeD,MAAME,MAArB,CAAD,EAA0E,CAAzC,eAAYC,GAAZ,CAAgBH,MAAME,MAAtB,EAA8BP,MAAnE,CAAiF,CAC7E,GAAI3B,YAAa,KAAKd,OAAL,CAAaK,IAAb,CAAkB,8BAAlB,CAAjB,CAEAU,YAAYmC,IAAZ,EAH6E,CAI7EnC,YAAYE,IAAZ,CAAiB,aAAjB,CAAgC,MAAhC,CAJ6E,CAK7EH,WAAWG,IAAX,CAAgB,eAAhB,CAAiC,OAAjC,CAL6E,CAM7E1B,EAAEqB,QAAF,EAAYuC,MAAZ,CAAmB,qCAAnB,CACH,CACJ,CA2VD,CAlVAtD,kBAAkBgC,SAAlB,CAA4BX,cAA5B,CAA6C,SAAS4B,KAAT,CAAgB,IACrDM,MAAO7D,EAAEuD,MAAME,MAAR,EAAgB/B,IAAhB,CAAqB,MAArB,CAD8C,CAErDoC,IAAMD,KAAKE,KAAL,CAAW,GAAX,EAAgBC,GAAhB,EAF+C,CAGrDC,QAAUjE,EAAEuD,MAAME,MAAR,EAAgBS,IAAhB,CAAqB,SAArB,CAH2C,CAKzD,GAAID,OAAJ,CACsC,CAAC,CAA/B,OAAKvD,QAAL,CAAcyD,OAAd,CAAsBL,GAAtB,CADR,GAEQ,KAAKpD,QAAL,CAAc,KAAKA,QAAL,CAAcwC,MAA5B,EAAsCY,GAF9C,MAIO,CACH,GAAIM,OAAQ,KAAK1D,QAAL,CAAcyD,OAAd,CAAsBL,GAAtB,CAAZ,CACa,CAAC,CAAV,OAFD,EAGC,KAAKpD,QAAL,CAAc2D,MAAd,CAAqBD,KAArB,CAA4B,CAA5B,CAEP,CAGD,GAAIE,YAAa,EAAjB,CACA,KAAK7D,OAAL,CAAaK,IAAb,CAAkB,mCAAlB,EAAuDA,IAAvD,CAA4D,mBAA5D,EAAiFyD,IAAjF,CAAsF,SAASC,GAAT,CAAcC,GAAd,CAAmB,CACjGzE,EAAEyE,GAAF,EAAOP,IAAP,CAAY,SAAZ,CADiG,GAEjGI,WAAWA,WAAWpB,MAAtB,EAAgClD,EAAEyE,GAAF,EAAOC,OAAP,CAAe,OAAf,EAAwBC,IAAxB,EAFiE,CAIxG,CAJD,CAlByD,CAuBrDL,WAAWpB,MAvB0C,CAwBrD,KAAKzC,OAAL,CAAaK,IAAb,CAAkB,mCAAlB,EAAuD6D,IAAvD,CAA4DL,WAAWM,IAAX,CAAgB,IAAhB,CAA5D,CAxBqD,CA0BrD1E,IAAI6B,UAAJ,CAAe,WAAf,CAA4B,YAA5B,EAA0CC,IAA1C,CAA+C,SAASC,CAAT,CAAY,CACvD,KAAKxB,OAAL,CAAaK,IAAb,CAAkB,mCAAlB,EAAuD6D,IAAvD,CAA4D1C,CAA5D,CACH,CAF8C,CAE7ChB,IAF6C,CAExC,IAFwC,CAA/C,EAEckB,IAFd,CAEmBlC,aAAamC,SAFhC,CA1BqD,IAiCrDG,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAjC4C,CAkCrDc,OAASW,OAAOb,IAAP,CAAY,eAAZ,CAlC4C,CAmCrDmD,WAAa,CAnCwC,CAqCzD,KAAKjE,cAAL,CAAsB,EArCmC,CAuCzDZ,EAAEuE,IAAF,CAAO,KAAK5D,MAAZ,CAAoB,SAASyD,KAAT,CAAgBU,IAAhB,CAAsB,CACtC,GAAIC,QAAJ,CACA/E,EAAEuE,IAAF,CAAO,KAAK7D,QAAZ,CAAsB,SAASsE,WAAT,CAAsBlC,MAAtB,CAA8B,CAClC,WAAV,QAD4C,CAEtB,GAAlB,OAAKmC,SAFmC,GAGxCF,OAHwC,EAK3B,cAAV,QALqC,CAMtB,GAAlB,OAAKE,SANmC,GAOxCF,OAPwC,EAS3B,gBAAV,QATqC,CAUjB,GAAvB,OAAKG,cAVmC,GAWxCH,OAXwC,EAa3B,kBAAV,QAbqC,EAcf,GAAzB,OAAKI,gBAdmC,GAexCJ,OAfwC,CAkBnD,CAlBD,CAFsC,CAsBlCA,IAtBkC,GAuBlC,KAAKnE,cAAL,CAAoB,KAAKA,cAAL,CAAoBsC,MAAxC,EAAkD4B,IAvBhB,CAwB9BlD,QAAUkD,KAAKM,EAxBe,GAyB9BP,WAAc,KAAKjE,cAAL,CAAoBsC,MAApB,CAA6B,CAzBb,EA4BzC,CA5BmB,CA4BlBjC,IA5BkB,CA4Bb,IA5Ba,CAApB,CAvCyD,CAqErD,KAAKL,cAAL,CAAoBsC,MArEiC,CAsErD,KAAKpB,eAAL,CAAqB,KAAKlB,cAAL,CAAoBiE,UAApB,EAAgCO,EAArD,CAtEqD,CAwErD,KAAKhC,aAAL,EAxEqD,CA0EzD,KAAKC,qBAAL,EACH,CAuQD,CA/PA/C,kBAAkBgC,SAAlB,CAA4Bc,aAA5B,CAA4C,UAAW,CAE/C,KAAKf,UAF0C,GAK/ChC,QAAQgF,mBAAR,CAA4B,wCAA5B,CAL+C,CAO/CnF,IAAIoF,WAAJ,CAAgB,CACZ,CAACxB,IAAK,gBAAN,CAAwByB,UAAW,YAAnC,CADY,CAEZ,CAACzB,IAAK,wBAAN,CAAgCyB,UAAW,YAA3C,CAFY,CAGZ,CAACzB,IAAK,iBAAN,CAAyByB,UAAW,YAApC,CAHY,CAIZ,CAACzB,IAAK,QAAN,CAAgByB,UAAW,MAA3B,CAJY,CAAhB,EAKGvD,IALH,CAKQ,SAASwD,IAAT,CAAe,CACnBvF,aAAawF,OAAb,CAAqBD,KAAK,CAAL,CAArB,CAA8BA,KAAK,CAAL,CAA9B,CAAuCA,KAAK,CAAL,CAAvC,CAAgDA,KAAK,CAAL,CAAhD,CAAyD,UAAW,CAChExF,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoC,CAAC,CAArC,CACH,CAFD,CAGH,CATD,CAP+C,CAkB/CnD,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoC,CAAC,CAArC,CAlB+C,CAoBtD,CA2OD,CAlOA7C,kBAAkBgC,SAAlB,CAA4BR,eAA5B,CAA8C,SAASF,MAAT,CAAiB,IACvDW,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAD8C,CAEvD4E,aAAeC,SAAS/D,MAAT,CAAiB,EAAjB,CAFwC,CAKvD,KAAKS,UALkD,GAQvDhC,QAAQgF,mBAAR,CAA4B,wCAA5B,CARuD,CAUvDnF,IAAIoF,WAAJ,CAAgB,CACZ,CAACxB,IAAK,gBAAN,CAAwByB,UAAW,YAAnC,CADY,CAEZ,CAACzB,IAAK,wBAAN,CAAgCyB,UAAW,YAA3C,CAFY,CAGZ,CAACzB,IAAK,iBAAN,CAAyByB,UAAW,YAApC,CAHY,CAIZ,CAACzB,IAAK,QAAN,CAAgByB,UAAW,MAA3B,CAJY,CAAhB,EAKGvD,IALH,CAKQ,SAASwD,IAAT,CAAe,CACnBvF,aAAawF,OAAb,CAAqBD,KAAK,CAAL,CAArB,CAA8BA,KAAK,CAAL,CAA9B,CAAuCA,KAAK,CAAL,CAAvC,CAAgDA,KAAK,CAAL,CAAhD,CAAyD,UAAW,CAChExF,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoCuC,YAApC,CACH,CAFD,CAGH,CATD,CAVuD,EAqBvDnD,OAAOb,IAAP,CAAY,eAAZ,CAA6BE,MAA7B,CArBuD,CAuBnD,CAACgE,MAAMF,YAAN,CAAD,EAAuC,CAAf,aAvB2B,EAwBnD1F,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoCvB,MAApC,CAxBmD,EA2B9D,CAuMD,CA9LAtB,kBAAkBgC,SAAlB,CAA4BlB,oBAA5B,CAAmD,SAASmC,KAAT,CAAgB,CAC/DA,MAAMsC,cAAN,EAD+D,IAE3DtE,YAAavB,EAAEuD,MAAME,MAAR,EAAgBiB,OAAhB,CAAwB,8BAAxB,CAF8C,CAG3DoB,SAA+C,MAApC,aAAWpE,IAAX,CAAgB,eAAhB,CAHgD,CAI3DF,YAAcxB,EAAEqB,SAASI,cAAT,CAAwBF,WAAWG,IAAX,CAAgB,eAAhB,CAAxB,CAAF,CAJ6C,CAM3DoE,QAN2D,EAO3DtE,YAAYmC,IAAZ,EAP2D,CAQ3DnC,YAAYE,IAAZ,CAAiB,aAAjB,CAAgC,MAAhC,CAR2D,CAS3DH,WAAWG,IAAX,CAAgB,eAAhB,CAAiC,OAAjC,CAT2D,CAU3D1B,EAAEqB,QAAF,EAAYuC,MAAZ,CAAmB,qCAAnB,CAV2D,GAY3DpC,YAAYuE,GAAZ,CAAgB,SAAhB,CAA2B,cAA3B,CAZ2D,CAa3DvE,YAAYE,IAAZ,CAAiB,aAAjB,CAAgC,OAAhC,CAb2D,CAc3DH,WAAWG,IAAX,CAAgB,eAAhB,CAAiC,MAAjC,CAd2D,CAe3D6B,MAAMyC,eAAN,EAf2D,CAgB3DhG,EAAEqB,QAAF,EAAYN,EAAZ,CAAe,qCAAf,CAAsD,KAAKuC,kCAAL,CAAwCrC,IAAxC,CAA6C,IAA7C,CAAtD,CAhB2D,CAkBlE,CA4KD,CAnKAX,kBAAkBgC,SAAlB,CAA4BtB,mBAA5B,CAAkD,SAASiF,CAAT,CAAY,CAC1DA,EAAEJ,cAAF,EAD0D,IAEtDtD,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAF6C,CAGtDoF,cAAgB3D,OAAOb,IAAP,CAAY,eAAZ,CAHsC,CAItDyE,EAAI,CAJkD,CAKtDC,aAAe,CALuC,CAO1D,IAAKD,EAAI,CAAT,CAAYA,EAAI,KAAKvF,cAAL,CAAoBsC,MAApC,CAA4CiD,GAA5C,CACI,GAAI,KAAKvF,cAAL,CAAoBuF,CAApB,EAAuBf,EAAvB,EAA6Bc,aAAjC,CAAgD,CAC5CE,aAAeD,CAD6B,CAE5C,KACH,CAXqD,GActDE,OAAQ,KAAKzF,cAAL,CAAoBsC,MAd0B,CAetDoD,SAAYF,aAAe,CAf2B,CAgB3C,CAAX,SAhBsD,GAiBtDE,SAAWD,MAAQ,CAjBmC,EAoBtDA,KApBsD,EAqBtD,KAAKvE,eAAL,CAAqB,KAAKlB,cAAL,CAAoB0F,QAApB,EAA8BlB,EAAnD,CAEP,CA4ID,CApIA9E,kBAAkBgC,SAAlB,CAA4BpB,eAA5B,CAA8C,SAAS+E,CAAT,CAAYM,KAAZ,CAAmB,CAC7DN,EAAEJ,cAAF,EAD6D,IAEzDtD,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAFgD,CAGzDoF,cAAgB3D,OAAOb,IAAP,CAAY,eAAZ,CAHyC,CAIzDyE,EAAI,CAJqD,CAKzDC,aAAe,CAL0C,CAO7D,IAAKD,EAAI,CAAT,CAAYA,EAAI,KAAKvF,cAAL,CAAoBsC,MAApC,CAA4CiD,GAA5C,CACI,GAAI,KAAKvF,cAAL,CAAoBuF,CAApB,EAAuBf,EAAvB,EAA6Bc,aAAjC,CAAgD,CAC5CE,aAAeD,CAD6B,CAE5C,KACH,CAXwD,GAczDE,OAAQ,KAAKzF,cAAL,CAAoBsC,MAd6B,CAezDoD,SAAW,CAACF,aAAe,CAAhB,EAAqBC,KAfyB,CAiB7D,GAAIE,OAASF,KAAb,CAAoB,IAEZzE,QAAS,KAAKhB,cAAL,CAAoB0F,QAApB,EAA8BlB,EAF3B,CAGZM,aAAeC,SAAS/D,MAAT,CAAiB,EAAjB,CAHH,CAIhBW,OAAOb,IAAP,CAAY,eAAZ,CAA6BE,MAA7B,CAJgB,CAKZ,CAACgE,MAAMF,YAAN,CAAD,EAAuC,CAAf,aALZ,EAMZ1F,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoCvB,MAApC,CAEP,CARD,IAQWyE,MARX,EASI,KAAKvE,eAAL,CAAqB,KAAKlB,cAAL,CAAoB0F,QAApB,EAA8BlB,EAAnD,CAEP,CAwGD,CAhGA9E,kBAAkBgC,SAAlB,CAA4BkE,aAA5B,CAA4C,UAAW,IAC/CjE,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CADsC,CAE/Cc,OAASW,OAAOb,IAAP,CAAY,eAAZ,CAFsC,CAG/CyE,EAAI,CAH2C,CAI/CC,aAAe,CAJgC,CAMnD,GAAIR,MAAMhE,MAAN,GAA2B,CAAV,QAArB,CACI,KAAKnB,OAAL,CAAaK,IAAb,CAAkB,4BAAlB,EAAgD6C,IAAhD,EADJ,KAEO,CAGH,IAFA,KAAKlD,OAAL,CAAaK,IAAb,CAAkB,4BAAlB,EAAgDiE,IAAhD,EAEA,CAAKoB,EAAI,CAAT,CAAYA,EAAI,KAAKvF,cAAL,CAAoBsC,MAApC,CAA4CiD,GAA5C,CACI,GAAI,KAAKvF,cAAL,CAAoBuF,CAApB,EAAuBf,EAAvB,EAA6BxD,MAAjC,CAAyC,CACrCwE,aAAeD,CADsB,CAErC,KACH,CAEL,GAAIE,OAAQ,KAAKzF,cAAL,CAAoBsC,MAAhC,CACImD,KAVD,GAWCD,cAAgB,CAXjB,EAaH,GAAIK,OAAQ,CAACC,EAAGN,YAAJ,CAAkBO,EAAGN,KAArB,CAAZ,CAEAnG,IAAI6B,UAAJ,CAAe,MAAf,CAAuB,YAAvB,CAAqC0E,KAArC,EAA4CzE,IAA5C,CAAiD,SAASC,CAAT,CAAY,CACzD,KAAKxB,OAAL,CAAaK,IAAb,CAAkB,oCAAlB,EAAwD6D,IAAxD,CAA6D1C,CAA7D,CACH,CAFgD,CAE/ChB,IAF+C,CAE1C,IAF0C,CAAjD,EAEckB,IAFd,CAEmBlC,aAAamC,SAFhC,CAGH,CACJ,CAqED,CA3DA9B,kBAAkBgC,SAAlB,CAA4BhB,gBAA5B,CAA+C,SAASiC,KAAT,CAAgB3B,MAAhB,CAAwB,CACnE,GAAIW,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAAb,CACAc,OAAS+D,SAAS/D,MAAT,CAAiB,EAAjB,CAF0D,CAI/D,CAACgE,MAAMhE,MAAN,CAAD,EAA2B,CAAT,OAJ6C,EAK/DW,OAAOb,IAAP,CAAY,eAAZ,CAA6BE,MAA7B,CAL+D,CAOnE,KAAK4E,aAAL,EACH,CAmDD,CA3CAlG,kBAAkBgC,SAAlB,CAA4Be,qBAA5B,CAAoD,UAAW,CAC1B,CAA7B,MAAKzC,cAAL,CAAoBsC,MADmC,CAEvDlD,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,WAApB,CAAiC,CAACyD,WAAY,IAAb,CAAmBC,WAAnB,CAAjC,CAFuD,CAIvD7G,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,WAApB,CAAiC,CAAC0D,WAAD,CAAjC,CAEP,CAqCD,CA5BAvG,kBAAkBgC,SAAlB,CAA4BnB,iBAA5B,CAAgD,UAAW,IACnDoB,QAAS,KAAK9B,OAAL,CAAaK,IAAb,CAAkB,2BAAlB,CAD0C,CAEnDc,OAAS+D,SAASpD,OAAOuE,GAAP,EAAT,CAAuB,EAAvB,CAF0C,CAInD,KAAKzE,UAJ8C,GAOnDhC,QAAQgF,mBAAR,CAA4B,wCAA5B,CAPmD,CASnDnF,IAAIoF,WAAJ,CAAgB,CACZ,CAACxB,IAAK,gBAAN,CAAwByB,UAAW,YAAnC,CADY,CAEZ,CAACzB,IAAK,wBAAN,CAAgCyB,UAAW,YAA3C,CAFY,CAGZ,CAACzB,IAAK,iBAAN,CAAyByB,UAAW,YAApC,CAHY,CAIZ,CAACzB,IAAK,QAAN,CAAgByB,UAAW,MAA3B,CAJY,CAAhB,EAKGvD,IALH,CAKQ,SAASwD,IAAT,CAAe,CACnBvF,aAAawF,OAAb,CAAqBD,KAAK,CAAL,CAArB,CAA8BA,KAAK,CAAL,CAA9B,CAAuCA,KAAK,CAAL,CAAvC,CAAgDA,KAAK,CAAL,CAAhD,CAAyD,UAAW,CAChExF,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoCvB,MAApC,CACH,CAFD,CAGH,CATD,CATmD,CAoB/C,CAACgE,MAAMhE,MAAN,CAAD,EAA2B,CAAT,OApB6B,GAqB/CW,OAAOb,IAAP,CAAY,eAAZ,CAA6BE,MAA7B,CArB+C,CAuB/C5B,EAAEqB,QAAF,EAAY8B,OAAZ,CAAoB,cAApB,CAAoCvB,MAApC,CAvB+C,EA0B1D,CAED,CAAOtB,iBACV,CA7dD,C","file":"grading_navigation.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle changing users via the user selector in the header.\n *\n * @module     mod_assign/grading_navigation\n * @package    mod_assign\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/notification', 'core/str', 'core/form-autocomplete',\n        'core/ajax', 'mod_assign/grading_form_change_checker'],\n       function($, notification, str, autocomplete, ajax, checker) {\n\n    /**\n     * GradingNavigation class.\n     *\n     * @class GradingNavigation\n     * @param {String} selector The selector for the page region containing the user navigation.\n     */\n    var GradingNavigation = function(selector) {\n        this._regionSelector = selector;\n        this._region = $(selector);\n        this._filters = [];\n        this._users = [];\n        this._filteredUsers = [];\n\n        // Get the current user list from a webservice.\n        this._loadAllUsers();\n\n        // Attach listeners to the select and arrow buttons.\n\n        this._region.find('[data-action=\"previous-user\"]').on('click', this._handlePreviousUser.bind(this));\n        this._region.find('[data-action=\"next-user\"]').on('click', this._handleNextUser.bind(this));\n        this._region.find('[data-action=\"change-user\"]').on('change', this._handleChangeUser.bind(this));\n        this._region.find('[data-region=\"user-filters\"]').on('click', this._toggleExpandFilters.bind(this));\n\n        $(document).on('user-changed', this._refreshSelector.bind(this));\n        $(document).on('done-saving-show-next', this._handleNextUser.bind(this));\n\n        // Position the configure filters panel under the link that expands it.\n        var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n        var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n        configPanel.on('change', '[type=\"checkbox\"]', this._filterChanged.bind(this));\n\n        var userid = $('[data-region=\"grading-navigation-panel\"]').data('first-userid');\n        if (userid) {\n            this._selectUserById(userid);\n        }\n\n        str.get_string('changeuser', 'mod_assign').done(function(s) {\n                autocomplete.enhance('[data-action=change-user]', false, 'mod_assign/participant_selector', s);\n            }\n        ).fail(notification.exception);\n\n        // We do not allow navigation while ajax requests are pending.\n\n        $(document).bind(\"start-loading-user\", function() {\n            this._isLoading = true;\n        }.bind(this));\n        $(document).bind(\"finish-loading-user\", function() {\n            this._isLoading = false;\n        }.bind(this));\n    };\n\n    /** @type {Boolean} Boolean tracking active ajax requests. */\n    GradingNavigation.prototype._isLoading = false;\n\n    /** @type {String} Selector for the page region containing the user navigation. */\n    GradingNavigation.prototype._regionSelector = null;\n\n    /** @type {Array} The list of active filter keys */\n    GradingNavigation.prototype._filters = null;\n\n    /** @type {Array} The list of users */\n    GradingNavigation.prototype._users = null;\n\n    /** @type {JQuery} JQuery node for the page region containing the user navigation. */\n    GradingNavigation.prototype._region = null;\n\n    /**\n     * Load the list of all users for this assignment.\n     *\n     * @private\n     * @method _loadAllUsers\n     */\n    GradingNavigation.prototype._loadAllUsers = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var assignmentid = select.attr('data-assignmentid');\n        var groupid = select.attr('data-groupid');\n\n        ajax.call([{\n            methodname: 'mod_assign_list_participants',\n            args: {assignid: assignmentid, groupid: groupid, filter: '', onlyids: true},\n            done: this._usersLoaded.bind(this),\n            fail: notification.exception\n        }]);\n    };\n\n    /**\n     * Call back to rebuild the user selector and x of y info when the user list is updated.\n     *\n     * @private\n     * @method _usersLoaded\n     * @param {Array} users\n     */\n    GradingNavigation.prototype._usersLoaded = function(users) {\n        this._filteredUsers = this._users = users;\n        if (this._users.length) {\n            // Position the configure filters panel under the link that expands it.\n            var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n            var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n            configPanel.find('[type=\"checkbox\"]').trigger('change');\n        } else {\n            this._selectNoUser();\n        }\n        this._triggerNextUserEvent();\n    };\n\n    /**\n     * Close the configure filters panel if a click is detected outside of it.\n     *\n     * @private\n     * @method _checkClickOutsideConfigureFilters\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._checkClickOutsideConfigureFilters = function(event) {\n        var configPanel = this._region.find('[data-region=\"configure-filters\"]');\n\n        if (!configPanel.is(event.target) && configPanel.has(event.target).length === 0) {\n            var toggleLink = this._region.find('[data-region=\"user-filters\"]');\n\n            configPanel.hide();\n            configPanel.attr('aria-hidden', 'true');\n            toggleLink.attr('aria-expanded', 'false');\n            $(document).unbind('click.mod_assign_grading_navigation');\n        }\n    };\n\n    /**\n     * Turn a filter on or off.\n     *\n     * @private\n     * @method _filterChanged\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._filterChanged = function(event) {\n        var name = $(event.target).attr('name');\n        var key = name.split('_').pop();\n        var enabled = $(event.target).prop('checked');\n\n        if (enabled) {\n            if (this._filters.indexOf(key) == -1) {\n                this._filters[this._filters.length] = key;\n            }\n        } else {\n            var index = this._filters.indexOf(key);\n            if (index != -1) {\n                this._filters.splice(index, 1);\n            }\n        }\n\n        // Update the active filter string.\n        var filterlist = [];\n        this._region.find('[data-region=\"configure-filters\"]').find('[type=\"checkbox\"]').each(function(idx, ele) {\n            if ($(ele).prop('checked')) {\n                filterlist[filterlist.length] = $(ele).closest('label').text();\n            }\n        });\n        if (filterlist.length) {\n            this._region.find('[data-region=\"user-filters\"] span').text(filterlist.join(', '));\n        } else {\n            str.get_string('nofilters', 'mod_assign').done(function(s) {\n                this._region.find('[data-region=\"user-filters\"] span').text(s);\n            }.bind(this)).fail(notification.exception);\n        }\n\n        // Filter the options in the select box that do not match the current filters.\n\n        var select = this._region.find('[data-action=change-user]');\n        var userid = select.attr('data-selected');\n        var foundIndex = 0;\n\n        this._filteredUsers = [];\n\n        $.each(this._users, function(index, user) {\n            var show = true;\n            $.each(this._filters, function(filterindex, filter) {\n                if (filter == \"submitted\") {\n                    if (user.submitted == \"0\") {\n                        show = false;\n                    }\n                } else if (filter == \"notsubmitted\") {\n                    if (user.submitted == \"1\") {\n                        show = false;\n                    }\n                } else if (filter == \"requiregrading\") {\n                    if (user.requiregrading == \"0\") {\n                        show = false;\n                    }\n                } else if (filter == \"grantedextension\") {\n                    if (user.grantedextension == \"0\") {\n                        show = false;\n                    }\n                }\n            });\n\n            if (show) {\n                this._filteredUsers[this._filteredUsers.length] = user;\n                if (userid == user.id) {\n                    foundIndex = (this._filteredUsers.length - 1);\n                }\n            }\n        }.bind(this));\n\n        if (this._filteredUsers.length) {\n            this._selectUserById(this._filteredUsers[foundIndex].id);\n        } else {\n            this._selectNoUser();\n        }\n        this._triggerNextUserEvent();\n    };\n\n    /**\n     * Select no users, because no users match the filters.\n     *\n     * @private\n     * @method _selectNoUser\n     */\n    GradingNavigation.prototype._selectNoUser = function() {\n        // Detect unsaved changes, and offer to save them - otherwise change user right now.\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', -1);\n                });\n            });\n        } else {\n            $(document).trigger('user-changed', -1);\n        }\n    };\n\n    /**\n     * Select the specified user by id.\n     *\n     * @private\n     * @method _selectUserById\n     * @param {Number} userid\n     */\n    GradingNavigation.prototype._selectUserById = function(userid) {\n        var select = this._region.find('[data-action=change-user]');\n        var useridnumber = parseInt(userid, 10);\n\n        // Detect unsaved changes, and offer to save them - otherwise change user right now.\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', useridnumber);\n                });\n            });\n        } else {\n            select.attr('data-selected', userid);\n\n            if (!isNaN(useridnumber) && useridnumber > 0) {\n                $(document).trigger('user-changed', userid);\n            }\n        }\n    };\n\n    /**\n     * Expand or collapse the filter config panel.\n     *\n     * @private\n     * @method _toggleExpandFilters\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._toggleExpandFilters = function(event) {\n        event.preventDefault();\n        var toggleLink = $(event.target).closest('[data-region=\"user-filters\"]');\n        var expanded = toggleLink.attr('aria-expanded') == 'true';\n        var configPanel = $(document.getElementById(toggleLink.attr('aria-controls')));\n\n        if (expanded) {\n            configPanel.hide();\n            configPanel.attr('aria-hidden', 'true');\n            toggleLink.attr('aria-expanded', 'false');\n            $(document).unbind('click.mod_assign_grading_navigation');\n        } else {\n            configPanel.css('display', 'inline-block');\n            configPanel.attr('aria-hidden', 'false');\n            toggleLink.attr('aria-expanded', 'true');\n            event.stopPropagation();\n            $(document).on('click.mod_assign_grading_navigation', this._checkClickOutsideConfigureFilters.bind(this));\n        }\n    };\n\n    /**\n     * Change to the previous user in the grading list.\n     *\n     * @private\n     * @method _handlePreviousUser\n     * @param {Event} e\n     */\n    GradingNavigation.prototype._handlePreviousUser = function(e) {\n        e.preventDefault();\n        var select = this._region.find('[data-action=change-user]');\n        var currentUserId = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        for (i = 0; i < this._filteredUsers.length; i++) {\n            if (this._filteredUsers[i].id == currentUserId) {\n                currentIndex = i;\n                break;\n            }\n        }\n\n        var count = this._filteredUsers.length;\n        var newIndex = (currentIndex - 1);\n        if (newIndex < 0) {\n            newIndex = count - 1;\n        }\n\n        if (count) {\n            this._selectUserById(this._filteredUsers[newIndex].id);\n        }\n    };\n\n    /**\n     * Change to the next user in the grading list.\n     *\n     * @param {Event} e\n     * @param {Boolean} saved Has the form already been saved? Skips checking for changes if true.\n     */\n    GradingNavigation.prototype._handleNextUser = function(e, saved) {\n        e.preventDefault();\n        var select = this._region.find('[data-action=change-user]');\n        var currentUserId = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        for (i = 0; i < this._filteredUsers.length; i++) {\n            if (this._filteredUsers[i].id == currentUserId) {\n                currentIndex = i;\n                break;\n            }\n        }\n\n        var count = this._filteredUsers.length;\n        var newIndex = (currentIndex + 1) % count;\n\n        if (saved && count) {\n            // If we've already saved the grade, skip checking if we've made any changes.\n            var userid = this._filteredUsers[newIndex].id;\n            var useridnumber = parseInt(userid, 10);\n            select.attr('data-selected', userid);\n            if (!isNaN(useridnumber) && useridnumber > 0) {\n                $(document).trigger('user-changed', userid);\n            }\n        } else if (count) {\n            this._selectUserById(this._filteredUsers[newIndex].id);\n        }\n    };\n\n    /**\n     * Rebuild the x of y string.\n     *\n     * @private\n     * @method _refreshCount\n     */\n    GradingNavigation.prototype._refreshCount = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var userid = select.attr('data-selected');\n        var i = 0;\n        var currentIndex = 0;\n\n        if (isNaN(userid) || userid <= 0) {\n            this._region.find('[data-region=\"user-count\"]').hide();\n        } else {\n            this._region.find('[data-region=\"user-count\"]').show();\n\n            for (i = 0; i < this._filteredUsers.length; i++) {\n                if (this._filteredUsers[i].id == userid) {\n                    currentIndex = i;\n                    break;\n                }\n            }\n            var count = this._filteredUsers.length;\n            if (count) {\n                currentIndex += 1;\n            }\n            var param = {x: currentIndex, y: count};\n\n            str.get_string('xofy', 'mod_assign', param).done(function(s) {\n                this._region.find('[data-region=\"user-count-summary\"]').text(s);\n            }.bind(this)).fail(notification.exception);\n        }\n    };\n\n    /**\n     * Respond to a user-changed event by updating the selector.\n     *\n     * @private\n     * @method _refreshSelector\n     * @param {Event} event\n     * @param {String} userid\n     */\n    GradingNavigation.prototype._refreshSelector = function(event, userid) {\n        var select = this._region.find('[data-action=change-user]');\n        userid = parseInt(userid, 10);\n\n        if (!isNaN(userid) && userid > 0) {\n            select.attr('data-selected', userid);\n        }\n        this._refreshCount();\n    };\n\n    /**\n     * Trigger the next user event depending on the number of filtered users\n     *\n     * @private\n     * @method _triggerNextUserEvent\n     */\n    GradingNavigation.prototype._triggerNextUserEvent = function() {\n        if (this._filteredUsers.length > 1) {\n            $(document).trigger('next-user', {nextUserId: null, nextUser: true});\n        } else {\n            $(document).trigger('next-user', {nextUser: false});\n        }\n    };\n\n    /**\n     * Change to a different user in the grading list.\n     *\n     * @private\n     * @method _handleChangeUser\n     * @param {Event} event\n     */\n    GradingNavigation.prototype._handleChangeUser = function() {\n        var select = this._region.find('[data-action=change-user]');\n        var userid = parseInt(select.val(), 10);\n\n        if (this._isLoading) {\n            return;\n        }\n        if (checker.checkFormForChanges('[data-region=\"grade-panel\"] .gradeform')) {\n            // Form has changes, so we need to confirm before switching users.\n            str.get_strings([\n                {key: 'unsavedchanges', component: 'mod_assign'},\n                {key: 'unsavedchangesquestion', component: 'mod_assign'},\n                {key: 'saveandcontinue', component: 'mod_assign'},\n                {key: 'cancel', component: 'core'},\n            ]).done(function(strs) {\n                notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\n                    $(document).trigger('save-changes', userid);\n                });\n            });\n        } else {\n            if (!isNaN(userid) && userid > 0) {\n                select.attr('data-selected', userid);\n\n                $(document).trigger('user-changed', userid);\n            }\n        }\n    };\n\n    return GradingNavigation;\n});\n"]}