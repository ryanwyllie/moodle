{"version":3,"sources":["../src/grading_popup.js"],"names":["define","$","notification","str","ajax","log","templates","Dialogue","GradingPopup","regionSelector","userCompetencySelector","_regionSelector","_userCompetencySelector","on","_handleClick","bind","prototype","e","cell","target","closest","competencyId","data","courseId","userId","debug","requests","call","methodname","args","userid","competencyid","courseid","when","apply","then","context","_contextLoaded","catch","exception","self","displayuser","render","done","html","js","get_string","title","runTemplateJS","_refresh","fail","region","_pageContextLoaded","replaceNode"],"mappings":"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","file":"grading_popup.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to enable inline editing of a comptency grade.\n *\n * @package    report_competency\n * @copyright  2015 Damyon Wiese\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'core/str', 'core/ajax', 'core/log', 'core/templates', 'tool_lp/dialogue'],\n       function($, notification, str, ajax, log, templates, Dialogue) {\n\n    /**\n     * GradingPopup\n     *\n     * @param {String} regionSelector The regionSelector\n     * @param {String} userCompetencySelector The userCompetencySelector\n     */\n    var GradingPopup = function(regionSelector, userCompetencySelector) {\n        this._regionSelector = regionSelector;\n        this._userCompetencySelector = userCompetencySelector;\n\n        $(this._regionSelector).on('click', this._userCompetencySelector, this._handleClick.bind(this));\n    };\n\n    /**\n     * Get the data from the clicked cell and open the popup.\n     *\n     * @method _handleClick\n     * @param {Event} e The event\n     */\n    GradingPopup.prototype._handleClick = function(e) {\n        var cell = $(e.target).closest(this._userCompetencySelector);\n        var competencyId = $(cell).data('competencyid');\n        var courseId = $(cell).data('courseid');\n        var userId = $(cell).data('userid');\n\n        log.debug('Clicked on cell: competencyId=' + competencyId + ', courseId=' + courseId + ', userId=' + userId);\n\n        var requests = ajax.call([{\n            methodname: 'tool_lp_data_for_user_competency_summary_in_course',\n            args: {userid: userId, competencyid: competencyId, courseid: courseId},\n        }, {\n            methodname: 'core_competency_user_competency_viewed_in_course',\n            args: {userid: userId, competencyid: competencyId, courseid: courseId},\n        }]);\n\n        $.when.apply($, requests).then(function(context) {\n            this._contextLoaded.bind(this)(context);\n            return;\n        }.bind(this)).catch(notification.exception);\n    };\n\n    /**\n     * We loaded the context, now render the template.\n     *\n     * @method _contextLoaded\n     * @param {Object} context\n     */\n    GradingPopup.prototype._contextLoaded = function(context) {\n        var self = this;\n        // We have to display user info in popup.\n        context.displayuser = true;\n        templates.render('tool_lp/user_competency_summary_in_course', context).done(function(html, js) {\n            str.get_string('usercompetencysummary', 'report_competency').done(function(title) {\n                (new Dialogue(title, html, templates.runTemplateJS.bind(templates, js), self._refresh.bind(self), true));\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n    };\n\n    /**\n     * Refresh the page.\n     *\n     * @method _refresh\n     */\n    GradingPopup.prototype._refresh = function() {\n        var region = $(this._regionSelector);\n        var courseId = region.data('courseid');\n        var userId = region.data('userid');\n\n        ajax.call([{\n            methodname: 'report_competency_data_for_report',\n            args: {courseid: courseId, userid: userId},\n            done: this._pageContextLoaded.bind(this),\n            fail: notification.exception\n        }]);\n    };\n\n    /**\n     * We loaded the context, now render the template.\n     *\n     * @method _pageContextLoaded\n     * @param {Object} context\n     */\n    GradingPopup.prototype._pageContextLoaded = function(context) {\n        var self = this;\n        templates.render('report_competency/report', context).done(function(html, js) {\n            templates.replaceNode(self._regionSelector, html, js);\n        }).fail(notification.exception);\n    };\n\n    /** @type {String} The selector for the region with the user competencies */\n    GradingPopup.prototype._regionSelector = null;\n    /** @type {String} The selector for the region with a single user competencies */\n    GradingPopup.prototype._userCompetencySelector = null;\n\n    return /** @alias module:report_competency/grading_popup */ GradingPopup;\n\n});\n"]}