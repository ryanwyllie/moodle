'use strict';define('report_competency/grading_popup',['jquery','core/notification','core/str','core/ajax','core/log','core/templates','tool_lp/dialogue'],function($,notification,str,ajax,log,templates,Dialogue){var GradingPopup=function(regionSelector,userCompetencySelector){this._regionSelector=regionSelector,this._userCompetencySelector=userCompetencySelector,$(this._regionSelector).on('click',this._userCompetencySelector,this._handleClick.bind(this))};return GradingPopup.prototype._handleClick=function(e){var cell=$(e.target).closest(this._userCompetencySelector),competencyId=$(cell).data('competencyid'),courseId=$(cell).data('courseid'),userId=$(cell).data('userid');log.debug('Clicked on cell: competencyId='+competencyId+', courseId='+courseId+', userId='+userId);var requests=ajax.call([{methodname:'tool_lp_data_for_user_competency_summary_in_course',args:{userid:userId,competencyid:competencyId,courseid:courseId}},{methodname:'core_competency_user_competency_viewed_in_course',args:{userid:userId,competencyid:competencyId,courseid:courseId}}]);$.when.apply($,requests).then(function(context){this._contextLoaded.bind(this)(context)}.bind(this)).catch(notification.exception)},GradingPopup.prototype._contextLoaded=function(context){var self=this;context.displayuser=!0,templates.render('tool_lp/user_competency_summary_in_course',context).done(function(html,js){str.get_string('usercompetencysummary','report_competency').done(function(title){new Dialogue(title,html,templates.runTemplateJS.bind(templates,js),self._refresh.bind(self),!0)}).fail(notification.exception)}).fail(notification.exception)},GradingPopup.prototype._refresh=function(){var region=$(this._regionSelector),courseId=region.data('courseid'),userId=region.data('userid');ajax.call([{methodname:'report_competency_data_for_report',args:{courseid:courseId,userid:userId},done:this._pageContextLoaded.bind(this),fail:notification.exception}])},GradingPopup.prototype._pageContextLoaded=function(context){var self=this;templates.render('report_competency/report',context).done(function(html,js){templates.replaceNode(self._regionSelector,html,js)}).fail(notification.exception)},GradingPopup.prototype._regionSelector=null,GradingPopup.prototype._userCompetencySelector=null,GradingPopup});
//# sourceMappingURL=grading_popup.min.js.map
