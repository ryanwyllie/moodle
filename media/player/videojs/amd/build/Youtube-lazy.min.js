'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};(function(root,factory){'object'===('undefined'==typeof exports?'undefined':_typeof(exports))&&'undefined'!=typeof module?module.exports=factory(require('video.js')):'function'==typeof define&&define.amd?define('media_videojs/Youtube-lazy',['media_videojs/video-lazy'],function(videojs){return root.Youtube=factory(videojs)}):root.Youtube=factory(root.videojs)})(void 0,function(videojs){'use strict';var _isOnMobile=videojs.browser.IS_IOS||videojs.browser.IS_ANDROID,Tech=videojs.getTech('Tech'),Youtube=videojs.extend(Tech,{constructor:function constructor(options,ready){Tech.call(this,options,ready),this.setPoster(options.poster),this.setSrc(this.options_.source,!0),this.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=' vjs-youtube',_isOnMobile&&(this.el_.parentNode.className+=' vjs-youtube-mobile'),Youtube.isApiReady?this.initYTPlayer():Youtube.apiReadyQueue.push(this))}.bind(this))},dispose:function dispose(){if(this.ytPlayer)this.ytPlayer.stopVideo&&this.ytPlayer.stopVideo(),this.ytPlayer.destroy&&this.ytPlayer.destroy();else{var index=Youtube.apiReadyQueue.indexOf(this);-1!==index&&Youtube.apiReadyQueue.splice(index,1)}this.ytPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(' vjs-youtube','').replace(' vjs-youtube-mobile',''),this.el_.parentNode.removeChild(this.el_),Tech.prototype.dispose.call(this)},createEl:function createEl(){var div=document.createElement('div');div.setAttribute('id',this.options_.techId),div.setAttribute('style','width:100%;height:100%;top:0;left:0;position:absolute'),div.setAttribute('class','vjs-tech');var divWrapper=document.createElement('div');if(divWrapper.appendChild(div),!_isOnMobile&&!this.options_.ytControls){var divBlocker=document.createElement('div');divBlocker.setAttribute('class','vjs-iframe-blocker'),divBlocker.setAttribute('style','position:absolute;top:0;left:0;width:100%;height:100%'),divBlocker.onclick=function(){this.pause()}.bind(this),divWrapper.appendChild(divBlocker)}return divWrapper},initYTPlayer:function initYTPlayer(){var playerVars={controls:0,modestbranding:1,rel:0,showinfo:0,loop:this.options_.loop?1:0};if('undefined'!=typeof this.options_.autohide&&(playerVars.autohide=this.options_.autohide),'undefined'!=typeof this.options_.cc_load_policy&&(playerVars.cc_load_policy=this.options_.cc_load_policy),'undefined'!=typeof this.options_.ytControls&&(playerVars.controls=this.options_.ytControls),'undefined'!=typeof this.options_.disablekb&&(playerVars.disablekb=this.options_.disablekb),'undefined'!=typeof this.options_.end&&(playerVars.end=this.options_.end),'undefined'!=typeof this.options_.color&&(playerVars.color=this.options_.color),playerVars.controls?'undefined'!=typeof this.options_.fs&&(playerVars.fs=this.options_.fs):playerVars.fs=0,'undefined'!=typeof this.options_.end&&(playerVars.end=this.options_.end),'undefined'==typeof this.options_.hl?'undefined'!=typeof this.options_.language&&(playerVars.hl=this.options_.language.substr(0,2)):playerVars.hl=this.options_.hl,'undefined'!=typeof this.options_.iv_load_policy&&(playerVars.iv_load_policy=this.options_.iv_load_policy),'undefined'==typeof this.options_.list?this.url&&'undefined'!=typeof this.url.listId&&(playerVars.list=this.url.listId):playerVars.list=this.options_.list,'undefined'!=typeof this.options_.listType&&(playerVars.listType=this.options_.listType),'undefined'!=typeof this.options_.modestbranding&&(playerVars.modestbranding=this.options_.modestbranding),'undefined'!=typeof this.options_.playlist&&(playerVars.playlist=this.options_.playlist),'undefined'!=typeof this.options_.playsinline&&(playerVars.playsinline=this.options_.playsinline),'undefined'!=typeof this.options_.rel&&(playerVars.rel=this.options_.rel),'undefined'!=typeof this.options_.showinfo&&(playerVars.showinfo=this.options_.showinfo),'undefined'!=typeof this.options_.start&&(playerVars.start=this.options_.start),'undefined'!=typeof this.options_.theme&&(playerVars.theme=this.options_.theme),'undefined'!=typeof this.options_.customVars){var customVars=this.options_.customVars;Object.keys(customVars).forEach(function(key){playerVars[key]=customVars[key]})}this.activeVideoId=this.url?this.url.videoId:null,this.activeList=playerVars.list,this.ytPlayer=new YT.Player(this.options_.techId,{videoId:this.activeVideoId,playerVars:playerVars,events:{onReady:this.onPlayerReady.bind(this),onPlaybackQualityChange:this.onPlayerPlaybackQualityChange.bind(this),onPlaybackRateChange:this.onPlayerPlaybackRateChange.bind(this),onStateChange:this.onPlayerStateChange.bind(this),onVolumeChange:this.onPlayerVolumeChange.bind(this),onError:this.onPlayerError.bind(this)}})},onPlayerReady:function onPlayerReady(){this.options_.muted&&this.ytPlayer.mute();var playbackRates=this.ytPlayer.getAvailablePlaybackRates();1<playbackRates.length&&(this.featuresPlaybackRate=!0),this.playerReady_=!0,this.triggerReady(),this.playOnReady?this.play():this.cueOnReady&&(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)},onPlayerPlaybackQualityChange:function onPlayerPlaybackQualityChange(){},onPlayerPlaybackRateChange:function onPlayerPlaybackRateChange(){this.trigger('ratechange')},onPlayerStateChange:function onPlayerStateChange(e){var state=e.data;state===this.lastState||this.errorNumber||(this.lastState=state,-1===state?(this.trigger('loadstart'),this.trigger('loadedmetadata'),this.trigger('durationchange'),this.trigger('ratechange')):state===YT.PlayerState.ENDED?this.trigger('ended'):state===YT.PlayerState.PLAYING?(this.trigger('timeupdate'),this.trigger('durationchange'),this.trigger('playing'),this.trigger('play'),this.isSeeking&&this.onSeeked()):state===YT.PlayerState.PAUSED?(this.trigger('canplay'),this.isSeeking?this.onSeeked():this.trigger('pause')):state===YT.PlayerState.BUFFERING?(this.player_.trigger('timeupdate'),this.player_.trigger('waiting')):void 0)},onPlayerVolumeChange:function onPlayerVolumeChange(){this.trigger('volumechange')},onPlayerError:function onPlayerError(e){this.errorNumber=e.data,this.trigger('pause'),this.trigger('error')},error:function error(){var code=1e3+this.errorNumber;switch(this.errorNumber){case 5:return{code:code,message:'Error while trying to play the video'};case 2:case 100:return{code:code,message:'Unable to find the video'};case 101:case 150:return{code:code,message:'Playback on other Websites has been disabled by the video owner.'};}return{code:code,message:'YouTube unknown error ('+this.errorNumber+')'}},loadVideoById_:function loadVideoById_(id){var options={videoId:id};this.options_.start&&(options.startSeconds=this.options_.start),this.options_.end&&(options.endEnd=this.options_.end),this.ytPlayer.loadVideoById(options)},cueVideoById_:function cueVideoById_(id){var options={videoId:id};this.options_.start&&(options.startSeconds=this.options_.start),this.options_.end&&(options.endEnd=this.options_.end),this.ytPlayer.cueVideoById(options)},src:function src(_src){return _src&&this.setSrc({src:_src}),this.source},poster:function poster(){return _isOnMobile?null:this.poster_},setPoster:function setPoster(poster){this.poster_=poster},setSrc:function setSrc(source){source&&source.src&&(delete this.errorNumber,this.source=source,this.url=Youtube.parseUrl(source.src),!this.options_.poster&&this.url.videoId&&(this.poster_='https://img.youtube.com/vi/'+this.url.videoId+'/0.jpg',this.trigger('posterchange'),this.checkHighResPoster()),this.options_.autoplay&&!_isOnMobile?this.isReady_?this.play():this.playOnReady=!0:this.activeVideoId!==this.url.videoId&&(this.isReady_?(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId):this.cueOnReady=!0))},autoplay:function autoplay(){return this.options_.autoplay},setAutoplay:function setAutoplay(val){this.options_.autoplay=val},loop:function loop(){return this.options_.loop},setLoop:function setLoop(val){this.options_.loop=val},play:function play(){this.url&&this.url.videoId&&(this.wasPausedBeforeSeek=!1,this.isReady_?(this.url.listId&&(this.activeList===this.url.listId?this.ytPlayer.playVideo():(this.ytPlayer.loadPlaylist(this.url.listId),this.activeList=this.url.listId)),this.activeVideoId===this.url.videoId?this.ytPlayer.playVideo():(this.loadVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)):(this.trigger('waiting'),this.playOnReady=!0))},pause:function pause(){this.ytPlayer&&this.ytPlayer.pauseVideo()},paused:function paused(){return!this.ytPlayer||this.lastState!==YT.PlayerState.PLAYING&&this.lastState!==YT.PlayerState.BUFFERING},currentTime:function currentTime(){return this.ytPlayer?this.ytPlayer.getCurrentTime():0},setCurrentTime:function setCurrentTime(seconds){this.lastState===YT.PlayerState.PAUSED&&(this.timeBeforeSeek=this.currentTime()),this.isSeeking||(this.wasPausedBeforeSeek=this.paused()),this.ytPlayer.seekTo(seconds,!0),this.trigger('timeupdate'),this.trigger('seeking'),this.isSeeking=!0,this.lastState===YT.PlayerState.PAUSED&&this.timeBeforeSeek!==seconds&&(clearInterval(this.checkSeekedInPauseInterval),this.checkSeekedInPauseInterval=setInterval(function(){this.lastState===YT.PlayerState.PAUSED&&this.isSeeking?this.currentTime()!==this.timeBeforeSeek&&(this.trigger('timeupdate'),this.onSeeked()):clearInterval(this.checkSeekedInPauseInterval)}.bind(this),250))},seeking:function seeking(){return this.isSeeking},seekable:function seekable(){return this.ytPlayer?videojs.createTimeRange(0,this.ytPlayer.getDuration()):videojs.createTimeRange()},onSeeked:function onSeeked(){clearInterval(this.checkSeekedInPauseInterval),this.isSeeking=!1,this.wasPausedBeforeSeek&&this.pause(),this.trigger('seeked')},playbackRate:function playbackRate(){return this.ytPlayer?this.ytPlayer.getPlaybackRate():1},setPlaybackRate:function setPlaybackRate(suggestedRate){this.ytPlayer&&this.ytPlayer.setPlaybackRate(suggestedRate)},duration:function duration(){return this.ytPlayer?this.ytPlayer.getDuration():0},currentSrc:function currentSrc(){return this.source&&this.source.src},ended:function ended(){return!!this.ytPlayer&&this.lastState===YT.PlayerState.ENDED},volume:function volume(){return this.ytPlayer?this.ytPlayer.getVolume()/100:1},setVolume:function setVolume(percentAsDecimal){this.ytPlayer&&this.ytPlayer.setVolume(100*percentAsDecimal)},muted:function muted(){return!!this.ytPlayer&&this.ytPlayer.isMuted()},setMuted:function setMuted(mute){this.ytPlayer&&(this.muted(!0),mute?this.ytPlayer.mute():this.ytPlayer.unMute(),this.setTimeout(function(){this.trigger('volumechange')},50))},buffered:function buffered(){if(!this.ytPlayer||!this.ytPlayer.getVideoLoadedFraction)return videojs.createTimeRange();var bufferedEnd=this.ytPlayer.getVideoLoadedFraction()*this.ytPlayer.getDuration();return videojs.createTimeRange(0,bufferedEnd)},preload:function preload(){},load:function load(){},reset:function reset(){},supportsFullScreen:function supportsFullScreen(){return!0},checkHighResPoster:function checkHighResPoster(){var uri='https://img.youtube.com/vi/'+this.url.videoId+'/maxresdefault.jpg';try{var image=new Image;image.onload=function(){if('naturalHeight'in image){if(90>=image.naturalHeight||120>=image.naturalWidth)return;}else if(90>=image.height||120>=image.width)return;this.poster_=uri,this.trigger('posterchange')}.bind(this),image.onerror=function(){},image.src=uri}catch(e){}}});Youtube.isSupported=function(){return!0},Youtube.canPlaySource=function(e){return Youtube.canPlayType(e.type)},Youtube.canPlayType=function(e){return'video/youtube'===e},Youtube.parseUrl=function(url){var result={videoId:null},regex=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,match=url.match(regex);match&&11===match[2].length&&(result.videoId=match[2]);var regPlaylist=/[?&]list=([^#\&\?]+)/;return match=url.match(regPlaylist),match&&match[1]&&(result.listId=match[1]),result},Youtube.apiReadyQueue=[],'undefined'!=typeof document&&(function(src,callback){var loaded=!1,tag=document.createElement('script'),firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),tag.onload=function(){loaded||(loaded=!0,callback())},tag.onreadystatechange=function(){loaded||'complete'!==this.readyState&&'loaded'!==this.readyState||(loaded=!0,callback())},tag.src=src}('https://www.youtube.com/iframe_api',function(){YT.ready(function(){Youtube.isApiReady=!0;for(var i=0;i<Youtube.apiReadyQueue.length;++i)Youtube.apiReadyQueue[i].initYTPlayer()})}),function(){var head=document.head||document.getElementsByTagName('head')[0],style=document.createElement('style');style.type='text/css',style.styleSheet?style.styleSheet.cssText='.vjs-youtube .vjs-iframe-blocker { display: none; }.vjs-youtube.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-youtube .vjs-poster { background-size: cover; }.vjs-youtube-mobile .vjs-big-play-button { display: none; }':style.appendChild(document.createTextNode('.vjs-youtube .vjs-iframe-blocker { display: none; }.vjs-youtube.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-youtube .vjs-poster { background-size: cover; }.vjs-youtube-mobile .vjs-big-play-button { display: none; }')),head.appendChild(style)}()),'undefined'==typeof videojs.registerTech?videojs.registerComponent('Youtube',Youtube):videojs.registerTech('Youtube',Youtube)});
//# sourceMappingURL=Youtube-lazy.min.js.map
