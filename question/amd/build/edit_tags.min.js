'use strict';define('core_question/edit_tags',['jquery','core/fragment','core/str','core/modal_events','core/modal_factory','core/notification','core/custom_interaction_events','core_question/repository','core_question/selectors'],function($,Fragment,Str,ModalEvents,ModalFactory,Notification,CustomEvents,Repository,QuestionSelectors){var enableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop('disabled',!1)},disableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop('disabled',!0)},getFormData=function(modal){return modal.getBody().find('form').serialize()},startLoading=function(root){var loadingIconContainer=root.find(QuestionSelectors.containers.loadingIcon);loadingIconContainer.removeClass('hidden')},stopLoading=function(root){var loadingIconContainer=root.find(QuestionSelectors.containers.loadingIcon);loadingIconContainer.addClass('hidden')},setContextId=function(modal,contextId){modal.getBody().attr('data-contextid',contextId)},getContextId=function(modal){return modal.getBody().data('contextid')},setQuestionId=function(modal,questionId){modal.getBody().attr('data-questionid',questionId)},getQuestionId=function(modal){return modal.getBody().data('questionid')},registerEventListeners=function(root){var modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,large:!1},[root,QuestionSelectors.actions.edittags]).then(function(modal){return Str.get_string('questiontags','question').then(function(string){return modal.setTitle(string),string}).fail(Notification.exception),modal.getRoot().on(ModalEvents.save,function(e){var form=modal.getBody().find('form');form.submit(),e.preventDefault()}),modal.getRoot().on('submit','form',function(e){save(modal,root).then(function(){return modal.hide(),void location.reload()}).fail(Notification.exception),e.preventDefault(),e.stopPropagation()}),modal});root.on(CustomEvents.events.activate,QuestionSelectors.actions.edittags,function(e){var currentTarget=$(e.currentTarget),questionId=currentTarget.data('questionid'),canTag=!!currentTarget.data('cantag'),contextId=currentTarget.data('contextid');modalPromise.then(function(modal){disableSaveButton(root),startLoading(root);var tagsFragment=Fragment.loadFragment('question','tags_form',contextId,{id:questionId});return modal.setBody(tagsFragment),tagsFragment.then(function(){enableSaveButton(root)}).always(function(){stopLoading(root)}).fail(Notification.exception),canTag?modal.getRoot().find(QuestionSelectors.actions.save).show():modal.getRoot().find(QuestionSelectors.actions.save).hide(),setQuestionId(modal,questionId),setContextId(modal,contextId),modal}).fail(Notification.exception),e.preventDefault()})},save=function(modal,root){disableSaveButton(root),startLoading(root);var formData=getFormData(modal),questionId=getQuestionId(modal),contextId=getContextId(modal);return Repository.submitTagCreateUpdateForm(questionId,contextId,formData).always(function(){return stopLoading(root),void enableSaveButton(root)}).fail(Notification.exception)};return{init:function init(root){root=$(root),registerEventListeners(root)}}});
//# sourceMappingURL=edit_tags.min.js.map
