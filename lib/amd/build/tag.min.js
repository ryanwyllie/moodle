'use strict';define('core/tag',['jquery','core/ajax','core/templates','core/notification','core/str','core/yui'],function($,ajax,templates,notification,str,Y){return{initTagindexPage:function initTagindexPage(){$('body').delegate('.tagarea[data-ta] a[data-quickload=1]','click',function(e){e.preventDefault();var target=$(this),query=target[0].search.replace(/^\?/,''),tagarea=target.closest('.tagarea[data-ta]'),args=query.split('&').reduce(function(s,c){var t=c.split('=');return s[t[0]]=decodeURIComponent(t[1]),s},{}),promises=ajax.call([{methodname:'core_tag_get_tagindex',args:{tagindex:args}}],!0);$.when.apply($,promises).done(function(data){templates.render('core_tag/index',data).done(function(html){tagarea.replaceWith(html)})})})},initManagePage:function initManagePage(){$('body').on('updated','[data-inplaceeditable]',function(e){if(str.get_string('selecttag','core_tag',e.ajaxreturn.value).then(function(s){return $('label[for="tagselect'+e.ajaxreturn.itemid+'"]').html(s)}).fail(notification.exception),str.get_string('now').done(function(s){$(e.target).closest('tr').find('td.col-timemodified').html(s)}),'tagflag'===e.ajaxreturn.itemtype){var row=$(e.target).closest('tr');'0'===e.ajaxreturn.value?row.removeClass('flagged-tag'):row.addClass('flagged-tag')}}),$('.tag-management-table').delegate('a.tagdelete','click',function(e){e.preventDefault();var href=$(this).attr('href');str.get_strings([{key:'delete'},{key:'confirmdeletetag',component:'tag'},{key:'yes'},{key:'no'}]).done(function(s){notification.confirm(s[0],s[1],s[2],s[3],function(){window.location.href=href})})}),$('#tag-management-delete').click(function(e){var form=$(this).closest('form').get(0),cnt=$(form).find('input[type=checkbox]:checked').length;if(cnt){var tempElement=$('<input type=\'hidden\'/>').attr('name',this.name);e.preventDefault(),str.get_strings([{key:'delete'},{key:'confirmdeletetags',component:'tag'},{key:'yes'},{key:'no'}]).done(function(s){notification.confirm(s[0],s[1],s[2],s[3],function(){tempElement.appendTo(form),form.submit()})})}}),$('#tag-management-combine').click(function(e){e.preventDefault();var form=$(this).closest('form').get(0),tags=$(form).find('input[type=checkbox]:checked');if(1>=tags.length)return void str.get_strings([{key:'combineselected',component:'tag'},{key:'selectmultipletags',component:'tag'},{key:'ok'}]).done(function(s){notification.alert(s[0],s[1],s[2])});var tempElement=$('<input type=\'hidden\'/>').attr('name',this.name);str.get_strings([{key:'combineselected',component:'tag'},{key:'selectmaintag',component:'tag'},{key:'continue'},{key:'cancel'}]).done(function(s){var el=$('<div><form id="combinetags_form" class="form-inline"><p class="description"></p><p class="options"></p><p class="mdl-align"><input type="submit" class="btn btn-primary" id="combinetags_submit"/><input type="button" class="btn btn-secondary" id="combinetags_cancel"/></p></form></div>');el.find('.description').html(s[1]),el.find('#combinetags_submit').attr('value',s[2]),el.find('#combinetags_cancel').attr('value',s[3]);var fldset=el.find('.options');tags.each(function(){var tagid=$(this).val(),tagname=$('.inplaceeditable[data-itemtype=tagname][data-itemid='+tagid+']').attr('data-value');fldset.append($('<input type="radio" name="maintag" id="combinetags_maintag_'+tagid+'" value="'+tagid+'"/><label for="combinetags_maintag_'+tagid+'">'+tagname+'</label><br>'))}),Y.use('moodle-core-notification-dialogue',function(){var panel=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:s[0],bodyContent:el.html()});panel.show(),$('#combinetags_form input[type=radio]').first().focus().prop('checked',!0),$('#combinetags_form #combinetags_cancel').on('click',function(){panel.destroy()}),$('#combinetags_form').on('submit',function(){tempElement.appendTo(form);var maintag=$('input[name=maintag]:checked','#combinetags_form').val();return $('<input type=\'hidden\'/>').attr('name','maintag').attr('value',maintag).appendTo(form),form.submit(),!1})})})}),$('body').on('updatefailed','[data-inplaceeditable][data-itemtype=tagname]',function(e){var exception=e.exception,newvalue=e.newvalue,tagid=$(e.target).attr('data-itemid');'namesalreadybeeingused'===exception.errorcode&&(e.preventDefault(),str.get_strings([{key:'nameuseddocombine',component:'tag'},{key:'yes'},{key:'cancel'}]).done(function(s){notification.confirm(e.message,s[0],s[1],s[2],function(){window.location.href=window.location.href+'&newname='+encodeURIComponent(newvalue)+'&tagid='+encodeURIComponent(tagid)+'&action=renamecombine&sesskey='+M.cfg.sesskey})}))}),$('body').on('click','a[data-action=addstandardtag]',function(e){e.preventDefault(),str.get_strings([{key:'addotags',component:'tag'},{key:'inputstandardtags',component:'tag'},{key:'continue'},{key:'cancel'}]).done(function(s){var el=$('<div><form id="addtags_form" class="form-inline" method="POST"><input type="hidden" name="action" value="addstandardtag"/><input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'"/><p><label for="id_tagslist">'+s[1]+'</label><input type="text" id="id_tagslist" name="tagslist"/></p><p class="mdl-align"><input type="submit" class="btn btn-primary" id="addtags_submit"/><input type="button" class="btn btn-secondary" id="addtags_cancel"/></p></form></div>');el.find('#addtags_form').attr('action',window.location.href),el.find('#addtags_submit').attr('value',s[2]),el.find('#addtags_cancel').attr('value',s[3]),Y.use('moodle-core-notification-dialogue',function(){var panel=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:s[0],bodyContent:el.html()});panel.show(),$('#addtags_form input[type=text]').focus(),$('#addtags_form #addtags_cancel').on('click',function(){panel.destroy()})})})})},initManageCollectionsPage:function initManageCollectionsPage(){$('body').on('updated','[data-inplaceeditable]',function(e){var areaid,collid,isenabled,ajaxreturn=e.ajaxreturn;'core_tag'===ajaxreturn.component&&'tagareaenable'===ajaxreturn.itemtype&&(areaid=$(this).attr('data-itemid'),$('.tag-collections-table ul[data-collectionid] li[data-areaid='+areaid+']').hide(),isenabled=ajaxreturn.value,'1'===isenabled?($(this).closest('tr').removeClass('dimmed_text'),collid=$(this).closest('tr').find('[data-itemtype="tagareacollection"]').attr('data-value'),$('.tag-collections-table ul[data-collectionid='+collid+'] li[data-areaid='+areaid+']').show()):$(this).closest('tr').addClass('dimmed_text')),'core_tag'===ajaxreturn.component&&'tagareacollection'===ajaxreturn.itemtype&&(areaid=$(this).attr('data-itemid'),$('.tag-collections-table ul[data-collectionid] li[data-areaid='+areaid+']').hide(),collid=$(this).attr('data-value'),isenabled=$(this).closest('tr').find('[data-itemtype="tagareaenable"]').attr('data-value'),'1'===isenabled&&$('.tag-collections-table ul[data-collectionid='+collid+'] li[data-areaid='+areaid+']').show())}),$('body').on('click','.addtagcoll > a',function(e){e.preventDefault();var href=$(this).attr('data-url')+'&sesskey='+M.cfg.sesskey;str.get_strings([{key:'addtagcoll',component:'tag'},{key:'name'},{key:'searchable',component:'tag'},{key:'create'},{key:'cancel'}]).done(function(s){var el=$('<div><form id="addtagcoll_form" class="form-inline"><p><label for="addtagcoll_name"></label>: <input id="addtagcoll_name" type="text"/></p><p><label for="addtagcoll_searchable"></label>: <input id="addtagcoll_searchable" type="checkbox" value="1" checked/></p><p class="mdl-align"><input type="submit" class="btn btn-primary" id="addtagcoll_submit"/><input type="button" class="btn btn-secondary" id="addtagcoll_cancel"/></p></form></div>');el.find('label[for="addtagcoll_name"]').html(s[1]),el.find('label[for="addtagcoll_searchable"]').html(s[2]),el.find('#addtagcoll_submit').attr('value',s[3]),el.find('#addtagcoll_cancel').attr('value',s[4]),Y.use('moodle-core-notification-dialogue',function(){var panel=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:s[0],bodyContent:el.html()});panel.show(),$('#addtagcoll_form #addtagcoll_name').focus(),$('#addtagcoll_form #addtagcoll_cancel').on('click',function(){panel.destroy()}),$('#addtagcoll_form').on('submit',function(){var name=$('#addtagcoll_form #addtagcoll_name').val(),searchable=$('#addtagcoll_form #addtagcoll_searchable').prop('checked')?1:0;return 0<(name+'').length&&(window.location.href=href+'&name='+encodeURIComponent(name)+'&searchable='+searchable),!1})})})}),$('body').on('click','.tag-collections-table .action_delete',function(e){e.preventDefault();var href=$(this).attr('data-url')+'&sesskey='+M.cfg.sesskey;str.get_strings([{key:'delete'},{key:'suredeletecoll',component:'tag',param:$(this).attr('data-collname')},{key:'yes'},{key:'no'}]).done(function(s){notification.confirm(s[0],s[1],s[2],s[3],function(){window.location.href=href})})})}}});
//# sourceMappingURL=tag.min.js.map
