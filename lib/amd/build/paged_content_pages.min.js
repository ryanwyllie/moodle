define(["jquery","core/templates","core/notification","core/paged_content_events"],function(a,b,c,d){var e={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},f={PAGING_CONTENT_ITEM:"core/paged_content_page",LOADING:"core/overlay_loading"},g=300,h=function(a,b){return a.find('[data-page="'+b+'"]')},i=function(d){var e=a.Deferred();return d.attr("aria-busy",!0),b.render(f.LOADING,{visible:!0}).then(function(b){var c=a(b),f=setTimeout(function(){d.css("position","relative"),c.appendTo(d)},g);e.always(function(){clearTimeout(f),c.remove(),d.css("position",""),d.removeAttr("aria-busy")})}).fail(c.exception),e},j=function(d,e,g){var i=a.Deferred();return e.then(function(a,e){e=e||"",b.render(f.PAGING_CONTENT_ITEM,{page:g,content:a}).then(function(a){b.appendNodeContents(d,a,e);var c=h(d,g);i.resolve(c)}).fail(function(a){i.reject(a)}).fail(c.exception)}).fail(function(a){i.reject(a)}).fail(c.exception),i.promise()},k=function(b,f,g,k){var l=[],m=[],n=a.Deferred();if(f.forEach(function(a){var c=a.pageNumber,d=h(b,c);d.length?l.push(d):m.push(a)}),m.length&&"function"==typeof k){var o=k(m,{allItemsLoaded:function(a){g.publish(d.ALL_ITEMS_LOADED,a)}}),p=o.map(function(a,c){return j(b,a,m[c].pageNumber)});a.when.apply(a,p).then(function(){var a=Array.prototype.slice.call(arguments);n.resolve(a)}).fail(function(a){n.reject(a)}).fail(c.exception)}else n.resolve([]);var q=i(b);n.then(function(a){var c=l.concat(a);b.find(e.PAGE_REGION).addClass("hidden"),c.forEach(function(a){a.removeClass("hidden")})}).then(function(){g.publish(d.PAGES_SHOWN,f)}).fail(c.exception).always(function(){q.resolve()})},l=function(b,c,e){b=a(b),c.subscribe(d.SHOW_PAGES,function(a){k(b,a,c,e)}),c.subscribe(d.SET_ITEMS_PER_PAGE_LIMIT,function(){b.empty()})};return{init:l,rootSelector:e.ROOT}});