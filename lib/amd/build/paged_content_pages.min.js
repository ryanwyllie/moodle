'use strict';define('core/paged_content_pages',['jquery','core/templates','core/notification','core/paged_content_events'],function($,Templates,Notification,PagedContentEvents){var SELECTORS={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},TEMPLATES={PAGING_CONTENT_ITEM:'core/paged_content_page',LOADING:'core/overlay_loading'},findPage=function(root,pageNumber){return root.find('[data-page="'+pageNumber+'"]')},startLoading=function(root){var deferred=$.Deferred();return Templates.render(TEMPLATES.LOADING,{visible:!0}).then(function(html){var loadingSpinner=$(html),timerId=setTimeout(function(){root.css('position','relative'),loadingSpinner.appendTo(root)},100);deferred.always(function(){return clearTimeout(timerId),loadingSpinner.remove(),void root.css('position','')})}).fail(Notification.exception),deferred},renderPagePromise=function(root,pagePromise,pageNumber){var deferred=$.Deferred();return pagePromise.then(function(html,pageJS){Templates.render(TEMPLATES.PAGING_CONTENT_ITEM,{page:pageNumber,content:html}).then(function(html){Templates.appendNodeContents(root,html,pageJS);var page=findPage(root,pageNumber);deferred.resolve(page)}).fail(function(exception){deferred.reject(exception)}).fail(Notification.exception)}).fail(function(exception){deferred.reject(exception)}).fail(Notification.exception),deferred},showPages=function(root,pagesData,renderPagesContentCallback){var existingPages=[],newPageData=[],newPagesPromise=$.Deferred();if(pagesData.forEach(function(pageData){var pageNumber=pageData.pageNumber,existingPage=findPage(root,pageNumber);existingPage.length?existingPages.push(existingPage):newPageData.push(pageData)}),newPageData.length&&'function'==typeof renderPagesContentCallback){var promises=renderPagesContentCallback(newPageData),renderPagePromises=promises.map(function(promise,index){return renderPagePromise(root,promise,newPageData[index].pageNumber)});$.when.apply($,renderPagePromises).then(function(){var newPages=Array.prototype.slice.call(arguments);newPagesPromise.resolve(newPages)}).fail(function(exception){newPagesPromise.reject(exception)}).fail(Notification.exception)}else newPagesPromise.resolve([]);var loadingPromise=startLoading(root);newPagesPromise.then(function(newPages){var pagesToShow=existingPages.concat(newPages);return root.find(SELECTORS.PAGE_REGION).addClass('hidden'),void pagesToShow.forEach(function(page){page.removeClass('hidden')})}).fail(Notification.exception).always(function(){loadingPromise.resolve()})};return{init:function init(root,eventElement,renderPagesContentCallback){root=$(root),eventElement=$(eventElement),eventElement.on(PagedContentEvents.SHOW_PAGES,function(e,pagesData){showPages(root,pagesData,renderPagesContentCallback)})},rootSelector:SELECTORS.ROOT}});
//# sourceMappingURL=paged_content_pages.min.js.map
