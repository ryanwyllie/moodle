define(["jquery","core/ajax","core/sessionstorage"],function(a,b,c){var d={},e=function(a){return"core_user_date/"+a.timestamp+"/"+a.format},f=function(a){return c.get(a)},g=function(a,b){c.set(a,b)},h=function(a){return"undefined"!=typeof d[a]},i=function(a){return d[a]},j=function(a,b){d[a]=b},k=function(a){var c=a.map(function(a){return{timestamp:a.timestamp,format:a.format}}),d={methodname:"core_get_user_dates",args:{timestamps:c}};return b.call([d],!0,!0)[0].then(function(b){b.dates.forEach(function(b,c){var d=a[c],f=e(d);g(f,b),d.deferred.resolve(b)})}).fail(function(b){a.forEach(function(a){a.deferred.reject(b)})})},l=function(b){var c=[],d=[];return b.forEach(function(b){var g=e(b);if(h(g))d.push(i(g));else{var k=a.Deferred(),l=f(g);l?k.resolve(l):(b.deferred=k,c.push(b)),j(g,k.promise()),d.push(k.promise())}}),c.length&&k(c),a.when.apply(a,d).then(function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)})};return{get:function(b){return l(a.isArray(b)?b:[b])}}});