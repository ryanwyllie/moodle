define ("core/ajax",["jquery","core/config","core/log","core/url"],function(a,b,c,d){var e=!1,f=function(a){var b=this,c=null,e=0,f,g,h;if(a.error){for(;e<b.length;e++){f=b[e];f.deferred.reject(a)}return}for(e=0;e<b.length;e++){f=b[e];g=a[e];if("undefined"!=typeof g){if(!1===g.error){f.deferred.resolve(g.data)}else{c=g.exception;h=b[e].nosessionupdate;break}}else{c=new Error("missing response");break}}if(null!==c){if("servicerequireslogin"===c.errorcode&&!h){window.location=d.relativeUrl("/login/index.php")}else{b.forEach(function(a){a.deferred.reject(c)})}}},g=function(a,b,d){var f=this,g=0;for(g=0;g<f.length;g++){var h=f[g];if(e){c.error("Page unloaded.");c.error(d)}else{h.deferred.reject(d)}}};return{call:function call(c,d,h,j,k){a(window).bind("beforeunload",function(){e=!0});var l=[],m,n=[],o=[],p="";if("undefined"==typeof h){h=!0}if("undefined"==typeof d){d=!0}if("undefined"==typeof k){k=0}if("undefined"==typeof j){j=!1}for(m=0;m<c.length;m++){var q=c[m];l.push({index:m,methodname:q.methodname,args:q.args});q.nosessionupdate=j;q.deferred=a.Deferred();n.push(q.deferred.promise());if("undefined"!=typeof q.done){q.deferred.done(q.done)}if("undefined"!=typeof q.fail){q.deferred.fail(q.fail)}q.index=m;o.push(q.methodname)}if(5>=o.length){p=o.sort().join()}else{p=o.length+"-method-calls"}l=JSON.stringify(l);var r={type:"POST",data:l,context:c,dataType:"json",processData:!1,async:d,contentType:"application/json",timeout:k},s="service.php";if(!h){s="service-nologin.php"}var t=b.wwwroot+"/lib/ajax/"+s+"?sesskey="+b.sesskey+"&info="+p;if(j){t+="&nosessionupdate=true"}if(d){a.ajax(t,r).done(f).fail(g)}else{r.success=f;r.error=g;a.ajax(t,r)}return n}}});
//# sourceMappingURL=ajax.min.js.map
