'use strict';define('core/ajax',['jquery','core/config','core/log','core/url'],function($,config,Log,URL){var unloading=!1,requestSuccess=function(responses){var request,response,requests=this,exception=null,i=0;if(responses.error){for(;i<requests.length;i++)request=requests[i],request.deferred.reject(responses);return}for(i=0;i<requests.length;i++)if(request=requests[i],response=responses[i],'undefined'==typeof response){exception=new Error('missing response');break}else if(!1===response.error)request.deferred.resolve(response.data);else{exception=response.exception;break}if(null!==exception)if('servicerequireslogin'===exception.errorcode)window.location=URL.relativeUrl('/login/index.php');else for(;i<requests.length;i++)request=requests[i],request.deferred.reject(exception)},requestFail=function(jqXHR,textStatus,exception){var requests=this,i=0;for(i=0;i<requests.length;i++){var request=requests[i];unloading?(Log.error('Page unloaded.'),Log.error(exception)):request.deferred.reject(exception)}};return{call:function call(requests,async,loginrequired){$(window).bind('beforeunload',function(){unloading=!0});var i,ajaxRequestData=[],promises=[],methodInfo=[],requestInfo='';for('undefined'==typeof loginrequired&&(loginrequired=!0),'undefined'==typeof async&&(async=!0),i=0;i<requests.length;i++){var request=requests[i];ajaxRequestData.push({index:i,methodname:request.methodname,args:request.args}),request.deferred=$.Deferred(),promises.push(request.deferred.promise()),'undefined'!=typeof request.done&&request.deferred.done(request.done),'undefined'!=typeof request.fail&&request.deferred.fail(request.fail),request.index=i,methodInfo.push(request.methodname)}requestInfo=5>=methodInfo.length?methodInfo.sort().join():methodInfo.length+'-method-calls',ajaxRequestData=JSON.stringify(ajaxRequestData);var settings={type:'POST',data:ajaxRequestData,context:requests,dataType:'json',processData:!1,async:async,contentType:'application/json'},script='service.php';loginrequired||(script='service-nologin.php');var url=config.wwwroot+'/lib/ajax/'+script+'?sesskey='+config.sesskey+'&info='+requestInfo;return async?$.ajax(url,settings).done(requestSuccess).fail(requestFail):(settings.success=requestSuccess,settings.error=requestFail,$.ajax(url,settings)),promises}}});
//# sourceMappingURL=ajax.min.js.map
