define ("core/str",["jquery","core/ajax","core/localstorage"],function(a,b,c){var d=[];return{get_string:function get_string(a,b,c,d){var e=this.get_strings([{key:a,component:b,param:c,lang:d}]);return e.then(function(a){return a[0]})},get_strings:function get_strings(e){var f=a.Deferred(),g=[],h=0,j=!1,k;for(h=0;h<e.length;h++){k=e[h];if("undefined"==typeof k.lang){k.lang=a("html").attr("lang").replace(/-/g,"_")}k.cacheKey="core_str/"+k.key+"/"+k.component+"/"+k.lang;if("undefined"==typeof M.str[k.component]||"undefined"==typeof M.str[k.component][k.key]){var l=c.get(k.cacheKey);if(l){if("undefined"==typeof M.str[k.component]){M.str[k.component]=[]}M.str[k.component][k.key]=l}else{j=!0}}}if(!j){for(h=0;h<e.length;h++){k=e[h];g[h]=M.util.get_string(k.key,k.component,k.param)}f.resolve(g)}else{var m=[],n=[],o=function(a){this.resolve(a)},p=function(a){this.reject(a)};for(h=0;h<e.length;h++){k=e[h];if("undefined"!=typeof d[k.cacheKey]){n.push(d[k.cacheKey])}else{var q=a.Deferred();m.push({methodname:"core_get_string",args:{stringid:k.key,component:k.component,lang:k.lang,stringparams:[]},done:o.bind(q),fail:p.bind(q)});d[k.cacheKey]=q.promise();n.push(d[k.cacheKey])}}if(0<m.length){b.call(m,!0,!1,!1,0,M.cfg.langrev)}a.when.apply(null,n).done(function(){var a=0;for(a=0;a<arguments.length;a++){k=e[a];if("undefined"==typeof M.str[k.component]){M.str[k.component]=[]}M.str[k.component][k.key]=arguments[a];c.set("core_str/"+k.key+"/"+k.component+"/"+k.lang,arguments[a]);g[a]=M.util.get_string(k.key,k.component,k.param).trim()}f.resolve(g)}).fail(function(a){f.reject(a)})}return f.promise()},cache_strings:function cache_strings(b){var e=a("html").attr("lang").replace(/-/g,"_");b.forEach(function(b){var f=!(f in b)?e:b.lang,g=b.key,h=b.component,i=b.value,j=["core_str",g,h,f].join("/");if(!(h in M.str)||!(g in M.str[h])){if(!(h in M.str)){M.str[h]={}}M.str[h][g]=i}if(!c.get(j)){c.set(j,i)}if(!(j in d)){d[j]=a.Deferred().resolve(i).promise()}})}}});
//# sourceMappingURL=str.min.js.map
