define('core/str',['exports','jquery','core/ajax','core/localstorage'],function(exports,_jquery,_ajax,_localstorage){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,'__esModule',{value:!0}),exports.get_strings=exports.get_string=void 0;var _jquery2=_interopRequireDefault(_jquery),_ajax2=_interopRequireDefault(_ajax),_localstorage2=_interopRequireDefault(_localstorage),_extends=Object.assign||function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i],source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target},promiseCache=[],get_string=exports.get_string=function(key,component,param,lang){return get_strings([{key:key,component:component,param:param,lang:lang}]).then(function(results){return results[0]})},get_strings=exports.get_strings=function(requests){var requestData=[],pageLang=(0,_jquery2.default)('html').attr('lang').replace(/-/g,'_'),getCacheKey=function(_ref){var key=_ref.key,component=_ref.component,_ref$lang=_ref.lang,lang=void 0===_ref$lang?pageLang:_ref$lang;return'core_str/'+key+'/'+component+'/'+lang},stringPromises=requests.map(function(request){var cacheKey=getCacheKey(request),component=request.component,key=request.key,lang=request.lang,buildReturn=function(promise){return promiseCache[cacheKey]=promise,promise};if(component in M.str&&key in M.str[component])return buildReturn(new Promise(function(resolve){resolve(M.str[component][key])}));var cached=_localstorage2.default.get(cacheKey);return cached?(M.str[component]=_extends({},M.str[component],_defineProperty({},key,cached)),buildReturn(new Promise(function(resolve){resolve(M.str[component][key])}))):cacheKey in promiseCache?buildReturn(promiseCache[cacheKey]):buildReturn(new Promise(function(resolve,reject){requestData.push({methodname:'core_get_string',args:{stringid:key,stringparams:[],component:component,lang:lang},done:function done(str){M.str[component]=_extends({},M.str[component],_defineProperty({},key,str)),_localstorage2.default.set(cacheKey,str),resolve(str)},fail:reject})}))});return requestData.length&&_ajax2.default.call(requestData,!0,!1),_jquery2.default.when.apply(_jquery2.default,stringPromises).then(function(){for(var _len=arguments.length,strings=Array(_len),_key=0;_key<_len;_key++)strings[_key]=arguments[_key];return strings})}});
//# sourceMappingURL=str.min.js.map
