{"version":3,"sources":["../src/checkbox-toggleall.js"],"names":["define","$","PubSub","registered","events","checkboxToggled","getAllCheckboxes","root","toggleGroup","find","getAllSlaveCheckboxes","filter","getControlCheckboxes","toggleSlavesFromMasters","e","data","target","toggleGroupName","targetState","is","slaves","checkedSlaves","setMasterStates","prop","publish","anyChecked","toggleMastersFromSlaves","length","masters","each","i","masterCheckbox","masterLabel","attr","targetString","html","registerListeners","document","body","on","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A module to help with toggle select/deselect all.\n *\n * @module     core/checkbox-toggleall\n * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/pubsub'], function($, PubSub) {\n\n    var registered = false;\n\n    var events = {\n        checkboxToggled: 'core/checkbox-toggleall:checkboxToggled',\n    };\n\n    var getAllCheckboxes = function(root, toggleGroup) {\n        return root.find('[data-action=\"toggle\"][data-togglegroup=\"' + toggleGroup + '\"]');\n    };\n\n    var getAllSlaveCheckboxes = function(root, toggleGroup) {\n        return getAllCheckboxes(root, toggleGroup).filter('[data-toggle=\"slave\"]');\n    };\n\n    var getControlCheckboxes = function(root, toggleGroup) {\n        return getAllCheckboxes(root, toggleGroup).filter('[data-toggle=\"master\"]');\n    };\n\n    var toggleSlavesFromMasters = function(e) {\n        var root = e.data.root;\n        var target = $(e.target);\n\n        var toggleGroupName = target.data('togglegroup');\n        var targetState = target.is(':checked');\n\n        var slaves = getAllSlaveCheckboxes(root, toggleGroupName);\n        var checkedSlaves = slaves.filter(':checked');\n\n        setMasterStates(root, toggleGroupName, targetState);\n\n        // Set the slave checkboxes from the masters.\n        slaves.prop('checked', targetState);\n\n        PubSub.publish(events.checkboxToggled, {\n            root: root,\n            toggleGroupName: toggleGroupName,\n            slaves: slaves,\n            checkedSlaves: checkedSlaves,\n            anyChecked: targetState,\n        });\n    };\n\n    var toggleMastersFromSlaves = function(e) {\n        var root = e.data.root;\n        var target = $(e.target);\n\n        var toggleGroupName = target.data('togglegroup');\n\n        var slaves = getAllSlaveCheckboxes(root, toggleGroupName);\n        var checkedSlaves = slaves.filter(':checked');\n        var targetState = (slaves.length === checkedSlaves.length);\n\n        setMasterStates(root, toggleGroupName, targetState);\n\n        PubSub.publish(events.checkboxToggled, {\n            root: root,\n            toggleGroupName: toggleGroupName,\n            slaves: slaves,\n            checkedSlaves: checkedSlaves,\n            anyChecked: !!checkedSlaves.length,\n        });\n    };\n\n    var setMasterStates = function(root, toggleGroupName, targetState) {\n        // Set the master checkboxes value and ARIA labels..\n        var masters = getControlCheckboxes(root, toggleGroupName);\n        masters.prop('checked', targetState);\n        masters.each(function(i, masterCheckbox) {\n            masterCheckbox = $(masterCheckbox);\n            var masterLabel = root.find('[for=\"' + masterCheckbox.attr('id') + '\"]');\n            var targetString;\n            if (masterLabel.length) {\n                if (targetState) {\n                    targetString = masterCheckbox.data('toggle-deselectall');\n                } else {\n                    targetString = masterCheckbox.data('toggle-selectall');\n                }\n\n                if (masterLabel.html() !== targetString) {\n                    masterLabel.html(targetString);\n                }\n            }\n        });\n    };\n\n    var registerListeners = function() {\n        if (!registered) {\n            registered = true;\n\n            var root = $(document.body);\n            root.on('change', '[data-action=\"toggle\"][data-toggle=\"master\"]', {root: root}, toggleSlavesFromMasters);\n            root.on('change', '[data-action=\"toggle\"][data-toggle=\"slave\"]', {root: root}, toggleMastersFromSlaves);\n        }\n    };\n\n    return {\n        init: function() {\n            registerListeners();\n        },\n        events: events,\n    };\n});\n"],"file":"checkbox-toggleall.min.js"}