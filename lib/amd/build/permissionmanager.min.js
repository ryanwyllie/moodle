define("core/permissionmanager",["jquery","core/config","core/notification","core/templates","core/yui"],function(a,b,c,d,e){var f={ADDROLE:"a.allowlink, a.prohibitlink",REMOVEROLE:"a.preventlink, a.unprohibitlink",UNPROHIBIT:"a.unprohibitlink"},g=a.Event("rolesloaded"),h,j,i,k,l=null,m=function loadOverideableRoles(){var d={contextid:h,getroles:1,sesskey:b.sesskey};a.post(i+"roles/ajax.php",d,null,"json").done(function(b){try{k=b;m=function loadOverideableRoles(){a("body").trigger(g)};m()}catch(a){c.exception(a)}}).fail(function(a,b,d){c.exception(d)})},n=function(b,e,f){var g={contextid:h,roleid:e,sesskey:M.cfg.sesskey,action:f,capability:b.data("name")};a.post(i+"roles/ajax.php",g,null,"json").done(function(f){var g=f;try{var h={rolename:k[e],roleid:e,adminurl:i,imageurl:M.util.image_url("t/delete","moodle")};switch(g){case"allow":h.spanclass="allowed";h.linkclass="preventlink";h.action="prevent";h.icon="t/delete";h.iconalt=M.util.get_string("deletexrole","core_role",k[e]);break;case"prohibit":h.spanclass="forbidden";h.linkclass="unprohibitlink";h.action="unprohibit";h.icon="t/delete";h.iconalt=M.util.get_string("deletexrole","core_role",k[e]);break;case"prevent":b.find("a[data-role-id=\""+e+"\"]").first().closest(".allowed").remove();return;case"unprohibit":b.find("a[data-role-id=\""+e+"\"]").first().closest(".forbidden").remove();return;default:return;}d.render("core/permissionmanager_role",h).done(function(c){if("allow"==g){a(c).insertBefore(b.find(".allowmore:first"))}else if("prohibit"==g){a(c).insertBefore(b.find(".prohibitmore:first"));var d=b.find(".allowedroles").first().find("a[data-role-id=\""+e+"\"]");if(d){d.first().closest(".allowed").remove()}}l.hide()}).fail(c.exception)}catch(a){c.exception(a)}}).fail(function(a,b,d){c.exception(d)})},o=function(b){b.preventDefault();var g=a(b.currentTarget);a("body").one("rolesloaded",function(){e.use("moodle-core-notification-dialogue",function(){var b=g.data("action"),h=g.closest("tr.rolecap"),e={cap:h.data("humanname"),context:j},m=M.util.get_string("role"+b+"info","core_role",e);if(null===l){l=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})}l.set("headerContent",M.util.get_string("role"+b+"header","core_role"));var o,p,q=[];switch(b){case"allow":p=h.find(f.REMOVEROLE);break;case"prohibit":p=h.find(f.UNPROHIBIT);break;}for(o in k){var r="",s=p.filter("[data-role-id='"+o+"']").length;if(s){r="disabled"}var t={roleid:o,rolename:k[o],disabled:r};q.push(t)}d.render("core/permissionmanager_panelcontent",{message:m,roles:q}).done(function(c){l.set("bodyContent",c);l.show();a("div.role_buttons").on("click","input",function(c){var d=a(c.currentTarget).data("role-id");n(h,d,b)})}).fail(c.exception)})});m()},p=function(b){b.preventDefault();var d=a(b.currentTarget);a("body").one("rolesloaded",function(){var a=d.data("action"),b=d.data("role-id"),e=d.closest("tr.rolecap"),f={role:k[b],cap:e.data("humanname"),context:j};c.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+a,"core_role",f),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),function(){n(e,b,a)})});m()};return{initialize:function initialize(b){h=b.contextid;j=b.contextname;i=b.adminurl;var c=a("body");c.on("click",f.ADDROLE,o);c.on("click",f.REMOVEROLE,p)}}});
//# sourceMappingURL=permissionmanager.min.js.map
