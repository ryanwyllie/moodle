{"version":3,"sources":["../src/paged_content_paging_dropdown.js"],"names":["define","$","CustomEvents","PagedContentEvents","SELECTORS","ROOT","DROPDOWN_ITEM","DROPDOWN_TOGGLE","ACTIVE_DROPDOWN_ITEM","CARET","getPageNumber","item","parseInt","attr","getAllItems","root","find","getPreviousItems","pageNumber","filter","index","element","getLimit","getOffset","offset","each","prevItem","getActiveItem","generateEventPayload","items","map","limit","get","generatePageNumbers","setActiveItem","prevItems","allItems","add","eventPayload","toggle","caret","removeClass","addClass","html","text","append","trigger","SHOW_PAGES","init","activeItem","length","events","activate","on","e","data","target","closest","originalEvent","preventDefault","rootSelector"],"mappings":"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","file":"paged_content_paging_dropdown.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to manage the paging dropdown control.\n *\n * @module     core/paged_content_paging_dropdown\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'core/paged_content_events'\n    ],\n    function(\n        $,\n        CustomEvents,\n        PagedContentEvents\n    ) {\n\n    var SELECTORS = {\n        ROOT: '[data-region=\"paging-dropdown-container\"]',\n        DROPDOWN_ITEM: '[data-region=\"dropdown-item\"]',\n        DROPDOWN_TOGGLE: '[data-region=\"dropdown-toggle\"]',\n        ACTIVE_DROPDOWN_ITEM: '[data-region=\"dropdown-item\"].active',\n        CARET: '[data-region=\"caret\"]'\n    };\n\n    /**\n     * Get the page number.\n     *\n     * @param {jquery} item The dropdown item.\n     * @returns {int}\n     */\n    var getPageNumber = function(item) {\n        return parseInt(item.attr('data-page-number'), 10);\n    };\n\n    /**\n     * Get all paging dropdown items.\n     *\n     * @param {jquery} root The root element.\n     * @returns {jquery} A jquery object with all items.\n     */\n    var getAllItems = function(root) {\n        return root.find(SELECTORS.DROPDOWN_ITEM);\n    };\n\n    /**\n     * Get all paging dropdown items with lower page numbers than the given\n     * dropdown item.\n     *\n     * @param {jquery} root The root element.\n     * @param {jquery} item The dropdown item.\n     * @returns {jquery} A jquery object with all items.\n     */\n    var getPreviousItems = function(root, item) {\n        var pageNumber = getPageNumber(item);\n        return getAllItems(root).filter(function(index, element) {\n            return getPageNumber($(element)) < pageNumber;\n        });\n    };\n\n    /**\n     * Get the number of items to be loaded for the dropdown item.\n     *\n     * @param {jquery} item The dropdown item.\n     * @returns {int}\n     */\n    var getLimit = function(item) {\n        return parseInt(item.attr('data-item-count'), 10);\n    };\n\n    /**\n     * Get the offset of items from the start of the itemset for the given\n     * dropdown item.\n     *\n     * @param {jquery} root The root element.\n     * @param {jquery} item The dropdown item.\n     * @returns {int}\n     */\n    var getOffset = function(root, item) {\n        if (item.attr('data-offset') != undefined) {\n            return parseInt(item.attr('data-offset'), 10);\n        }\n\n        var offset = 0;\n\n        getPreviousItems(root, item).each(function(index, prevItem) {\n            prevItem = $(prevItem);\n            offset += getLimit(prevItem);\n        });\n\n        item.attr('data-offset', offset);\n        return offset;\n    };\n\n    /**\n     * Get the active dropdown item.\n     *\n     * @param {jquery} root The root element.\n     * @returns {jquery} The active dropdown item.\n     */\n    var getActiveItem = function(root) {\n        return root.find(SELECTORS.ACTIVE_DROPDOWN_ITEM);\n    };\n\n    /**\n     * Create the event payload for the list of dropdown items. The event payload\n     * is an array of objects with one object per dropdown item.\n     *\n     * Each payload object contains the page number, limit, and offset for the\n     * corresponding dropdown item.\n     *\n     * For example: If we had 3 dropdown items with incrementing page numbers loading\n     * 25 items per page then the generated payload would look like:\n     * [\n     *      {\n     *          pageNumber: 1,\n     *          limit: 25,\n     *          offset: 0\n     *      },\n     *      {\n     *          pageNumber: 2,\n     *          limit: 25,\n     *          offset: 25\n     *      },\n     *      {\n     *          pageNumber: 3,\n     *          limit: 25,\n     *          offset: 50\n     *      }\n     * ]\n     *\n     * @param {jquery} root The root element.\n     * @param {jquery} items The dropdown items.\n     * @returns {object[]} The payload for the event.\n     */\n    var generateEventPayload = function(root, items) {\n        return items.map(function(index, item) {\n            item = $(item);\n            return {\n                pageNumber: getPageNumber(item),\n                limit: getLimit(item),\n                offset: getOffset(root, item),\n            };\n        }).get();\n    };\n\n    /**\n     * Add page number attributes to each of the given items. The page numbers\n     * start at 1 and increment by 1 for each item, e.g. 1, 2, 3 etc.\n     *\n     * @param {jquery} items The dropdown items.\n     */\n    var generatePageNumbers = function(items) {\n        items.each(function(index, item) {\n            item = $(item);\n            item.attr('data-page-number', index + 1);\n        });\n    };\n\n    /**\n     * Make the given item active by setting the active class on it and firing\n     * the SHOW_PAGES event for the paged content to show the appropriate\n     * pages.\n     *\n     * @param {jquery} root The root element.\n     * @param {jquery} item The dropdown item.\n     */\n    var setActiveItem = function(root, item) {\n        var prevItems = getPreviousItems(root, item);\n        var allItems = prevItems.add(item);\n        var eventPayload = generateEventPayload(root, allItems);\n        var toggle = root.find(SELECTORS.DROPDOWN_TOGGLE);\n        var caret = toggle.find(SELECTORS.CARET);\n\n        getActiveItem(root).removeClass('active');\n        item.addClass('active');\n\n        // Update the dropdown toggle to show which item is selected.\n        toggle.html(item.text());\n        // Bootstrap 2 compatibility.\n        toggle.append(caret);\n        // Fire the event to tell the content to update.\n        root.trigger(PagedContentEvents.SHOW_PAGES, [eventPayload]);\n    };\n\n    /**\n     * Initialise the module by firing the SHOW_PAGES event for an existing\n     * active page found and setting up the event listener for the user to select\n     * new pages.\n     *\n     * @param {object} root The root element.\n     */\n    var init = function(root) {\n        root = $(root);\n        var items = getAllItems(root);\n        generatePageNumbers(items);\n\n        var activeItem = getActiveItem(root);\n        if (activeItem.length) {\n            // Fire the first event for the content to make sure it's visible.\n            setActiveItem(root, activeItem);\n        }\n\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.DROPDOWN_ITEM, function(e, data) {\n            var item = $(e.target).closest(SELECTORS.DROPDOWN_ITEM);\n            setActiveItem(root, item);\n\n            data.originalEvent.preventDefault();\n        });\n    };\n\n    return {\n        init: init,\n        rootSelector: SELECTORS.ROOT,\n    };\n});\n"]}