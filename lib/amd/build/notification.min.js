'use strict';define('core/notification',['core/yui','jquery','core/log'],function(Y,$,log){var notificationModule={types:{success:'core/notification_success',info:'core/notification_info',warning:'core/notification_warning',error:'core/notification_error'},fieldName:'user-notifications',fetchNotifications:function fetchNotifications(){require(['core/ajax'],function(ajax){var promises=ajax.call([{methodname:'core_fetch_notifications',args:{contextid:notificationModule.contextid}}]);promises[0].done(notificationModule.addNotifications)})},addNotifications:function addNotifications(notifications){notifications||(notifications=[]),$.each(notifications,function(i,notification){notificationModule.renderNotification(notification.template,notification.variables)})},setupTargetRegion:function setupTargetRegion(){var targetRegion=$('#'+notificationModule.fieldName);if(targetRegion.length)return!1;var newRegion=$('<span>').attr('id',notificationModule.fieldName);return(targetRegion=$('#region-main'),targetRegion.length)?targetRegion.prepend(newRegion):(targetRegion=$('[role="main"]'),targetRegion.length)?targetRegion.prepend(newRegion):(targetRegion=$('body'),targetRegion.prepend(newRegion))},addNotification:function addNotification(notification){var template=notificationModule.types.error;return notification=$.extend({closebutton:!0,announce:!0,type:'error'},notification),notification.template?(template=notification.template,delete notification.template):notification.type&&('undefined'!=typeof notificationModule.types[notification.type]&&(template=notificationModule.types[notification.type]),delete notification.type),notificationModule.renderNotification(template,notification)},renderNotification:function renderNotification(template,variables){return'undefined'!=typeof variables.message&&variables.message?void require(['core/templates'],function(templates){templates.render(template,variables).done(function(html,js){$('#'+notificationModule.fieldName).prepend(html),templates.runTemplateJS(js)}).fail(notificationModule.exception)}):void log.debug('Notification received without content. Skipping.')},alert:function alert(title,message,yesLabel){Y.use('moodle-core-notification-alert',function(){var alert=new M.core.alert({title:title,message:message,yesLabel:yesLabel});alert.show()})},confirm:function confirm(title,question,yesLabel,noLabel,yesCallback,noCallback){Y.use('moodle-core-notification-confirm',function(){var modal=new M.core.confirm({title:title,question:question,yesLabel:yesLabel,noLabel:noLabel});modal.on('complete-yes',function(){yesCallback()}),noCallback&&modal.on('complete-no',function(){noCallback()}),modal.show()})},exception:function exception(ex){if('undefined'==typeof ex.stack&&(ex.stack=''),ex.debuginfo&&(ex.stack+=ex.debuginfo+'\n'),!ex.backtrace&&ex.stacktrace&&(ex.backtrace=ex.stacktrace),ex.backtrace){ex.stack+=ex.backtrace;var ln=ex.backtrace.match(/line ([^ ]*) of/),fn=ex.backtrace.match(/ of ([^:]*): /);ln&&ln[1]&&(ex.lineNumber=ln[1]),fn&&fn[1]&&(ex.fileName=fn[1],30<ex.fileName.length&&(ex.fileName='...'+ex.fileName.substr(ex.fileName.length-27)))}'undefined'==typeof ex.name&&ex.errorcode&&(ex.name=ex.errorcode),Y.use('moodle-core-notification-exception',function(){var modal=new M.core.exception(ex);modal.show()})}};return{init:function init(contextid,notifications){notificationModule.contextid=contextid,notificationModule.setupTargetRegion(),notificationModule.addNotifications(notifications),notificationModule.fetchNotifications()},fetchNotifications:notificationModule.fetchNotifications,addNotification:notificationModule.addNotification,alert:notificationModule.alert,confirm:notificationModule.confirm,exception:notificationModule.exception}});
//# sourceMappingURL=notification.min.js.map
